try{let t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},e=(new t.Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="d64f016f-28d7-4d02-9c3b-44a4a2d258aa",t._sentryDebugIdIdentifier="sentry-dbid-d64f016f-28d7-4d02-9c3b-44a4a2d258aa")}catch(e){}("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:{}).SENTRY_RELEASE={id:"f7a3b7576263fd8d05d0380dc061abc3dc8c58dc"};(self.webpackChunkbooqable=self.webpackChunkbooqable||[]).push([[611],{65821:function(t,e,i){"use strict";i.d(e,{A:function(){return p}});var n=i(96540),s=i(5556),o=i.n(s),a=i(2123),r=i(88267);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},l.apply(null,arguments)}class p extends n.Component{static displayName="HelpCenterLink";static propTypes=(()=>({href:o().string,children:o().oneOfType([o().node,o().string,o().array])}))();render(){const{children:t,href:e,...i}=this.props;return n.createElement(a.A,l({href:e,target:"_blank",rel:"noopener noreferrer","data-track-event":"Help center link clicked",onClick:r.Routing.navigateLink},i),0!==t.length&&n.createElement("span",null,t))}}p.displayName="HelpCenterLink"},27611:function(t,e,i){"use strict";i.d(e,{D0:function(){return y},ED:function(){return l.ED},lV:function(){return P},bn:function(){return C},Ay:function(){return O},ed:function(){return w}});var n=i(96540),s=i(5556),o=i.n(s),a=i(37584),r=i.n(a),l=i(7425),p=i(56449),c=i.n(p),d=i(58156),h=i.n(d),u=i(30872),m=i.n(u),f=i(73916),g=i.n(f),b=i(64251);var v=i(29121);class y extends n.Component{static displayName="Field";static propTypes=(()=>({component:o().any,name:o().any,validate:o().func}))();static defaultProps=(()=>({component:v.A}))();renderChild=(t,e)=>i=>{const{field:s,form:o}=i,a=Object.assign({},s);a.onChange=t=>{let i;i=t&&t.target?t.target.value:t,e.onChange?e.onChange(i):s.onChange({target:{value:i,name:s.name}}),e.handleChange&&(t.persist&&t.persist(),e.handleChange(t)),e.afterChange&&e.afterChange(i)};const r=h()(o.errors,e.errorKey||s.name),l=h()(o.touched,s.name),p=void 0===s.value||null===s.value;e.defaultValue&&p&&!l&&!o.dirty&&(o.setFieldTouched(s.name,!0),o.setFieldValue(s.name,e.defaultValue));return(0,n.createElement)(t,{...e,field:a,form:o,error:r,touched:l})};render(){const{component:t,name:e,validate:i,...s}=this.props;return n.createElement(l.D0,{name:e,validate:i},this.renderChild(t,s))}}y.displayName="Field";var k=i(33431);const _={dirty:s.bool.isRequired,handleBlur:s.func.isRequired,handleChange:s.func.isRequired,handleReset:s.func.isRequired,handleSubmit:s.func.isRequired,isSubmitting:s.bool.isRequired,isValid:s.bool.isRequired,isValidating:s.bool.isRequired,registerField:s.func.isRequired,resetForm:s.func.isRequired,setErrors:s.func.isRequired,setFieldError:s.func.isRequired,setFieldTouched:s.func.isRequired,setFormikState:s.func.isRequired,submitForm:s.func.isRequired,submitCount:s.number,setFieldValue:s.func.isRequired,setStatus:s.func.isRequired,setSubmitting:s.func.isRequired,setTouched:s.func.isRequired,setValues:s.func.isRequired,status:s.any,validateForm:s.func.isRequired,validateField:s.func.isRequired,initialValues:s.object.isRequired,validate:s.func,validateOnBlur:s.bool,validateOnChange:s.bool,validationSchema:(0,s.oneOfType)([s.object,s.func])},x={submitPromise:k.A},C=t=>{var e;return{..._,...(e=t,{errors:(0,s.shape)(g()(e,(()=>(0,s.oneOfType)([s.string,s.array])))).isRequired,touched:(0,s.shape)(g()(e,(()=>(0,s.oneOfType)([s.bool,s.array])))).isRequired,values:(0,s.shape)(g()(e,(()=>s.any))).isRequired}),...x}},w=t=>encodeURI(t).replaceAll(".","%2E");function A(){return A=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},A.apply(null,arguments)}const E=(t,e)=>{if(!t.replace)return[];const i=[];return t.replace(e,(function(){i.push(Array.prototype.slice.call(arguments,1,-2))})),i},T=(t,e,i,n)=>{const s=n[t],o=E(t,/\[(.*)\]/g)[0][0],a=t.split(".")[1];let r=E(t,/(.*)\[/g)[0][0];r=`${r}_attributes`,e[r]||(e[r]=[],i[r].forEach((()=>{e[r].push({})})));const l=e[r][o]||{};l[a]=s,e[r][o]=l},S=(t,e,i,n,s,o,a)=>t(i,n,s).then((t=>{e.handleReset(),o(!0),e.serverSuccess&&e.serverSuccess(i,t)}),(t=>{if(t instanceof Error&&!["Error","AxiosError"].includes(t.name))throw t;t.response&&(t=t.response.data),e.serverFailure&&e.serverFailure(i,t);const s={};if(t instanceof Array){if(t[0].code&&!h()(t[0],"source.pointer")){if(t[0].meta){for(const e in t[0])s[e]=t[0][e];console.log(s),n.setErrors(s)}return Promise.reject(t)}t=function(t){return t.reduce(((t,e)=>{const i=e.source?.pointer?.split("/").reverse()[0];return i?(t[i]||=[],t[i].push(e.meta.message)):(0,b.Cp)(new Error("Expected JSON:API error object to include .source.pointer but it was not found in: "+JSON.stringify(e))),t}),{})}(t)}if(t.errors&&(t=t.errors),c()(t))t.forEach((t=>{const i=h()(t,"source.pointer");if(!i)return;const n=i.replace("relationships/","").split("/").pop();if(s[n])return;let o;if(e.translations){const e=[];t.code&&e.push(`user.public_errors.${t.code}`),e.push(t.meta.message),o=a(e);o=m()(o,{interpolate:/%{([\s\S]+?)}/g})(t.meta)}else o=t.meta.message;s[n]=o}));else for(const e in t)e.code&&e.title||(0===E(e,/\[.*\]/g).length?s[e]=t[e]:T(e,s,i,t));return n.setErrors(s),Promise.reject(s)})),P=({children:t,onSubmit:e,noValidate:i})=>{const s={};return e&&(s.onSubmit=e),i&&(s.noValidate=i),n.createElement(l.lV,s,t,n.createElement("button",{type:"submit",style:{display:"none"}}))};P.displayName="Form",P.propTypes={children:o().node.isRequired,onSubmit:o().func,noValidate:o().bool};var O=(t={},e={})=>i=>class extends n.Component{static displayName=(()=>`withForm(${i.displayName})`)();static propTypes=(()=>({initialValues:o().any,handleSubmit:o().func,serverFailure:o().func,serverSuccess:o().func,validate:o().func,validationSchema:o().any,isInitialValid:o().oneOfType([o().bool,o().func]),resetForm:o().func,ignoreDirty:o().bool,enableReinitialize:o().bool,validateOnMount:o().bool,validateOnBlur:o().bool,validateOnChange:o().bool,initialTouched:o().object,t:o().func}))();constructor(t){super(t),this.state={id:r()(),submitPromise:null,enableReinitialize:!0}}componentDidMount=()=>{window.dirtyForms=window.dirtyForms||{},window.dirtyForms[this.state.id]=null};componentWillUnmount=()=>{window.dirtyForms&&delete window.dirtyForms[this.state.id]};setReinitialize=t=>{this.setState({enableReinitialize:t})};handleSubmit=(t,i)=>{const{initialValues:n,handleSubmit:s,serverFailure:o,serverSuccess:a}=this.props;this.setReinitialize(!1);const r=S(s,{serverSuccess:a,serverFailure:o,handleReset:this.handleReset,translations:e.translations},Object.assign({},t),i,n,this.setReinitialize,this.props.t);return this.setState({submitPromise:r}),r};handleReset=()=>{window.dirtyForms&&delete window.dirtyForms[this.state.id],this.setState({submitPromise:null})};renderForm=e=>(window.dirtyForms||(window.dirtyForms={}),window.dirtyForms&&!this.props.ignoreDirty&&void 0!==window.dirtyForms[this.state.id]&&window.dirtyForms[this.state.id]!==e.dirty&&(window.dirtyForms[this.state.id]=e.dirty),n.createElement(i,A({},this.props,e,t,{submitPromise:this.state.submitPromise})));computedFormOptions=()=>g()(t,(t=>t instanceof Function?t(this.props):t));render(){const{initialValues:t,validate:e,isInitialValid:i,validationSchema:s,enableReinitialize:o,validateOnMount:a,validateOnBlur:r,validateOnChange:p,initialTouched:c}=this.props;return n.createElement(l.l1,A({initialValues:t||{},isInitialValid:i,validationSchema:s,validate:e,onSubmit:this.handleSubmit,onReset:this.handleReset,enableReinitialize:void 0===o?this.state.enableReinitialize:o,validateOnMount:a,validateOnBlur:r,validateOnChange:p,initialTouched:c||{}},this.computedFormOptions()),(t=>this.renderForm(t)))}}},66675:function(t){var i;!function(){var n={settings:{},post:function(t){return new s("post",t)},get:function(t){return new s("get",t)},request:function(t,e){return new s(t,e)}},s=function(t,e){var i={method:t,url:"",before:function(){},success:function(){},error:function(){},data:!1,async:!0,headers:{}};this.p=this.extend(i,e),this.p=this.extend(this.p,n.settings),this.p.method=this.p.method.toUpperCase(),this.prepareData(),this.xhr=new XMLHttpRequest,this.xhr.open(this.p.method,this.p.url,this.p.async),this.setHeaders(),!1!==("function"!==typeof this.p.before||this.p.before(this.xhr))&&this.send()};s.prototype={extend:function(t,e){return e&&Object.keys(e).forEach((function(i){t[i]=e[i]})),t},prepareData:function(){if(-1===["POST","PUT"].indexOf(this.p.method)||this.isFormData()||(this.p.headers["Content-Type"]="application/x-www-form-urlencoded"),"object"!==typeof this.p.data||this.isFormData()||(this.p.data=this.toParams(this.p.data)),"GET"===this.p.method){var t=-1!==this.p.url.search(/\?/)?"&":"?";this.p.url=this.p.data?this.p.url+t+this.p.data:this.p.url}},setHeaders:function(){this.xhr.setRequestHeader("X-Requested-With",this.p.headers["X-Requested-With"]||"XMLHttpRequest"),Object.keys(this.p.headers).forEach(function(t){this.xhr.setRequestHeader(t,this.p.headers[t])}.bind(this))},isFormData:function(){return"undefined"!==typeof window.FormData&&this.p.data instanceof window.FormData},isComplete:function(){return!(this.xhr.status<200||this.xhr.status>=300&&304!==this.xhr.status)},send:function(){this.p.async?(this.xhr.onload=this.loaded.bind(this),this.xhr.send(this.p.data)):(this.xhr.send(this.p.data),this.loaded.call(this))},loaded:function(){var t;this.isComplete()?(t=this.parseResponse(),"function"===typeof this.p.success&&this.p.success(t,this.xhr)):(t=this.parseResponse(),"function"===typeof this.p.error&&this.p.error(t,this.xhr,this.xhr.status))},parseResponse:function(){var t=this.xhr.response,e=this.parseJson(t);return e||t},parseJson:function(t){try{var i=JSON.parse(t);if(i&&"object"===typeof i)return i}catch(e){return!1}return!1},toParams:function(t){return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")}};var o=[0],a="data"+(new Date).getTime(),r=function(t,e){return this.parse(t,e)};r.ready=function(t){document.addEventListener("DOMContentLoaded",t)},r.prototype={get length(){return this.nodes.length},parse:function(t,e){var i;if(t){if(t instanceof r)return this.nodes=t.nodes,t;i=/^\s*<(\w+|!)[^>]*>/.test(t)?this.create(t):"string"!==typeof t?t.nodeType&&11===t.nodeType?t.childNodes:t.nodeType||this._isWindowNode(t)?[t]:t:this._query(t,e)}else i=[];this.nodes=this._slice(i)},create:function(t){if(/^<(\w+)\s*\/?>(?:<\/\1>|)$/.test(t))return[document.createElement(RegExp.$1)];var e=[],i=document.createElement("div");i.innerHTML=t;for(var n=0,s=i.childNodes.length;n<s;n++)e.push(i.childNodes[n]);return e},dataset:function(t,e){return this.each((function(i){o[this.dataindex(i.get())][t]=e}))},dataget:function(t){return o[this.dataindex(this.get())][t]},dataindex:function(t){var e=t[a],i=o.length;return e||(e=i,t&&(t[a]=i),o[e]={}),e},add:function(t){return this.nodes=this.nodes.concat(this._array(t)),this},get:function(t){return this.nodes[t||0]||!1},getAll:function(){return this.nodes},eq:function(t){return new r(this.nodes[t])},first:function(){return new r(this.nodes[0])},last:function(){return new r(this.nodes[this.nodes.length-1])},contents:function(){return this.get().childNodes},each:function(t){for(var e=this.nodes.length,i=0;i<e;i++)t.call(this,new r(this.nodes[i]),i);return this},is:function(t){return this.filter(t).length>0},filter:function(t){var e;return void 0===t?this:(e="function"===typeof t?function(e){return t(new r(e))}:function(e){return t&&t.nodeType||t instanceof Node?t===e:(e.matches=e.matches||e.msMatchesSelector||e.webkitMatchesSelector,1===e.nodeType&&e.matches(t||"*"))},new r(this.nodes.filter.call(this.nodes,e)))},not:function(t){return this.filter((function(e){return!new r(e).is(t||!0)}))},find:function(t){var e=[];return this.each((function(i){for(var n=i.get(),s=this._query(t,n),o=0;o<s.length;o++)e.push(s[o])})),new r(e)},children:function(t){var e=[];return this.each((function(t){var i=t.get();if(i.children)for(var n=i.children,s=0;s<n.length;s++)e.push(n[s])})),new r(e).filter(t)},parent:function(t){var e=this.get(),i=!!e.parentNode&&e.parentNode;return i?new r(i).filter(t):new r},parents:function(t,e){e=this._context(e);var i=[];return this.each((function(n){for(var s=n.get().parentNode;s&&s!==e;)t?new r(s).is(t)&&i.push(s):i.push(s),s=s.parentNode})),new r(i)},closest:function(t,e){e=this._context(e);var i=[],n=t&&t.nodeType;return this.each((function(s){var o=s.get();do{if(o&&(n&&o===t||new r(o).is(t)))return i.push(o)}while((o=o.parentNode)&&o!==e)})),new r(i)},next:function(t){return this._sibling(t,"nextSibling")},nextElement:function(t){return this._sibling(t,"nextElementSibling")},prev:function(t){return this._sibling(t,"previousSibling")},prevElement:function(t){return this._sibling(t,"previousElementSibling")},css:function(t,e){if(void 0===e&&"object"!==typeof t){var i=this.get();return"width"===t||"height"===t?i.style?this._getHeightOrWidth(t)+"px":void 0:i.style?getComputedStyle(i,null)[t]:void 0}return this.each((function(i){var n=i.get(),s={};for(var o in"object"===typeof t?s=t:s[t]=e,s)n.style&&(n.style[o]=s[o])}))},attr:function(t,e,i){if(i=i?"data-":"","undefined"===typeof e&&"object"!==typeof t){var n=this.get();return n&&3!==n.nodeType?"checked"===t?n.checked:this._boolean(n.getAttribute(i+t)):void 0}return this.each((function(n){var s=n.get(),o={};for(var a in"object"===typeof t?o=t:o[t]=e,o)3!==s.nodeType&&("checked"===a?s.checked=o[a]:s.setAttribute(i+a,o[a]))}))},data:function(t,e){if(void 0===t||!0===t){var i=/^data-(.+)$/,n=this.get().attributes,s={},o=function(t){return t[1].toUpperCase()};for(var a in n)if(n[a]&&i.test(n[a].nodeName)){var r=n[a].nodeName.match(i)[1],l=n[a].value;!0!==t&&(r=r.replace(/-([a-z])/g,o)),l=-1!==l.search(/^{/)?this._object(l):this._number(l)?parseFloat(l):this._boolean(l),s[r]=l}return s}return this.attr(t,e,!0)},val:function(t){if(void 0===t){var e=this.get();return e.type&&"checkbox"===e.type?e.checked:e.value}return this.each((function(e){var i=e.get();i.type&&"checkbox"===i.type?i.checked=t:i.value=t}))},removeAttr:function(t){return this.each((function(e){var i=e.get();t.split(" ").forEach((function(t){3!==i.nodeType&&i.removeAttribute(t)}))}))},addClass:function(t){return this._eachClass(t,"add")},removeClass:function(t){return this._eachClass(t,"remove")},toggleClass:function(t){return this._eachClass(t,"toggle")},hasClass:function(t){var e=this.get();return!!e.classList&&e.classList.contains(t)},empty:function(){return this.each((function(t){t.get().innerHTML=""}))},html:function(t){return void 0===t?this.get().innerHTML||"":this.empty().append(t)},text:function(t){return void 0===t?this.get().textContent||"":this.each((function(e){e.get().textContent=t}))},after:function(t){return this._inject(t,(function(t,e){if("string"===typeof t)e.insertAdjacentHTML("afterend",t);else if(null!==e.parentNode)for(var i=t instanceof Node?[t]:this._array(t).reverse(),n=0;n<i.length;n++)e.parentNode.insertBefore(i[n],e.nextSibling);return e}))},before:function(t){return this._inject(t,(function(t,e){if("string"===typeof t)e.insertAdjacentHTML("beforebegin",t);else for(var i=t instanceof Node?[t]:this._array(t),n=0;n<i.length;n++)e.parentNode.insertBefore(i[n],e);return e}))},append:function(t){return this._inject(t,(function(t,e){if("string"===typeof t||"number"===typeof t)e.insertAdjacentHTML("beforeend",t);else for(var i=t instanceof Node?[t]:this._array(t),n=0;n<i.length;n++)e.appendChild(i[n]);return e}))},prepend:function(t){return this._inject(t,(function(t,e){if("string"===typeof t||"number"===typeof t)e.insertAdjacentHTML("afterbegin",t);else for(var i=t instanceof Node?[t]:this._array(t).reverse(),n=0;n<i.length;n++)e.insertBefore(i[n],e.firstChild);return e}))},wrap:function(t){return this._inject(t,(function(t,e){var i="string"===typeof t||"number"===typeof t?this.create(t)[0]:t instanceof Node?t:this._array(t)[0];return e.parentNode&&e.parentNode.insertBefore(i,e),i.appendChild(e),i}))},unwrap:function(){return this.each((function(t){for(var e=t.get(),i=document.createDocumentFragment();e.firstChild;){var n=e.removeChild(e.firstChild);i.appendChild(n)}e.parentNode.replaceChild(i,e)}))},replaceWith:function(t){return this._inject(t,(function(t,e){for(var i=document.createDocumentFragment(),n="string"===typeof t||"number"===typeof t?this.create(t):t instanceof Node?[t]:this._array(t),s=0;s<n.length;s++)i.appendChild(n[s]);var o=i.childNodes[0];return e.parentNode&&e.parentNode.replaceChild(i,e),o}))},remove:function(){return this.each((function(t){var e=t.get();e.parentNode&&e.parentNode.removeChild(e)}))},clone:function(t){var e=[];return this.each((function(i){var n=i.get(),s=this._clone(n);t&&(s=this._cloneEvents(n,s)),e.push(s)})),new r(e)},show:function(){return this.each(function(t){var e=t.get();if(e.style&&this._hasDisplayNone(e)){var i=e.getAttribute("domTargetShow");e.style.display=i||"block",e.removeAttribute("domTargetShow")}}.bind(this))},hide:function(){return this.each((function(t){var e=t.get();if(e.style&&!this._hasDisplayNone(e)){var i=e.style.display;"block"!==i&&e.setAttribute("domTargetShow",i),e.style.display="none"}}))},scrollTop:function(t){var e=this.get(),i=this._isWindowNode(e),n=9===e.nodeType?e.scrollingElement||e.body.parentNode||e.body||e.documentElement:e;return"undefined"!==typeof t?(t=parseInt(t),void(i?e.scrollTo(0,t):n.scrollTop=t)):i?e.pageYOffset:n.scrollTop},offset:function(){return this._getPos("offset")},position:function(){return this._getPos("position")},width:function(t){return void 0!==t?this.css("width",parseInt(t)+"px"):this._getSize("width","Width")},height:function(t){return void 0!==t?this.css("height",parseInt(t)+"px"):this._getSize("height","Height")},outerWidth:function(){return this._getSize("width","Width","outer")},outerHeight:function(){return this._getSize("height","Height","outer")},innerWidth:function(){return this._getSize("width","Width","inner")},innerHeight:function(){return this._getSize("height","Height","inner")},click:function(){return this._trigger("click")},focus:function(){return this._trigger("focus")},blur:function(){return this._trigger("blur")},on:function(t,e,i){return this.each((function(n){for(var s=n.get(),o=t.split(" "),a=0;a<o.length;a++){var r=this._getEventName(o[a]),l=this._getEventNamespace(o[a]);e=i?this._getOneHandler(e,t):e,s.addEventListener(r,e),s._e=s._e||{},s._e[l]=s._e[l]||{},s._e[l][r]=s._e[l][r]||[],s._e[l][r].push(e)}}))},one:function(t,e){return this.on(t,e,!0)},off:function(t,e){var i=function(t,e,i){return t===i},n=function(t,e,i,n){return e===n},s=function(t,e,i,n){return t===i&&e===n},o=function(){return!0};return void 0===t?this.each((function(t){this._offEvent(t.get(),!1,!1,e,o)})):this.each((function(o){for(var a=o.get(),r=t.split(" "),l=0;l<r.length;l++){var p=this._getEventName(r[l]),c=this._getEventNamespace(r[l]);"_events"===c?this._offEvent(a,p,c,e,i):p||"_events"===c?this._offEvent(a,p,c,e,s):this._offEvent(a,p,c,e,n)}}))},serialize:function(t){for(var e={},i=this.get().elements,n=0;n<i.length;n++){var s=i[n];if((!/(checkbox|radio)/.test(s.type)||s.checked)&&(s.name&&!s.disabled&&"file"!==s.type)){if("select-multiple"===s.type)for(var o=0;o<s.options.length;o++){var a=s.options[o];a.selected&&(e[s.name]=a.value)}e[s.name]=this._number(s.value)?parseFloat(s.value):this._boolean(s.value)}}return t?e:this._params(e)},scroll:function(){this.get().scrollIntoView({behavior:"smooth"})},fadeIn:function(t,e){var i=this._anim(t,e,500);return this.each((function(t){t.css({display:"block",opacity:0,animation:"fadeIn "+i.speed+"s ease-in-out"}).removeClass("hidden"),t.one("animationend",(function(){t.css({opacity:"",animation:""}),i.fn&&i.fn(t)}))}))},fadeOut:function(t,e){var i=this._anim(t,e,300);return this.each((function(t){t.css({opacity:1,animation:"fadeOut "+i.speed+"s ease-in-out"}),t.one("animationend",(function(){t.css({display:"none",opacity:"",animation:""}),i.fn&&i.fn(t)}))}))},slideUp:function(t,e){var i=this._anim(t,e,300);return this.each((function(t){t.height(t.height()),t.css({overflow:"hidden",animation:"slideUp "+i.speed+"s ease-out"}),t.one("animationend",(function(){t.css({display:"none",height:"",animation:""}),i.fn&&i.fn(t)}))}))},slideDown:function(t,e){var i=this._anim(t,e,400);return this.each((function(t){t.height(t.height()),t.css({display:"block",overflow:"hidden",animation:"slideDown "+i.speed+"s ease-in-out"}).removeClass("hidden"),t.one("animationend",(function(){t.css({overflow:"",height:"",animation:""}),i.fn&&i.fn(t)}))}))},_queryContext:function(t,e){return 3!==(e=this._context(e)).nodeType&&"function"===typeof e.querySelectorAll?e.querySelectorAll(t):[]},_query:function(t,e){var i=document;if(e)return this._queryContext(t,e);if(/^[.#]?[\w-]*$/.test(t)){if("#"===t[0]){var n=i.getElementById(t.slice(1));return n?[n]:[]}return"."===t[0]?i.getElementsByClassName(t.slice(1)):i.getElementsByTagName(t)}return i.querySelectorAll(t)},_context:function(t){return t?"string"===typeof t?document.querySelector(t):t:document},_sibling:function(t,e){var i,n=t&&t.nodeType;return this.each((function(s){var o=s.get();do{if((o=o[e])&&(n&&o===t||new r(o).is(t)))return void(i=o)}while(o)})),new r(i)},_slice:function(t){return t&&0!==t.length?t.length?[].slice.call(t.nodes||t):[t]:[]},_array:function(t){if(void 0===t)return[];if(t instanceof NodeList){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}return t instanceof r?t.nodes:t},_object:function(t){var e=t.replace(/(\w+:)|(\w+ :)/g,(function(t){return'"'+t.substring(0,t.length-1)+'":'}));return JSON.parse(e)},_params:function(t){var e="";return Object.keys(t).forEach(function(i){e+="&"+this._encodeUri(i)+"="+this._encodeUri(t[i])}.bind(this)),e.replace(/^&/,"")},_boolean:function(t){return"true"===t||"false"!==t&&t},_number:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))},_inject:function(t,e){for(var i=this.nodes.length,n=[];i--;){var s="function"===typeof t?t.call(this,this.nodes[i]):t,o=0===i?s:this._clone(s),a=e.call(this,o,this.nodes[i]);a&&(a.dom?n.push(a.get()):n.push(a))}return new r(n)},_clone:function(t){if("undefined"!==typeof t)return"string"===typeof t?t:t instanceof Node||t.nodeType?t.cloneNode(!0):"length"in t?[].map.call(this._array(t),(function(t){return t.cloneNode(!0)})):void 0},_cloneEvents:function(t,e){var i=t._e;if(i)for(var n in e._e=i,i._events)if(i._events.hasOwnProperty(n))for(var s=0;s<i._events[n].length;s++)e.addEventListener(n,i._events[n][s]);return e},_trigger:function(t){var e=this.get();return e&&3!==e.nodeType&&e[t](),this},_encodeUri:function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},_getSize:function(t,e){var i=this.get(),n=0;return n=3===i.nodeType?0:9===i.nodeType?this._getDocSize(i,e):this._isWindowNode(i)?window["inner"+e]:this._getHeightOrWidth(t),Math.round(n)},_getDocSize:function(t,e){var i=t.body,n=t.documentElement;return Math.max(i["scroll"+e],i["offset"+e],n["client"+e],n["scroll"+e],n["offset"+e])},_getPos:function(t){var e=this.get(),i={top:0,left:0};if(3===e.nodeType||this._isWindowNode(e)||9===e.nodeType)return i;if("position"===t)return{top:e.offsetTop,left:e.offsetLeft};if("offset"===t){var n=e.getBoundingClientRect(),s=e.ownerDocument,o=s.documentElement,a=s.defaultView;return{top:n.top+a.pageYOffset-o.clientTop,left:n.left+a.pageXOffset-o.clientLeft}}return i},_getHeightOrWidth:function(t,e){var i=t.charAt(0).toUpperCase()+t.slice(1),n=e||"offset",s=0,o=this.get(),a=getComputedStyle(o,null),r=this.parents().filter((function(t){var e=t.get();return 1===e.nodeType&&"none"===getComputedStyle(e,null).display&&e}));if("none"===a.display&&r.add(o),0!==r.length){var l="visibility: hidden !important; display: block !important;",p=[];r.each((function(t){var e=t.attr("style");null!==e&&p.push(e),t.attr("style",null!==e?e+";"+l:l)})),s=o[n+i],r.each((function(t,e){void 0===p[e]?t.removeAttr("style"):t.attr("style",p[e])}))}else s=o[n+i];return s},_eachClass:function(t,e){return this.each((function(i){if(t){var n=i.get();t.split(" ").forEach((function(t){n.classList&&n.classList[e](t)}))}}))},_getOneHandler:function(t,e){var i=this;return function(){t.apply(this,arguments),i.off(e)}},_getEventNamespace:function(t){var e=t.split("."),i=e[1]?e[1]:"_events";return e[2]?i+e[2]:i},_getEventName:function(t){return t.split(".")[0]},_offEvent:function(t,e,i,n,s){for(var o in t._e)if(t._e.hasOwnProperty(o))for(var a in t._e[o])if(s(a,o,e,i))for(var r=t._e[o][a],l=0;l<r.length;l++)"undefined"!==typeof n&&r[l].toString()!==n.toString()||(t.removeEventListener(a,r[l]),t._e[o][a].splice(l,1),0===t._e[o][a].length&&delete t._e[o][a],0===Object.keys(t._e[o]).length&&delete t._e[o])},_hasDisplayNone:function(t){return"none"===t.style.display||"none"===(t.currentStyle?t.currentStyle.display:getComputedStyle(t,null).display)},_anim:function(t,e,i){return"function"===typeof t?(e=t,t=i):t=t||i,{fn:e,speed:t/1e3}},_isWindowNode:function(t){return t===window||t.parent&&t.parent===window}};var l=0,p=function(t,e){return c(t,e)},c=function(t,e){var i;return d.dom(t).each((function(t){(i=t.dataget(d.namespace))||(i=new h(t,e,l),t.dataset(d.namespace,i),d.instances[l]=i,l++)})),i},d=p;d.dom=function(t,e){return new r(t,e)},d.ajax=n,d.instances=[],d.namespace="redactorx",d.prefix="rx",d.version="1.3.8",d.settings={},d.lang={},d._mixins={},d._repository={},d._subscribe={},d.keycodes={BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37},d.add=function(t,e,i){if(i.translations&&(d.lang=d.extend(!0,d.lang,i.translations)),i.defaults){var n={};n[e]=i.defaults,d.opts=d.extend(!0,d.opts,n)}if("mixin"===t)d._mixins[e]=i;else{if(i.subscribe)for(var s in i.subscribe)if(i.subscribe.hasOwnProperty(s))for(var o=s.split(","),a=0;a<o.length;a++){var r=o[a].trim();"undefined"===typeof d._subscribe[r]&&(d._subscribe[r]=[]),d._subscribe[r].push({module:e,func:i.subscribe[s]})}var l=function(){};if(l.prototype=i,i.mixins)for(var p=0;p<i.mixins.length;p++)d.inherit(l,d._mixins[i.mixins[p]]);d._repository[e]={type:t,proto:l,obj:i}}},d.extend=function(){var t={},e=!1,i=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],i++);for(var s=function(i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e&&"[object Object]"===Object.prototype.toString.call(i[n])?t[n]=d.extend(!0,t[n],i[n]):t[n]=i[n])};i<n;i++){s(arguments[i])}return t},d.error=function(t){throw t},d.inherit=function(t,e){var i=function(){};i.prototype=e;var n=new i;for(var s in t.prototype)t.prototype.__lookupGetter__(s)?n.__defineGetter__(s,t.prototype.__lookupGetter__(s)):n[s]=t.prototype[s];return t.prototype=n,t.prototype.super=e,t},d.addLang=function(t,e){"undefined"===typeof d.lang[t]&&(d.lang[t]={}),d.lang[t]=d.extend(!0,d.lang[t],e)},p.opts={plugins:[],content:!1,placeholder:!1,classes:!1,draggable:!1,editor:{classname:"content",focus:!1,sync:!0,drop:!0,lang:"en",add:"top",https:!1,enterKey:!0,scrollTarget:window,direction:"ltr",spellcheck:!0,grammarly:!1,notranslate:!1,reloadmarker:!0,minHeight:"40px",maxHeight:!1},codemirrorSrc:!1,codemirror:!1,source:!0,autosave:{url:!1,name:!1,data:!1,method:"post"},state:{limit:100},clean:{comments:!1,enter:!0,enterinline:!1},tab:{key:!0,spaces:!1},link:{size:30,nofollow:!1,target:!1},tooltip:{context:!0},topbar:!0,context:!1,control:!1,reorder:!1,buttons:{addbar:["paragraph","image","embed","table","quote","pre","line"],context:["bold","italic","deleted","code","link"],topbar:["shortcut"],editor:["add","html","format"],toolbar:!1,tags:{b:["bold"],strong:["bold"],i:["italic"],em:["italic"],del:["deleted"],u:["underline"],a:["link"]},types:!1,icons:!1,hidden:{}},addbar:{add:{},hide:[]},toolbar:{hide:[],sticky:!0,stickyMinHeight:200,stickyTopOffset:0},paste:{clean:!0,autoparse:!0,paragraphize:!0,plaintext:!1,linkTarget:!1,images:!0,links:!0,keepClass:[],keepStyle:[],keepAttrs:["td","th"],formTags:["form","input","button","select","textarea","legend","fieldset"],blockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","hr","figure","iframe","figcaption","address"],inlineTags:["a","svg","img","br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i","abbr"]},image:{states:!0,upload:!1,url:!0,select:!1,name:"file",data:!1,drop:!0,multiple:!0,clipboard:!0,types:["image/*"],tag:"figure",newtab:!1,link:!0,width:!1},noneditable:{classname:"noneditable"},embed:{responsive:"embed-responsive",script:!0,checkbox:!0},pre:{template:"<pre></pre>",spaces:4},line:!0,table:{template:"<table><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>",nowrap:"nowrap"},quote:{template:"<blockquote><p>Quote...</p><p><cite>Author Attribution</cite></p></blockquote>"},format:["p","h1","h2","h3","ul","ol"],formatAdd:!1,shortcutsRemove:!1,shortcutsBase:{"meta+z":"## shortcuts.meta-z ##","meta+shift+z":"## shortcuts.meta-shift-z ##","meta+a":"## shortcuts.meta-a ##"},shortcuts:{"ctrl+shift+o, meta+shift+o":{title:"## shortcuts.meta-shift-o ##",name:"meta+shift+o",command:"addbar.popup"},"ctrl+shift+d, meta+shift+d":{title:"## shortcuts.meta-shift-d ##",name:"meta+shift+d",command:"block.duplicate"},"ctrl+shift+up, meta+shift+up":{title:"## shortcuts.meta-shift-up ##",name:"meta+shift+&uarr;",command:"block.moveUp"},"ctrl+shift+down, meta+shift+down":{title:"## shortcuts.meta-shift-down ##",name:"meta+shift+&darr;",command:"block.moveDown"},"ctrl+shift+m, meta+shift+m":{title:"## shortcuts.meta-shift-m ##",name:"meta+shift+m",command:"inline.removeFormat"},"ctrl+b, meta+b":{title:"## shortcuts.meta-b ##",name:"meta+b",command:"inline.set",params:{tag:"b"}},"ctrl+i, meta+i":{title:"## shortcuts.meta-i ##",name:"meta+i",command:"inline.set",params:{tag:"i"}},"ctrl+u, meta+u":{title:"## shortcuts.meta-u ##",name:"meta+u",command:"inline.set",params:{tag:"u"}},"ctrl+h, meta+h":{title:"## shortcuts.meta-h ##",name:"meta+h",command:"inline.set",params:{tag:"sup"}},"ctrl+l, meta+l":{title:"## shortcuts.meta-l ##",name:"meta+l",command:"inline.set",params:{tag:"sub"}},"ctrl+alt+0, meta+alt+0":{title:"## shortcuts.meta-alt-0 ##",name:"meta+alt+0",command:"block.format",params:{tag:"p"}},"ctrl+alt+1, meta+alt+1":{title:"## shortcuts.meta-alt-1 ##",name:"meta+alt+1",command:"block.format",params:{tag:"h1"}},"ctrl+alt+2, meta+alt+2":{title:"## shortcuts.meta-alt-2 ##",name:"meta+alt+2",command:"block.format",params:{tag:"h2"}},"ctrl+alt+3, meta+alt+3":{title:"## shortcuts.meta-alt-3 ##",name:"meta+alt+3",command:"block.format",params:{tag:"h3"}},"ctrl+alt+4, meta+alt+4":{title:"## shortcuts.meta-alt-4 ##",name:"meta+alt+4",command:"block.format",params:{tag:"h4"}},"ctrl+alt+5, meta+alt+5":{title:"## shortcuts.meta-alt-5 ##",name:"meta+alt+5",command:"block.format",params:{tag:"h5"}},"ctrl+alt+6, meta+alt+6":{title:"## shortcuts.meta-alt-6 ##",name:"meta+alt+6",command:"block.format",params:{tag:"h6"}},"ctrl+shift+7, meta+shift+7":{title:"## shortcuts.meta-shift-7 ##",name:"meta+shift+7",command:"block.format",params:{tag:"ol"}},"ctrl+shift+8, meta+shift+8":{title:"## shortcuts.meta-shift-8 ##",name:"meta+shift+8",command:"block.format",params:{tag:"ul"}},"ctrl+], meta+]":{title:"## shortcuts.meta-indent ##",name:"meta+]",command:"list.indent"},"ctrl+[, meta+[":{title:"## shortcuts.meta-outdent ##",name:"meta+[",command:"list.outdent"},"ctrl+k, meta+k":{title:"## shortcuts.meta-k ##",name:"meta+k",command:"link.format"}},paddingControl:"24px 26px",paddingNormal:"20px",buttonsObj:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"},undo:{title:"## buttons.undo ##",command:"state.undo"},redo:{title:"## buttons.redo ##",command:"state.redo"},shortcut:{title:"## buttons.shortcuts ##",command:"shortcut.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},code:{title:"## buttons.code ##",command:"inline.set",params:{tag:"code"}},link:{title:"## buttons.link ##",command:"link.popup"},mark:{title:"## buttons.mark ##",command:"inline.set",params:{tag:"mark"}},sub:{title:"## buttons.subscript ##",command:"inline.set",params:{tag:"sub"}},sup:{title:"## buttons.superscript ##",command:"inline.set",params:{tag:"sup"}},kbd:{title:"## buttons.shortcut ##",command:"inline.set",params:{tag:"kbd"}},paragraph:{title:"## blocks.paragraph ##",command:"block.add",params:{name:"paragraph"}},image:{title:"## blocks.image ##",command:"image.popup",observer:"image.observe"},embed:{title:"## blocks.embed ##",command:"embed.popup",observer:"embed.observe"},"table-tune":{title:"## buttons.column-settings ##",command:"table.cellSetting",icon:"tune"},indent:{title:"## buttons.indent ##",command:"list.indent"},outdent:{title:"## buttons.outdent ##",command:"list.outdent"},line:{title:"## blocks.line ##",command:"block.add",observer:"block.observe",params:{name:"line"}},table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe",params:{name:"table"}},quote:{title:"## blocks.quote ##",command:"block.add",observer:"block.observe",params:{name:"quote"}},pre:{title:"## blocks.pre ##",command:"block.add",observer:"block.observe",params:{name:"pre"}}},formatObj:{p:{title:"## format.p ##",type:"paragraph",shortcut:"Ctrl+Alt+0"},h1:{title:'<span style="font-size: 20px; font-weight: bold;">## format.h1 ##</span>',type:"heading",shortcut:"Ctrl+Alt+1"},h2:{title:'<span style="font-size: 16px; font-weight: bold;">## format.h2 ##</span>',type:"heading",shortcut:"Ctrl+Alt+2"},h3:{title:'<span style="font-weight: bold;">## format.h3 ##</span>',type:"heading",shortcut:"Ctrl+Alt+3"},h4:{title:'<span style="font-weight: bold;">## format.h4 ##</span>',type:"heading",shortcut:"Ctrl+Alt+4"},h5:{title:'<span style="font-weight: bold;">## format.h5 ##</span>',type:"heading",shortcut:"Ctrl+Alt+5"},h6:{title:'<span style="font-weight: bold;">## format.h6 ##</span>',type:"heading",shortcut:"Ctrl+Alt+6"},ol:{title:"1. ## format.ol ##",type:"list",shortcut:"Ctrl+Shift+7"},ul:{title:"&bull; ## format.ul ##",type:"list",shortcut:"Ctrl+Shift+8"},address:{title:"<em>## format.address ##</em>",type:"address"},dl:{title:"## format.dl ##",type:"dlist"}},markerChar:"\ufeff",containers:{main:["toolbar","editor","source","statusbar"]},tags:{denied:["font","html","head","link","title","body","meta","applet","marquee"],incode:["!DOCTYPE","!doctype","html","head","link","title","body","meta","textarea","style"],form:["form","input","button","select","textarea","legend","fieldset"],inline:["a","svg","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small","abbr"],block:["pre","hr","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","table","tbody","thead","tfoot","tr","th","td","blockquote","output","figcaption","figure","address","main","section","header","footer","aside","article","iframe"],parser:["pre","hr","ul","ol","p","h1","h2","h3","h4","h5","h6","table","address","blockquote","figure","iframe","form","dl","div","section","header","footer","article","main","aside"]},bsmodal:!1,regex:{youtube:/^https?\:\/\/(?:www\.youtube(?:\-nocookie)?\.com\/|m\.youtube\.com\/|youtube\.com\/)?(?:ytscreeningroom\?vi?=|youtu\.be\/|vi?\/|user\/.+\/u\/\w{1,2}\/|embed\/|watch\?(?:.*\&)?vi?=|\&vi?=|\?(?:.*\&)?vi?=)([^#\&\?\n\/<>"']*)/gi,vimeo:/(http|https)?:\/\/(?:www.|player.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:\/[a-zA-Z0-9_-]+)?/gi,imageurl:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z\u00F0-\u02AF0-9()!@:%_+.~#?&//=]*)/gi,aurl1:/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,aurl2:/(^|[^\/])(www\.[\S]+(\b|$))/gim}},p.lang.en={accessibility:{"help-label":"Rich text editor"},placeholders:{figcaption:"Type caption (optional)"},popup:{back:"Back",link:"Link",add:"Add",image:"Image","add-image":"Add Image"},shortcuts:{"meta-a":"Select all","meta-z":"Undo","meta-shift-z":"Redo","meta-shift-m":"Remove inline format","meta-b":"Bold","meta-i":"Italic","meta-u":"Underline","meta-h":"Superscript","meta-l":"Subscript","meta-k":"Link","meta-alt-0":"Normal text","meta-alt-1":"Heading 1","meta-alt-2":"Heading 2","meta-alt-3":"Heading 3","meta-alt-4":"Heading 4","meta-alt-5":"Heading 5","meta-alt-6":"Heading 6","meta-shift-7":"Ordered List","meta-shift-8":"Unordered List","meta-indent":"Indent","meta-outdent":"Outdent","meta-shift-backspace":"Delete","meta-shift-o":"Add","meta-shift-d":"Duplicate","meta-shift-up":"Move up","meta-shift-down":"Move down"},buttons:{add:"Add",html:"HTML",format:"Format",bold:"Bold",italic:"Italic",deleted:"Deleted",link:"Link",list:"List",image:"Image",indent:"Indent",outdent:"Outdent",embed:"Embed",table:"Table",insert:"Insert",save:"Save",cancel:"Cancel",delete:"Delete",duplicate:"Duplicate",shortcut:"Shortcuts",underline:"Underline",undo:"Undo",redo:"Redo",code:"Code",mark:"Mark",subscript:"Subscript",superscript:"Superscript",kbd:"Shortcut","column-settings":"Column settings"},blocks:{text:"Text",paragraph:"Paragraph",image:"Image",embed:"Embed",line:"Line",table:"Table",quote:"Quote",pre:"Code",address:"Address"},format:{p:"Normal Text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",address:"Address",ul:"Unordered List",ol:"Ordered List",dl:"Definition List"},embed:{embed:"Embed",caption:"Caption",description:"Paste any embed/html code or enter the url (vimeo or youtube video only)","responsive-video":"Responsive video"},image:{or:"or","alt-text":"Alt Text",link:"Link",width:"Width",caption:"Caption","link-in-new-tab":"Open link in new tab","url-placeholder":"Paste url of image...","upload-new-placeholder":"Drag to upload a new image<br>or click to select"},link:{link:"Link","edit-link":"Edit Link",unlink:"Unlink","link-in-new-tab":"Open link in new tab",text:"Text",url:"URL"},table:{width:"Width",nowrap:"Nowrap",column:"Column","add-head":"Add head","remove-head":"Remove head","add-row-below":"Add row below","add-row-above":"Add row above","remove-row":"Remove row","add-column-after":"Add column after","add-column-before":"Add column before","remove-column":"Remove column","delete-table":"Delete table"}};var h=function(t,e,i){for(var n=["keycodes","prefix","dom","ajax","_repository","_subscribe"],s=0;s<n.length;s++)this[n[s]]=d[n[s]];this.uuid=i,this.$win=this.dom(window),this.$doc=this.dom(document),this.$body=this.dom("body"),this.$element=t,this.app=this,this.initialSettings=e,this._initer=["setting","lang"],this._priority=["container","editor","state","accessibility"],this._plugins=[],this.started=!1,this.start()};h.prototype={start:function(t){this.isTextarea()&&(this.isStarted()||(t&&(this.initialSettings=t),this._initCore(),this._plugins=this.setting.get("plugins"),this.broadcast("app.before.start"),this._initModules(),this._initPlugins(),this._startPriority(),this._startModules(),this._startPlugins(),this.started=!0,this.broadcast("app.start"),this._loadModulesAndPlugins()))},isStarted:function(){return this.started},isTextarea:function(){return"TEXTAREA"===this.$element.get().tagName},stop:function(){this.isStopped()||(this.broadcast("app.before.stop"),this._stopPlugins(),this._stopPriority(),this._stopModules(),this.started=!1,this.broadcast("app.stop"))},isStopped:function(){return!this.started},destroy:function(){clearTimeout(this.app.sync.typingTimer),this.stop(),this.broadcast("app.destroy"),this.$element.dataset(d.namespace,!1);var t=d.instances.indexOf(this.uuid);t>-1&&d.instances.splice(t,1)},broadcast:function(t,e){var i=e instanceof h.Event?e:new h.Event(t,e);if("undefined"!==typeof this._subscribe[t])for(var n=this._subscribe[t],s=0;s<n.length;s++){var o=this[n[s].module];o&&n[s].func.call(o,i)}var a=this.setting.has("subscribe")?this.setting.get("subscribe"):{};return"function"===typeof a[t]&&a[t].call(this,i),i},broadcastParams:function(t,e){return this.broadcast(t,e).getAll()},broadcastHtml:function(t,e){return this.broadcast(t,{html:e}).get("html")},create:function(t){"undefined"===typeof this._repository[t]&&d.error('The class "'+t+'" does not exist.');var e=[].slice.call(arguments,1),i=new this._repository[t].proto;i._name=t,i.app=this;for(var n,s=["uuid","prefix","dom","ajax"],o=0;o<s.length;o++)i[s[o]]=this[s[o]];return this.lang&&(i.lang=this.lang),this.opts&&(i.opts=this.opts),i.init&&(n=i.init.apply(i,e)),n||i},api:function(t){for(var e=[].slice.call(arguments,1),i=t.split("."),n=i.pop(),s=this,o=0;o<i.length;o++)s=s[i[o]];if(s&&"function"===typeof s[n])return s[n].apply(s,e)},_initCore:function(){for(var t=0;t<this._initer.length;t++)this[this._initer[t]]=this.create(this._initer[t]);this.setting&&(this.opts=this.setting.dump())},_initModules:function(){for(var t in this._repository)"module"===this._repository[t].type&&-1===this._initer.indexOf(t)&&(this[t]=this.create(t))},_initPlugins:function(){var t=this.setting.get("plugins");for(var e in this._repository)"plugin"===this._repository[e].type&&-1!==t.indexOf(e)&&(this[e]=this.create(e))},_startPriority:function(){for(var t=0;t<this._priority.length;t++)this._call(this[this._priority[t]],"start")},_startModules:function(){this._iterate("module","start")},_startPlugins:function(){this._iterate("plugin","start")},_stopPriority:function(){for(var t=this._priority.slice().reverse(),e=0;e<t.length;e++)this._call(this[t[e]],"stop")},_stopModules:function(){this._iterate("module","stop")},_stopPlugins:function(){this._iterate("plugin","stop")},_loadModulesAndPlugins:function(){this._iterate("module","load"),this._iterate("plugin","load")},_iterate:function(t,e){for(var i in this._repository)if(this._repository.hasOwnProperty(i)){var n="module"===t?"load"===e||-1===this._priority.indexOf(i):-1!==this._plugins.indexOf(i);this._repository[i].type===t&&n&&this._call(this[i],e)}},_call:function(t,e){"function"===typeof t[e]&&t[e].apply(t)}},h.Event=function(t,e){this.name=t,this.params="undefined"===typeof e?{}:e,this.stopped=!1},h.Event.prototype={is:function(t){if(!Array.isArray(t))return this.get(t);for(var e=0;e<t.length;e++)if(this.params[t[e]])return!0},has:function(t){return"undefined"!==typeof this.params[t]},getAll:function(){return this.params},get:function(t){return this.params[t]},set:function(t,e){this.params[t]=e},stop:function(){this.stopped=!0},isStopped:function(){return this.stopped}},p.add("mixin","block",{defaults:{id:{getter:"getId",setter:"setId"},html:{getter:"getHtml",setter:"setHtml"}},init:function(t,e){this.$block=t?this.dom(t):this.create(e),this._build(e),this._buildData(),this._render()},isType:function(t){return-1!==(Array.isArray(t)?t:[t]).indexOf(this.type)},isBlock:function(){return!0},isEditable:function(){return"undefined"!==typeof this.editable&&!0===this.editable},isFigcaption:function(){return"figcaption"===this.type},isSecondLevel:function(){return-1!==["quoteitem","row","cell"].indexOf(this.type)},isNested:function(){return-1!==["quote","table"].indexOf(this.type)},isFirstLevel:function(){return this.$block.attr("data-"+this.prefix+"-first-level")},isAllSelected:function(){return!this.isEditable()||this.app.selection.isAll(this.$block)},isEmpty:function(){var t=this.$block.text();return""===(t=this._cleanEmpty(t))},isCaretStart:function(){if("pre"===this.getType())return this.app.caret.is(this.$block,"start",!1,!1);if("list"===this.getType()){var t=this.app.selection.getCurrent();return 0===this.dom(t).closest("li").prev().length&&this.app.caret.is(this.$block,"start")}return!this.isEditable()||this.app.caret.is(this.$block,"start")},isCaretEnd:function(){return"pre"===this.getType()?this.app.caret.is(this.$block,"end",!1,!1):"address"===this.getType()?this.app.caret.is(this.$block,"end",!1,!0,!1):!this.isEditable()||this.app.caret.is(this.$block,"end")},isAllowedButton:function(t,e){var i=this.getType();if("undefined"!==typeof this.opts.buttons.hidden[i]){var n=this.opts.buttons.hidden[i];if(Array.isArray(n)&&-1!==n.indexOf(t))return!1}if("undefined"===typeof e.blocks)return!0;var s=e.blocks;if(s.except&&-1!==s.except.indexOf(i))return!1;if(s.all){if(!0===s.all||"all"===s.all)return!0;if("editable"===s.all&&-1!==["heading","paragraph","list","address","quote","table"].indexOf(i))return!0;if("first-level"===s.all&&this.isFirstLevel())return!0;if("noneditable"===s.all&&-1!==["image","embed","layer","line"].indexOf(i))return!0}return!(!Array.isArray(s.types)||-1===s.types.indexOf(i))},getData:function(t){var e={};return Object.keys(this.data).forEach(function(t){e[t]=this[this.data[t].getter].apply(this)}.bind(this)),t?e[t]:e},getOffset:function(){return this.$block.offset()},getType:function(){return this.type},getTag:function(){return!!this.$block&&this.$block.get().tagName.toLowerCase()},getBlock:function(){return this.$block},getHtml:function(){return this.$block.html()},getPlainText:function(){var t=this.$block.html();return this.app.content.getTextFromHtml(t,{nl:!0})},getOuterHtml:function(){return this.$block.get().outerHTML},getFirstLevel:function(){var t=this.$block.closest("[data-"+this.prefix+"-first-level]");return 0!==t.length&&t.dataget("instance")},getParent:function(t){t=t?"="+t:"";var e=this.$block.parent().closest("[data-"+this.prefix+"-type"+t+"]");return 0!==e.length&&e.dataget("instance")},getNext:function(t){t=t?"="+t:"";var e=this.$block.nextElement();return!(0===e.length||!e.is("[data-"+this.prefix+"-type"+t+"]"))&&e.dataget("instance")},getPrev:function(t){t=t?"="+t:"";var e=this.$block.prevElement();return!(0===e.length||!e.is("[data-"+this.prefix+"-type"+t+"]"))&&e.dataget("instance")},getChildFirst:function(t){t=t?"="+t:"";var e=this.$block.find("[data-"+this.prefix+"-type"+t+"]").first();return 0!==e.length&&e.dataget("instance")},getChildLast:function(t){t=t?"="+t:"";var e=this.$block.find("[data-"+this.prefix+"-type"+t+"]").last();return 0!==e.length&&e.dataget("instance")},getId:function(){return this.$block.attr("id")},getCaption:function(){var t=this.$block.find("figcaption");return 0!==t.length?t.html().trim():""},setData:function(t){for(var e in t)this.data[e]&&this[this.data[e].setter].call(this,t[e])},setEmpty:function(){this.$block.html("")},setSelectAll:function(){this.isEditable()&&this.app.selection.select(this.$block)},setHtml:function(t){this.$block.html(t)},setId:function(t){""===t?this.$block.removeAttr("id"):this.$block.attr("id",t)},setCaption:function(t){if(""===t)this.$block.find("figcaption").remove();else{var e=this.$block.find("figcaption");0===e.length&&((e=this.dom("<figcaption>")).attr("data-placeholder",this.lang.get("placeholders.figcaption")),this.$block.append(e),this.app.create("block.figcaption",e)),e.html(t)}},setClassFromObj:function(t,e){this._removeObjClasses(t);var i=t[e];"none"===i&&!1===i||this.$block.addClass(i)},setCaret:function(t){this.app.caret.set(this.$block,t)},moveUp:function(){var t=this.getPrev();t&&this._move(t,"before")},moveDown:function(){var t=this.getNext();t&&this._move(t,"after")},remove:function(t){var e=this.getType();this.$block.remove(),t&&this.app.broadcast("block.remove",{type:e})},appendNext:function(){var t=this.getNext();if(t.isEmpty())t.remove();else{if(this.isEmpty())return this.remove(),void this.app.block.set(t,"start");var e=t.getHtml(),i=this.getType(),n=t.getType(),s=!0,o=!0;if("pre"===i&&"pre"!==n&&(e=t.getPlainText()),"list"===n)if("list"===i){var a=t.getBlock().children();this.$block.append(a),s=!1,o=!0}else e=this._appendListHtml(t.getBlock(),e),o=t.isEmpty();if(s){var r=this.app.selection.getTopInline();r&&this.app.caret.set(r,"after"),this.app.insertion.insertHtml(e,"start")}o&&t.remove()}},appendToPrev:function(){var t=this.getPrev();if(this.isEmpty())return this.remove(),void this.app.block.set(t,"end");if(t.isEmpty())t.remove();else{var e=t.getType(),i=this.getHtml(),n=this.getType(),s=!0,o=!0;if("pre"!==n&&"pre"===e&&(i=this.getPlainText()),"list"===n)if("list"===e){var a=this.getBlock().children();this.app.block.set(t,"end"),t.getBlock().append(a),s=!1,o=!0}else i=this._appendListHtml(this.getBlock(),i),o=this.isEmpty();if(s){this.app.block.set(t,"end");var r=this.app.selection.getTopInline();r&&this.app.caret.set(r,"after"),this.app.insertion.insertHtml(i,"start")}o&&this.remove()}},insertEmpty:function(t){return(t=t||{}).instance=this.app.block.create(),this.insert(t)},insert:function(t){var e=d.extend({},{instance:!1,position:"after",caret:!1,remove:!0,type:"input"},t),i=e.instance.getBlock();return"list"===e.instance.getType()&&"list"===this.getType()?this.app.insertion.insertListToList(i,this.$block,e.caret):("split"===e.position?this.app.element.split(this.$block).before(i):this.$block[e.position](i),e.remove&&this.isEditable()&&this.isEmpty()&&this.remove()),this.app.editor.build(),e.caret&&this.app.block.set(e.instance,e.caret),this.app.toolbar.observe(),this.app.context.observe(),this.app.broadcast("block.add",{instance:e.instance,type:e.type}),e.instance},change:function(t,e){var i=t.getBlock();this.$block.after(i),this.$block.remove(),this.app.editor.build(),this.app.block.set(t),!1!==e&&this.app.broadcast("block.change",{instance:t})},duplicate:function(t){var e=this.getType(),i=this.$block.clone();return i.removeClass(this.prefix+"-block-focus"),t&&i.html(""),this.app.create("block."+e,i)},duplicateEmpty:function(){return this.duplicate(!0)},_build:function(t){this.build&&this.build(t)},_buildData:function(){this.data||(this.data={}),this.data=d.extend({},!0,this.defaults,this.data)},_buildItems:function(t,e){var i=this.$block.find(t);0!==i.length&&i.each(function(t){this.app.create("block."+e,t)}.bind(this))},_buildCaption:function(){"figure"===this.getTag()&&this.$block.find("figcaption").attr("data-placeholder",this.lang.get("placeholders.figcaption"))},_render:function(){this._renderEdit()},_renderEdit:function(){this.$block.dataset("instance",this),this.$block.attr("data-"+this.prefix+"-type",this.getType()),"undefined"!==typeof this.editable&&!1===this.editable?this.$block.attr("contenteditable",!1):"figcaption"===this.type&&this.$block.attr("contenteditable",!0)},_cleanEmpty:function(t){return t=(t=-1!==(t=this.app.utils.removeInvisibleChars(t)).search(/^<br\s?\/?>$/)?"":t).replace(/\n/g,"")},_appendListHtml:function(t,e){var i=t.find("li").first();return e=(e=(e=i.html().trim()).replace(/<\/li>/gi,"</li><br>")).replace(/<(ul|ol)/gi,"<br><$1"),e=(e=(e=this.app.content.removeTags(e,["ul","ol","li"])).trim()).replace(/<br\s?\/?>$/gi,""),i.remove(),e},_move:function(t,e){var i=this;i.isNested()&&(i=i.getFirst()),(this.isEditable()||this.isNested())&&this.app.selection.save(i.getBlock()),t.getBlock()[e](this.$block),this.app.block.set(i,!1,!0),(this.isEditable()||this.isNested())&&this.app.selection.restore(!1)},_removeObjClasses:function(t){var e=this._buildObjClasses(t);this.$block.removeClass(e.join(" ")),this.app.element.removeEmptyAttrs(this.$block,["class"])},_buildObjClasses:function(t){var e=[];for(var i in t)t[i]&&e.push(t[i]);return e}}),p.add("mixin","tool",{init:function(t,e,i,n){this.name=t,this.setter=i.get("setter"),this.popup=i,this.data=n,this.obj=this._observe(e),this.obj&&this._build()},getElement:function(){return this.$tool},getInput:function(){return this.$input},getValue:function(){return this.$input.val().trim()},setValue:function(t){this.$input.val(t)},setFocus:function(){this.$input.focus()},trigger:function(t){this.setValue(t),this.setter&&this.app.api(this.setter,this.popup)},_build:function(){this._buildTool(),this._buildLabel(),this._buildInputElement(),this._buildInput(),this._buildEvent(),this._has("placeholder")&&this.$input.attr("placeholder",this.lang.parse(this.obj.placeholder)),this._has("width")&&this.$input.css("width",this.obj.width),this._has("classname")&&this.$input.addClass(this.obj.classname)},_buildInputElement:function(){this.$input=this.dom("<"+this._getInputParam("tag")+">").addClass(this.prefix+this._getInputParam("classname")),this.$input.attr({name:this.name,type:this._getInputParam("type"),"data-type":this.type}),this.$input.dataset("instance",this)},_buildInput:function(){},_buildEvent:function(){if(-1===["segment"].indexOf(this.type)&&this.setter){var t="checkbox"===this.type||"select"===this.type?"change":"keydown blur";t="number"===this.type?t+" change":t,this.$input.on(t,this._catchSetter.bind(this))}},_buildTool:function(){this.$tool=this.dom("<div>").addClass(this.prefix+"-form-item").dataset("instance",this)},_buildLabel:function(){"checkbox"!==this.type&&this._has("label")&&(this.$label=this.dom("<label>").addClass(this.prefix+"-form-label").html(this.lang.parse(this.obj.label)),this.$tool.append(this.$label))},_getInputParam:function(t){return this.input&&"undefined"!==typeof this.input[t]?this.input[t]:""},_get:function(t){return this.obj[t]},_has:function(t){return Object.prototype.hasOwnProperty.call(this.obj,t)},_observe:function(t){return Object.prototype.hasOwnProperty.call(t,"observer")&&(t=this.app.api(t.observer,t,this.name)),t},_catchSetter:function(t){"keydown"===t.type&&13!==t.which||("keydown"===t.type&&t.preventDefault(),this.app.api(this.setter,this.popup))}}),p.add("module","accessibility",{start:function(){this._buildRole(),this._buildLabel()},_buildRole:function(){this.app.editor.getEditor().attr({"aria-labelledby":this.prefix+"-voice",role:"presentation"})},_buildLabel:function(){var t=this.lang.get("accessibility.help-label"),e=this._createLabel(t);this.app.container.get("main").prepend(e)},_createLabel:function(t){var e=this.dom("<span />").addClass(this.prefix+"-voice-label");return e.attr({id:this.prefix+"-voice-"+this.uuid,"aria-hidden":!1}),e.html(t),e}}),p.add("module","lang",{init:function(){this.langKey=this.app.setting.get("editor.lang"),this.vars=this._build()},get:function(t){var e=this._get(t,this.vars);return"undefined"===typeof e&&"en"!==this.langKey&&(e=this._get(t,d.lang.en)),"undefined"===typeof e?"":e},parse:function(t){if("string"!==typeof t)return t;var e=t.match(/## (.*?) ##/g);if(e)for(var i=0;i<e.length;i++){var n=e[i].replace(/^##\s/g,"").replace(/\s##$/g,"");t=t.replace(e[i],this.get(n))}return t},_get:function(t,e){var i=t.split(".");return 1===i.length?e[t]:"undefined"!==typeof e[i[0]]?e[i[0]][i[1]]:void 0},_build:function(){var t=d.lang.en;return"en"!==this.langKey&&(t="undefined"!==d.lang[this.langKey]?d.lang[this.langKey]:t),t}}),p.add("module","setting",{init:function(){this.opts=this._build()},dump:function(){return this.opts},has:function(t){var e=t.split(".");return 1===e.length?"undefined"!==typeof this.opts[t]:"undefined"!==typeof this.opts[e[0]]&&"undefined"!==typeof this.opts[e[1]]},set:function(t,e,i){"undefined"===typeof this.opts[t]&&(this.opts[t]={}),"undefined"===typeof i?this.opts[t]=e:this.opts[t][e]=i},get:function(t){var e=t.split(".");return 1===e.length?this.opts[t]:"undefined"!==typeof this.opts[e[0]]?this.opts[e[0]][e[1]]:void 0},_build:function(){var t=d.extend(!0,{},d.opts,this.app.initialSettings);return t=d.extend(!0,t,d.settings)}}),p.add("module","element",{is:function(t,e,i){var n=!1,s="text"===e?t:this._getNode(t);return"inline"===e?n=this._isElement(s)&&this._isInlineTag(s.tagName,i):"blocks"===e?n=this._isElement(s)&&s.hasAttribute("data-"+this.prefix+"-type"):"blocks-first"===e?n=this._isElement(s)&&s.hasAttribute("data-"+this.prefix+"-first-level"):"block"===e?n=this._isElement(s)&&this._isBlockTag(s.tagName,i):"element"===e?n=this._isElement(s):"text"===e?n="string"===typeof s&&!/^\s*<(\w+|!)[^>]*>/.test(s)||this.isTextNode(s):"list"===e?n=this._isElement(s)&&-1!==["ul","ol"].indexOf(s.tagName.toLowerCase()):"heading"===e&&(n=this._isElement(s)&&-1!==["h1","h2","h3","h4","h5","h6"].indexOf(s.tagName.toLowerCase())),n},isEmptyOrImageInline:function(t){var e=this.dom(t).get();if(!e||3===e.nodeType)return!1;var i=e.tagName.toLowerCase(),n="false"===e.getAttribute("contenteditable"),s=this.is(e,"inline");return!!(s&&this.isEmpty(e)||s&&n||-1!==["svg","img"].indexOf(i))},isEmpty:function(t){var e=this._getNode(t);return!!e&&(3===e.nodeType?""===e.textContent.trim().replace(/\n/,""):""===e.innerHTML)},isTag:function(t,e){return this._getNode(t).tagName.toLowerCase()===e},isTextNode:function(t){var e=this._getNode(t);return e&&e.nodeType&&3===e.nodeType},isVisible:function(t){var e=this._getNode(t);return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},isScrollVisible:function(t){var e=this.app.scroll.getTarget(),i=this.dom(t),n=e.scrollTop()+e.height();return i.offset().top<=n},getFirstLevel:function(t){return this.dom(t).closest("[data-"+this.prefix+"-first-level]")},getDataBlock:function(t){return this.dom(t).closest("[data-"+this.prefix+"-type]")},getType:function(t){return this.dom(t).attr("data-"+this.prefix+"-type")},getAllInlines:function(t){for(var e=[],i=t;i;)this.is(i,"inline")&&e.push(i),i=i.parentNode;return e},getClosest:function(t,e){return this.dom(t).closest(this.getTypesSelector(e))},getParents:function(t,e){return this.dom(t).parents(this.getTypesSelector(e))},getChildren:function(t,e){return this.dom(t).find(this.getTypesSelector(e))},getTypesSelector:function(t){return"[data-"+this.prefix+"-type="+t.join("],[data-"+this.prefix+"-type=")+"]"},hasClass:function(t,e){e="string"===typeof e?[e]:e;for(var i=this.dom(t),n=e.length,s=0,o=0;o<n;o++)i.hasClass(e[o])&&s++;return n===s},scrollTo:function(t,e){if(!this.isScrollVisible(t)){e=e||60;var i=t.offset(),n=this.app.scroll.getTarget(),s=i.top-e;n.scrollTop(s),setTimeout((function(){n.scrollTop(s)}),1)}},replaceToTag:function(t,e,i){return this.dom(t).replaceWith(function(t){var n=this.dom("<"+e+">");if(i||n.append(t.innerHTML),t.attributes)for(var s=t.attributes,o=0;o<s.length;o++)n.attr(s[o].nodeName,s[o].value);if(i)for(;t.childNodes.length>0;)n.append(this.dom(t.firstChild));return n}.bind(this))},split:function(t){var e=this.dom(t),i=(t=e.get()).tagName.toLowerCase(),n=this.app.content.extractHtmlFromCaret(t);n.nodeType&&11===n.nodeType&&(n=this.dom(n.childNodes));var s=this.dom("<"+i+" />");(s=this.cloneAttrs(t,s)).append(n),e.after(s);var o=e.children().last();if(this.is(o,"inline")){var a=o.html();""===(a=this.app.utils.removeInvisibleChars(a))&&o.remove()}var r=this.getType(s);return r&&this.app.create("block."+r,s,!0),""===e.html()&&e.remove(),s},cloneEmpty:function(t){var e=this.dom(t).get().tagName.toLowerCase();return this.dom("<"+e+">")},cloneAttrs:function(t,e){for(var i=this.dom(e),n=this._getNode(t).attributes,s=n.length;s--;){var o=n[s];i.attr(o.name,o.value)}return i},getAttrs:function(t){var e=this._getNode(t),i={};if(null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;n++){var s=e.attributes[n].nodeValue;s=this._isNumber(s)?parseFloat(s):this._getBooleanFromStr(s),i[e.attributes[n].nodeName]=s}return i},removeEmptyAttrs:function(t,e){var i=this.dom(t),n=e.join(" "),s=!1;return"undefined"===typeof i.attr(n)||null===i.attr(n)?s=!0:""===i.attr(n)&&(i.removeAttr(n),s=!0),s},getBlocks:function(t,e,i){var n=this._getNode(t).childNodes,s=[],o=e||this.opts.tags.parser;i&&(o=this.app.utils.extendArray(o,i));for(var a=0;a<n.length;a++)1===n[a].nodeType&&-1!==o.indexOf(n[a].tagName.toLowerCase())&&s.push(n[a]);return s},hasBlocks:function(t){return 0!==this.getBlocks(t).length},hasTextSiblings:function(t){var e=this._getNode(t),i=e.previousSibling&&3===e.previousSibling.nodeType&&!this.isEmpty(e.previousSibling),n=e.nextSibling&&3===e.nextSibling.nodeType&&!this.isEmpty(e.nextSibling);return i||n},_getNode:function(t){return this.dom(t).get()},_getBooleanFromStr:function(t){return"true"===t||"false"!==t&&t},_isBlockTag:function(t,e){return-1!==this.app.utils.extendArray(this.opts.tags.block,e).indexOf(t.toLowerCase())},_isInlineTag:function(t,e){return-1!==this.app.utils.extendArray(this.opts.tags.inline,e).indexOf(t.toLowerCase())},_isElement:function(t){return t&&t.nodeType&&1===t.nodeType},_isTag:function(t){return void 0!==t&&t},_isNumber:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))}}),p.add("module","paragraphizer",{init:function(){this.remStart="#####replace",this.remEnd="#####";this.tags=this.opts.tags.parser.concat(["form","audio","figcaption","object","style","script","iframe","select","input","textarea","button","option","map","area","math","fieldset","legend","hgroup","nav","details","menu","summary"])},paragraphize:function(t){var e=[],i=[];t=this._storeTags(t,e),t=(t=this.app.content.storeComments(t,i)).trim();for(var n="",s=(t=(t=(t=(t=(t=(t=this._trimLinks(t)).replace(/xparagraphmarkerz(?:\r\n|\r|\n)$/g,"")).replace(/xparagraphmarkerz$/g,"")).replace(/xparagraphmarkerz(?:\r\n|\r|\n)/g,"\n")).replace(/xparagraphmarkerz/g,"\n")).replace(/[\n]+/g,"\n")).split("\n"),o=0;o<s.length;o++)n+="<p>"+s[o].trim()+"</"+"p>\n";return t=(t=(t=(t=n.replace(/\n$/,"")).replace(new RegExp("<p>\\s+#####","gi"),"#####")).replace(new RegExp("<p>#####","gi"),"#####")).replace(new RegExp("#####</p>","gi"),"#####"),t=this._restoreTags(t,e),t=(t=(t=(t=(t=(t=this.app.content.restoreComments(t,i)).replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\s\n]*<\/\1>/gi,"<$1$2></$1>")).replace(/<p(.*?)><\/?br\s?\/?><\/p>/gi,"<p$1></p>")).replace(/<div(.*?)><\/?br\s?\/?><\/div>/gi,"<div$1></div>")).replace(/<\/?br\s?\/?><\/div>/gi,"</div>")).replace(/<\/?br\s?\/?><\/li>/gi,"</li>")},_storeTags:function(t,e){return this.app.utils.wrap(t,function(t){t.find(this.tags.join(", ")).each(function(t,i){this._replaceTag(t,i,e)}.bind(this))}.bind(this))},_restoreTags:function(t,e){for(var i=0;i<e.length;i++){var n=e[i].replace(/\$/gi,"&#36;");t=t.replace(this.remStart+i+this.remEnd,n)}return t},_replaceTag:function(t,e,i){var n=t.get(),s=document.createTextNode(this.remStart+e+this.remEnd+"xparagraphmarkerz");i.push(n.outerHTML),n.parentNode.replaceChild(s,n)},_trimLinks:function(t){return this.app.utils.wrap(t,function(t){t.find("a").each(this._trimLink.bind(this))}.bind(this))},_trimLink:function(t){t.html(t.html().trim())}}),p.add("module","utils",{isMobile:function(){return/(iPhone|iPad|iPod|Android)/.test(navigator.userAgent)},createInvisibleChar:function(){return document.createTextNode(this.opts.markerChar)},searchInvisibleChars:function(t){return t.search(/^\uFEFF$/g)},removeInvisibleChars:function(t){return t.replace(/\uFEFF/g,"")},wrap:function(t,e){var i=this.dom("<div>").html(t);return e(i),t=i.html(),i.remove(),t},extendArray:function(t,e){if(t=t.concat(t),e)for(var i=0;i<e.length;i++)t.push(e[i]);return t},removeFromArrayByValue:function(t,e){var i;e=Array.isArray(e)?e:[e];for(var n=0;n<e.length;n++)(i=t.indexOf(e[n]))>-1&&t.splice(i,1);return t},sumOfArray:function(t){return t.reduce((function(t,e){return parseInt(t)+parseInt(e)}),0)},getObjectIndex:function(t,e){return Object.keys(t).indexOf(e)},insertToObject:function(t,e,i,n){return Object.keys(i).reduce((function(s,o,a){return a===n&&(s[t]=e),s[o]=i[o],s}),{})},getRandomId:function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<12;i++)t+=e.charAt(Math.floor(36*Math.random()));return t},escapeRegExp:function(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")},capitalize:function(t){return(t=t.toLowerCase()).charAt(0).toUpperCase()+t.slice(1)},extendData:function(t,e){for(var i in e)t="elements"===i?this._extendDataElements(t,e[i]):this._setData(t,i,e[i]);return t},_extendDataElements:function(t,e){return this.dom(e).each(function(e){if("FORM"===e.get().tagName){var i=e.serialize(!0);Object.keys(i).forEach(function(e){t=this._setData(t,e,i[e])}.bind(this))}else{var n=e.attr("name")?e.attr("name"):e.attr("id");t=this._setData(t,n,e.val())}}.bind(this)),t},_setData:function(t,e,i){return t instanceof FormData?t.append(e,i):t[e]=i,t}}),p.add("module","scroll",{init:function(){this.scrolltop=!1},save:function(){this.scrolltop=this.getTarget().scrollTop()},restore:function(){!1!==this.scrolltop&&(this.getTarget().scrollTop(this.scrolltop),this.scrolltop=!1)},isTarget:function(){return this.opts.editor.scrollTarget!==window},getTarget:function(){return this.dom(this.opts.editor.scrollTarget)}}),p.add("module","autosave",{send:function(){this.opts.autosave.url&&this._sending()},_getName:function(){return this.opts.autosave.name?this.opts.autosave.name:this.app.$element.attr("name")||"content"+this.uuid},_sending:function(){var t=this._getName(),e={};e[t]=this.app.$element.val(),e=this.app.utils.extendData(e,this.opts.autosave.data),this.ajax.request(this.opts.autosave.method,{url:this.opts.autosave.url,data:e,before:function(i){if(this.app.broadcast("autosave.before.send",{xhr:i,name:t,data:e}).isStopped())return!1}.bind(this),success:function(i){this._complete(i,t,e)}.bind(this)})},_complete:function(t,e,i){var n=t&&t.error?"autosave.error":"autosave.send";this.app.broadcast(n,{name:e,data:i,response:t})}}),p.add("module","progress",{stop:function(){this.hide()},show:function(){this.hide(),this.$progress=this.dom("<div>").addClass(this.prefix+"-editor-progress"),this.$progress.attr("id",this.prefix+"-progress"),this.$progressBar=this.dom("<span>"),this.$progress.append(this.$progressBar),this.app.$body.append(this.$progress)},hide:function(){this.app.$body.find("#"+this.prefix+"-progress").remove()}}),p.add("module","clipboard",{getContent:function(t){var e=this.isPlainText(t)?"text/plain":"text/html",i=t.getData(e);return"text/plain"===e?this.app.content.escapeHtml(i):i},setContent:function(t,e,i){var n=t.clipboardData;e=this.app.parser.unparse(e),e='<meta type="'+this.prefix+'-editor"/>'+e,i=i||this.app.content.getTextFromHtml(e,{nl:!0}),n.setData("text/html",e),n.setData("text/plain",i)},isPlainText:function(t){var e=t.getData("text/plain"),i=t.getData("text/html");return(!i||""===i.trim())&&null!==e}}),p.add("module","fragment",{build:function(t){return this.is(t)?t:this.create(t)},insert:function(t){var e=this.app.selection.get();if(e.range){if(e.collapsed){var i=e.range.startContainer;3!==i.nodeType&&"BR"===i.tagName&&i.parentNode.removeChild(i)}else e.range.deleteContents();t.frag?e.range.insertNode(t.frag):e.range.insertNode(t)}},createContainer:function(t){var e=this.dom("<div>");return"string"===typeof t?e.html(t):e.append(this.dom(t).clone(!0)),e.get()},create:function(t){for(var e,i,n,s="string"===typeof t?this.createContainer(t):t,o=document.createDocumentFragment(),a=[],r=0;e=s.firstChild;){r++;var l=o.appendChild(e);1===r&&(i=l),a.push(l),n=l}return{frag:o,first:i,last:n,nodes:a}},is:function(t){return"object"===typeof t&&t.frag}}),p.add("module","button",{init:function(t,e,i,n){if("object"===typeof t)this.name=t.name,this.obj=e,this._buildFromElement(t.element);else if(t){this.type=n||!1,this.name=t;var s=this._observe(e);this.obj="undefined"===typeof s?e:s,this.obj&&this._build(t,i)}},setColor:function(t,e){var i=t.getName();if("background"===i||"text-color"===i){var n="background"===i?"background-color":"color";this.setBackground(e[n])}},isButton:function(){return!0},isAddbar:function(){return this._has("addbar")},isControl:function(){return this._has("control")},getName:function(){return this.name},getTitle:function(){return this.title},getParams:function(){return!!this._has("params")&&this.obj.params},getOffset:function(){return this.$button.offset()},getDimension:function(){return{width:this.$button.width(),height:this.$button.height()}},getElement:function(){return this.$button},setBackground:function(t){this._background("add",t)},resetBackground:function(){this._background("remove","")},_has:function(t){return Object.prototype.hasOwnProperty.call(this.obj,t)},_observe:function(t){return Object.prototype.hasOwnProperty.call(t,"observer")&&(t=this.app.api(t.observer,t,this.name)),t},_background:function(t,e){var i="remove"===t?"removeClass":"addClass";this.$icon[i](this.prefix+"-button-icon-color").css({"background-color":e,color:""!==e?this.app.color.invert(e):""})},_buildFromElement:function(t){this.$button=this.dom(t),this.$button.addClass(this.prefix+"-button-target"),this._buildData()},_build:function(t,e){this._buildTitle(),this._buildElement(),this._buildIcon(),this._buildData(e)},_buildData:function(t){this.$button.attr({tabindex:"-1","data-name":this.name,"data-command":this.obj.command||!1}),this.$button.dataset("instance",this);var e=this._has("command")?"_catch":"_stop";this.$button.on("click."+this.prefix+"-button",this[e].bind(this)),this.$button.on("dragstart."+this.prefix+"-button",(function(t){t.preventDefault()})),t&&(this._buildTooltip(),this._buildBackground(),this._buildPosition(t))},_buildTitle:function(){this.title="undefined"!==typeof this.obj.title?this.lang.parse(this.obj.title):""},_buildElement:function(){this.$button=this.dom('<a href="#"></a>'),this.$button.addClass(this.prefix+"-button "+this.prefix+"-button-target"),this.type&&this.$button.addClass(this.prefix+"-button-"+this.type),this._has("classname")&&this.$button.addClass(this.obj.classname)},_buildIcon:function(){var t=this._has("icon"),e='<span class="'+this.prefix+"-icon-"+this.name+'"></span>';this.$icon=this._buildIconElement(),t&&!0!==this.obj.icon&&(e=-1!==this.obj.icon.search(/</)?this.obj.icon:'<span class="'+this.prefix+"-icon-"+this.obj.icon+'"></span>'),this.opts.buttons.icons&&"undefined"!==typeof this.opts.buttons.icons[this.name]&&(e=this.opts.buttons.icons[this.name]),this.$icon.append(e),this.$button.append(this.$icon)},_buildIconElement:function(){return this.dom("<span>").addClass(this.prefix+"-button-icon")},_buildTooltip:function(){("toolbar"===this.type||"context"===this.type&&this.opts.tooltip.context)&&this.app.tooltip.build(this.$button,this.title)},_buildBackground:function(){this._has("background")&&this.setBackground(this.obj.background)},_buildPosition:function(t){if(this._has("position")){var e=this.obj.position;if("first"===e)t.prepend(this.$button);else if("object"===typeof e){var i=Object.prototype.hasOwnProperty.call(e,"after")?"after":"before",n=e[i],s=this._findPositionElement(n,t);s?s[i](this.$button):t.append(this.$button)}}else t.append(this.$button)},_findPositionElement:function(t,e){var i;if(Array.isArray(t))for(var n=0;n<t.length&&0===(i=e.find("[data-name="+t[n]+"]")).length;n++);else i=e.find("[data-name="+t+"]");return 0!==i.length?i:0},_stop:function(t){t.preventDefault(),t.stopPropagation()},_catch:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-button-target");if(!e.hasClass("disable")){this.app.editor.setFocus();var i=e.attr("data-command"),n=e.attr("data-name"),s=e.dataget("instance");this.app.api(i,this.getParams(),s,n,t),this.app.tooltip.close()}}}),p.add("module","tooltip",{init:function(){this.classname=this.prefix+"-tooltip",this.eventname=this.prefix+"-button-"+this.uuid},stop:function(){this.close()},build:function(t,e){(e=this._cleanTitle(e))&&(t.attr("data-tooltip",e),t.on("mouseover."+this.eventname,this.open.bind(this)),t.on("mouseout."+this.eventname,this.close.bind(this)))},open:function(t){var e=this._getButton(t);this.app.popup.isOpen()||e.hasClass("disable")||(this.$tooltip=this._create(e),this._setPosition(e),this._fixBSModal(),this.app.$body.append(this.$tooltip))},close:function(){this.app.$body.find("."+this.classname).remove()},_create:function(t){return this.dom("<span>").addClass(this.classname).html(t.attr("data-tooltip"))},_cleanTitle:function(t){return!!t&&t.replace(/(<([^>]+)>)/gi,"")},_setPosition:function(t){var e=t.offset(),i=t.height();this.$tooltip.css({top:e.top+i+"px",left:e.left+"px"})},_fixBSModal:function(){this.opts.bsmodal&&this.$tooltip.css("z-index",1060)},_getButton:function(t){return this.dom(t.target).closest("."+this.prefix+"-button-target")}}),p.add("module","codemirror",{init:function(){this.cm=!1},create:function(t){if(this.is()){var e="object"===typeof this.opts.codemirror?this.opts.codemirror:{},n=this.opts.codemirrorSrc?this.opts.codemirrorSrc:i;return this.cm=n.fromTextArea(this.dom(t.el).get(),e),t.height&&this.cm.setSize(null,t.height),t.focus&&this.cm.focus(),this.cm}},destroy:function(){this.cm&&(this.cm.toTextArea(),this.cm=!1)},is:function(){return this.opts.codemirror},val:function(t){return this.is()&&this.cm&&(t=this.cm.getValue()),t}}),p.add("class","upload",{defaults:{type:"image",box:!1,url:!1,cover:!0,name:"file",data:!1,multiple:!0,placeholder:!1,hidden:!0,target:!1,success:!1,error:!1,remove:!1,trigger:!1,input:!1},init:function(t,e,i){this.eventname=this.prefix+"-upload",t&&this._build(t,e,i)},send:function(t,e,i,n){this.p=this._buildParams(i,n),this._send(t,e)},complete:function(t,e){this._complete(t,e)},setImage:function(t){this.p.input||(this.$image&&this.$image.remove(),this.$remove&&this.$remove.remove(),""===t?this.$placeholder.show():(this.$placeholder.hide(),this._buildImage(t),this.p.remove&&this._buildRemove()))},_build:function(t,e,i){this.p=this._buildParams(e,i),this.$element=this.dom(t),"INPUT"===this.$element.get().tagName?this._buildByInput():this._buildByBox()},_buildImage:function(t){this.$image=this.dom("<img>"),this.$image.attr("src",t),this.$box.append(this.$image),!1===this.p.input&&(this.$box.off("click."+this.eventname),this.$image.on("click."+this.eventname,this._click.bind(this)))},_buildRemove:function(){this.$remove=this.dom("<span>"),this.$remove.addClass(this.prefix+"-upload-remove"),this.$remove.on("click",this._removeImage.bind(this)),this.$box.append(this.$remove)},_buildParams:function(t,e){return t=d.extend(!0,this.defaults,t),e&&(t.trigger=e),t},_buildByInput:function(){this.$input=this.$element,this.p.box?(this._buildBox(),this._buildPlaceholder()):this.p.input=!0,this._buildAccept(),this._buildMultiple(),this._buildEvents()},_buildByBox:function(){this._buildInput(),this._buildAccept(),this._buildMultiple(),this._buildBox(),this._buildPlaceholder(),this._buildEvents()},_buildBox:function(){this.$box=this.dom("<div>").addClass(this.prefix+"-form-upload-box"),this.$element.before(this.$box),!1===this.p.cover&&this.$box.addClass(this.prefix+"-form-upload-cover-off"),this.p.hidden&&this.$element.hide()},_buildPlaceholder:function(){this.p.placeholder&&(this.$placeholder=this.dom("<span>").addClass(this.prefix+"-form-upload-placeholder"),this.$placeholder.html(this.p.placeholder),this.$box.append(this.$placeholder))},_buildInput:function(){this.$input=this.dom("<input>"),this.$input.attr("type","file"),this.$input.attr("name",this._getUploadParam()),this.$input.hide(),this.$element.before(this.$input)},_buildAccept:function(){if("image"===this.p.type){var t=this.opts.image.types.join(",");this.$input.attr("accept",t)}},_buildMultiple:function(){"image"===this.p.type&&(this.p.multiple?this.$input.attr("multiple","multiple"):this.$input.removeAttr("multiple"))},_buildEvents:function(){this.$input.on("change."+this.eventname+"-"+this.uuid,this._change.bind(this)),!1===this.p.input&&(this.$box.on("click."+this.eventname,this._click.bind(this)),this.$box.on("drop."+this.eventname,this._drop.bind(this)),this.$box.on("dragover."+this.eventname,this._dragover.bind(this)),this.$box.on("dragleave."+this.eventname,this._dragleave.bind(this)))},_buildData:function(t,e,i){if("single"===this.p.multiple)i.append(t,e[0]);else if(this.p.multiple)for(var n=0;n<e.length;n++)i.append(t+"[]",e[n]);else i.append(t+"[]",e[0]);return i},_removeImage:function(t){t&&(t.preventDefault(),t.stopPropagation()),this.$image&&this.$image.remove(),this.$remove&&this.$remove.remove(),this.$placeholder.show(),!1===this.p.input&&this.$box.on("click."+this.eventname,this._click.bind(this)),t&&this.app.api(this.p.remove,t)},_getUploadParam:function(){return this.p.name},_click:function(t){t.preventDefault(),this.$input.click()},_change:function(t){this._send(t,this.$input.get().files)},_drop:function(t){t.preventDefault(),this._send(t)},_dragover:function(t){return t.preventDefault(),this._setStatus("hover"),!1},_dragleave:function(t){return t.preventDefault(),this._removeStatus(),!1},_setStatus:function(t){!this.p.input&&this.p.box&&(this._removeStatus(),this.$box.addClass(this.prefix+"-form-upload-"+t))},_removeStatus:function(){if(!this.p.input&&this.p.box)for(var t=["hover","error"],e=0;e<t.length;e++)this.$box.removeClass(this.prefix+"-form-upload-"+t[e])},_send:function(t,e){e=e||t.dataTransfer.files;var i=new FormData,n=this._getUploadParam();i=this._buildData(n,e,i),i=this.app.utils.extendData(i,this.p.data),this._sendData(t,e,i)},_sendData:function(t,e,i){"function"===typeof this.p.url?this.p.url.call(this.app,this,{data:i,files:e,e:t}):(this.app.progress.show(),this.ajax.post({url:this.p.url,data:i,before:function(n){if(this.app.broadcast("upload.before.send",{xhr:n,data:i,files:e,e:t}).isStopped())return this.app.progress.hide(),!1}.bind(this),success:function(e){this._complete(e,t)}.bind(this),error:function(e){this._complete(e,t)}.bind(this)}))},_complete:function(t,e){t&&t.error?(this._setStatus("error"),this.p.error&&(this.app.broadcast("upload.error",{response:t}),this.app.api(this.p.error,t,e))):(this._removeStatus(),this._trigger(t),this.p.success&&(this.app.broadcast("upload.complete",{response:t}),this.app.api(this.p.success,t,e))),setTimeout(function(){this.app.progress.hide()}.bind(this),500)},_trigger:function(t){if(this.p.trigger&&t&&t.url){var e=this.p.trigger.instance;e[this.p.trigger.method].call(e,t.url)}}}),p.add("module","statusbar",{init:function(){this.classname=this.prefix+"-statusbar"},start:function(){this._build()},add:function(t,e){return this.update(t,e)},update:function(t,e){var i=this.get(t);return 0===i.length&&(i=this._buildItem(t)),i.html(e)},get:function(t){var e=t?"[data-name="+t+"]":"[data-name]";return this.$statusbar.find(e)},remove:function(t){this.get(t).remove()},clear:function(){this.$statusbar.html("")},_build:function(){this.$statusbar=this.dom("<div>").attr("dir",this.opts.editor.direction),this.$statusbar.addClass(this.classname+" "+this.classname+"-"+this.uuid),this.app.container.get("statusbar").append(this.$statusbar)},_buildItem:function(t){var e=this.dom("<span>").addClass(this.classname+"-item");return e.attr("data-name",t),this.$statusbar.append(e),e}}),p.add("module","container",{init:function(){this.blurclass=this.prefix+"-in-blur",this.focusclass=this.prefix+"-in-focus"},start:function(){this._buildMain(),this._buildContainers(this.$main,this.opts.containers.main),this._buildBSModal()},stop:function(){this.$main.remove()},get:function(t){return this["$"+t]},setFocus:function(){this.$main.removeClass(this.blurclass).addClass(this.focusclass)},setBlur:function(){this.$main.removeClass(this.focusclass).addClass(this.blurclass)},isFocus:function(){return this.$main.hasClass(this.focusclass)},_buildMain:function(){this.$main=this.dom("<div>").attr(this.prefix+"-uuid",this.uuid),this.$main.addClass(this.prefix+"-container "+this.prefix+"-container-"+this.uuid),this.app.$element.after(this.$main)},_buildContainers:function(t,e){for(var i=0;i<e.length;i++){var n=e[i],s="$"+n;this[s]=this._createContainer(n),"undefined"!==typeof this.opts.containers[n]&&this._buildContainers(this[s],this.opts.containers[n]),t.append(this[s])}},_buildBSModal:function(){this.opts.bsmodal=0!==this.$main.closest(".modal-dialog").length},_createContainer:function(t){return this.dom("<div>").addClass(this.prefix+"-"+t+"-container")}}),p.add("module","shortcut",{init:function(){if(this.opts.shortcutsRemove)for(var t=this.opts.shortcutsRemove,e=0;e<t.length;e++)this.remove(t[e]);this.shortcuts=this.opts.shortcuts,this.hotkeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},this.hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},add:function(t,e){this.shortcuts[t]=e},remove:function(t){this.opts.shortcutsBase=this._remove(t,this.opts.shortcutsBase),this.opts.shortcuts=this._remove(t,this.opts.shortcuts)},popup:function(t,e){var i=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?"<b>&#8984;</b>":"ctrl",n={},s=0;s=this._buildPopupItems(n,s,this.opts.shortcutsBase,i,"base"),this._buildPopupItems(n,s,this.opts.shortcuts,i),this.app.popup.create("shortcuts",{width:"360px",items:n}),this.app.popup.open({button:e})},handle:function(t){if(this.triggered=!1,!1===this.shortcuts)return!t.ctrlKey&&!t.metaKey||66!==t.which&&73!==t.which||t.preventDefault(),!0;if(t.ctrlKey||t.metaKey||t.shoftKey||t.altKey)for(var e in this.shortcuts)this.shortcuts.hasOwnProperty(e)&&this._build(t,e,this.shortcuts[e]);return this.triggered},_buildPopupItems:function(t,e,i,n,s){for(var o in i)if(i.hasOwnProperty(o)){for(var a=this.dom("<div>").addClass(this.prefix+"-popup-shortcut-item"),r="base"===s?i[o]:i[o].title,l=this.dom("<span>").addClass(this.prefix+"-popup-shortcut-title").html(this.lang.parse(r)),p=this.dom("<span>").addClass(this.prefix+"-popup-shortcut-kbd"),c=("base"===s?o.replace("meta",n):i[o].name.replace("meta",n)).split("+"),d=0;d<c.length;d++)c[d]="<span>"+c[d]+"</span>";p.html(c.join("+")),a.append(l),a.append(p),t[e]={html:a},e++}return e},_build:function(t,e,i){for(var n=e.split(","),s=n.length,o=0;o<s;o++)"string"!==typeof n[o]||Object.prototype.hasOwnProperty.call(i,"trigger")||this._handler(t,n[o].trim(),i)},_handler:function(t,e,i){e=e.toLowerCase().split(" ");for(var n=this.hotkeys[t.keyCode],s=91!==t.which&&String.fromCharCode(t.which).toLowerCase(),o="",a={},r=["meta","ctrl","alt","shift"],l=0;l<r.length;l++){var p=r[l];t[p+"Key"]&&n!==p&&(o+=p+"+")}93===t.keyCode&&(o+="meta+"),n&&(a[o+n]=!0),s&&(a[o+s]=!0,a[o+this.hotkeysShiftNums[s]]=!0,"shift+"===o&&(a[this.hotkeysShiftNums[s]]=!0));for(var c=e.length,d=0;d<c;d++)if(a[e[d]])return t.preventDefault(),this.triggered=!0,void this.app.api(i.command,i.params,t)},_remove:function(t,e){return Object.keys(e).reduce((function(i,n){return n!==t&&(i[n]=e[n]),i}),{})}}),p.add("module","offset",{get:function(t){t=this._getEl(t);var e=this.app.editor.getWinNode().getSelection(),i=!1;if(e&&e.rangeCount>0){var n=e.getRangeAt(0);if(t.contains(e.anchorNode)){var s=n.cloneRange();s.selectNodeContents(t),s.setEnd(n.startContainer,n.startOffset);var o=s.toString().length;i={start:o,end:o+n.toString().length}}}return i},set:function(t,e){!1===e&&(e={start:0,end:0}),t=this._getEl(t);var i,n=0,s=this.app.editor.getDocNode().createRange(),o=[t],a=!1,r=!1;for(s.setStart(t,0),s.collapse(!0);!r&&(i=o.pop());)if(3===i.nodeType){var l=n+i.length;!a&&e.start>=n&&e.start<=l&&(s.setStart(i,e.start-n),a=!0),a&&e.end>=n&&e.end<=l&&(s.setEnd(i,e.end-n),r=!0),n=l}else for(var p=i.childNodes.length;p--;)o.push(i.childNodes[p]);this.app.selection.setRange(s)},_getEl:function(t){return t?this.dom(t).get():this.app.editor.getLayout().get()}}),p.add("module","marker",{build:function(t){var e=this.dom("<span>").attr("id","selection-marker-"+t);return e.addClass(this.prefix+"-selection-marker"),e.html(this.opts.markerChar),e.get()},insert:function(){this.remove();var t=this.app.selection.get(),e=!t.collapsed;if(t.range){var i=this.build("start"),n=this.build("end"),s=t.range.cloneRange();e&&(s.collapse(!1),s.insertNode(n)),s.setStart(t.range.startContainer,t.range.startOffset),s.collapse(!0),s.insertNode(i),t.range.setStartAfter(i),e&&t.range.setEndBefore(n),this.app.selection.setRange(t.range)}},restore:function(){var t=this.find("start"),e=this.find("end"),i=this.app.selection.get(),n=i.range?i.range:this.app.editor.getDocNode().createRange();if(t){var s=!!e&&e.previousSibling,o=t.nextSibling;o=(!o||3!==o.nodeType||""!==o.textContent.replace(/[\n\t]/g,""))&&o,e?o&&"selection-marker-end"===o.id?this._restoreInject(n,t):s&&o?(n.selectNodeContents(s),n.collapse(!1),n.setStart(o,0)):s&&!o?(n.selectNodeContents(s),n.collapse(!1),n.setStartAfter(t)):(n.setStartAfter(t),n.setEndBefore(e)):o?(n.selectNodeContents(o),n.collapse(!0)):this._restoreInject(n,t),this.app.selection.setRange(n);var a=t&&e?2:1,r=this.app.offset.get();r={start:r.start-a,end:r.end-a},t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e),this.app.editor.setWinFocus(),this.app.offset.set(!1,r)}},find:function(t){var e=this.app.editor.getLayout().find("#selection-marker-"+t);return 0!==e.length&&e.get()},remove:function(){var t=this.find("start"),e=this.find("end");t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)},_restoreInject:function(t,e){var i=this.app.utils.createInvisibleChar();this.dom(e).after(i),t.selectNodeContents(i),t.collapse(!1)}}),p.add("module","state",{init:function(){this.started=!1,this.storage=!1,this.state=!1,this.passed=!0,this.undoStorage=[],this.redoStorage=[]},load:function(){this.clear(),this.trigger(!0)},stop:function(){this.clear()},clear:function(){this.storage=!1,this.state=!1,this.passed=!0,this.undoStorage=[],this.redoStorage=[]},get:function(){return this.undoStorage},add:function(t){t&&(t.ctrlKey||t.metaKey||this._isUndo(t)||this._isRedo(t))||!this.app.observer.trigger||(this.state=this._createState(),!1===this.started&&(this._setState(this.state,0),this.started=!0))},trigger:function(t){if(this.passed){var e=this._createState();this.state?e=this.state:this.state||t||(e=this.storage,this.started=!0),this._addState(e),this.storage=this._createState(),this.state=!1}},listen:function(t){return this._isUndo(t)?(t.preventDefault(),this.undo(),!0):this._isRedo(t)?(t.preventDefault(),this.redo(),!0):void(this.passed=!0)},undo:function(){if(this._hasUndo()){this.passed=!1;var t=this._getUndo();this._setRedo();var e=this.app.parser.parse(t[0]);this.app.editor.getLayout().html(e.children()),this._rebuild(t,"undo");var i=this.app.block.get(),n=!(!i||!i.isEditable())&&i.getBlock();this.app.offset.set(n,t[1])}},redo:function(){if(this._hasRedo()){this.passed=!1;var t=this.redoStorage.pop();this._addState(t);var e=this.app.parser.parse(t[0]);this.app.editor.getLayout().html(e.children()),this._rebuild(t,"redo");var i=this.app.block.get(),n=!(!i||!i.isEditable())&&i.getBlock();this.app.offset.set(n,t[1])}},_rebuild:function(t,e){this.app.editor.build(),this.app.editor.getLayout().find("."+this.prefix+"-block-state").each(function(t){this.app.block.set(t)}.bind(this)),this.app.broadcast("state."+e,{html:t[0],offset:t[1]})},_isUndo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&90===e&&!t.shiftKey&&!t.altKey},_isRedo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&(90===e&&t.shiftKey||89===e&&!t.shiftKey)&&!t.altKey},_hasUndo:function(){return 0!==this.undoStorage.length},_hasRedo:function(){return 0!==this.redoStorage.length},_getUndo:function(){return 1===this.undoStorage.length?this.undoStorage[0]:this.undoStorage.pop()},_createState:function(){var t=this.app.editor.getLayout().html();t=this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-block-focus").addClass(this.prefix+"-block-state")}.bind(this));var e=this.app.block.get(),i=!(!e||!e.isEditable())&&e.getBlock();return{html:this.app.parser.unparse(t,!0),offset:this.app.offset.get(i)}},_setState:function(t,e){this.undoStorage[e]=[t.html,t.offset]},_addState:function(t){var e=this.undoStorage[this.undoStorage.length-1];"undefined"===typeof e||e[0]!==t.html?(this.undoStorage.push([t.html,t.offset]),this._removeOverStorage()):e[1]=t.offset},_setRedo:function(){var t=this._createState();this.redoStorage.push([t.html,t.offset]),this.redoStorage=this.redoStorage.slice(0,this.opts.state.limit)},_removeOverStorage:function(){this.undoStorage.length>this.opts.state.limit&&(this.undoStorage=this.undoStorage.slice(0,this.undoStorage.length-this.opts.state.limit))}}),p.add("module","sync",{build:function(){this.syncedHtml=this.app.$element.val()},trigger:function(){this.opts.editor.sync&&(this.typingTimer&&clearTimeout(this.typingTimer),this.typingTimer=setTimeout(function(){var t=this._getHtml();this.is(t)&&this._sync(t)}.bind(this),300))},invoke:function(){var t=this._getHtml();this.syncedHtml=t,this._sync(t)},is:function(t){var e=!1;return this.syncedHtml!==t&&(this.syncedHtml=t,e=!0),e},_getHtml:function(){var t=this.app.editor.getLayout().html();return this.app.parser.unparse(t)},_sync:function(t){var e=this.app.broadcast("editor.before.change",{html:t});e.isStopped()||(this.app.$element.val(e.get("html")),this.app.autosave.send(),this.app.state.trigger(),this.app.broadcast("editor.change",e))}}),p.add("module","placeholder",{start:function(){this.placeholder=!1,this.$layout=this.app.editor.getLayout(),this._build()},handleClick:function(t){this.dom(t.target).hasClass(this.prefix+"-placeholder")&&(t.preventDefault(),t.stopPropagation(),this.app.editor.setFocus("start"))},trigger:function(){this.placeholder&&this.app.editor.isEmpty(!0)?this.show():this.hide()},toggle:function(){this.observerTimer&&clearTimeout(this.observerTimer),this.observerTimer=setTimeout(this.trigger.bind(this),10)},show:function(){this.$layout.addClass(this.prefix+"-placeholder")},hide:function(){this.$layout.removeClass(this.prefix+"-placeholder")},change:function(t){this.opts.placeholder=t,this._rebuild(),this.app.editor.isEmpty(!0)&&this.app.editor.setEmpty()},_build:function(){this._rebuild(),this.toggle()},_rebuild:function(){var t=this.opts.placeholder,e=this.app.$element.attr("placeholder");(!1!==t||e)&&(this.$layout.attr("placeholder",!1!==t?t:e),this.placeholder=!0)}}),p.add("module","list",{indent:function(){var t=this.app.selection.get(),e=this.app.selection.getBlock(),i=this.dom(e),n=i.prevElement(),s=n.get(),o=t.collapsed&&e&&s&&"LI"===s.tagName;if(this.app.selection.save(e),o){var a=(n=this.dom(s)).children("ul, ol"),r=i.closest("ul, ol");if(0!==a.length)a.append(i);else{var l=r.get().tagName.toLowerCase(),p=this.dom("<"+l+">");p.append(i),n.append(p)}}return this.app.selection.restore(),o},outdent:function(){var t=this.app.selection.get(),e=this.app.selection.getBlock(),i=this.dom(e),n=!1;if(t.collapsed&&e){var s,o,a=i.parent(),r=a.closest("li"),l=i.prevElement(),p=i.nextElement(),c=l.get(),d=p.get(),h=!1===c,u=!1!==c&&!1!==d;if(this.app.selection.save(e),0!==r.length){if(u){s=this._getAllNext(i.get()),o=this.dom("<"+a.get().tagName.toLowerCase()+">");for(var m=0;m<s.length;m++)o.append(s[m]);r.after(i),i.append(o)}else r.after(i),0===a.children().length?a.remove():h&&i.append(a);n=!0}this.app.selection.restore()}return n},_getAllNext:function(t){for(var e=[];t;){if(!(t=this.dom(t).nextElement().get()))return e;e.push(t)}return e}}),p.add("module","cleaner",{cleanHtml:function(t){t=this.app.broadcastHtml("editor.before.clean",t);var e={},i=this.opts.paste.blockTags.concat(this.opts.paste.inlineTags).concat(this.opts.paste.formTags),n=this._isPages(t),s=this._isHtmlMsWord(t),o=this._isEditor(t);t=this.app.content.store(t,"embed",e,0),t=this.app.content.removeDoctype(t),t=(t=this.app.content.removeTags(t,this.opts.tags.denied)).trim(),t=this.app.content.removeComments(t),t=this.app.content.removeTagsWithContent(t,["script","style"]),t=n?this._cleanPages(t):t,t=s?t:this._cleanGDocs(t),t=this._encodePhp(t),t=this.app.content.removeTagsExcept(t,i),t=s?this._cleanMsWord(t):t;var a=!1;if(!o&&this.app.event.pasteEvent&&(t=this.app.content.restore(t,"embed",e),a=!0),!o){var r=0!==this.opts.paste.keepClass.length?this.opts.paste.keepClass.join(","):"",l=0!==this.opts.paste.keepAttrs.length?this.opts.paste.keepAttrs.join(","):"";t=this.app.utils.wrap(t,(function(t){var e=t.find("*");e.not(r).removeAttr("class"),e.not(l).each((function(t){for(var e=t.get(),i=e.attributes,n=i.length-1;n>=0;n--){var s=i[n].name;"class"!==s&&"dir"!==s&&-1===s.search(/^data-/)&&(("IMG"!==e.tagName||"src"!==s&&"alt"!==s)&&("A"!==e.tagName||"href"!==s&&"target"!==s)&&e.removeAttribute(s))}}))}))}return a||(t=this.app.content.restore(t,"embed",e)),t=o?this.app.content.cacheStyle(t):this.app.content.removeStyleAttr(t),t=(t=(t=(t=(t=(t=this.app.content.removeEmptyInlines(t)).replace(/<figure[^>]*><\/figure>/gi,"")).replace(/<p>&nbsp;<\/p>/gi,"<p></p>")).replace(/<p><br\s?\/?><\/p>/gi,"<p></p>")).replace(/^<li/gi,"<ul><li")).replace(/<\/li>$/gi,"</li></ul>"),(s||n)&&(t=(t=t.replace(/<p><\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")),t=this.app.utils.wrap(t,function(t){t.find(".Apple-converted-space").unwrap(),t.find("ul, ol").each(this._placeListToItem.bind(this)),t.find("li p").unwrap()}.bind(this)),this.app.broadcastHtml("editor.clean",t)},_encodePhp:function(t){return t=(t=(t=t.replace("<?php","&lt;?php")).replace("<?","&lt;?")).replace("?>","?&gt;")},_isEditor:function(t){return t.match(new RegExp('meta\\stype="'+this.prefix+'-editor"',"i"))},_isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},_isPages:function(t){return t.match(/name="Generator"\scontent="Cocoa\sHTML\sWriter"/i)},_placeListToItem:function(t){var e=t.get(),i=e.previousSibling;if(i&&"LI"===i.tagName){var n=this.dom(i);n.find("p").unwrap(),n.append(e)}},_cleanPages:function(t){return t=(t=t.replace(/\sclass="s[0-9]"/gi,"")).replace(/\sclass="p[0-9]"/gi,"")},_cleanGDocs:function(t){return t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?(bold|600|700)|font-weight:\s?(bold|600|700);\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$4</i></b>")).replace(/<span[^>]*font-style:\s?italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight:\s?(bold|600|700)[^>]*>([\w\W]*?)<\/span>/gi,"<b>$2</b>")},_cleanMsWord:function(t){t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]+?-->/gi,"")).trim()).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|meta|link|style|\w:\w+)(?=[\s/>]))[^>]*>/gi,"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/&nbsp;/gi," ")).replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,(function(t,e){return e.length>0?e.replace(/./," ").slice(Math.floor(e.length/2)).split("").join("\xa0"):""}));for(var e="",i=(t=(t=(t=(t=(t=(t=this.app.utils.wrap(t,function(t){t.find("p").each((function(t){var e=/mso-list:\w+ \w+([0-9]+)/.exec(t.attr("style"));e&&t.attr("data-listLevel",parseInt(e[1],10))})),this._parseWordLists(t),t.find("[align]").removeAttr("align"),t.find("[name]").removeAttr("name"),t.find("span").each((function(t){var e=t.attr("style");/mso-list:Ignore/.exec(e)?t.remove():t.unwrap()})),t.find("[style]").removeAttr("style"),t.find("[class^='Mso']").removeAttr("class"),t.find("a").filter((function(t){return!t.attr("href")})).unwrap()}.bind(this))).replace(/<p><img(.*?)>/gi,"<p><img$1></p><p>")).replace(/<p[^>]*><\/p>/gi,"")).replace(/<li>\xb7/gi,"<li>")).trim()).replace(/\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi,"/$1>\n<$2")).split(/\n/),n=0;n<i.length;n++){var s=""!==i[n]&&-1===i[n].search(/>$/)?" ":"\n";e+=i[n]+s}return e=e.trim()},_parseWordLists:function(t){var e=0,i=null,n=null,s=null;t.find("p").each(function(t){var o=t.attr("data-listLevel");if(null===o&&t.hasClass("MsoListParagraphCxSpMiddle")&&(o=1),null!==o){var a=t.text(),r=/^\s*\w+\./.test(a)?"<ol></ol>":"<ul></ul>";if(t.hasClass("MsoListParagraphCxSpFirst")||t.hasClass("MsoNormal")?(n=this.dom(r),t.before(n)):o>e&&0!==e&&(s=this.dom(r),i.append(s),n=s),o<e)for(var l=e-o+1,p=0;p<l;p++)n=n.parent();t.find("span").first().unwrap(),i=this.dom("<li>"+t.html().trim()+"</li>"),null===n&&(t.before(r),n=t.prev()),n.append(i),t.remove(),e=o}else n=null,e=0}.bind(this))}}),p.add("module","tidy",{init:function(){},parse:function(t){t=this.app.content.encodeAttrSings(t);var e=["li"],i=["li"];this.lineBefore=new RegExp("^<(/?"+e.join("|/?")+"|"+i.join("|")+")[ >]"),this.lineAfter=new RegExp("^<(/?"+e.join("|/?")+"|/"+i.join("|/")+")[ >]"),this.newLevel=new RegExp("^</?("+["p","ul","ol","li","div","h1","h2","h3","h4","h5","h6","blockquote","figure","figcaption","table","thead","tbody","tfoot","tr","td","th","dl","dt","dd"].join("|")+")[ >]");var n=0,s=t.length,o=0,a=null,r=null,l="",p="",c="";for(this.cleanlevel=0;n<s;n++){if(o=n,-1===t.substr(n).indexOf("<"))return p+=t.substr(n),this.finish(p);for(;o<s&&"<"!==t.charAt(o);)o++;for(n!==o&&((c=t.substr(n,o-n)).match(/^\s{2,}$/g)||("\n"===p.charAt(p.length-1)?p+=this.getTabs():"\n"===c.charAt(0)&&(p+="\n"+this.getTabs(),c=c.replace(/^\s+/,"")),p+=c)),a=o;o<s&&">"!==t.charAt(o);)o++;var d;if(n=o,"!--"===(l=t.substr(a,o-a)).substr(1,3)){if(!l.match(/--$/)){for(;"--\x3e"!==t.substr(o,3);)o++;o+=2,l=t.substr(a,o-a),n=o}"\n"!==p.charAt(p.length-1)&&(p+="\n"),p+=this.getTabs(),p+=l+">\n"}else"!"===l[1]?p=this.placeTag(l+">",p):"?"===l[1]?p+=l+">\n":d===l.match(/^<(script|style|pre)/i)?(d[1]=d[1].toLowerCase(),l=this.cleanTag(l),p=this.placeTag(l,p),(r=String(t.substr(n+1)).toLowerCase().indexOf("</"+d[1]))&&(c=t.substr(n+1,r),n+=r,p+=c)):(l=this.cleanTag(l),p=this.placeTag(l,p))}return this.finish(p)},getTabs:function(){for(var t="",e=0;e<this.cleanlevel;e++)t+="    ";return t},finish:function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/,"")).replace(/[\s\n]*$/,"")).replace(/<li(.*?)>[\s\n]*/gi,"<li$1>")).replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\s\n]*<\/\1>/gi,"<$1$2></$1>")).replace(/[\s\n]*<\/li>/gi,"</li>")).replace(/<script(.*?)>\n<\/script>/gi,"<script$1><\/script>"),t=this.app.content.decodeAttrSings(t),this.cleanlevel=0,t},cleanTag:function(t){var e,i="",n="";for((t=(t=(t=t.replace(/\n/g," ")).replace(/\s{2,}/g," ")).replace(/^\s+|\s+$/g," ")).match(/\/$/)&&(n="/",t=t.replace(/\/+$/,""));e=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)e[2]?i+=e[1].toLowerCase()+"="+e[2]:e[1]&&(i+=e[1].toLowerCase()),i+=" ",t=t.substr(e[0].length);return i.replace(/\s*$/,"")+n+">"},placeTag:function(t,e){var i=t.match(this.newLevel);return(t.match(this.lineBefore)||i)&&(e=e.replace(/\s*$/,""),e+="\n"),i&&"/"===t.charAt(1)&&this.cleanlevel--,"\n"===e.charAt(e.length-1)&&(e+=this.getTabs()),i&&"/"!==t.charAt(1)&&this.cleanlevel++,e+=t,(t.match(this.lineAfter)||t.match(this.newLevel))&&(e=e.replace(/ *$/,""),e+="\n"),e}}),p.add("module","source",{start:function(){this.eventname=this.prefix+"-source-events",this._build()},toggle:function(){this.is()?this.close():this.open()},is:function(){return"none"!==this.app.container.get("source").css("display")},open:function(){this.app.broadcast("source.before.open");var t=this.app.editor.getContent();t=this.app.tidy.parse(t);var e=this.app.container.get("editor").height();this.$source.height(e),this.$source.val(t),this.$source.on("focus."+this.eventname,this._handleFocus.bind(this)),this.$source.on("input."+this.eventname,this._handleChanges.bind(this)),this.$source.on("keydown."+this.eventname,this.app.input.handleTextareaTab.bind(this)),this.app.editor.unselectAll(),this.app.container.get("editor").hide(),this.app.container.get("source").show();var i=this.app.codemirror.create({el:this.$source,height:e,focus:!0});i&&(i.on("change",this._handleChanges.bind(this)),i.on("focus",this._handleFocus.bind(this))),this.app.editor.disableUI(),this.app.toolbar.setToggled("html"),this.app.broadcast("source.open")},close:function(){this.app.broadcast("source.before.close");var t=this.getContent();this.app.codemirror.destroy(),this.$source.off("."+this.eventname),this.app.container.get("source").hide(),this.app.container.get("editor").show(),this.app.editor.setContent({html:t,caret:"start"}),this.app.editor.enableUI(),this.app.toolbar.unsetToggled("html"),this.app.broadcast("source.close")},update:function(t){var e=this.app.editor.isTextarea()?"val":"html";this.app.$element[e](t)},getContent:function(){var t=this.$source.val();return t=this.app.codemirror.val(t)},_build:function(){this.opts.source&&(this.$source=this.dom("<textarea>").addClass(this.prefix+"-source"),this.$source.attr("data-gramm_editor",!1),this.app.container.get("source").append(this.$source))},_handleFocus:function(){this.app.editor.setFocus()},_handleChanges:function(t){var e=this.getContent();this.update(e),this.app.broadcast("source.change",{e:t})}}),p.add("module","content",{init:function(){this._selectors={code:["pre","code"],embed:["figure"],noneditable:["."+this.opts.noneditable.classname],images:["img"],links:["a"]}},paragraphize:function(t){return this.app.paragraphizer.paragraphize(t)},encodeEntities:function(t){return this.decodeEntities(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},encodeCode:function(t){return t=(t=(t=(t=(t=(t=(t=(t=this.encodeAttrSings(t)).replace(/<\s/gi,"&lt; ")).replace(/<([^>]+)</gi,"&lt;$1<")).replace(/<(.*?)>/gi,"xtagstartz$1xtagendz")).replace(/xtagstartzpre(.*?)xtagendz/g,"<pre$1>")).replace(/xtagstartzcode(.*?)xtagendz/g,"<code$1>")).replace(/xtagstartz\/codextagendz/g,"</code>")).replace(/xtagstartz\/prextagendz/g,"</pre>"),t=(t=(t=this._encodeCode(t)).replace(/xtagstartz([\w\W]*?)xtagendz/g,"<$1>")).replace(/xtagstartz\/(.*?)xtagendz/g,"</$1>"),t=this.decodeAttrSings(t)},encodeAttrSings:function(t){var e=t.match(/="(.*?)"/g);if(null!==e)for(var i=0;i<e.length;i++)if(-1===e[i].search(/^"</)&&-1===e[i].search(/>"$/)){var n=e[i].replace(">","xmoresignz");n=n.replace("<","xlesssignz"),t=t.replace(e[i],n)}return t},decodeAttrSings:function(t){return t=(t=t.replace(/xmoresignz/gi,">")).replace(/xlesssignz/gi,"<")},decodeEntities:function(t){return String(t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},decodeHref:function(t){var e=t.match(new RegExp('(href=".*?)(&amp;)(.*?">)',"g"));if(null!==e)for(var i=0;i<e.length;i++)t=t.replace(e[i],e[i].replace(/&amp;/g,"&"));return t},sanitize:function(t){return t=this.app.utils.wrap(t,function(t){t.find("[src]").each(this._sanitizeSrc),t.find("a").each(this._sanitizeHref),t.find("a,b,i,strong,em,svg,img,details,audio").each(this._sanitizeEvents)}.bind(this))},escapeHtml:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},store:function(t,e,i,n){for(var s=this._selectors[e],o=0;o<s.length;o++){var a=this._getElementsFromHtml(t,s[o]);t=this._store(t,e,a,i,n)}return t},restore:function(t,e,i){if("undefined"===typeof i[e])return t;for(var n=0;n<i[e].length;n++)t=t.replace("####_"+e+n+"_####",i[e][n]);return t},storeComments:function(t,e){var i=t.match(new RegExp("\x3c!--([\\w\\W]*?)--\x3e","gi"));if(null===i)return t;for(var n=0;n<i.length;n++)t=t.replace(i[n],"#####xstarthtmlcommentzz"+n+"xendhtmlcommentzz#####"),e.push(i[n]);return t},restoreComments:function(t,e){for(var i=0;i<e.length;i++){var n=e[i].replace(/\$/gi,"&#36;");t=t.replace("#####xstarthtmlcommentzz"+i+"xendhtmlcommentzz#####",n)}return t},cacheStyle:function(t){var e=this.opts.tags.block.join(",")+",img,"+this.opts.tags.inline.join(",");return this.app.utils.wrap(t,function(t){t.find(e).each(this._cacheStyle.bind(this))}.bind(this))},recacheStyle:function(t){return this.app.utils.wrap(t,function(t){t.find("[data-"+this.prefix+"-style-cache]").each(this._recacheStyle.bind(this))}.bind(this))},fixListMargin:function(t){var e=parseInt(t.css("margin-left"));if(0!==e){var i=parseInt(t.css("padding-left"));t.css({"margin-left":0,"padding-left":i+e+"px"}),t.attr(this.prefix+"-list-left",e)}},unfixListMargin:function(t){t.attr(this.prefix+"-list-left")&&(t.css({"padding-left":"","margin-left":""}),t.removeAttr(this.prefix+"-list-left"))},addNofollow:function(t){return this.opts.link.nofollow?this.app.utils.wrap(t,(function(t){t.find("a").attr("rel","nofollow")})):t},addHttps:function(t){return this.opts.editor.https?t=(t=(t=t.replace('href="http://','href="https://')).replace('src="http://','src="https://')).replace('srcset="http://','srcset="https://'):t},addSpaceToBlocks:function(t){return t.replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1> ")},addBrToBlocks:function(t){return t.replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1><br>")},addPredefinedTagClass:function(t){var e=t.get().tagName.toLowerCase(),i="undefined"!==typeof this.opts.classes.tags?this.opts.classes.tags:this.opts.classes;"undefined"!==typeof i[e]&&t.addClass(i[e])},addPredefinedBlockClass:function(t){var e=t.attr("data-"+this.prefix+"-type"),i=this.opts.classes.blocks;"undefined"!==typeof i[e]&&t.addClass(i[e])},getPredefinedBlocks:function(){var t=[];return Object.keys(this.opts.classes.blocks).forEach((function(e){t.push(e)})),t},getPredefinedTags:function(){var t=[],e="undefined"!==typeof this.opts.classes.tags?this.opts.classes.tags:this.opts.classes;return Object.keys(e).forEach((function(e){t.push(e)})),t},getText:function(t){var e="";if(3===t.nodeType)e=t.nodeValue;else{for(var i=0;i<t.childNodes.length;i++)e+=this.getText(t.childNodes[i]);var n=1===t.nodeType?getComputedStyle(t).getPropertyValue("display"):"";(n.match(/^block/)||n.match(/list/)||"BR"===t.tagName||"HR"===t.tagName)&&(e+="\n")}return e},getTextFromHtml:function(t,e){var i={};e=d.extend({},{br:!1,nl:!1,trimlines:!0,images:!1,links:!1},e),t=this.store(t,"code",i,0),t=e.links?this.store(t,"links",i,0):t,t=(t=(t=(t=(t=(t=(t=(t=(t=e.images?this.store(t,"images",i,0):t).replace(/<(ul|ol)>\s+<li>/gi,"<$1><li>")).replace(/<li[^>]*>\n/gi,"<li$1>")).replace(/<p[^>]*>(\s+|)<\/p>/gi,"xemptyz")).replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<script[\s\S]*?script>/gi,"")).replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1>\n")).replace(/&(lt|gt);/gi,"x$1z");var n=this.dom("<div>").html(t);if(t=this.getText(n.get()),e.trimlines){for(var s="",o=t.split("\n"),a=0;a<o.length;a++)s+=o[a].trim()+"\n";t=s}return t=(t=(t=t.replace(/[\n]+/g,"\n")).replace("xemptyz","\n")).replace(/x(lt|gt)z/gi,"&$1;"),t=e.br?(t=t.replace(/\n/g,"<br>\n")).replace(/<br\s?\/?>\n?$/gi,""):e.nl?t:t.replace(/\n/gi," "),t=this.restore(t,"code",i),t=e.links?this.restore(t,"links",i):t,t=(t=(t=(t=(t=e.images?this.restore(t,"images",i):t).replace(/<pre[^>]*>/g,"")).replace(/<code[^>]*>/g,"")).replace(/<\/pre>\n?/g,"")).replace(/<\/code>/g,""),e.images||(t=(t=t.replace(/<img[\s\S]*?>/gi,"")).replace(/<a[^>]*>(\s+|)<\/a>/gi,"")),t.trim()},extractHtmlFromCaret:function(t){var e=this.dom(t).get(),i=this.app.selection.getRange();if(i){var n=i.cloneRange();return n.selectNodeContents(e),n.setStart(i.endContainer,i.endOffset),n.extractContents()}},isEmptyHtml:function(t,e){return t=t.trim(),t=(t=(t=(t=(t=(t=(t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/^&nbsp;$/gi,"1")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>\s\S<\/p>$/i,"")).replace(/<hr(.*?[^>])>$/i,"hr")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source"),t=this.removeComments(t),""===(t=(t=(t=(t=e?t.replace(/<p[^>]*><\/p>/gi,""):t).replace(/<[^/>]><\/[^>]+>/gi,"")).replace(/<[^/>]><\/[^>]+>/gi,"")).trim())},isLine:function(t){var e=document.createElement("div");return e.innerHTML=t,0===this.dom(e).find(this.opts.tags.block.join(",")+",img").length},removeDoctype:function(t){return t.replace(new RegExp("<!doctype[^>]*>","gi"),"")},removeComments:function(t){return t.replace(/<!--[\s\S]*?-->\n?/g,"")},removeTags:function(t,e){var i=e?/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi:/(<([^>]+)>)/gi,n=e?function(t,i){return-1===e.indexOf(i.toLowerCase())?t:""}:"";return t.replace(i,n)},removeTagsExcept:function(t,e){if(void 0===e)return t.replace(/(<([^>]+)>)/gi,"");return t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(function(t,i){return-1===e.indexOf(i.toLowerCase())?"":t}))},removeTagsWithContent:function(t,e){return this.app.utils.wrap(t,(function(t){t.find(e.join(",")).remove()}))},removeMarkers:function(t){return this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-plus-button").remove(),t.find("."+this.prefix+"pastemarker").removeClass(this.prefix+"pastemarker"),t.find("."+this.prefix+"pasteitems").removeClass(this.prefix+"pasteitems"),t.find("."+this.prefix+"-selection-marker").remove()}.bind(this))},removeEmptySpans:function(t){return this.app.utils.wrap(t,function(t){t.find("span").each(this._removeEmptySpan.bind(this))}.bind(this))},removeEmptyInlines:function(t){return this.app.utils.wrap(t,function(t){t.find(this.opts.tags.inline.join(",")).each(this._removeEmptyTag.bind(this))}.bind(this))},removeEmptyAttrs:function(t,e){return this.app.utils.wrap(t,(function(t){for(var i=0;i<e.length;i++)t.find("["+e[i]+'=""]').removeAttr(e[i])}))},removeBlockTags:function(t,e,i){var n=this.opts.tags.block.concat();return i&&(n=this.app.utils.removeFromArrayByValue(n,i)),e&&(e=e?this.app.utils.extendArray(n,e):n),this.removeTags(t,e)},removeBlockTagsInside:function(t,e){return this.blockListTags=this.app.utils.removeFromArrayByValue(this.opts.tags.block.concat(),["ul","ol","li"]),this.app.utils.wrap(t,function(t){t.find(e.join(",")).each(this._removeBlockTagsInside.bind(this))}.bind(this))},removeInlineStyles:function(t){var e=this.app.utils.removeFromArrayByValue(this.opts.tags.inline,"a");return this.app.utils.wrap(t,(function(t){t.find(e.join(",")).removeAttr("style")}))},removeStyleAttr:function(t,e){return e=e||"",this.app.utils.wrap(t,function(t){t.find("*").not("[data-"+this.prefix+"-style-cache]"+e).removeAttr("style")}.bind(this))},_cacheStyle:function(t){var e="data-"+this.prefix+"-style-cache",i=t.attr("style");i?(i=i.replace(/"/g,""),t.attr(e,i)):i&&""!==i||t.removeAttr(e)},_recacheStyle:function(t){var e="data-"+this.prefix+"-style-cache",i=t.attr(e);t.attr("style",i).removeAttr(e)},_cleanEmpty:function(t){return t=t.trim(),t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")},_removeEmptySpan:function(t){0===t.get().attributes.length&&t.unwrap()},_removeEmptyTag:function(t){var e=t.html().trim();0===t.get().attributes.length&&""===e&&t.unwrap()},_removeBlockTagsInside:function(t){var e="LI"===t.get().tagName?this.blockListTags:this.opts.tags.block;t.find(e.join(",")).append("<br>").unwrap()},_store:function(t,e,i,n,s){if(!i)return t;"undefined"===typeof n[e]&&(n[e]=[]);for(var o=0;o<i.length;o++)n[e][s]=i[o],t=t.replace(i[o],"####_"+e+s+"_####"),s++;return t},_getElementsFromHtml:function(t,e){var i=[];return this.dom("<div>").html(t).find(e).each((function(t){i.push(t.get().outerHTML)})),i},_sanitizeSrc:function(t){var e=t.get(),i=e.getAttribute("src");(-1!==i.search(/^javascript:/i)||"IMG"!==e.tagName&&-1!==i.search(/^data:/i))&&e.setAttribute("src","")},_sanitizeHref:function(t){var e=t.get(),i=e.getAttribute("href");i&&-1!==i.search(/^javascript:/i)&&e.setAttribute("href","")},_sanitizeEvents:function(t){t.removeAttr("onload onerror ontoggle onwheel onmouseover oncopy")},_encodeCode:function(t){return this.app.utils.wrap(t,function(t){t.find("pre code, pre, code").each(this._encodeNode.bind(this))}.bind(this))},_encodeNode:function(t){var e=t.get(),i=e.firstChild,n=e.innerHTML;if("PRE"!==e.tagName||!i||"CODE"!==i.tagName){n=(n=n.replace(/xtagstartz/g,"<")).replace(/xtagendz/g,">");var s=this.decodeEntities(n);e.textContent=this._encodeNodeHtml(s)}},_encodeNodeHtml:function(t){return t=t.replace(/&nbsp;/g," ").replace(/<br\s?\/?>/g,"\n"),t=this.opts.code.spaces?t.replace(/\t/g,new Array(this.opts.code.spaces+1).join(" ")):t}}),p.add("module","autoparse",{parse:function(t){if(!this.opts.paste.autoparse)return t;var e=this.app.block.get(),i=[];t=this.app.content.storeComments(t,i),t=this.app.content.removeDoctype(t);var n,s=["figure","html","form","pre","div","span","video","object","iframe","code","a","img","link","script"],o=["div","img","html","span"],a=[],r=0;for(n=0;n<s.length;n++){var l=-1!==o.indexOf(s[n])?"<"+s[n]+"[^>]*>":"<"+s[n]+"[^>]*>([\\w\\W]*?)</"+s[n]+">",p=t.match(new RegExp(l,"gi"));if(null!==p)for(var c=0;c<p.length;c++)t=t.replace(p[c],"#####replaceparse"+r+"#####"),a.push(p[c]),r++}if(!(t=t.replace("&amp;","&")).match(this.opts.regex.aurl1)&&!t.match(this.opts.regex.aurl2)||t.match(this.opts.regex.imageurl)||(t=this._formatLinks(t)),t.match(this.opts.regex.imageurl)){var d=t.match(this.opts.regex.imageurl);for(n=0;n<d.length;n++)t=t.replace(d[n],this._splitBlock(e,'<img src="'+d[n]+'">'))}return t=this._restoreReplaced(a,t),t=this.app.content.restoreComments(t,i),t=this._restoreReplaced(a,t)},_splitBlock:function(t,e){return t?e="\n"+e+"\n":e},_formatLinks:function(t){var e=!1!==this.opts.paste.linkTarget?' target="'+this.opts.paste.linkTarget+'"':"",i=this.opts.editor.https?"https":"http",n=this;return t=(t=t.replace(this.opts.regex.aurl1,(function(t){return'<a href="'+t+'"'+e+">"+n._subLinkText(t)+"</a>"}))).replace(this.opts.regex.aurl2,(function(t,s,o){return s+'<a href="'+i+"://"+o+'"'+e+">"+n._subLinkText(o)+"</a>"}))},_subLinkText:function(t){return t=-1===(t=t.length>this.opts.link.size?t.substring(0,this.opts.link.size)+"...":t).search("%")?decodeURIComponent(t):t},_restoreReplaced:function(t,e){for(var i=0;i<t.length;i++)e=e.replace("#####replaceparse"+i+"#####",t[i]);return e}}),p.add("module","caret",{set:function(t,e){var i=this.dom(t).get(),n=this.app.editor.getDocNode().createRange();i&&this._isInPage(i)&&(this.app.editor.setWinFocus(),this._isInline(i)&&this._isNon(i)&&("start"===e?e="before":"end"===e&&(e="after")),this[{start:"_setStart",end:"_setEnd",before:"_setBefore",after:"_setAfter"}[e]](n,i),this.app.selection.setRange(n))},is:function(t,e,i,n,s){var o=this.dom(t).get(),a=this.app.editor.getWinNode().getSelection(),r=!1;if(!o||!a.isCollapsed)return r;var l=this._getPosition(o,n,s),p=this._getSize(o,i,n);return"end"===e?r=l===p:"start"===e&&(r=0===l),r},_setStart:function(t,e){t.setStart(e,0),t.collapse(!0);var i=this._getInlineInside(e);i&&(t=this._setStartInline(t,i)),this._isInline(e)&&this._insertInvisibleNode(t)},_setStartInline:function(t,e){var i=this.app.element.getAllInlines(e)[0];t.selectNodeContents(i),t.collapse(!0)},_setEnd:function(t,e){var i=1===e.nodeType&&e.lastChild;i&&this._isInline(i)&&(e=i),t.selectNodeContents(e),t.collapse(!1)},_setBefore:function(t,e){t.setStartBefore(e),t.collapse(!0),this._isInline(e)&&this._insertInvisibleNode(t,e)},_setAfter:function(t,e){t.setStartAfter(e),t.collapse(!0);var i=3!==e.nodeType&&e.tagName.toLowerCase();(this._isInline(e)||"br"===i||"svg"===i)&&this._insertInvisibleNode(t)},_insertInvisibleNode:function(t,e){var i=this.app.utils.createInvisibleChar();return e?e.parentNode.insertBefore(i,e):t.insertNode(i),t.selectNodeContents(i),t.collapse(!1),i},_getInlineInside:function(t){var e=t.firstChild;if(this._isInline(e)){for(var i=e.firstChild;i;){if(this._isInline(i))return i;i=i.firstChild}return e}},_getSize:function(t,e,i){var n,s=3===t.nodeType;if(e&&0!==e.length){var o=this.dom(t).clone();o.find(e.join(",")).remove(),n=o.html().trim()}else n=s?t.textContent:t.innerHTML,n=s||!1===i?n:n.trim();return this._trimmed(n,s,i).length},_getPosition:function(t,e,i){var n=this.app.editor.getWinNode().getSelection().getRangeAt(0),s=n.cloneRange(),o=document.createElement("div"),a=3===t.nodeType;s.selectNodeContents(t),s.setEnd(n.endContainer,n.endOffset),o.appendChild(s.cloneContents());var r=a||!1===e?o.innerHTML:o.innerHTML.trim(),l=-1!==r.search(/<\/?br\s?\/?>$/g)?1:0;return!1===i&&(l=0),(r=this._trimmed(r,a,e)).length+l},_trimmed:function(t,e,i){return!1===i?t=t.replace(/\n$/g,""):(""===(t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,"")).replace(/\s+/g," "))||e||(t=t.replace(/\s$/,"")),t)},_isInline:function(t){return this.app.element.is(t,"inline")},_isInPage:function(t){var e=!1,i=this.app.editor.getDocNode();return t&&t.nodeType&&(e=t!==i.body&&i.body.contains(t)),e},_isNon:function(t){return"false"===t.getAttribute("contenteditable")}}),p.add("module","selection",{init:function(){this.savedSelection=!1,this.savedMarker=!1,this.savedPosition=!1,this.savedRange=!1},get:function(){var t=this._getSelection(),e=this._getRange(t),i=this._getCurrent(t);return{selection:t,range:e,collapsed:this._getCollapsed(t,e),current:i,parent:this._getParent(i)}},getRange:function(){return this._getRange(this.get().selection)},getNodes:function(t){var e=this.get(),i=t&&(t.type&&"inline"===t.type||t.tags&&-1!==t.tags.indexOf("a")),n=i?"_getAllRangeNodes":"_getRangeNodes",s=[];return(s=this.app.editor.isAllSelected()?this.app.editor.getLayout().children().getAll():e.selection&&e.range?this[n](e.range):s).length>0?this._filterNodes(s,e.range,i,t):s},getCurrent:function(){var t=this._getSelection();return this._getCurrent(t)},getParent:function(){var t=this.getCurrent();return this._getParent(t)},getElement:function(t){return this._getElement(t,"element")},getInline:function(t){return this._getElement(t,"inline")},getTopInline:function(t){for(var e=t?this.dom(t).get():this.getCurrent(),i=[];e&&this._getElement(e,"inline");)i.push(e),e=e.parentNode;return i[i.length-1]},getDataBlock:function(t){var e=this._getSelection(),i=t||this._getCurrent(e);if(i)for(i=this.dom(i).get();i;){if(1===i.nodeType&&i.getAttribute("data-"+this.prefix+"-type"))return this.dom(i);i=i.parentNode}return this.dom()},getBlock:function(t){return this._getElement(t,"block")},getText:function(t,e){var i=this.get(),n=!1;if(!i.selection)return!1;if(t&&i.range){e="undefined"===typeof e?1:e;var s=this.app.editor.getLayout().get(),o=i.range.cloneRange();"before"===t?(o.collapse(!0),o.setStart(s,0),n=o.toString().slice(-e)):"after"===t&&(o.selectNodeContents(s),o.setStart(i.range.endContainer,i.range.endOffset),n=o.toString().slice(0,e))}else n=i.selection?i.selection.toString():"";return n},getHtml:function(){var t="",e=this.get();if(e.selection){var i=e.range.cloneContents(),n=document.createElement("div");n.appendChild(i),t=(t=n.innerHTML).replace(/<p><\/p>$/i,"")}return t},getPosition:function(){var t=this.getRange(),e={top:0,left:0,width:0,height:0};if(this.app.editor.getWinNode().getSelection&&t.getBoundingClientRect){var i=(t=t.cloneRange()).startOffset-1;t.setStart(t.startContainer,i<0?0:i);var n=t.getBoundingClientRect();e={top:n.top,bottom:n.bottom,left:n.left,width:n.right-n.left,height:n.bottom-n.top}}return e},set:function(t,e){t&&(t.removeAllRanges(),t.addRange(e))},setRange:function(t){this.set(this.app.editor.getWinNode().getSelection(),t)},is:function(t){if("undefined"===typeof t)return this.get().selection;for(var e=this.dom(t).get(),i=this.getNodes(),n=0;n<i.length;n++)if(i[n]===e)return!0;return!1},isCollapsed:function(){var t=this.get();return this._getCollapsed(t.selection,t.range)},isIn:function(t){var e=this.dom(t).get(),i=this.getCurrent();return!(!i||!e)&&e.contains(i)},isAll:function(t){var e=!t,i=t?this.dom(t).get():this.app.editor.getLayout().get(),n=this.app.editor.getWinNode().getSelection(),s=this._getRange(n),o=!!e||this.is(i);return!n.isCollapsed&&(!!o&&("undefined"!==typeof i.textContent&&i.textContent.trim().length===s.toString().trim().length))},select:function(t){var e=t?this.dom(t).get():this.app.editor.getLayout().get(),i=this.app.editor.getDocNode().createRange();i.selectNodeContents(e),this.setRange(i)},removeAllRanges:function(){var t=this._getSelection();t&&t.removeAllRanges()},deleteContents:function(){var t=this.getRange();!this.isCollapsed()&&t&&t.deleteContents()},collapse:function(t){t=t||"start";var e=this.get();e.selection&&!e.collapsed&&("start"===t?e.selection.collapseToStart():e.selection.collapseToEnd())},save:function(t){if(!t){var e=this.app.block.get();t=e?e.getBlock():this.app.editor.getLayout()}this.savedSelection={el:t,offset:this.app.offset.get(t)}},restore:function(t){if(!this.savedMarker&&this.savedSelection){this.app.editor.setWinFocus();var e=this.savedSelection.el;this.dom(e).dataget("instance")&&!1!==t&&this.app.block.set(e),e&&(e.focus(),this.app.offset.set(e,this.savedSelection.offset)),this.savedSelection=!1}},saveMarker:function(){this.savedMarker=!0,this.app.marker.insert()},restoreMarker:function(){this.app.marker.restore(),this.savedMarker=!1,this.savedSelection=!1},_getSelection:function(){return this.app.editor.getSelection()},_getRange:function(t){return!!t&&(t.rangeCount>0&&t.getRangeAt(0))},_getCurrent:function(t){return!!t&&t.anchorNode},_getParent:function(t){return!!t&&t.parentNode},_getElement:function(t,e){var i=this._getSelection();if(i){var n=t||this._getCurrent(i);for(n=this.dom(n).get();n;){if(this.app.element.is(n,e))return n;n=n.parentNode}}return!1},_getCollapsed:function(t,e){var i=!1;return(t&&t.isCollapsed||e&&0===e.toString().length)&&(i=!0),i},_getNextNode:function(t){if(t.firstChild)return t.firstChild;for(;t;){if(t.nextSibling)return t.nextSibling;t=t.parentNode}},_getRangeNodes:function(t,e){var i,n=t.startContainer.childNodes[t.startOffset]||t.startContainer,s=t.endContainer.childNodes[t.endOffset]||t.endContainer,o=t.commonAncestorContainer,a=[];if(e){for(this.app.editor.isLayout(n)||a.push(n),i=n.parentNode;i&&!this.app.editor.isLayout(i)&&(a.push(i),i!==o);i=i.parentNode);for(a.reverse(),i=n;i&&(3===i.nodeType||0!==this.dom(i.parentNode).closest(o).length)&&(a.push(i),i!==s);i=this._getNextNode(i));}else for(3===n.nodeType&&a.push(this.getBlock(n)),i=n;i&&i!==o&&(3===i.nodeType||0!==this.dom(i.parentNode).closest(o).length)&&(a.push(i),i!==s);i=this._getNextNode(i));return a},_getAllRangeNodes:function(t){return this._getRangeNodes(t,!0)},_filterNodes:function(t,e,i,n){var s=this.getText();s=s?s.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&"):"";for(var o=[],a=0;a<t.length;a++){var r=!0;this.app.editor.isLayout(t[a])&&(r=!1),n&&(r=n.types?this._filterByTypes(r,n,t[a]):r,r=n.selected?this._filterBySelected(r,n,t[a],e,s):r,r=n.type?this._filterByType(r,n,t[a],i):r,r=n.tags?this._filterByTags(r,n,t[a]):r),r&&o.push(t[a])}var l=[];if(n&&("blocks"===n.type||"blocks-first"===n.type)){for(var p=0;p<o.length;p++){var c;"blocks-first"===n.type?c=this.app.element.is(o[p],"blocks-first")?o[p]:this.app.element.getFirstLevel(o[p]).get():"blocks"===n.type&&(c=this.app.element.is(o[p],"blocks")?o[p]:this.app.element.getDataBlock(o[p]).get()),this._isInNodesArray(l,c)||l.push(c)}o=l}return o},_filterByTypes:function(t,e,i){var n;return!0===e.types?(n=this.app.element.getType(i))||(t=!1):(n=this.app.element.getType(i),-1===e.types.indexOf(n)&&(t=!1)),t},_filterByType:function(t,e,i,n){var s=e.type;return"blocks"!==s&&"blocks-first"!==s||(s="block"),n?e.links?this.app.element.is(i,s)||(t=!1):(1===i.nodeType&&"A"===i.tagName||!this.app.element.is(i,s))&&(t=!1):this.app.element.is(i,s)||(t=!1),t},_filterByTags:function(t,e,i){var n="undefined"!==typeof i.tagName;return n?n&&-1===e.tags.indexOf(i.tagName.toLowerCase())&&(t=!1):t=!1,t},_filterBySelected:function(t,e,i,n,s){return!0!==e.selected||this._containsNodeText(n,i)?"inside"===e.selected&&(1===i.nodeType&&"A"===i.tagName?t=!0:this._isTextSelected(i,s)||(t=!1)):t=!1,t},_isTextSelected:function(t,e){var i=9!==t.nodeType?this.app.utils.removeInvisibleChars(t.textContent):"";return e===i||-1!==i.search(e)||-1!==e.search(new RegExp("^"+this.app.utils.escapeRegExp(i)+"$"))},_isBackwards:function(){var t=!1,e=this.get();if(e&&!e.collapsed){var i=this.app.editor.getDocNode().createRange();i.setStart(e.selection.anchorNode,e.selection.anchorOffset),i.setEnd(e.selection.focusNode,e.selection.focusOffset),t=i.collapsed,i.detach()}return t},_containsNodeText:function(t,e){for(var i,n,s,o=this.app.editor.getDocNode().createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return NodeFilter.FILTER_ACCEPT}},!1);s=o.nextNode();)i||(i=s),n=s;var a=t.cloneRange();return i?(a.setStart(i,0),a.setEnd(n,n.length)):a.selectNodeContents(e),t.compareBoundaryPoints(Range.START_TO_START,a)<1&&t.compareBoundaryPoints(Range.END_TO_END,a)>-1},_isInNodesArray:function(t,e){return-1!==t.indexOf(e)}}),p.add("module","inline",{removeFormat:function(){this.app.popup.close();var t=this.app.block.get().getBlock();this.app.selection.save(t);for(var e=this.app.selection.getNodes({type:"inline"}),i=0;i<e.length;i++){var n=this.dom(e[i]);n.attr("data-"+this.prefix+"-type")||n.unwrap()}this.app.selection.restore(),this.app.editor.observeUI()},set:function(t){this.app.popup.isOpen()&&this.app.popup.close(),this.params=t;var e=[];return e=this.app.selection.get().collapsed?this.formatCollapsed():this.formatUncollapsed(),this.app.editor.observeUI(),this.app.broadcast("inline.format",{nodes:e}),this.app.sync.trigger(),e},formatCollapsed:function(){var t,e=this.app.selection.getInline(),i=this.dom(e),n=this._getParamsTags(),s=this._isSameTag(e,n),o=!(!this.params||!this.params.caret)&&this.params.caret;if(e)if(this.app.content.isEmptyHtml(e.innerHTML))if(s)this.app.caret.set(e,o||"after"),i.remove();else{var a=this.app.element.replaceToTag(e,this.params.tag);this.app.caret.set(a,o||"start")}else if(s){var r=e;if(this.app.caret.is(e,"end"))o="after";else{var l=this.app.content.extractHtmlFromCaret(e),p=this.dom("<"+this.params.tag+" />");p=this.app.element.cloneAttrs(e,p),i.after(p.append(l)),r=p}this.app.caret.set(r,o||"before")}else t=this._insertInline(this.params.tag,o);else t=this._insertInline(this.params.tag,o);if(t&&this.params&&"undefined"!==typeof this.params.attr){var c=this.dom(t);Object.keys(this.params.attr).forEach(function(t){c.attr(t,this.params.attr[t])}.bind(this))}return t||[]},formatUncollapsed:function(){var t=this.app.block.get(),e=this._getBlock(t);this.app.selection.save(),this._convertTags("u",t),this._convertTags("del",t),this.app.selection.restore();var i=this.app.selection.getNodes({type:"inline"});this.app.selection.save(),this._convertToStrike(i),this.app.selection.restore(),this.app.selection.save(),this.app.editor.getDocNode().execCommand("strikethrough");var n=this._revertToInlines(t);this.app.selection.restore();for(var s=[],o=this.app.selection.getText(),a=0;a<n.length;a++)this._isInSelection(n[a],o)&&s.push(n[a]);if(this._clearEmptyStyle(),this.params&&"undefined"!==typeof this.params.attr)for(var r=0;r<s.length;r++)this._applyAttrs(s[r]);if(1===e.length&&e.get().normalize(),this.app.selection.save(),this._revertTags("u",t),this._revertTags("del",t),this.app.selection.restore(),this.params&&this.params.caret){var l=s[s.length-1];this.app.caret.set(l,this.params.caret)}return s},_applyAttrs:function(t){Object.keys(this.params.attr).forEach(function(e){t.setAttribute(e,this.params.attr[e])}.bind(this))},_clearEmptyStyle:function(){for(var t=this.app.selection.getNodes({type:"inline"}),e=0;e<t.length;e++){this._clearEmptyStyleAttr(t[e]);var i=t[e].childNodes;if(i)for(var n=0;n<i.length;n++)this._clearEmptyStyleAttr(i[n])}},_clearEmptyStyleAttr:function(t){3!==t.nodeType&&""===t.getAttribute("style")&&t.removeAttribute("style")},_isSameTag:function(t,e){return t&&-1!==e.indexOf(t.tagName.toLowerCase())},_isInSelection:function(t,e){var i=this.app.utils.removeInvisibleChars(t.textContent);return-1!==e.search(new RegExp(this.app.utils.escapeRegExp(i)))},_insertInline:function(t,e){return this.app.insertion.insertNode(document.createElement(t),e||"start")},_convertTags:function(t,e){this.params.tag!==t&&this._getBlock(e).find(t).each(function(e){this.app.element.replaceToTag(e,"span").addClass(this.prefix+"-convertable-"+t)}.bind(this))},_revertTags:function(t,e){this._getBlock(e).find("span."+this.prefix+"-convertable-"+t).each(function(e){var i=this.app.element.replaceToTag(e,t);i.removeClass(this.prefix+"-convertable-"+t),this.app.element.removeEmptyAttrs(i,["class"])&&i.removeAttr("class")}.bind(this))},_convertToStrike:function(t){for(var e=this._getParamsTags(),i=0;i<t.length;i++){var n=t[i],s=this.dom(n),o=t[i].tagName.toLowerCase();-1!==e.indexOf(o)&&this._replaceToStrike(s)}},_getParamsTags:function(){var t=[this.params.tag];return"b"===this.params.tag||"strong"===this.params.tag?t=["b","strong"]:"i"!==this.params.tag&&"em"!==this.params.tag||(t=["i","em"]),t},_replaceToStrike:function(t){t.replaceWith(function(){return this.dom("<strike>").append(t.html())}.bind(this))},_revertToInlines:function(t){var e=[];return this._getBlock(t).find("strike").each(function(t){var i=this.app.element.replaceToTag(t,this.params.tag);e.push(i.get())}.bind(this)),e},_getBlock:function(t){return this.app.editor.isBlocksSelection()?this.dom(this.app.blocks.getSelectedBlocks()):t.getBlock()}}),p.add("module","popup",{init:function(){this.stack=!1,this.stacks=[],this.name=!1,this.supername=!1,this.autoclose=!0,this.control=!1,this.saved=!1},start:function(){this._build(),this._buildDepth()},stop:function(){this._stopEvents(),this._stop()},stopStack:function(){this._stopEvents(),this.app.toolbar.unsetToggled(),this.$popup.removeAttr("data-"+this.prefix+"-popup-name"),this.$popup.removeClass("open")},isOpen:function(t){var e=this.$popup.hasClass("open");return t?this._getName()===t&&e:e},create:function(t,e){return this.isOpen(t)||(this._reset(),this.name=t,this.supername=t,this.stack=this._createStack(t,e)),this.stack},add:function(t,e){return this._createStack(t,e,!0)},setStack:function(t){this.stack=t,this.name=t.getName()},setData:function(t){this.stack.setData(t)},setFocus:function(t){this.stack.setFocus(t)},setWidth:function(t){this.stack.setWidth(t)},getName:function(){return this.name},getElement:function(){return this.$popup},getButton:function(){return this.button},getStack:function(t){return t?this.stacks[t]:this.stack},getBody:function(){return this.stack.getBody()},getItems:function(){return this.stack.getItems()},getFooter:function(){return this.stack.getFooter()},getFooterPrimary:function(){return this.stack.getFooterPrimary()},getTool:function(t){return this.stack.getTool(t)},getInput:function(t){return this.stack.getInput(t)},getFormItem:function(t){return this.stack.getFormItem(t)},getData:function(t){return this.stack.getData(t)},open:function(t){this.isOpen()?this.isOpen(this.supername)?(this.saved=!0,this.close(!1)):(this.saved=!0,this.close(!1),this._open(t,!1)):(this.saved=!1,this._open(t))},openStack:function(t){var e=this.getStack(t),i={};this.stack&&this.stack.isCollapsed()&&(i={collapse:!0},this.removeStack(this.stack)),e.open(i)},close:function(t,e){if(!1===this.autoclose)if(!0===t);else if(!e)return;this.isOpen()&&(t&&this._isPopupTarget(t)||(this._stopEvents(),this._resetToolbarToggledButton(),!1!==t&&!1===this.saved&&(this.app.scroll.save(),this.app.selection.restore(),this.app.scroll.restore()),this.$popup.hide(),this._closed()))},closeStacks:function(){for(var t in this.stacks)"object"===typeof this.stacks[t]&&this.stacks[t].close()},removeStack:function(t){var e=t.getName();delete this.stacks[e],this.$popup.find("[data-"+this.prefix+"-stack-name="+e+"]").remove()},updatePosition:function(t){this._buildPosition(t),this._buildHeight()},resize:function(){var t=this.$popup.attr("data-width"),e=this.app.editor.getWidth();if("100%"!==t&&parseInt(t)<e)return;this.$popup.css("width",e+"px")},_build:function(){this.$popup=this.dom("<div>").addClass(this.prefix+"-popup "+this.prefix+"-popup-"+this.uuid),this.$popup.hide(),this.$popup.attr("dir",this.opts.editor.direction),this.app.$body.append(this.$popup)},_buildDepth:function(){this.opts.bsmodal&&this.$popup.css("z-index",1061)},_buildButton:function(t){t&&(this.button=!!Object.prototype.hasOwnProperty.call(t,"button")&&t.button)},_buildControl:function(t){t&&(this.control=!!Object.prototype.hasOwnProperty.call(t,"control")&&t.control)},_buildName:function(){this.$popup.attr("data-"+this.prefix+"-popup-name",this.name),this.$popup.addClass(this.prefix+"-popup-"+this.name)},_buildHeader:function(){this.header=this.app.create("popup.header",this)},_buildHeight:function(){var t,e,i=this.app.scroll.getTarget(),n=this.$popup.offset();this.app.scroll.isTarget()?(e=n.top-i.offset().top,t=i.height()-parseInt(i.css("border-bottom-width"))):(e=n.top-i.scrollTop(),t=i.height());var s=t-e-10;this.$popup.css("max-height",s+"px")},_buildPosition:function(){var t;t=this._isButton()&&this.button.isControl()||this._isControl()?this._buildPositionControl():this._isButton()?this._buildPositionButton():this._buildPositionModal(),this.$popup.css({top:t.top-1+"px",left:t.left+"px"})},_buildPositionButton:function(){var t=this.app.editor.getRect(),e=this.button.getOffset(),i=this.button.getDimension(),n=this.$popup.width(),s={};return this._isToolbarButton()||this._isTopbarButton()?(s={top:e.top+i.height,left:e.left}).left+n>t.right&&(s.left=e.left+i.width-n):(s={top:e.top+t.top+i.height,left:e.left+t.left+i.width/2-n/2}).left+n>t.right&&(s.left=t.left+t.width-n),(s.left<t.left||s.left<0)&&(s.left=t.left),s},_buildPositionControl:function(){var t=this.app.block.get();t.isSecondLevel()&&(t=t.getFirstLevel());var e=t.getBlock().offset();return{top:e.top,left:e.left}},_buildPositionModal:function(){var t,e,i;if(this.opts.toolbar){var n=this.app.container.get("toolbar"),s=n.height();e=(t=n.offset()).top+s,i=t.left}else{var o=this.app.block.get();o.isSecondLevel()&&(o=o.getFirstLevel()),e=(t=o.getBlock().offset()).top,i=t.left}return{top:e,left:i}},_getName:function(){return this.$popup.attr("data-"+this.prefix+"-popup-name")},_setToolbarToggledButton:function(){if(this.app.toolbar.unsetToggled(),this._isToolbarButton()){var t=this.button.getName();this.app.toolbar.setToggled(t)}},_createStack:function(t,e,i){Object.prototype.hasOwnProperty.call(e,"collapse")&&!1===e.collapse&&(i=!1),Object.prototype.hasOwnProperty.call(e,"autoclose")&&(this.autoclose=e.autoclose);var n=this.app.create("popup.stack",t,e,i,this);return this.stacks[t]=n,n},_open:function(t,e){this._buildButton(t),this._buildControl(t),this._buildName(),this._buildHeader(),this.app.broadcast("popup.before.open").isStopped()?this.stopStack():(this._setToolbarToggledButton(),this._startEvents(),!1!==e&&this.app.editor.isPopupSelection()&&this.app.selection.save(),this.stack=this._findActiveStack(),this.stack.open(t,!1,!1),this._buildPosition(),!1===e?(this.$popup.show(),this._opened()):this.$popup.fadeIn(100,this._opened.bind(this)))},_opened:function(){this._buildHeight(),this.$popup.addClass("open"),this.app.broadcast("popup.open"),this.stack.renderFocus()},_closed:function(){var t="data-"+this.prefix+"-popup-name",e=this.$popup.attr(t);this.$popup.removeAttr(t),this.$popup.removeClass("open "+this.prefix+"-popup-"+e),this.saved=!1,this.app.broadcast("popup.close")},_isPopupTarget:function(t){return 0!==this.dom(t.target).closest("."+this.prefix+"-popup").length},_isButton:function(){return this.button},_isControl:function(){return this.control},_isToolbarButton:function(){return this.button&&("toolbar"===this.button.type||"context"===this.button.type)},_isTopbarButton:function(){return this.button&&"topbar"===this.button.type},_findActiveStack:function(){for(var t in this.stacks)"object"===typeof this.stacks[t]&&this.stacks[t].isActive()&&(this.stack=this.stacks[t]);return this.stack},_reset:function(){this.button=!1,this.control=!1,this.autoclose=!0,this.stack=!1,this.stacks=[],this.$popup.html(""),this.$popup.removeClass("has-footer has-items has-form")},_resetToolbarToggledButton:function(){if(this.button){var t=this.button.getName();this.app.toolbar.unsetToggled(t)}},_startEvents:function(){var t=this.prefix+"-popup";this.app.scroll.getTarget().on("resize."+t+" scroll."+t,this.updatePosition.bind(this))},_stopEvents:function(){this.app.scroll.getTarget().off("."+this.prefix+"-popup")},_stop:function(){this.$popup&&this.$popup.remove()}}),p.add("class","popup.item",{defaults:{container:!1,title:!1,html:!1,toggle:!0,active:!1,divider:!1,remover:!1,classname:!1,params:!1,instance:!1,observer:!1,command:!1},init:function(t,e,i){this.popup=t,this.name=e,this.params=this._buildParams(i),this._build(),this._buildContainer(),this._buildIcon(),this._buildTitle(),this._buildImage(),this._buildShortcut(),this._buildActive(),this._buildHidden(),this._buildDivider(),this._buildCommand(),this._buildRemover()},getPopup:function(){return this.popup},getName:function(){return this.name},getParams:function(){return this.params.params},getElement:function(){return this.$item},getInstance:function(){return this.params.instance},isControl:function(){return this.params.control},_build:function(){this.$item=this.params.html?this.dom(this.params.html):this.dom("<div>"),this.$item.addClass(this.prefix+"-popup-item "+this.prefix+"-popup-stack-item"),this.$item.attr({"data-name":this.name})},_buildContainer:function(){this.params.container&&this.$item.addClass(this.prefix+"-popup-item-container")},_buildTitle:function(){this.params.title&&(this.$title=this.dom("<span>").addClass(this.prefix+"-popup-item-title"),this.$title.html(this.lang.parse(this.params.title)),this.$item.append(this.$title))},_buildImage:function(){this.params.image&&(this.$image=this.dom("<span>").addClass(this.prefix+"-popup-item-image"),this.$image.html(this.params.image),this.$item.append(this.$image))},_buildIcon:function(){this.params.icon&&(this.$icon=this.dom("<span>").addClass(this.prefix+"-popup-item-icon"),this.opts.buttons.icons&&"undefined"!==typeof this.opts.buttons.icons[this.name]?this.$icon.html(this.opts.buttons.icons[this.name]):!0===this.params.icon?this.$icon.addClass(this.prefix+"-icon-"+this.name):-1!==this.params.icon.search(/</)?this.$icon.html(this.params.icon):this.$icon.addClass(this.prefix+"-icon-"+this.params.icon),this.$item.append(this.$icon))},_buildShortcut:function(){if(this.params.shortcut){var t=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?"<b>&#8984;</b>":"ctrl";t=this.params.shortcut.replace("Ctrl",t),this.$shortcut=this.dom("<span>").addClass(this.prefix+"-popup-item-shortcut"),this.$shortcut.html(t),this.$item.append(this.$shortcut)}},_buildParams:function(t){return d.extend({},!0,this.defaults,t)},_buildActive:function(){this.params.active&&this.$item.addClass("active")},_buildHidden:function(){this.params.hidden&&this.$item.addClass(this.prefix+"-popup-item-hidden")},_buildDivider:function(){this.params.divider&&this.$item.addClass(this.prefix+"-popup-item-divider-"+this.params.divider)},_buildCommand:function(){this.params.command&&(this.$item.on("click."+this.prefix+"-popup-item-"+this.uuid,this._catch.bind(this)),this.$item.attr("data-command",this.params.command))},_buildRemover:function(){if(this.params.title&&this.params.remover){var t=this.dom("<span>").addClass(this.prefix+"-popup-item-trash "+this.prefix+"-icon-trash");t.attr("data-command",this.params.remover),t.on("click."+this.prefix+"-popup-item-"+this.uuid,this._catchRemover.bind(this)),this.$item.append(t)}},_catchRemover:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-popup-stack-item"),i=this.dom(t.target).closest("."+this.prefix+"-popup-item-trash").attr("data-command"),n=e.attr("data-name");this.app.api(i,this,n),e.fadeOut(200,(function(t){t.remove()}))},_catch:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-popup-stack-item"),i=e.attr("data-name"),n=e.attr("data-command");this.popup.$items.find("."+this.prefix+"-popup-stack-item").removeClass("active"),this.params.toggle&&e.addClass("active"),this.app.api(n,this.getParams(),this,i,t)}}),p.add("class","popup.stack",{defaults:{active:!1,title:!1,type:!1,width:!1,setter:!1,getter:!1,builder:!1,observer:!1,instance:!1,collapse:!1,form:!1,items:!1,focus:!1,footer:!1},init:function(t,e,i,n){this.defaultWidth="240px",this.popup=n,this.name=t,this.tools={},this.data=!1,this.items=!1,this.formitems=!1,this.params=d.extend({},!0,this.defaults,e),i&&(this.params.collapse=!0),this._build(),this._observe()},set:function(t,e){this.params[t]=e},setData:function(t){this.data=t},setFocus:function(t){"undefined"!==typeof this.tools[t]&&this.tools[t].setFocus()},setWidth:function(t){var e=this.app.popup.getElement();e.attr("data-width",t),"100%"===t&&(t=this.app.editor.getWidth()+"px"),e.css("width",t),this.app.$win.on("resize."+this.prefix+"-popup-"+this.uuid,this.popup.resize.bind(this.popup)),this.popup.resize()},setItemsData:function(t){this.items=t},get:function(t){return this.params[t]},getElement:function(){return this.$stack},getName:function(){return this.name},getBody:function(){return this.$body},getInstance:function(){return this.get("instance")},getItemsData:function(){return this.items},getItems:function(){return this.$items},getFooter:function(){return this.$footer},getFooterPrimary:function(){return this.$footer.find("."+this.prefix+"-form-button-primary")},getTool:function(t){return"undefined"!==typeof this.tools[t]&&this.tools[t]},getInput:function(t){var e=this.getTool(t);return e?e.getInput():this.dom()},getFormItem:function(t){var e=this.getTool(t);return e?e.getInput().closest("."+this.prefix+"-form-item"):this.dom()},getData:function(t){var e;return t?"undefined"!==typeof this.tools[t]&&(e=this.tools[t].getValue()):(e={},Object.keys(this.tools).forEach(function(t){e[t]=this.tools[t].getValue()}.bind(this))),e},hasForm:function(){return this.formitems},hasFooter:function(){return 0!==this.footerbuttons},hasItems:function(){return!1!==this.items},isCollapsed:function(){return this.get("collapse")},isActive:function(){return this.get("active")},open:function(t,e,i){if((t&&t.focus&&this.set("focus",t.focus),this.popup.closeStacks(),this.app.popup.setStack(this),!1!==i)&&this.app.broadcast("popup.before.open").isStopped())return void this.popup.stopStack();t&&t.collapse?(this._buildItems(),this._renderItems()):this.render(),this.popup.header.render(this.popup.stacks),this.popup.header.setActive(this),this.$stack.show(),this._renderWidth(),!1!==e&&this.renderFocus(),!1!==i&&this.app.broadcast("popup.open")},close:function(){this.$stack.hide()},collapse:function(){var t=this._getPrev();this.isCollapsed()&&this.popup.removeStack(this),t.open({collapse:!0})},render:function(){this._renderType(),this._renderItems(),this._renderForm(),this._renderFooter(),this._renderEnv()},renderFocus:function(){this.get("focus")&&this.setFocus(this.get("focus"))},_observe:function(){this.params.observer&&this.app.api(this.params.observer,this)},_getPrev:function(){var t;for(var e in this.popup.stacks)if(this.popup.stacks.hasOwnProperty(e)){if(e===this.name)return t;t=this.popup.stacks[e]}},_build:function(){this._buildElement(),this._buildBody(),this._buildFooter(),this._buildParams()},_buildElement:function(){this.$stack=this.dom("<div>").addClass(this.prefix+"-popup-stack "+this.prefix+"-popup-stack-"+this.name),this.$stack.hide(),this.$stack.attr("data-"+this.prefix+"-stack-name",this.name),this.popup.getElement().append(this.$stack)},_buildBody:function(){this.$body=this.dom("<div>").addClass(this.prefix+"-popup-body"),this.$stack.append(this.$body)},_buildFooter:function(){this.$footer=this.dom("<div>").addClass(this.prefix+"-popup-footer"),this.$stack.append(this.$footer)},_buildParams:function(){this.params.width=this.params.width?this.params.width:this.defaultWidth,this.params.setter=!!this.params.setter&&this.params.setter,this.params.getter=!!this.params.getter&&this.params.getter,this.data=!!this.params.getter&&this.app.api(this.params.getter,this),this._buildItems()},_buildItems:function(){this.params.builder?this.items=this.app.api(this.params.builder,this):this.params.items&&(this.items=this.params.items)},_renderWidth:function(){this.setWidth(this.get("width"))},_renderType:function(){this.$stack.removeClass(this.prefix+"-popup-type-grid");var t=this.get("type");t&&this.$stack.addClass(this.prefix+"-popup-type-"+t)},_renderItems:function(){if(this.items)for(var t in this.$items?this.$items.html(""):(this.$items=this.dom("<div>").addClass(this.prefix+"-popup-items"),this.$body.append(this.$items)),this.items)if(this.items.hasOwnProperty(t)){if(Object.prototype.hasOwnProperty.call(this.items[t],"observer")&&this.items[t].observer){var e=this.app.api(this.items[t].observer,this.items[t],t,this);"undefined"!==typeof e&&(this.items[t]=e)}if(!1===this.items[t])continue;var i=this.app.create("popup.item",this,t,this.items[t]).getElement();this._renderItemPosition(this.$items,i,this.items[t])}},_renderItemPosition:function(t,e,i){if(i.position){var n=i.position;if("first"===n)t.prepend(e);else if("object"===typeof n){var s=Object.prototype.hasOwnProperty.call(n,"after")?"after":"before",o=n[s],a=this._findPositionElement(o,t);a?a[s](e):t.append(e)}}else t.append(e)},_renderEnv:function(){var t=this.popup.getElement();t.removeClass("has-footer has-items has-form"),this.hasForm()&&t.addClass("has-form"),this.hasFooter()&&t.addClass("has-footer"),this.hasItems()&&t.addClass("has-items")},_renderForm:function(){this.formitems=this.get("form"),this.formitems&&(this.$form?this.$form.html(""):(this.$form=this.dom("<form>").addClass(this.prefix+"-popup-form"),this.$body.append(this.$form)),this._renderTools(),this._renderData(),this.$form.find("input[type=text],input[type=url],input[type=email]").on("keydown."+this.prefix+"-popup",function(t){if(13===t.which)return t.preventDefault(),!1}.bind(this)))},_renderTools:function(){Object.keys(this.formitems).forEach(function(t){this._renderTool(t,this.formitems[t])}.bind(this))},_renderTool:function(t,e){var i=this.app.create("tool."+e.type,t,e,this,this.data),n=i.getElement();n&&(this.tools[t]=i,this.$form.append(n))},_renderData:function(){if(this.data)for(var t in this.data)"undefined"!==typeof this.tools[t]&&this.tools[t].setValue(this.data[t])},_renderFooter:function(){this.footerbuttons=0;var t=this.get("footer");if(t)for(var e in this.$footer.html(""),t)if(t.hasOwnProperty(e)){if(!1===t[e])continue;var i=this.app.create("popup.button",e,this,t[e]);this.$footer.append(i.getElement()),this.footerbuttons++}},_findPositionElement:function(t,e){var i;if(Array.isArray(t))for(var n=0;n<t.length&&0===(i=e.find("[data-name="+t[n]+"]")).length;n++);else i=e.find("[data-name="+t+"]");return 0!==i.length?i:0}}),p.add("class","popup.button",{init:function(t,e,i){this.name=t,this.obj=i,this.popup=e,this.$button=this.dom("<button>").addClass(this.prefix+"-form-button"),this.$button.attr("data-name",this.name),this.$button.html(this.lang.parse(this.obj.title)),this.$button.dataset("instance",this),this._has("type")&&this.$button.addClass(this.prefix+"-form-button-"+this.obj.type),this._has("classname")&&this.$button.addClass(this.obj.classname),this._has("fullwidth")&&this.$button.addClass(this.prefix+"-form-button-fullwidth"),this._has("right")&&this.$button.addClass(this.prefix+"-form-button-push-right"),this.$button.on("click."+this.prefix+"-popup-button"+this.uuid,this._catch.bind(this))},getName:function(){return this.name},getElement:function(){return this.$button},invokeCommand:function(){this._invoke()},_has:function(t){return Object.prototype.hasOwnProperty.call(this.obj,t)},_catch:function(t){t.preventDefault(),t.stopPropagation(),this._has("command")?this._invoke(t):this._has("close")&&this.app.popup.close()},_invoke:function(t){this.app.api(this.obj.command,this.popup,this.name,t)}}),p.add("class","popup.header",{init:function(t){this.popup=t,this._build()},setActive:function(t){this.$headerbox.find("."+this.prefix+"-popup-header-item").removeClass("active"),this.$headerbox.find("[data-"+this.prefix+"-name="+t.getName()+"]").addClass("active")},render:function(t){this._reset(),this._buildItems(t)>0&&this._buildClose()},_build:function(){this.$header=this.dom("<div>").addClass(this.prefix+"-popup-header"),this.$headerbox=this.dom("<div>").addClass(this.prefix+"-popup-header-box"),this.$header.append(this.$headerbox),this.popup.getElement().prepend(this.$header)},_buildClose:function(){var t=this.dom("<span>").addClass(this.prefix+"-popup-close");t.one("click",this._catchClose.bind(this)),this.$header.append(t)},_buildItems:function(t){var e=Object.keys(t).length,i=0,n=0;for(var s in t)if(t.hasOwnProperty(s)){if("object"!==typeof t[s])continue;n++;var o=t[s].get("title");o?(i++,this._buildItem(t[s],o,e)):1===n&&e>1&&(i++,this._buildItem(t[s],"## popup.back ##",e))}return i},_buildItem:function(t,e,i){var n=i>1,s=n?this.dom("<a>").attr("href","#"):this.dom("<span>");n&&(s.dataset("stack",t),s.addClass(this.prefix+"-popup-header-item-link"),s.on("click",this._catchStack.bind(this))),s.attr("data-"+this.prefix+"-name",t.getName()),s.addClass(this.prefix+"-popup-header-item"),s.html(this.lang.parse(e)),this.$headerbox.append(s)},_reset:function(){this.$headerbox.html(""),this.$header.find("."+this.prefix+"-popup-close").remove()},_catchStack:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).dataget("stack"),i=this.app.popup.getStack();i.isCollapsed()&&this.app.popup.removeStack(i),e.open()},_catchClose:function(t){t.preventDefault(),t.stopPropagation(),this.popup.close()}}),p.add("module","editor",{start:function(){this._buildEditor(),this._buildBlurClass(),this._buildOptions(),this._buildContent()},stop:function(){this.app.$element.show()},load:function(){this._setFocusOnStart()},build:function(){this.app.blocks.build(),this.app.embed.build(),this.app.image.observeStates(),this.app.parser.buildPredefinedClasses(),this.app.broadcast("editor.build")},isEditor:function(t){return this.dom(t).get()===this.$editor.get()},isLayout:function(t){return this.isEditor(t)},isTextarea:function(){return!1===this.opts.content},isFocus:function(){return this.app.container.isFocus()},isAllSelected:function(){return this._classSelect("has")},isEmpty:function(t){return!(this.app.blocks.getFirstLevel().length>1)&&this.app.content.isEmptyHtml(this.$editor.html(),t)},isPopupSelection:function(){return!this.app.blocks.isMeta()},isBlocksSelection:function(){return this.app.blocks.isMeta()||this.app.blocks.is()||this.app.editor.isAllSelected()},addButton:function(t,e){this.opts.buttonsObj[t]=e,this.opts.buttons.editor.push(t)},selectAll:function(){if(!this.isAllSelected()){this._classSelect("add"),this.app.block.unset(),this.app.blocks.unset(),this.app.toolbar.build(),this.app.control.close(),this.app.context.close();var t=this.app.blocks.getLast(),e=!1;t&&"layer"===t.getType()&&(e=t.getBlock()).attr("contenteditable",!0),this.app.selection.select(),this.app.broadcast("editor.select"),e&&setTimeout((function(){e.attr("contenteditable",!1)}),0)}},unselectAll:function(){this.isAllSelected()&&(this.unsetSelectAll(),this.app.block.unset(),this.app.blocks.unset(),this.app.broadcast("editor.unselect"))},unsetSelectAll:function(){this._classSelect("remove")},observeBlocks:function(t){this.blocks=[];var e=this.app.blocks.getSelectedBlock(t);this.app.editor.setFocus();var i=this.app.blocks.getSelectedBlocks();if(1===i.length)this.app.block.set(e);else if(this.app.selection.isAll()){var n=this.app.blocks.getBlocks(),s=this.app.selection.getNodes({type:"blocks-first"});n.length===s.length?this.app.editor.selectAll():this.blocksSelection(i)}else i.length>1?this.blocksSelection(i):this.app.block.set(e)},blocksSelection:function(t){this.app.block.unset(),this.app.blocks.set(t),this.app.toolbar.build()},insertContent:function(t){this.app.insertion.insertContent(t)},setContent:function(t){this.app.insertion.setContent(t)},setEmpty:function(){this.app.insertion.setContent({html:""})},setWinFocus:function(){},setFocus:function(t){if(t){var e=!0===t?"start":t,i="start"===e?this.app.blocks.getFirst():this.app.blocks.getLast();this.app.block.set(i,e)}else{if(this.isFocus())return;for(var n=0;n<d.instances.length;n++)d.instances[n]!==this.app&&d.instances[n].editor.setBlur();this.app.container.setFocus(),this.app.broadcast("editor.focus")}},setBlur:function(t){this.isFocus()&&(this.$editor.get&&(this.app.broadcast("editor.before.blur",{e:t}).isStopped()?t&&t.preventDefault():(this.app.container.setBlur(),this.app.selection.removeAllRanges(),this.app.source.is()||(this.app.block.unset(),this.app.blocks.unset(),this.app.popup.close(!1),this.app.context.close(),this.app.control.close(),this.app.toolbar.build()),this.app.broadcast("editor.blur",{e:t}))))},getContent:function(t){var e="";return this.app.source.is()?e=this.app.source.getContent():(e=this._getContent(),e=t?this.app.tidy.parse(e):e),e=this.app.content.decodeHref(e)},getSelection:function(){var t=this.getWinNode().getSelection();if(t.rangeCount>0){var e=t.anchorNode;return 0!==this.dom(e).closest("."+this.prefix+"-container-"+this.uuid).length&&t}return!1},getWinNode:function(){return this.app.$win.get()},getDocNode:function(){return this.app.$doc.get()},getEditor:function(){return this.$editor},getLayout:function(){return this.getEditor()},getWidth:function(){var t=this.getEditor(),e=parseInt(t.css("padding-left")),i=parseInt(t.css("padding-right"));return t.width()-e-i},getRect:function(){var t=this.$editor.offset(),e=this.$editor.width(),i=this.$editor.height(),n=Math.round(t.top),s=Math.round(t.left);return{top:n,left:s,bottom:n+i,right:s+e,width:e,height:i}},getButtonsFromArr:function(t){var e={};if(!Array.isArray(t)&&"object"===typeof t)return t;if(t)for(var i=d.extend(!0,{},this.opts.buttonsObj),n=0;n<t.length;n++){var s=t[n];"undefined"!==typeof i[s]&&(e[s]=i[s])}return e},observeUI:function(){this.app.toolbar.observe(),this.app.context.observe()},enableUI:function(){this.app.toolbar.enable(),this.app.toolbar.enableSticky()},disableUI:function(){this.app.popup.close(),this.app.control.close(),this.app.context.close(),this.app.toolbar.disable(),this.app.toolbar.disableSticky()},_buildEditor:function(){this.app.$element.hide(),this.$editor=this.dom("<div>"),this.$editor.addClass(this.prefix+"-editor "+this.prefix+"-reset "+this.prefix+"-"+this.opts.editor.classname),this.$editor.attr("contenteditable",!0);var t=this.opts.paddingNormal;(this.opts.control||this.opts.reorder)&&(t=this.opts.paddingControl),this.$editor.css("padding",t),this.app.container.get("editor").append(this.$editor)},_buildBlurClass:function(){this.app.container.setBlur()},_buildOptions:function(){var t=this.$editor,e=this.opts.editor;this.opts.code=this.opts.pre,t.attr("dir",e.direction),e.minHeight&&t.css("min-height",e.minHeight),e.maxHeight&&t.css({"max-height":e.maxHeight,overflow:"auto"}),e.notranslate&&t.addClass("notranslate"),e.spellcheck||t.attr("spellcheck",!1),e.grammarly||t.attr("data-gramm_editor",!1)},_buildContent:function(){var t=this._getContentValue();t=this.app.broadcastHtml("editor.before.load",t);var e=this.app.parser.parse(t,!0,!0);this.$editor.html(e.get().childNodes);var i=this.app.parser.unparse(this.$editor.html());this.app.$element.val(i),this._load()},_buildDraggable:function(){this.app.$body.find("[data-"+this.prefix+"-drop-id]").each(function(t){t.attr("draggable",!0),t.on("dragstart",function(t){var e=this.dom(t.target).attr("data-"+this.prefix+"-drop-id");t.dataTransfer.setData("item",e)}.bind(this))}.bind(this))},_load:function(){this.app.blocks.build(),this.app.event.build(),this.app.observer.build(),this.app.embed.build(),this.app.sync.build(),this.app.image.observeStates(),this._buildDraggable(),this.app.broadcast("editor.load")},_getContent:function(){var t=this.$editor.html();return t=this.app.parser.unparse(t)},_getContentValue:function(){return this.opts.content?this.opts.content:this.app.$element.val()},_setFocusOnStart:function(){this.opts.editor.focus&&(this.setFocus(),this.setFocus(this.opts.editor.focus))},_classSelect:function(t){return this.$editor[t+"Class"](this.prefix+"-select-all")}}),p.add("module","parser",{build:function(t){return this.$layout=this.dom("<div>"),this.$layout.html(t),this.$layout.find("[data-"+this.prefix+"-type]").each(this._build.bind(this)),this.$layout},buildPredefinedClasses:function(t){if(this.opts.classes){t=t||this.app.editor.getEditor();var e=this.app.content,i=!0,n=!1;if("undefined"!==typeof this.opts.classes.blocks&&(n=!0,"undefined"===typeof this.opts.classes.tags&&(i=!1)),i&&t.find(e.getPredefinedTags().join(",")).each(e.addPredefinedTagClass.bind(this)),n){var s=e.getPredefinedBlocks(),o="data-"+this.prefix+"-type",a="["+o+"="+s.join("],["+o+"=")+"]";t.find(a).each(e.addPredefinedBlockClass.bind(this))}}},parse:function(t,e,i){return t=t.trim(),t=this.app.broadcastHtml("editor.before.parse",t),this.app.content.isEmptyHtml(t)?t=this.app.block.createHtml():(t=this._clean(t,i),t=this._parse(t)),t=this.app.broadcastHtml("editor.parse",t),!1!==e?this.build(t):t},parseLine:function(t,e){return" "===t?t="&nbsp;":(t=(t=this.app.broadcastHtml("editor.before.parse",t)).replace(/\r?\n/g,"<br>"),t=this.app.content.encodeCode(t),t=this.app.content.sanitize(t),t=this.app.content.removeEmptySpans(t),t=this.app.content.addHttps(t),t=this.app.broadcastHtml("editor.parse",t)),!1!==e?this.build(t):t},unparse:function(t,e){var i={},n=this.app.content;return t=t.trim(),t=this.app.broadcastHtml("editor.before.unparse",t),n.isEmptyHtml(t)?"":(t=this._revertForms(t),t=this._revertFrames(t),t=n.store(t,"embed",i,0),t=n.addNofollow(t),t=n.removeMarkers(t),t=this.app.utils.removeInvisibleChars(t),t=n.recacheStyle(t),t=n.restore(t,"embed",i),t=n.removeEmptyAttrs(t,["style","class","rel","alt","title"]),t=this._unparseAllTags(t),t=this._unparseDataType(t,e),t=n.removeEmptyAttrs(t,["style","class","rel","alt","title"]),this.opts.classes&&(t=this.app.utils.wrap(t,this.buildPredefinedClasses.bind(this))),"<p></p>"===t&&(t=""),this.app.broadcastHtml("editor.unparse",t))},_build:function(t){var e=t.attr("data-"+this.prefix+"-type");this.app.create("block."+e,t)},_clean:function(t,e){var i={},n=[],s=this.app.content;return t=(t=s.storeComments(t,n)).replace(/\xa4t/gi,"&current"),e&&this.app.editor.isTextarea()&&(t=s.encodeCode(t)),t=s.sanitize(t),t=this._convertForms(t),t=this._convertFrames(t),t=s.store(t,"embed",i,0),t=s.removeTags(t,this.opts.tags.denied),t=s.removeDoctype(t),t=s.removeTagsWithContent(t,["script","style"]),t=s.removeEmptySpans(t),t=s.addHttps(t),t=s.removeBlockTagsInside(t,["th","td","li","dt","dd","address"]),t=s.cacheStyle(t),t=s.restore(t,"embed",i),t=s.restoreComments(t,n),this.opts.clean.comments&&(t=s.removeComments(t)),t=s.isEmptyHtml(t)?this.app.block.createHtml():s.paragraphize(t)},_parse:function(t){return this.app.utils.wrap(t,function(t){for(var e=this.app.element.getBlocks(t),i=0;i<e.length;i++)this._parseHtml(e[i]);this.buildPredefinedClasses(t)}.bind(this))},_parseHtml:function(t){var e=t.tagName.toLowerCase(),i=this.dom(t),n=this._parseType(i,e);n&&(i.attr("data-"+this.prefix+"-type",n),"image"===n&&e!==this.opts.image.tag&&(i=this.app.element.replaceToTag(i,this.opts.image.tag,!0)))},_parseType:function(t,e){return t.attr("data-"+this.prefix+"-type")?t.attr("data-"+this.prefix+"-type"):this._parseTypeByTag(t,e)},_parseTypeByTag:function(t,e){var i;switch(e){case"p":i="paragraph",this._isImageBlock(t,"p")&&(i="image");break;case"figure":i="embed",this._isImageBlock(t,"figure")?i="image":this._hasChild(t,"pre")?i="pre":this._hasChild(t,"blockquote")&&(i="quote");break;case"div":i="layer",this._isImageBlock(t,"div")&&(i="image");break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":i="heading";break;case"blockquote":i="quote";break;case"table":i="table";break;case"pre":i="pre";break;case"hr":i="line";break;case"dl":i="dlist";break;case"address":i="address";break;case"ul":case"ol":i="list";break;default:i="layer"}return i},_isImageBlock:function(t,e){var i=t.find("img");if(0!==i.length&&("div"!==e||0===i.closest("figure").length)){var n=i,s=i.parent(),o=0!==s.length&&s.get().tagName;if(!o||"A"!==o&&"SPAN"!==o){if(o&&s.get()!==t.get())return}else n=s;if(0===n.prevElement().length&&("figure"===e||0===n.nextElement().length))return!0}},_hasChild:function(t,e){if("pre"===e){if(0!==t.find("pre").length)return!0}else if("blockquote"===e){var i=t.find("blockquote");if(0===t.find("script").length&&0!==i.length)return!0}},_unparseAllTags:function(t){return this.app.utils.wrap(t,function(t){t.find("*").removeAttr("contenteditable data-gramm_editor"),this.opts.image.states||t.find("img").removeAttr("data-image")}.bind(this))},_unparseDataType:function(t,e){return this.app.utils.wrap(t,function(t){var i=t.find("[data-"+this.prefix+"-type]");!0!==e&&i.removeClass(this.prefix+"-block-state"),i.removeAttr("tabindex data-"+this.prefix+"-parsed data-"+this.prefix+"-first-level"),i.removeClass(this.prefix+"-block-focus "+this.prefix+"-block-multiple-focus "+this.prefix+"-block-multiple-hover "+this.prefix+"-editable-pause"),i.removeClass(this.prefix+"-nowrap"),i.each(this._unparseByType.bind(this)),i.removeAttr("data-"+this.prefix+"-type"),t.find("figcaption").removeAttr("data-"+this.prefix+"-type data-placeholder").each(this.app.content._removeEmptyTag.bind(this))}.bind(this))},_unparseByType:function(t){var e=t.attr("data-"+this.prefix+"-type");"embed"===e?this._unparseEmbed(t):"list"===e&&this._unparseList(t)},_unparseEmbed:function(t){var e,i=decodeURI(t.attr("data-embed-code")),n=t.find("."+this.opts.embed.responsive),s=t.find("figcaption");0!==s.length&&(e=s.clone(),s.remove()),0===n.length?t.html(i):n.html(i),e&&t.append(e),t.removeAttr("data-embed-code")},_unparseList:function(t){this.app.content.unfixListMargin(t)},_convertFrames:function(t){return this.app.utils.wrap(t,function(t){t.find("iframe").each(this._convertFrame.bind(this))}.bind(this))},_convertFrame:function(t){0===t.closest("figure").length&&(t.wrap("<figure>"),t.parent().addClass(this.prefix+"-figure-iframe"))},_convertForms:function(t){return this.app.utils.wrap(t,function(t){t.find("form").each(this._convertForm.bind(this))}.bind(this))},_convertForm:function(t){this.app.element.replaceToTag(t,"div").addClass(this.prefix+"-div-form")},_revertFrames:function(t){return this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-figure-iframe").each(this._revertFrame.bind(this))}.bind(this))},_revertFrame:function(t){0!==t.find("figcaption").length?t.removeClass(this.prefix+"-figure-iframe"):t.unwrap()},_revertForms:function(t){return this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-div-form").each(this._revertForm.bind(this))}.bind(this))},_revertForm:function(t){this.app.element.replaceToTag(t,"form").removeClass(this.prefix+"-div-form")}}),p.add("module","blocks",{init:function(){this.selected=[],this.focusclass=this.prefix+"-block-meta-focus"},start:function(){this.$editor=this.app.editor.getEditor()},build:function(){this._buildFirstLevel()},is:function(){return this.selected.length>0},isMeta:function(){return this.getSelected().length>0},set:function(t){this.selected=t},setMeta:function(t){t=t.closest("[data-"+this.prefix+"-first-level]"),this.app.block.unset(),this._classFocus(t,"add"),this.app.toolbar.build(),setTimeout(function(){this.app.selection.removeAllRanges()}.bind(this),0)},unset:function(){this._classFocus(this.getFirstLevel(),"remove"),this.selected=[]},getBlocks:function(){return this.$editor.find("[data-"+this.prefix+"-type]")},getFirstLevel:function(){return this.$editor.find("[data-"+this.prefix+"-first-level]")},getFirst:function(){return this.getBlocks().first().dataget("instance")},getLast:function(){return this.getBlocks().last().dataget("instance")},getFirstSelected:function(){return this.getSelected().first().dataget("instance")},getLastSelected:function(){return this.getSelected().last().dataget("instance")},getSelected:function(){return this.$editor.find("."+this.focusclass)},getSelectedBlocks:function(t){var e=this.app.selection.getNodes({type:"blocks-first"});if("editable"===t){for(var i=[],n=0;n<e.length;n++){var s=this.dom(e[n]).dataget("instance").getType();-1!==["paragraph","heading","list","address"].indexOf(s)&&i.push(e[n])}e=i}return e},getSelectedBlock:function(t){var e=this.app.selection.getDataBlock();return t&&0===e.length&&(e=this.app.element.getDataBlock(t.target)),e},getFirstSelectedBlock:function(){return this.selected.length>0&&this.selected[0]},getLastSelectedBlock:function(){return this.selected.length>0&&this.selected[this.selected.length-1]},removeSelected:function(t){var e,i=this.getLastSelected();!1!==t&&i&&(e=i.getNext()),this.getSelected().each(this._removeSelectedBlock.bind(this)),e&&this.app.block.set(e,"start")},_buildFirstLevel:function(){var t="data-"+this.prefix+"-first-level",e=this.app.editor.getEditor();e.find("["+t+"]").removeAttr(t),e.children("[data-"+this.prefix+"-type]").attr(t,!0)},_removeSelectedBlock:function(t){t.dataget("instance").remove({traverse:!1})},_classFocus:function(t,e){return t[e+"Class"](this.focusclass)}}),p.add("module","event",{init:function(){this.trigger=!0,this.imageDrag=!1,this.dragoverEvent=!1,this.isPopupMouseUp=!1,this.isEditorMouseUp=!1,this.isBlockMouseUp=!1,this.pasteEvent=!1,this.events={editor:["click","touchstart","mouseover","mouseup","mousedown","keyup","drop","dragstart","dragover","dragleave"],doc:["keydown","mousedown","mouseup","click","paste","cut","copy"],win:["focus"]}},build:function(){this.$editor=this.app.editor.getEditor(),this._buildPreventLinks(),this._buildEvents()},run:function(){this._buildEvents()},pause:function(){this._pauseEvents()},onmouseover:function(t){this.app.broadcast("editor.mouseover",{e:t})},ontouchstart:function(t){this.app.state.add(t)},onclick:function(t){this.app.broadcast("editor.click",{e:t}),this._isEditorClick(t)&&!this.isBlockMouseUp&&this._setByClick(t),3===t.detail&&setTimeout(function(){this._setBlockFocus(t,!0)}.bind(this),0)},onmouseup:function(t){this.trigger&&(!this.isEditorMouseUp&&this._isEditorClick(t)||setTimeout(function(){this._observeBlockFocus(t),this.isEditorMouseUp=!1,this.app.broadcast("editor.mouseup",{e:t})}.bind(this),0))},onmousedown:function(t){this.app.placeholder.handleClick(t),this._isEditorClick(t)?this.isBlockMouseUp=!1:(this.isBlockMouseUp=!0,this._setCaretInline(t),this.isEditorMouseUp=!0,this.app.state.add(t),this.app.broadcast("editor.mousedown",{e:t}))},onkeyup:function(t){if(this.app.broadcast("editor.keyup",this._buildEventKeysObj(t)).isStopped())return t.preventDefault();var e=t.which;if(e===this.app.keycodes.DOWN||e===this.app.keycodes.UP){var i=this.app.selection.getDataBlock();0===i.length||this.app.block.is(i)||this.app.block.set(i)}e===this.app.keycodes.BACKSPACE&&this.app.editor.isEmpty()&&this.app.editor.setEmpty(),e!==this.app.keycodes.TAB||this.app.block.is()||this._setBlock(t)},ondrop:function(t){if(!this.opts.editor.drop)return t.preventDefault();var e;if(this.app.broadcast("editor.drop",{e:t}).isStopped())return t.preventDefault();var i=t.dataTransfer,n=i.getData("item");if(""!==n)t.preventDefault(),(e=this.opts.draggable&&"undefined"!==typeof this.opts.draggable[n]?this.opts.draggable[n]:(e=this.dom("[data-"+this.prefix+"-drop-item="+n+"]").html()).trim())&&this._drop(t,e,"after",!1);else if(this.opts.image&&this.opts.image.upload&&null!==i.files&&i.files.length>0)t.preventDefault(),this.app.image.drop(t,i);else{e=""===(e=i.getData("text/html")).trim()?i.getData("Text"):e;var s=this._drop(t,e);if(this.imageDrag&&0!==s.instances.length)s.instances[0].change(this.imageDrag,!1)}this._removeDragPlaceholder(),this.imageDrag=!1,this.app.observer.trigger=!0},ondragstart:function(t){var e=this._getBlock(t.target);0!==e.length&&"image"===this.app.element.getType(e)&&(this.imageDrag=e.dataget("instance")),this.app.broadcast("editor.dragstart",{e:t})},ondragover:function(t){if(t.preventDefault(),this.dragoverEvent=!0,this.app.observer.trigger=!1,this._removeDragPlaceholder(),-1!==t.dataTransfer.types.indexOf("item")){var e=this._getBlockFirst(t.target);if(0!==e.length){var i=this.dom("<div>").addClass(this.prefix+"-draggable-placeholder");e.after(i)}}this.app.broadcast("editor.dragover",{e:t})},ondragleave:function(t){t.preventDefault(),this.dragoverEvent=!0,this.app.observer.trigger=!0,this._removeDragPlaceholder(),this.app.broadcast("editor.dragleave",{e:t})},onwinfocus:function(){var t=this.app.block.get();!t||t.isEditable()||setTimeout(function(){this.app.selection.removeAllRanges()}.bind(this),0)},ondocpaste:function(t){this._isFocusEditor()&&this._paste(t)},ondoccopy:function(t){this._isFocusEditor()&&this._copy(t)},ondoccut:function(t){this._isFocusEditor()&&this._cut(t)},ondockeydown:function(t){if(this.app.popup.isOpen()){if(this._isEnter(t)){var e=this.app.popup.getStack();if(!1!==e.hasForm()&&"TEXTAREA"!==t.target.tagName)return t.preventDefault(),void e.getFooterPrimary().dataget("instance").invokeCommand()}this._isEsc(t)&&this.app.popup.close(!1)}if(!this._isOutsideEditor(t)&&this.app.editor.isFocus()&&!this.app.popup.isOpen()&&!this.app.source.is()){var i=this.app.broadcast("editor.keydown",this._buildEventKeysObj(t));if(i.isStopped())return t.preventDefault();if(!1===this.opts.editor.enterKey&&13===t.which)return void t.preventDefault();if(this.app.state.listen(t))return;if(this._isEsc(t)&&(this.app.block.unset(),this.app.selection.removeAllRanges()),this.app.shortcut.handle(t))return;this.app.input.handle(i)}},ondocmousedown:function(t){this.isPopupMouseUp=0!==this.dom(t.target).closest("."+this.prefix+"-popup-"+this.uuid).length,this.app.broadcast("editor.docmousedown",{e:t})},ondocmouseup:function(t){this.app.selection.is()&&!this.app.editor.isFocus()&&this._observeBlockFocus(t),this.app.broadcast("editor.docmouseup",{e:t})},ondocclick:function(t){if(!this.app.popup.isOpen()||!this._isEditorContainer(t))return!this._isOutsideEditor(t)||!1===this.trigger||void(this.isEditorMouseUp?this.isEditorMouseUp=!1:(this.app.popup.isOpen()?!1===this.isPopupMouseUp&&this.app.popup.close(!1):this.app.editor.setBlur(t),this.app.broadcast("editor.docclick",{e:t})));this.app.popup.close(!1)},_buildPreventLinks:function(){var t=this.prefix+"-prevent-events";this.$editor.on("click."+t+" dblclick."+t,this._preventLinks.bind(this))},_buildEventKeysObj:function(t){var e=t.which,i=[this.app.keycodes.UP,this.app.keycodes.DOWN,this.app.keycodes.LEFT,this.app.keycodes.RIGHT],n=!t.ctrlKey&&!t.metaKey&&(e>=48&&e<=57||e>=65&&e<=90),s=this.app.keycodes;return{e:t,key:e,ctrl:t.ctrlKey||t.metaKey,shift:t.shiftKey,alt:t.altKey,select:(t.ctrlKey||t.metaKey)&&!t.altKey&&65===e,enter:e===s.ENTER,space:e===s.SPACE,esc:e===s.ESC,tab:e===s.TAB&&!t.shiftKey&&!t.altKey&&!t.ctrlKey&&!t.metaKey,delete:e===s.DELETE,backspace:e===s.BACKSPACE,alpha:n,arrow:-1!==i.indexOf(e),left:e===s.LEFT,right:e===s.RIGHT,up:e===s.UP,down:e===s.DOWN,"left-right":e===s.LEFT||e===s.RIGHT,"up-left":e===s.UP||e===s.LEFT,"down-right":e===s.DOWN||e===s.RIGHT}},_buildEvents:function(){var t=this.prefix+"-events";this._buildTargetEvents(this.$editor,this.events.editor,t,""),this._buildTargetEvents(this.app.$doc,this.events.doc,t,"doc"),this._buildTargetEvents(this.app.$win,this.events.win,t,"win")},_buildTargetEvents:function(t,e,i,n){for(var s=0;s<e.length;s++)t.on(e[s]+"."+i,this["on"+n+e[s]].bind(this))},_pauseEvents:function(){var t=this.prefix+"-events";this.$editor.off("."+t),this.app.$doc.off("."+t),this.app.$win.off("."+t)},_preventLinks:function(t){0!==this.dom(t.target).closest("a").length&&t.preventDefault()},_isEditorClick:function(t){if(this.app.editor.isEditor(t.target))return t.preventDefault(),!0},_isEsc:function(t){return t.which===this.app.keycodes.ESC},_isEnter:function(t){return t.which===this.app.keycodes.ENTER},_isEditorContainer:function(t){return 0!==this.dom(t.target).closest("."+this.prefix+"-container-"+this.uuid).length},_isOutsideEditor:function(t){return 0===this.dom(t.target).closest("."+this.prefix+["-container-","-popup-","-toolbar-","-control-"].join(this.uuid+",."+this.prefix)+this.uuid).length},_isFocusEditor:function(){return!this.app.popup.isOpen()&&!this.app.source.is()&&(this.app.block.is()||this.app.blocks.is()||this.app.blocks.isMeta()||this.app.editor.isAllSelected())},_removeDragPlaceholder:function(){this.app.editor.getEditor().find("."+this.prefix+"-draggable-placeholder").remove()},_getBlock:function(t){return this.dom(t).closest("[data-"+this.prefix+"-type]")},_getBlockFirst:function(t){return this.dom(t).closest("[data-"+this.prefix+"-first-level]")},_observeBlockFocus:function(t){this.app.selection.isCollapsed()?this._setBlockFocus(t):this.app.editor.observeBlocks(t),this.app.toolbar.observe(),this.app.state.add(t)},_setByClick:function(t){var e=this.app.blocks.getFirstLevel(),i=[];e.each((function(t){var e=t.get().getBoundingClientRect();i.push([e.x,e.y,e.y+e.height])}));var n=[],s=!1;i.forEach((function(e,i){var o=parseInt(t.clientY),a=parseInt(t.clientX);if(e[1]<o&&o<e[2])s=i;else{var r=Math.hypot(e[0]-a,e[1]-o);n.push(parseInt(r))}}));var o=!1!==s?s:n.indexOf(Math.min.apply(Math,n)),a=e.eq(o);this.app.block.set(a.dataget("instance"),"start"),this.app.editor.setFocus()},_setBlock:function(t){this.app.editor.setFocus();var e=t?this._getBlock(t.target):this.app.selection.getDataBlock(),i=!1;0===e.length&&(e=this.app.blocks.getFirst(),i="start"),this.app.block.set(e,i)},_setBlockFocus:function(t,e){var i=this._getBlock(t.target);0!==i.length&&(this.app.editor.setFocus(),e&&this.app.selection.select(i),this.app.block.set(i))},_setCaretInline:function(t){var e=this.app.block.get(),i=!1;e&&e.isEditable()&&(this.app.element.isEmptyOrImageInline(t.target)?this.app.caret.set(t.target,"after"):this.app.selection.isCollapsed()&&"CODE"===t.target.tagName&&(i=!0,setTimeout(function(){var e=this.app.selection.getElement();e&&i&&"CODE"!==e.tagName&&(this.app.caret.set(t.target,"start"),i=!1)}.bind(this),1)))},_drop:function(t,e,i,n){var s="after"===i?"getFirstLevel":"getDataBlock",o=this.app.element[s](t.target);o=0===o.length?this.app.blocks.getFirst():o,this.app.block.set(o),i||this.app.insertion.insertPoint(t);var a=!0,r=!0,l=this.app.block.get(),p=this.app.editor.isAllSelected();if(l&&"pre"===l.getType()&&!p&&(a=!1,r=!1,e=this.app.content.getTextFromHtml(e,{nl:!0,trimlines:!1})),!1===n&&(a=!1,e=this.app.autoparse.parse(e)),""!==e)return e=a?this.app.autoparse.parse(e):e,this.app.insertion.insertContent({html:e,clean:a,parse:r,position:i})},_paste:function(t){t.preventDefault();var e=t.clipboardData;if(!(this.opts.image&&this.opts.image.upload&&this.app.image.insertFromClipboard(e))){var i=e.getData("URL"),n=this.app.clipboard.getContent(e);this.pasteEvent=!0;var s=this.app.broadcast("editor.before.paste",{e:t,html:n});if(s.isStopped())this.pasteEvent=!1;else{n=s.get("html"),n=i&&""!==i?i:n;var o=this.app.block.get(),a=!0,r=!0,l=this.app.editor.isAllSelected();if(this.opts.paste.plaintext?(a=!1,r=!1,n=this.app.content.getTextFromHtml(n,{br:!0})):o&&"pre"===o.getType()&&!l?(a=!1,r=!1,n=this.app.content.getTextFromHtml(n,{nl:!0,trimlines:!1})):this.opts.paste.clean||(a=!1),n=this.opts.paste.links?n:this.app.content.removeTags(n,["a"]),""!==(n=this.opts.paste.images?n:this.app.content.removeTags(n,["img"]))){var p=e.getData("text/rtf");if(p){var c=this._findLocalImages(n);n=this._replaceLocalImages(n,c,this._extractImagesFromRtf(p))}n=a?this.app.autoparse.parse(n):n;var d=this.app.insertion.insertContent({html:n,clean:a,parse:r});this.opts.image.upload&&this.app.image.parseInserted(d),this.app.placeholder.toggle(),this.app.broadcast("editor.paste",d),this.pasteEvent=!1}else this.pasteEvent=!1}}},_copy:function(t){this._action(t,"copy")},_cut:function(t){this._action(t,"cut")},_action:function(t,e){var i=!1,n={},s=this.app.block.get();if(!(s&&s.isEditable()&&this.app.selection.isCollapsed())){this.app.blocks.isMeta()&&(s=this.app.blocks.getLastSelected()),t.preventDefault(),this.app.editor.isAllSelected()?n={html:this.app.editor.getLayout().html(),remove:"all"}:this.app.blocks.is()?n={html:this.app.selection.getHtml(),remove:"content"}:s&&s.isEditable()?n=this._copyFromEditable(e,s):s&&(n=this._copyFromNonEditable(e,s));var o=this.app.broadcast("editor.before."+e,{e:t,html:n.html});o.isStopped()||("cut"===e&&this._cutDeleteContent(n),i=o.get("html"),i=this.app.clipboard.setContent(t,i),this.app.broadcastHtml("editor."+e,i))}},_cutDeleteContent:function(t){"instance"===t.remove?(t.instance.remove(!0),this.app.control.close()):"all"===t.remove?this.app.editor.setEmpty():!1!==t.remove&&this.app.selection.deleteContents()},_copyFromEditable:function(t,e){var i=e.getType(),n=this.app.selection.getHtml(),s="content";if("figcaption"===i||"cell"===i)s="content";else if(e.isAllSelected())n=e.getOuterHtml(),s="instance";else if("list"===i){var o=e.getTag();-1!==(n=this.app.selection.getHtml()).search(/<li/gi)&&(-1===n.search(/^<li/g)&&(n="<li>"+n+"</li>"),n="<"+o+">"+n+"</"+o+">")}return{html:n,remove:s,instance:e}},_copyFromNonEditable:function(t,e){var i=e.getOuterHtml(),n=!1;return"cut"!==t||e.isSecondLevel()||(n="instance"),{html:i,remove:n,instance:e}},_findLocalImages:function(t){var e=[];return this.app.utils.wrap(t,(function(t){t.find("img").each((function(t){-1!==t.attr("src").search(/^file:\/\//)&&e.push(t.attr("src"))}))})),e},_extractImagesFromRtf:function(t){if(!t)return[];var e=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,i=new RegExp("(?:("+e.source+"))([\\da-fA-F\\s]+)\\}","g"),n=t.match(i);if(!n)return[];for(var s=[],o=0;o<n.length;o++){var a=!1;-1!==n[o].indexOf("\\pngblip")?a="image/png":-1!==n[o].indexOf("\\jpegblip")&&(a="image/jpeg"),a&&s.push({hex:n[o].replace(e,"").replace(/[^\da-fA-F]/g,""),type:a})}return s},_convertHexToBase64:function(t){return btoa(t.match(/\w{2}/g).map((function(t){return String.fromCharCode(parseInt(t,16))})).join(""))},_replaceLocalImages:function(t,e,i){if(e.length===i.length)for(var n=0;n<e.length;n++){var s="data:"+i[n].type+";base64,"+this._convertHexToBase64(i[n].hex);t=t.replace(new RegExp('src="'+e[n]+'"',"g"),'src="'+s+'"')}return t}}),p.add("module","block",{init:function(){this.instance=!1,this.$block=!1},create:function(t){var e=this.app.create("block.paragraph");return t&&e.getBlock().html(t),e},createHtml:function(t){return this.create(t).getOuterHtml()},is:function(t){return t?this._isBlockActive(t):this.get()},isType:function(t){if(this.is())return this.get().isType(t)},get:function(){return this.instance},set:function(t,e,i){t&&(t.isBlock&&(t=t.isNested()?e&&"end"===e?t.getLast().getBlock():t.getFirst().getBlock():t.getBlock()),this.app.blocks.unset(),this.app.editor.unsetSelectAll(),!0!==i&&this._isBlockActive(t)||(this.unset(),this.instance=this._getInstance(t),this.$block=this.instance.getBlock(),this.$block.addClass(this.prefix+"-block-focus"),this._setCaret(e),this.app.toolbar.build(),this.app.control.build(),this.app.broadcast("block.set")))},unset:function(){this.instance&&(this.$block.removeClass(this.prefix+"-block-focus"),this.instance=!1,this.$block=!1,this.app.popup.close(),this.app.control.close(),this.app.context.close(),this.app.broadcast("block.unset"))},observe:function(t,e){if(-1!==["line","quote","pre"].indexOf(e)&&!this.opts[e])return!1},format:function(t){this.app.format.set(t)},add:function(t){this.app.popup.close();var e=this.get();this.app.blocks.isMeta()&&(e=this.app.blocks.getLastSelected()),t.type&&"image"===t.type&&e&&"cell"===e.getType()&&(e=e.getParent("table"));var i,n="after";if(t&&t.template)return e||(n=this.opts.editor.add),void this.app.insertion.insertContent({html:t.template,position:n});i=t.instance?t.instance:this.app.create("block."+t.name,t.source),e?(e.isSecondLevel()&&(e=e.getFirstLevel()),e.isEditable()&&(n=t&&t.position?t.position:this.app.insertion.detectPosition(e.getBlock(),!1))):"top"===this.opts.editor.add?(e=this.app.blocks.getFirst(),n="before"):(e=this.app.blocks.getLast(),n="after");var s=!0;if(e){var o=e.getType();"paragraph"===t.name&&-1!==["paragraph","heading"].indexOf(o)&&(s=!1)}return e.insert({instance:i,caret:t.caret?t.caret:"end",position:n,remove:s,type:"add"}),i},change:function(t){var e=this._getCurrentInstance();e&&e.change(t)},duplicate:function(){if(this.app.popup.close(),this.is()){var t=this.get();t.isSecondLevel()&&(t=t.getFirstLevel());var e=t.duplicate(),i=t.insert({instance:e,caret:"start",type:"duplicate"});return this.app.broadcast("block.duplicate",{instance:i}),i}},remove:function(t){var e;this.app.popup.close();var i=this.get();if(i){i.isSecondLevel()&&(i=i.getFirstLevel());var n=i.getType();if("image"===n&&(e={url:i.getSrc(),id:i.getId()}),!t||"undefined"===typeof t.tarverse||!1!==t.tarverse){var s=i.getNext(),o=i.getPrev();i.remove(),s?this.app.block.set(s,"start"):o?this.app.block.set(o,"end"):this.unset()}else this.unset(),i.remove();"image"===n&&this.app.broadcast("image.remove",e),this.app.broadcast("block.remove",{type:n}),this.app.editor.isEmpty()&&this.app.editor.setEmpty()}},moveUp:function(){var t=this._getCurrentInstance();t&&(t.isSecondLevel()&&(t=t.getFirstLevel()),t.moveUp())},moveDown:function(){var t=this._getCurrentInstance();t&&(t.isSecondLevel()&&(t=t.getFirstLevel()),t.moveDown())},getData:function(){if(this.is())return this.get().getData()},setData:function(t){if(this.is()){var e=t.getData();this.get().setData(e)}},_isBlockActive:function(t){return this.instance&&this.dom(t).get()===this.$block.get()},_getCurrentInstance:function(){var t;return this.app.blocks.isMeta()?t=this.app.blocks.getLastSelected():this.is()&&(t=this.get()),t},_getInstance:function(t){return this.dom(t).dataget("instance")},_setCaret:function(t){var e=this.instance.getType(),i=this.get();-1!==["embed","image","line","layer"].indexOf(e)?(this.app.scroll.save(),this.$block.attr("tabindex","-1"),this.$block.focus(),setTimeout(function(){this.app.selection.removeAllRanges()}.bind(this),1),this.app.scroll.restore()):i.isEditable()&&t&&this.instance.setCaret(t)}}),p.add("module","observer",{init:function(){this.observer=!1,this.trigger=!0},build:function(){if(window.MutationObserver){var t=this.app.editor.getEditor().get();this.observer=this._build(t),this.observer.observe(t,{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})}},stop:function(){this.observer&&this.observer.disconnect(),this.trigger=!0},isButtons:function(){return!this.app.blocks.isMeta()&&!this.app.editor.isAllSelected()&&!(!this.opts.buttons.tags&&!this.opts.buttons.types)},buildButtons:function(t,e){for(var i,n=this.app.block.get(),s=!!n&&n.getType(),o=!!n&&n.getTag(),a=this.app.selection.getNodes({type:"inline",selected:"inside",links:!0}),r=this._getObservedTags(o,a),l=[],p=0;p<r.length;p++)(i=t[r[p]])&&(l=l.concat(i));return s&&(i=e[s])&&(l=l.concat(i)),l},buildActiveButtons:function(t){var e={};for(var i in e.tags=this.opts.buttons.tags?this.opts.buttons.tags:{},e.types=this.opts.buttons.types?this.opts.buttons.types:{},t)if(t.hasOwnProperty(i)){var n=t[i].active;n&&(this._buildActiveButton(i,n.tags,e.tags),this._buildActiveButton(i,n.types,e.types))}return e},_build:function(t){var e=this;return new MutationObserver((function(i){e._observe(i[i.length-1],t)}))},_observe:function(t,e){"attributes"===t.type&&t.target===e||this.trigger&&(this.app.broadcast("observer.change"),this.app.placeholder.toggle(),this.app.sync.trigger())},_buildActiveButton:function(t,e,i){if(e){for(var n=0;n<e.length;n++){var s=e[n];i[s]?i[s].push(t):i[s]=[t]}return i}},_getObservedTags:function(t,e){var i=[];if(t&&i.push(t),e.length>0)for(var n=0;n<e.length;n++)i.push(e[n].tagName.toLowerCase());return i}}),p.add("module","input",{handle:function(t){var e=t.get("e"),i=t.get("key");if(!this._doSelectAll(e,t))if(t.is("enter")&&t.is("shift"))this.handleShiftEnter(e,i,t);else if(t.is("enter"))this.handleEnter(e,i,t);else if(t.is("space")&&t.is("shift"))this.handleShiftSpace(e,i,t);else if(t.is("space"))this.handleSpace(e,i,t);else if(t.is("tab")&&this.opts.tab.key)this.handleTab(e,i,t);else if(t.is("arrow")){if(t.is("ctrl")&&t.is("up"))return void this.handleArrowCtrl(e,i,t);if(t.is(["shift","alt","ctrl"]))return;this.handleArrow(e,i,t)}else t.is(["delete","backspace"])&&this.handleDelete(e,i,t)},handleDelete:function(t,e,i){var n,s=this.app.block.get(),o=i.is("backspace"),a=i.is("delete");if(this.app.editor.isEmpty(!0))t.preventDefault();else{if(this.app.blocks.isMeta())return t.preventDefault(),void this.app.blocks.removeSelected();if(this.app.blocks.is()){t.preventDefault();var r=this.app.blocks.getFirstSelectedBlock(),l=this.dom(r);return this.app.selection.deleteContents(),this.app.block.set(l,"end"),void this.app.block.get().appendNext()}if(!this._deleteInsideSelection(t)){if(!s)return t.preventDefault(),void this.app.selection.deleteContents();if(!(s&&s.isEditable()&&this._trimInvisibleChar(t,i.is("backspace")?"left":"right",a))){var p=this.app.selection.getInline();if(p&&1===p.innerHTML.length)return t.preventDefault(),void(p.innerHTML="");if(!s.handleDelete||!s.handleDelete(t,e,i)){var c=s.getNext(),d=s.getPrev();if(s.isEditable()){if(s.isEditable()){if(s.isAllSelected())return t.preventDefault(),s.setEmpty(),this.app.caret.set(s.getBlock(),"start"),void this.app.toolbar.observe();if(s.isSecondLevel()||s.isFigcaption())return;if(a&&c&&s.isCaretEnd())return t.preventDefault(),void(c.isEditable()?"pre"===c.getType()?(this.app.blocks.setMeta(c.getBlock()),s.isEmpty()&&s.remove(!0)):s.appendNext():(c.isNested()?this.app.blocks.setMeta(c.getBlock()):this.app.block.set(c),s.isEmpty()&&s.remove(!0)));if(o&&d&&s.isCaretStart())return t.preventDefault(),void(d.isEditable()?"pre"===d.getType()?(this.app.blocks.setMeta(d.getBlock()),s.isEmpty()&&s.remove(!0)):(s.appendToPrev(),this.app.control.updatePosition()):(d.isNested()?this.app.blocks.setMeta(d.getBlock()):this.app.block.set(d),s.isEmpty()&&s.remove(!0)));if(!this.app.selection.isCollapsed())return t.preventDefault(),void this.app.selection.deleteContents()}}else t.preventDefault(),"image"===s.getType()&&(n={url:s.getSrc(),id:s.getId()}),s.remove(!0),"image"===s.getType()&&this.app.broadcast("image.remove",n),c?this.app.block.set(c,"start"):d?this.app.block.set(d,"end"):this.app.editor.isEmpty()?this.app.editor.setEmpty():this.app.block.unset()}}}}},handleArrowCtrl:function(t,e,i){this.app.editor.unselectAll(),this.app.selection.removeAllRanges(),this.app.editor.setFocus("start")},handleArrow:function(t,e,i){var n=this.app.block.get();if(this.app.editor.isAllSelected()){t.preventDefault();var s=i.is("down-right")?this.app.blocks.getLast():this.app.blocks.getFirst(),o=i.is("down-right")?"end":"start";return this.app.editor.unselectAll(),this.app.selection.removeAllRanges(),void this.app.block.set(s,o)}if(!this.app.blocks.is()){if(this.app.blocks.isMeta())return n=this.app.blocks.getLastSelected(),void this._doArrow(t,i,n);if(n.isEditable()){var a=this.app.selection.getTopInline();if(i.is("right")&&a&&"CODE"===a.tagName){var r=this.app.caret.is(a,"end"),l=this.app.caret.is(n.getBlock(),"end");if(r&&l)return t.preventDefault(),void this.app.caret.set(a,"after")}}n.isEditable()&&this._trimInvisibleChar(t,i.is("left")?"left":"right")||n.handleArrow&&n.handleArrow(t,e,i)||this._doArrow(t,i,n)}},handleTab:function(t,e,i){var n,s=this.app.block.get();if(this.app.blocks.isMeta())return t.preventDefault(),void((n=(s=this.app.blocks.getLastSelected()).getNext())&&this.app.block.set(n,"start"));if(this.app.blocks.is()){var o=this.app.blocks.getLastSelectedBlock();(s=this.dom(o).dataget("instance")).isSecondLevel()&&(s=s.getFirstLevel())}if(!s.handleTab||!s.handleTab(t,e,i))if(this.opts.tab.spaces&&s.isEditable()){t.preventDefault();var a=this.opts.tab.spaces,r=document.createTextNode(Array(a+1).join("\xa0"));this.app.insertion.insertNode(r,"end")}else t.preventDefault(),(n=s.getNext())&&this.app.block.set(n,"start")},handleShiftSpace:function(t){var e=this.app.block.get();if(this.app.blocks.isMeta())t.preventDefault();else{if(this.app.blocks.is()){t.preventDefault();var i=this.app.blocks.getFirstSelectedBlock(),n=this.dom(i);return this.app.selection.deleteContents(),this.app.caret.set(n,"end"),void this.app.insertion.insertHtml("&nbsp;","end")}if(e.isEditable()){if(e.isAllSelected())return t.preventDefault(),void e.setEmpty();if("pre"!==e.getType())return t.preventDefault(),void this.app.insertion.insertHtml("&nbsp;","end")}}},handleSpace:function(t,e,i){var n=this.app.block.get();if(this.app.blocks.isMeta())return t.preventDefault(),this.app.blocks.getLastSelected().insertEmpty({position:"after",caret:"start"}),void this.app.blocks.removeSelected(!1);if(this.app.blocks.is()){var s=this.app.blocks.getFirstSelectedBlock(),o=this.dom(s);return this.app.selection.deleteContents(),void this.app.caret.set(o,"end")}return n.handleSpace&&n.handleSpace(t,e,i)?void 0:n.isEditable()&&n.isAllSelected()?(t.preventDefault(),void n.setEmpty()):void(n.isEditable()||(t.preventDefault(),n.insertEmpty({position:"after",caret:"start"}),n.remove(!0)))},handleShiftEnter:function(t){if(this.app.blocks.isMeta())t.preventDefault();else{if(this.app.blocks.is()){t.preventDefault();var e=this.app.blocks.getFirstSelectedBlock(),i=this.dom(e);return this.app.selection.deleteContents(),this.app.caret.set(i,"end"),void this.app.insertion.insertBreakline()}if(!this._deleteInsideSelection(t)){var n=this.app.block.get();n.isEditable()?(t.preventDefault(),this.app.insertion.insertBreakline()):(t.preventDefault(),n.insertEmpty({position:"after",caret:"start"}))}}},handleEnter:function(t,e,i){if(this.app.blocks.isMeta())return t.preventDefault(),void this.app.blocks.getLastSelected().insertEmpty({position:"after",caret:"start"});if(this.app.blocks.is())return t.preventDefault(),void this.app.selection.deleteContents();if(!this._deleteInsideSelection(t)){var n=this.app.block.get();if(n.isEditable()){if(n.isAllSelected())return t.preventDefault(),void n.setEmpty();if(!this.app.selection.isCollapsed())return t.preventDefault(),void("pre"===n.getType()?this.app.insertion.insertNewline():this.app.insertion.insertBreakline())}n.isEditable()||(t.preventDefault(),n.insertEmpty({position:"after",caret:"start"})),n.handleEnter&&n.handleEnter(t,e,i)}},handleTextareaTab:function(t){if(9!==t.keyCode)return!0;t.preventDefault();var e=t.target,i=e.value,n=e.selectionStart;e.value=i.substring(0,n)+"    "+i.substring(e.selectionEnd),e.selectionStart=e.selectionEnd=n+4},_deleteInsideSelection:function(t){if(!this.app.selection.isCollapsed()){var e=this.app.selection.getNodes({type:"blocks"});if(e.length>1)return t.preventDefault(),this.app.selection.deleteContents(),this.app.caret.set(e[0],"end"),!0}return!1},_doSelectAll:function(t,e){return this._isAllSelected(e)?(this._setEditorEmpty(t,e),!0):e.is("select")?(t.preventDefault(),this.app.editor.selectAll(),!0):void 0},_doArrow:function(t,e,i){var n,s,o=i.getType(),a=["pre","line","image","embed","layer"];if(e.is("up-left")&&i.isCaretStart()){if(s="end",!(n=i.getPrev())&&-1!==a.indexOf(o))return void this.app.insertion.insertEmptyBlock({position:"before",caret:"start"})}else if(e.is("down-right")&&i.isCaretEnd()&&(s="start",!(n=i.getNext())&&-1!==a.indexOf(o)))return void this.app.insertion.insertEmptyBlock({position:"after",caret:"start"});n&&(t.preventDefault(),this.app.block.set(n,s))},_isAllSelected:function(t){return this.app.editor.isAllSelected()&&t.is(["enter","delete","backspace","alpha","space"])},_setEditorEmpty:function(t,e){e.is(["alpha","space"])||t.preventDefault(),this.app.editor.setEmpty()},_trimInvisibleChar:function(t,e,i){var n,s="left"===e?"before":"after",o=this.app.selection.get(),a=this._isInvisibleChar(s);if(a&&"left"===e)n=o.current,this.dom(n).replaceWith(n.textContent.replace(/\uFEFF/g,""));else if(a&&i&&o.current&&o.current.nextSibling)n=o.current.nextSibling,this.dom(n).replaceWith(n.textContent.replace(/\uFEFF/g,""));else if(a&&"right"===e){t.preventDefault();var r=this.app.offset.get();return this.app.offset.set(!1,{start:r.start+1,end:r.end+1}),!0}},_isInvisibleChar:function(t){var e=this.app.selection.get(),i=this.app.selection.getText(t);return e.current&&3===e.current.nodeType&&0===this.app.utils.searchInvisibleChars(i)}}),p.add("module","insertion",{init:function(){this._clear()},start:function(){this.win=this.app.$win.get(),this.doc=this.app.$doc.get()},getFirstInserted:function(){return this.inserted.instances[0]},getLastInserted:function(){var t=this.inserted.instances.length,e=this.inserted.instances[t-1];return e&&e.isFigcaption()&&(e=e.getFigure()),e},getInserted:function(){return this.inserted},setContent:function(t){this._insert(t,"set");var e=this.getInserted();return this.inserted=!1,e},insertContent:function(t){this._insert(t,"insert");var e=this.getInserted();return this.inserted=!1,e},insertEmptyBlock:function(t){t||(t={}),t.html=this.app.block.createHtml(),this._insert(t,"insert");var e=this.getInserted();return this.inserted=!1,this.app.broadcast("block.add",{instance:e.instances[0],type:"input"}),e},insertNewline:function(t,e){var i=e?"\n\n":"\n";return this._insertFragment({node:document.createTextNode(i)},t||"after")},insertPoint:function(t){var e,i=this.app.utils.createInvisibleChar(),n=t.clientX,s=t.clientY;if(this.doc.caretPositionFromPoint){var o=this.doc.caretPositionFromPoint(n,s);(e=this.doc.getSelection().getRangeAt(0)).setStart(o.offsetNode,o.offset),e.collapse(!0),e.insertNode(i)}else this.doc.caretRangeFromPoint&&(e=this.doc.caretRangeFromPoint(n,s)).insertNode(i);this.app.caret.set(i,"after")},insertBreakline:function(t){var e=this.app.selection.getNodes({type:"inline"});return this.app.selection.isCollapsed()&&0!==e.length?this._splitInline(e,document.createElement("br")):this._insertFragment({node:document.createElement("br")},t||"after")},insertNode:function(t,e,i){if(i){var n=this.app.selection.getNodes({type:"inline"});if(0!==n.length)return this._splitInline(n,t)}return this._insertFragment({node:this.dom(t).get()},e)},insertHtml:function(t,e){return this._insertFragment({html:t},e)},insertText:function(t,e){var i=this.app.block.get();if(!(i&&!i.isEditable()||this.app.blocks.isMeta())){var n,s=this.win.getSelection();if(s.getRangeAt&&s.rangeCount){t=this.app.content.getTextFromHtml(t,{nl:!0}),n=document.createTextNode(t);var o=s.getRangeAt(0);o.deleteContents(),o.insertNode(n),e=e||"end",this.app.caret.set(n,e)}return n}this.insertContent({html:t,caret:e})},insertListToList:function(t,e,i){var n=t.find("li"),s=n.last();n.addClass(this.prefix+"-pasteitems"),s.addClass(this.prefix+"-pastemarker");var o=t.children(),a=this.dom(this.app.selection.getBlock()),r=this.app.caret.is(e,"start"),l=this.app.caret.is(e,"end"),p=this.app.caret.is(a,"start"),c=this.app.caret.is(a,"end",["ul","ol"]),d=this.app.content.isEmptyHtml(a.html());if(r)d&&a.remove(),e.prepend(o);else if(l)d&&a.remove(),e.append(o);else if(d)a.after(o),a.remove();else if(p)a.before(o);else if(c){var h=a.find("ul, ol");0!==h.length?h.prepend(o):a.after(o)}else this.app.element.split(a).before(o);var u=this.prefix+"-pastemarker",m=this.prefix+"-pasteitems";return i&&(s=this.app.editor.getEditor().find("."+u).removeClass(u),this.app.caret.set(s,"end")),this.app.editor.getEditor().find("."+m).removeClass(m)},detectPosition:function(t,e){if(e)return e;var i=this.app.caret.is(t,"start");return e=this.app.caret.is(t,"end")?"after":i?"before":"split"},_insert:function(t,e){this.html=t.html,this.html=this.app.broadcastHtml("editor.before.insert",this.html),this.isParse="undefined"===typeof t.parse||t.parse,this.isClean="undefined"!==typeof t.clean&&t.clean,this.isCaret="undefined"===typeof t.caret||t.caret,this.isPosition="undefined"!==typeof t.position&&t.position,this.isCurrent="undefined"!==typeof t.current&&t.current,"set"===e||this.app.editor.isAllSelected()?this._setContent():this._insertContent(),this.app.broadcast("editor.insert",this.inserted)},_insertContent:function(){var t,e,i=this.isCurrent?this.isCurrent:this.app.block.get(),n=!1,s=!1;if(this._checkEmpty(),this._checkLine(),this.app.blocks.isMeta()||this.app.blocks.is()){if(this.isEmpty)return;var o;if(this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild(),t=this._buildParsedNodes(),this.app.blocks.is()){if(!(o=this.app.blocks.getLastSelectedBlock()))return;i=(e=this.dom(o)).dataget("instance"),this.app.selection.deleteContents(),this._insertToEditable(i,e,t)}else{(o=this.app.blocks.getLastSelected()).getBlock().after(t),this.app.blocks.removeSelected(!1)}}else if(!i||this.isPosition){if(this.isEmpty)return;this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild(),t=this._buildParsedNodes();"top"===this.isPosition||!this.isPosition&&"top"===this.opts.editor.add?(i=this.app.blocks.getFirst(),n="before"):i&&-1!==["after","before","append"].indexOf(this.isPosition)?n=this.isPosition:(i=this.app.blocks.getLast(),n="after"),(e=i.getBlock())[n](t)}else if(this._isListToList(i)){this.app.selection.deleteContents(),this._clean(),this._parse(),this._parseBuild(),e=i.getBlock();var a=this.$parsed.children().first();this.$nodes=this.insertListToList(a,e,"end"),this.isCaret=!1}else{if(!i)return;if(i.isEditable()){if(this.isEmpty)return;this._clean(),this._cleanSpecial(i),this.isLine?this._parseLine():this._parse(),this._parseBuild(),i.isEmpty()?(s=!0,n="after"):this.app.selection.deleteContents(),t=this._buildParsedNodes(),e=i.getBlock(),this._insertToEditable(i,e,t,n,s)}else{if(n="after",this.isEmpty)return;this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this.isLine?this._parseLine():this._parse(),this._parseBuild(),t=this._buildParsedNodes(),(e=i.getBlock())[n](t)}}this._buildInserted(),this._buildEditor(),this._buildCaret()},_insertToEditable:function(t,e,i,n,s){this.isLine?(this.$nodes=this._insertFragment({fragment:this.$parsed.get()},"end"),this.isCaret=!1):(this.app.content.isEmptyHtml(e.html())?(n="after",s=!0):n=this.detectPosition(e,n),"split"===n?this.app.element.split(e).before(i):e[n](i),s&&t.remove())},_insertFragment:function(t,e){var i;if(t.html||t.fragment?(i=this.app.fragment.build(t.html||t.fragment),this.app.fragment.insert(i)):this.app.fragment.insert(t.node),e){var n=t.node?t.node:"start"===e?i.first:i.last;this.app.caret.set(n,e)}return t.node?this.dom(t.node):this.dom(i.nodes)},_setContent:function(){this._checkEmpty(),this._checkLine(),this.isEmpty?this.html=this.app.block.createHtml():this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild();var t=this._buildParsedNodes();this.app.editor.unsetSelectAll(),this.app.editor.getEditor().html("").append(t),this.isEmpty&&this.app.broadcast("editor.empty"),this._buildInserted(),this._buildEditor(),this._buildCaret(),this.app.broadcast("editor.set",this.inserted)},_splitInline:function(t,e){var i=this.app.element.split(t[0]);return i.before(e),""===i.html()&&i.remove(),this.dom(e)},_buildEditor:function(){this.app.placeholder.trigger(),this.app.editor.build(),this.app.editor.setFocus(),this.app.toolbar.observe(),this.app.context.observe()},_buildCaret:function(){if(this.isCaret){var t,e="end";"start"===this.isCaret?(t=this.getFirstInserted(),e="start"):t=this.getLastInserted(),t&&this.app.block.set(t,e)}},_buildInserted:function(){this.inserted={$nodes:this.$nodes,instances:[]},this.inserted.$nodes.each(this._buildInstance.bind(this))},_buildInstance:function(t){var e=t.dataget("instance");e&&this.inserted.instances.push(e)},_buildParsedNodes:function(){return this.$parsed.get().childNodes},_clear:function(){this.html=!1,this.isLine=!1,this.isEmpty=!1,this.isSplit=!1,this.isClean=!1,this.isParse=!0,this.isCaret=!0,this.isCurrent=!1,this.isPosition=!1},_clean:function(){this.isClean&&(this.html=this.app.cleaner.cleanHtml(this.html))},_cleanSpecial:function(t){var e,i,n=t.getType();-1!==["cell","address","figcaption","quoteitem"].indexOf(n)?e=!0:"list"===n&&(e=!0,i=["ul","ol","li"]),e&&(this.isLine=!0,this.html=this.app.content.addBrToBlocks(this.html),this.html=this.app.content.removeBlockTags(this.html,undefined,i),this.html=this.html.replace(/<br\s?\/?>\n?$/gi,""))},_parse:function(){this.isParse&&(this.html=this.app.parser.parse(this.html,!1))},_parseLine:function(){this.isParse&&(this.html=this.app.parser.parseLine(this.html,!1))},_parseBuild:function(){this.$parsed=this.app.parser.build(this.html),this.$nodes=this.$parsed.children()},_checkEmpty:function(){this.isEmpty=this.app.content.isEmptyHtml(this.html)},_checkLine:function(){this.isLine=this.app.content.isLine(this.html)},_isListToList:function(t){var e=t.getBlock().attr("data-"+this.prefix+"-type"),i=this.dom("<div>").html(this.html);return i.find("meta").remove(),i.find("b").unwrap(),i=i.children().first(),"list"===e&&0!==i.length&&-1!==["ul","ol"].indexOf(i.get().tagName.toLowerCase())}}),p.add("module","toolbar",{init:function(){this.eventname=this.prefix+"-toolbar",this.activeClass="active",this.toggledClass="toggled",this.disableClass="disable",this.customButtons={},this.aTags={},this.aTypes={}},start:function(){this.$container=this.app.container.get("toolbar"),this.opts.toolbar&&(this._build(),this._buildSticky())},load:function(){this.opts.toolbar&&(this._buildActiveButtons(),this.app.block.get()||(this.$toolbar.html(""),this._buildButtons()))},stop:function(){this.opts.toolbar&&(this.$toolbar.remove(),this.customButtons={},this.editorButtons={})},build:function(){if(this.opts.toolbar){var t=this.app.block.get();t&&t.isSecondLevel()&&(t=t.getFirstLevel());var e=this.app.editor.getButtonsFromArr(this.opts.buttons.editor);t&&t.toolbar&&(e=this.app.editor.getButtonsFromArr(t.toolbar)),this.$toolbar.html("");var i=this._createButtons(e,t);t||this._checkIntialToolbar(i)}},observe:function(){if(this.opts.toolbar&&(this.unsetActive(),this.app.observer.isButtons())){var t=this.app.observer.buildButtons(this.aTags,this.aTypes);this._setActiveKeys(t)}},getElement:function(){return this.$toolbar},get:function(t){return this._findButton(t)},add:function(t,e){this.customButtons[t]=e},setActive:function(t){this.opts.toolbar&&(this._findButtons().removeClass(this.activeClass),this._findButton(t).removeClass(this.disableClass).addClass(this.activeClass))},setToggled:function(t){this.opts.toolbar&&(this._findButtons().removeClass(this.toggledClass),this._findButton(t).removeClass(this.disableClass).addClass(this.toggledClass))},unsetActive:function(t){this.opts.toolbar&&(t?this._findButton(t):this._findButtons()).removeClass(this.activeClass)},unsetToggled:function(t){this.opts.toolbar&&(t?this._findButton(t):this._findButtons()).removeClass(this.toggledClass)},enable:function(){this.opts.toolbar&&this._findButtons().removeClass(this.disableClass)},disable:function(){this.opts.toolbar&&this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass)},disableSticky:function(){var t=this.app.container.get("toolbar");t.removeClass(this.prefix+"-toolbar-sticky"),t.css("top","")},enableSticky:function(){if(this.opts.toolbar.sticky){var t=this.app.container.get("toolbar");t.addClass(this.prefix+"-toolbar-sticky"),t.css("top",this.opts.toolbar.stickyTopOffset+"px")}},isSticky:function(){var t=this.app.container.get("toolbar"),e=this.app.container.get("main"),i=e.offset().top+parseInt(e.css("border-top-width")),n=t.offset().top;return n>i||n<i},_build:function(){this.$toolbar=this.dom("<div>").addClass(this.prefix+"-toolbar"),this.$container.append(this.$toolbar),this.$container.addClass("is-"+this.prefix+"-toolbar")},_buildSticky:function(){this.opts.toolbar.sticky&&(this._toggleSticky("add",this.opts.toolbar.stickyTopOffset+"px"),this._startEvent())},_buildButtons:function(){var t=this.app.editor.getButtonsFromArr(this.opts.buttons.editor),e=this._createButtons(t);this._checkIntialToolbar(e)},_buildActiveButtons:function(){var t=this.app.observer.buildActiveButtons(this.customButtons);this.aTags=t.tags,this.aTypes=t.types},_checkIntialToolbar:function(t){if(0===t&&!this.opts.topbar){var e=this.app.blocks.getFirst(),i=this.app.editor.getButtonsFromArr(e.toolbar);this.$toolbar.html(""),this._createButtons(i,e),this.disable()}},_findButtons:function(){return this.$toolbar.find("."+this.prefix+"-button-toolbar")},_findButton:function(t){return this.$toolbar.find("[data-name="+t+"]")},_createButtons:function(t,e){var i=t;e&&(i=d.extend(!0,{},t,this.customButtons));var n=0;for(var s in i)if(i.hasOwnProperty(s)){if("add"===s&&!this.opts.addbar)continue;if("html"===s&&!this.opts.source)continue;if("format"===s&&!this.opts.format)continue;if(e&&!e.isAllowedButton(s,i[s]))continue;if(this._isHidden(s))continue;this.app.create("button",s,i[s],this.$toolbar,"toolbar"),n++}return n},_isHidden:function(t){return-1!==this.opts.toolbar.hide.indexOf(t)},_setActiveKeys:function(t){for(var e=0;e<t.length;e++)this._findButton(t[e]).addClass(this.activeClass)},_getObservedTags:function(t,e){var i=[];if(t&&i.push(t),e.length>0)for(var n=0;n<e.length;n++)i.push(e[n].tagName.toLowerCase());return i},_toggleSticky:function(t,e){var i="remove"===t?"removeClass":"addClass";this.$container[i](this.prefix+"-toolbar-sticky"),this.$container.css("top",e)},_startEvent:function(){this.app.scroll.getTarget().on("scroll."+this.eventname,this._observeSticky.bind(this))},_stopEvent:function(){this.app.scroll.getTarget().off("."+this.eventname)},_observeSticky:function(){if(this.app.source.is())this.$container.css("top",0);else{var t=this.app.scroll.getTarget(),e=this.app.scroll.isTarget()?parseInt(t.css("padding-top")):0;this.$container.css("top",0-e+this.opts.toolbar.stickyTopOffset+"px"),this.isSticky()?this.app.broadcast("toolbar.sticky"):this.app.broadcast("toolbar.static")}}}),p.add("module","addbar",{init:function(){this.custom={}},popup:function(t,e){if(this.opts.addbar){this.app.popup.create("addbar",{width:"380px",items:this.buildItems()});var i=e.isButton||e.isControl?{button:e}:{};this.app.popup.open(i)}},add:function(t,e){this.custom[t]=e,this.custom[t].container=!0,this.custom[t].addbar=!0,this.custom[t].command=e.command?e.command:"block.add",e.template&&(this.custom[t].params={template:e.template})},buildItems:function(){for(var t={},e=this.opts.buttons.addbar,i=d.extend(!0,{},this.opts.buttonsObj),n=0;n<e.length;n++){var s=e[n];this._isHidden(s)||(t[s]=i[s],t[s].container=!0,t[s].addbar=!0,t[s].icon=!0)}for(var o in this.opts.addbar.add)if(this.opts.addbar.add.hasOwnProperty(o)){if(this._isHidden(o))continue;t[o]=this.opts.addbar.add[o],t[o].container=!0,t[o].addbar=!0,t[o].command="block.add",t[o].params={template:this.opts.addbar.add[o].template}}return t=d.extend(!0,{},t,this.custom)},_isHidden:function(t){return-1!==this.opts.addbar.hide.indexOf(t)}}),p.add("module","format",{popup:function(t,e){for(var i=this.app.block.get(),n=!!i&&i.getBlock(),s=!!i&&i.getTag(),o=this.opts.format,a={},r=0;r<o.length;r++){var l=o[r];a[l]={title:this.opts.formatObj[l].title,params:{tag:l},command:"block.format",shortcut:this.opts.formatObj[l].shortcut}}if(this.opts.formatAdd){var p=this.opts.formatAdd;Object.keys(p).forEach((function(t){a[t]={title:p[t].title,params:p[t].params,command:"block.format"}}))}var c=this._isActiveFormat(n,s,a);c&&(a[c].active=!0),this.app.popup.create("format",{width:"300px",items:a}),this.app.popup.open({button:e})},set:function(t){if(this.app.popup.close(),!this.app.blocks.isMeta()){var e={type:this.opts.formatObj[t.tag].type,tag:t.tag,classname:t.classname||!1},i=this.app.blocks.getSelectedBlocks("editable"),n=this.app.block.get();n?this.setSingle(n,e,t):0!==i.length&&this.setMultiple(i,e,t)}},setSingle:function(t,e){var i,n=t.isEmpty(),s=!!n&&"start";this.tag=t.getTag(),this.type=t.getType(),this.$block=t.getBlock(),n||this.app.selection.saveMarker(),this._isSameTag(e)&&(e=this._checkSameFormat(this.$block,e)),e&&(this._isListToText(e,"list")?i=this._formatListToText(e):this._isListToText(e,"dlist")?i=this._formatListToText(e,!0):this._isTextToList(e,"list")?this._formatTextToList(e,!1,s):this._isTextToList(e,"dlist")?this._formatTextToList(e,!0,s):this._replaceTo(t,e,s)),n||this.app.selection.restoreMarker(),i&&this.app.block.unset(),t=this.app.block.get(),this.app.editor.build(),this.app.broadcast("block.format",{instance:t})},setMultiple:function(t,e){var i,n,s,o;this.app.selection.saveMarker(),this._isListTag(e.tag)&&this._isMultipleParagraphs()&&(o=(i=this.app.create("block."+e.type,!1,{tag:e.tag})).getBlock(),this.dom(t[0]).before(o));for(var a=0;a<t.length;a++){var r,l;if((s=t[a].tagName.toLowerCase())!==e.tag)if(o)r=this.dom("<li>").html(t[a].innerHTML),o.append(r),this.dom(t[a]).remove(),this._setStyleAndClass(o,e);else if(!this._isListTag(s)&&this._isListTag(e.tag))n=(i=this.app.create("block."+e.type,!1,{tag:e.tag})).getBlock(),r=this.dom("<li>").html(t[a].innerHTML),n.append(r),(l=this.dom(t[a])).after(n),l.remove(),this._setStyleAndClass(n,e);else if(this._isListTag(s)&&!this._isListTag(e.tag)){var p=(l=this.dom(t[a])).find("li");p.find("ul, ol").each((function(t){t.parent().after(t)})),p.find("ul, ol").unwrap(),p.each(function(t){var i=this.dom("<"+e.tag+">");i.html(t.html()),t.remove(),this.app.create("block."+e.type,i),l.before(i),this._setStyleAndClass(i,e)}.bind(this)),l.remove()}else i=this._replaceToBlock(t[a],e)}this.app.selection.restoreMarker(),o&&this.app.block.set(o),this.app.editor.build(),this.app.editor.unsetSelectAll(),this.app.broadcast("block.format",{instance:i})},_isListTag:function(t){return-1!==["ul","ol"].indexOf(t)},_isSameTag:function(t){return this.tag===t.tag&&this.type===t.type},_isMultipleParagraphs:function(){var t=this.app.blocks.getSelectedBlocks(),e=["P","ADDRESS","H1","H2","H3","H4","H5","H6"];if(t.length>1){for(var i=0,n=0;n<t.length;n++)-1===e.indexOf(t[n].tagName)&&i++;if(0===i)return!0}return!1},_checkSameFormat:function(t,e){var i=this.app.element.hasClass(t,e.classname);return!e.classname||i?this._buildDefaultFormat():e},_buildDefaultFormat:function(){return{type:"paragraph",tag:"p",classname:!1}},_formatListToText:function(t,e){var i=e?this._getDlistItems():this._getListItems();return this._createItems(i,t),this.$block.remove(),i},_formatTextToList:function(t,e,i){var n=this.app.create("block."+t.type,"<"+t.tag+">").getBlock();if(e&&"list"===this.type){var s=0;this._getListItems().each(function(t){var e=0===s?"dt":"dd",i=this.dom("<"+e+">").html(t.html());s="dt"===e?1:0,n.append(i)}.bind(this))}else if(e||"dlist"!==this.type){var o=e?"<dt>":"<li>",a=this.dom(o).html(this.$block.html());n.append(a)}else this._getDlistItems().each(function(t){var e=this.dom("<li>").html(t.html());n.append(e)}.bind(this));this.app.create("block."+t.type,n),this.$block.after(n),this.$block.remove(),this._setStyleAndClass(n,t),this.app.block.set(n,i)},_replaceTo:function(t,e,i){var n=t.getBlock(),s=(t=this._replaceToBlock(n,e)).getBlock();this.app.block.set(s,i)},_replaceToBlock:function(t,e){var i=this.app.element.replaceToTag(t,e.tag);return this._setStyleAndClass(i,e),this.app.create("block."+e.type,i)},_createItems:function(t,e){t.each(function(t){var i=this.dom("<"+e.tag+">");i.html(t.html()),t.remove(),this.app.create("block."+e.type,i),this.$block.before(i),this._setStyleAndClass(i,e)}.bind(this))},_isListToText:function(t,e){return this.type===e&&-1!==["heading","address","paragraph"].indexOf(t.type)},_isTextToList:function(t,e){var i="list"===e?"dlist":"list";return t.type===e&&-1!==["heading","address","paragraph",i].indexOf(this.type)},_isActiveFormat:function(t,e,i){if(t){var n;for(var s in i)if(i.hasOwnProperty(s)){var o=i[s].params.classname||!1;e===i[s].params.tag&&(o?o&&this.app.element.hasClass(t,o)&&(n=s):n=s)}return n}},_setStyleAndClass:function(t,e){t.removeAttr("style class data-"+this.prefix+"-style-cache"),e.classname&&t.addClass(e.classname)},_getListItems:function(){var t=this.$block.find("li");return t.find("ul, ol").each((function(t){t.parent().after(t)})),t.find("ul, ol").unwrap(),t},_getDlistItems:function(){return this.$block.find("dt, dd")}}),p.add("module","embed",{popups:{add:{title:"## embed.embed ##",width:"100%",form:{embed:{type:"textarea",label:"## embed.description ##",rows:6},caption:{type:"input",label:"## embed.caption ##"},responsive:{type:"checkbox",text:"## embed.responsive-video ##"}},footer:{insert:{title:"## buttons.insert ##",command:"embed.insert",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}},edit:{title:"## embed.embed ##",width:"100%",form:{embed:{type:"textarea",label:"## embed.description ##",rows:6},caption:{type:"input",label:"## embed.caption ##"},responsive:{type:"checkbox",text:"## embed.responsive-video ##"}},footer:{save:{title:"## buttons.save ##",command:"embed.save",type:"primary"},remove:{title:"## buttons.delete ##",command:"embed.remove",type:"danger",right:!0},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}}},build:function(t){t?this._callScripts(t):this._findScripts()},observe:function(t,e,i){if(!this.opts.embed)return!1;var n=this.app.block.get();return i&&"addbar"===i.getName()?t.command="embed.popup":n&&"embed"===n.getType()&&(t.command="embed.edit"),t},popup:function(){this.app.popup.create("embed",this.popups.add),this.app.popup.open({focus:"embed"}),this.opts.embed.checkbox&&this.app.popup.getInput("responsive").attr("checked",!0),this._buildCodemirror()},edit:function(t){var e=this.app.block.get(),i={embed:e.getEmbedCode(),caption:e.getCaption(),responsive:e.isResponsive()};this.app.popup.create("embed",this.popups.edit),this.app.popup.setData(i),this.app.popup.open({focus:"embed"}),this._buildCodemirror()},insert:function(){this.app.popup.close();var t=this.app.popup.getData(),e=this._getEmbedCode(t);if(""!==e){var i=this._createInstance(t,e);this.app.block.add({instance:i})}},save:function(){this.app.popup.close();var t=this.app.block.get(),e=this.app.popup.getData(),i=this._getEmbedCode(e);if(""!==i){var n=this._createInstance(e,i,t);this._isNeedToChange(e,n,t)&&this.app.block.change(n)}else this.app.block.remove()},remove:function(){this.app.popup.close(),this.app.block.remove()},_buildCodemirror:function(){var t=this.app.popup.getInput("embed");this.app.codemirror.create({el:t,height:"200px",focus:!0}),this.app.popup.updatePosition()},_findScripts:function(){var t=this.app.editor.getEditor().find("[data-"+this.prefix+"-type=embed]").find("script").getAll();this.build.call(this,t)},_callScripts:function(t){for(var e=0;e<t.length;e++)if(""!==t[e].src){var i=t[e].src;this.app.$doc.find('head script[src="'+i+'"]').remove();var n=this.dom("<script>").attr({src:i,async:!0,defer:"true"});n.on("load",function(){if(-1!==i.search("instagram")){var n=this.app.$win.get();n.instgrm&&n.instgrm.Embeds.process()}this.build(t.slice(e+1))}.bind(this));var s=this.app.$doc.get().getElementsByTagName("head")[0];s&&s.appendChild(n.get())}},_getEmbedCode:function(t){var e=t.embed.trim();return e=this.app.codemirror.val(e),e=this._removeScript(e),e=this.app.content.sanitize(e),e=this._isHtmlString(e)||""===e?e:this._parseUrl(e)},_removeScript:function(t){return this.opts.embed.script||(t=this.app.content.removeTagsWithContent(t,["script"])),t},_createInstance:function(t,e,i){var n;i?(n=i.duplicate().getBlock()).html(e):n=this._isFigure(e)?e:"<figure>"+e+"</figure>";var s=this.app.create("block.embed",n);return s.setCaption(t.caption),t.responsive&&s.addResponsive(),s},_parseUrl:function(t){var e='<iframe width="560" height="315" src="',i='" frameborder="0" allowfullscreen></iframe>';if(t.match(this.opts.regex.youtube)){var n="//www.youtube.com";return-1!==t.search("youtube-nocookie.com")&&(n="//www.youtube-nocookie.com"),e+t.replace(this.opts.regex.youtube,n+"/embed/$1")+i}return t.match(this.opts.regex.vimeo)?e+t.replace(this.opts.regex.vimeo,"//player.vimeo.com/video/$2")+i:t},_isNeedToChange:function(t,e,i){return i.getEmbedCode()!==e.getEmbedCode()||(t.responsive!==i.isResponsive()||(t.caption!==i.getCaption()||void 0))},_isHtmlString:function(t){return/^\s*<(\w+|!)[^>]*>/.test(t)},_isFigure:function(t){return/^<figure/.test(t)}}),p.add("module","image",{popups:{add:{title:"## popup.add-image ##",width:"100%"},edit:{title:"## popup.image ##",width:"100%",getter:"block.getData",form:{width:{type:"input",width:"100px",label:"## image.width ##",observer:"image.observeImageWidth"},alt:{type:"input",label:"## image.alt-text ##"},caption:{type:"input",label:"## image.caption ##",observer:"image.observeImageCaption"},link:{type:"input",label:"## image.link ##",observer:"image.observeImageLink"},target:{type:"checkbox",text:"## image.link-in-new-tab ##",observer:"image.observeImageLink"}},footer:{save:{title:"## buttons.save ##",command:"image.save",type:"primary"},remove:{title:"## buttons.delete ##",command:"image.remove",type:"danger",right:!0},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}}},init:function(){this.dataStates=[]},popup:function(){this.app.popup.create("image",this.popups.add);var t=this.app.popup.getBody();this._createImageByUrl(t),this._createOrSection(t),this._createUploadBox(t),this._createSelectBox(t),this.app.popup.open()},edit:function(t){this.app.popup.create("image-edit",this.popups.edit),this._buildEditUpload(),this.app.popup.open()},observe:function(t,e,i){if(!this.isImagePopup())return!1;var n=this.app.block.get();return i&&"addbar"===i.getName()?t.command="image.popup":n&&"image"===n.getType()&&(t.command="image.edit"),t},observeStates:function(){this._findImages().each(this._addImageState.bind(this))},observeImageLink:function(t){return!!this.opts.image.link&&t},observeImageCaption:function(t){var e=this.app.block.get();return!(!e||"figure"!==e.getTag())&&t},observeImageWidth:function(t){return!!this.opts.image.width&&t},isImagePopup:function(){return!1!==this.opts.image},paste:function(t,e){var i={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:this.opts.image.multiple,success:"image.insertFromBlob",error:"image.error"};this.app.create("upload").send(e,[t],i)},parseInserted:function(t){var e=[],i={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:!0,success:"image.insertFromInserted",error:"image.error"};this.pasteInsertedImages=[],this.resolved=[];for(var n=0,s=0;s<t.instances.length;s++){var o=t.instances[s];if("image"===o.getType()){var a=o.getSrc();if(-1!==a.search(/^data:/i)){var r=this._dataURLtoFile(a,"image"+s);e.push(r),this.pasteInsertedImages.push(o)}else if(-1!==a.search(/^blob:/i)){n++,this.pasteInsertedImages.push(o);var l=this;function p(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=function(t){if(200==i.status){var n=i.response,s=new File([n],"image"+e,{type:"image/png"});l.resolved.push(s)}},i.send()}p(a,s)}}}if(0!==n)var c=setInterval(function(){this.resolved.length===n&&(clearInterval(c),this.app.create("upload").send(!1,this.resolved,i))}.bind(this),100);0!==e.length&&this.app.create("upload").send(!1,e,i)},drop:function(t,e){for(var i=[],n=0;n<e.files.length;n++){var s=e.files[n]||e.items[n].getAsFile();s&&i.push(s)}var o={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:this.opts.image.multiple,success:"image.insertByDrop",error:"image.error"};if(i.length>0){var a=this.dom(t.target).closest("[data-"+this.prefix+"-type]");0!==a.length&&this.app.block.set(a),this.app.create("upload").send(t,i,o)}},insertFromClipboard:function(t){var e=t.getData("text/plain")||t.getData("text/html");if(""===(e=e.trim())){for(var i=t.items,n=null,s=0;s<i.length;s++)0===i[s].type.indexOf("image")&&(n=i[s].getAsFile());return null!==n?(this.paste(n),!0):void 0}},insertFromBlob:function(t){this.insert(t)},insertByDrop:function(t,e){if(this.app.block.is()){var i=this.app.block.get(),n=e.target,s=i.getType();if("card"===s&&n&&"IMG"===n.tagName&&i.hasImage()||"image"===s)return void this.change(t);e&&"card"!==s&&i.isEditable()&&this.app.insertion.insertPoint(e)}this.insert(t)},insertByUpload:function(t){this.insert(t)},insertByUrl:function(t){t.preventDefault();var e=this.$urlinput.val();if(""!==e.trim()){var i={file:{url:e,id:this.app.utils.getRandomId()}};this.insert(i)}},insertFromSelect:function(t){t.preventDefault();for(var e=this.dom(t.target),i={url:e.attr("data-url")},n=["id","alt","caption","link","width","height"],s=0;s<n.length;s++){var o=e.attr("data-"+n[s]);null!==o&&(i[n[s]]=o)}this.insert({file:i},!0)},insertFromInserted:function(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&(this.pasteInsertedImages[e].setImage(t[i]),e++)},changeClone:function(t){for(var e in t)if(t.hasOwnProperty(e)){this.$imageclone.attr("src",t[e].url);break}this.change(t,!1)},change:function(t,e){!1!==e&&this.app.popup.close();var i=this.app.block.get();for(var n in t)if(t.hasOwnProperty(n))return i.setImage(t[n]),this.app.broadcast("image.change",t[n]),void this.app.broadcast("image.upload",{instance:i,data:t[n]});this.app.parser.buildPredefinedClasses()},save:function(t){this.app.popup.close(),this.app.block.setData(t)},insert:function(t,e){this.app.popup.close(),this.imageslen=0,this.imagescount=0;var i=this.opts.image.tag;for(var n in t)if(t.hasOwnProperty(n)){var s=this.dom("<"+i+">"),o=this._createImageFromResponseItem(t[n]);s.append(o);var a=this.app.create("block.image",s);if(this.app.block.add({instance:a,type:"image"}),Object.prototype.hasOwnProperty.call(t[n],"caption")){var r=this.dom("<figcaption>").html(t[n].caption);a.$block.append(r),this.app.create("block.figcaption",r)}var l=e?"select":"upload";this.app.broadcast("image."+l,{instance:a,data:t[n]}),this.$last=a.getBlock(),this.imageslen++}},remove:function(){this.app.popup.close(),this.app.block.remove()},error:function(t){this.app.broadcast("image.upload.error",{response:t})},getStates:function(){var t=this._findImages();for(var e in this.dataStates)if(this.dataStates.hasOwnProperty(e)){var i=this.dataStates[e],n=t.is('[data-image="'+i.id+'"]');this._setImageState(i.id,n)}return this.dataStates},createUploadBox:function(t,e){if(t){var i=this.dom("<div>");return e.append(i),i}},createSelectBox:function(t,e,i){if(t)if(this.$selectbox=this._createImagesBox(e),"object"===typeof t)this._parseList(t,i);else{var n=this.opts.editor.reloadmarker?{d:(new Date).getTime()}:{};this.ajax.get({url:t,data:n,success:function(t){this._parseList(t,i)}.bind(this)})}},_findImages:function(){return this.app.editor.getEditor().find("[data-image]")},_addImageState:function(t){var e=t.attr("data-image");this.dataStates[e]={type:"image",status:!0,url:t.attr("src"),$img:t,id:e}},_setImageState:function(t,e){this.dataStates[t].status=e},_checkImageLoad:function(){this.imagescount++,this.imagescount===this.imageslen&&(this.app.block.unset(),this.app.block.set(this.$last))},_buildEditUpload:function(){if(this.opts.image.upload){var t=this.app.block.get(),e=this.app.popup.getBody(),i=this._createFormItem();i.addClass(this.prefix+"-form-item-edit-image-box"),this.$imageclone=t.getImage().clone(),this.$imageclone.removeAttr("width height style");var n=this.dom("<div>").addClass(this.prefix+"-form-item-image");n.append(this.$imageclone),i.append(n),this.$upload=this.dom("<div>"),i.append(this.$upload),e.prepend(i),this._buildUpload(this.$upload,"image.changeClone")}},_buildUpload:function(t,e){if(this.opts.image.upload){var i={box:!0,placeholder:this.lang.get("image.upload-new-placeholder"),url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:this.opts.image.multiple,success:e,error:"image.error"};this.app.create("upload",t,i)}},_createSelectBox:function(t){this.createSelectBox(this.opts.image.select,t,"image.insertFromSelect")},_createUploadBox:function(t){this.$upload=this.createUploadBox(this.opts.image.upload,t),this._buildUpload(this.$upload,"image.insertByUpload")},_createImageFromResponseItem:function(t){for(var e=this.dom("<img>").attr("src",t.url).one("load",this._checkImageLoad.bind(this)),i=e,n=["id","alt","width","height"],s=0;s<n.length;s++)Object.prototype.hasOwnProperty.call(t,n[s])&&i.attr(n[s],t[n[s]]);if(Object.prototype.hasOwnProperty.call(t,"id")&&i.attr("data-image",t.id),Object.prototype.hasOwnProperty.call(t,"2x")&&i.attr("srcset",t["2x"]+" 2x"),Object.prototype.hasOwnProperty.call(t,"link")){var o=this.dom("<a>");o.attr("href",t.link),e.wrap(o),i=o}return i},_createImagesBox:function(t){var e=this.dom("<div>").addClass(this.prefix+"-popup-images-box");return t.append(e),e},_createOrSection:function(t){if(this.opts.image.url&&(this.opts.image.upload||this.opts.image.select)){var e=this.dom("<div>").addClass(this.prefix+"-popup-image-section-or");e.html(this.lang.get("image.or")),t.append(e)}},_createImageByUrl:function(t){if(this.opts.image.url){var e=this._createFormItem();this.$urlinput=this._createUrlInput(),this.$urlbutton=this._createUrlButton(),e.append(this.$urlinput),e.append(this.$urlbutton),t.append(e),this.$urlinput.focus()}},_createFormItem:function(){return this.dom("<div>").addClass(this.prefix+"-form-container-flex")},_createUrlInput:function(){var t=this.dom("<input>").addClass(this.prefix+"-form-input");return t.attr("placeholder",this.lang.get("image.url-placeholder")),t},_createUrlButton:function(){var t=this.dom("<button>").addClass(this.prefix+"-form-button "+this.prefix+"-form-button-primary");return t.html(this.lang.get("buttons.insert")),t.one("click",this.insertByUrl.bind(this)),t},_parseList:function(t,e){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if("object"!==typeof n)continue;var s=this.dom("<img>"),o=n.thumb?n.thumb:n.url;s.addClass(this.prefix+"-popup-event"),s.attr("src",o),s.attr("data-url",n.url),s.attr("data-callback",e);for(var a=["id","alt","caption","link","width","height"],r=0;r<a.length;r++)Object.prototype.hasOwnProperty.call(n,a[r])&&s.attr("data-"+a[r],n[a[r]]);s.on("click."+this.prefix+"-popup-event-"+this.uuid,function(t){var e=this.dom(t.target).attr("data-callback");this.app.api(e,t)}.bind(this)),this.$selectbox.append(s)}},_dataURLtoFile:function(t,e){for(var i=t.split(","),n=i[0].match(/:(.*?);/)[1],s=atob(i[1]),o=s.length,a=new Uint8Array(o);o--;)a[o]=s.charCodeAt(o);return new File([a],e,{type:n})}}),p.add("module","link",{popups:{format:{items:{format:{title:"## link.link ##",command:"link.format",shortcut:"Ctrl+k"},unlink:{title:"## link.unlink ##",command:"link.unlink"}}},change:{items:{edit:{title:"## link.edit-link ##",command:"link.format",shortcut:"Ctrl+k"},unlink:{title:"## link.unlink ##",command:"link.unlink"}}},create:{title:"## popup.link ##",width:"600px",form:{text:{type:"input",label:"## link.text ##"},url:{type:"input",label:"## link.url ##"},target:{type:"checkbox",text:"## link.link-in-new-tab ##"}},footer:{insert:{title:"## buttons.insert ##",command:"link.insert",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}},edit:{title:"## popup.link ##",width:"600px",form:{text:{type:"input",label:"## link.text ##"},url:{type:"input",label:"## link.url ##"},target:{type:"checkbox",text:"## link.link-in-new-tab ##"}},footer:{save:{title:"## buttons.save ##",command:"link.save",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}}},popup:function(t,e){var i=0===this.getLink().length?"format":"change";this.app.popup.create("link-items",this.popups[i]),this.app.popup.open({button:e})},format:function(t){this.app.selection.restore();var e=this.getLink(),i=0!==e.length,n=this.app.selection.getText();this.app.selection.save();var s=i?"edit":"create";this.app.popup.create("link",this.popups[s]);var o={};i?(o={text:e.text(),url:e.attr("href"),target:e.attr("target")||this.opts.link.target},o=this._encodeUrl(o)):o={text:n,target:this.opts.link.target},this.app.popup.setData(o);var a=i?{focus:"url"}:{focus:n?"url":"text"};this.app.popup.open(a)},insert:function(){this.app.popup.close();var t=this.app.inline.set({tag:"a",caret:"after"}),e=this.dom(t);this._save(e,"add")},save:function(){this.app.popup.close();var t=this.getLink();this._save(t,"change")},unlink:function(){this.app.popup.close();var t=this.app.selection.getNodes({tags:["a"]});if(0!==t.length){for(var e=0;e<t.length;e++){var i=this.dom(t[e]);this.app.broadcast("link.remove",{url:i.attr("href"),text:i.text()}),i.unwrap()}this.app.toolbar.observe(),this.app.context.observe()}},getLink:function(){var t=this.app.selection.getNodes({tags:["a"]});return 0!==t.length?this.dom(t[0]):this.dom()},_save:function(t,e){var i=this.app.popup.getData();i=this._cleanUrl(i),""!==(i=this._encodeUrl(i)).url?(i=this._setUrl(t,i),1===t.length&&(i=this._setText(t,i)),(i=this._setTarget(t,i)).element=t,this.app.broadcast("link."+e,i)):t.unwrap()},_cleanUrl:function(t){return t.url=this.app.content.escapeHtml(t.url),t.url=-1!==t.url.search(/^javascript:/i)?"":t.url,t},_encodeUrl:function(t){return t.url=t.url?t.url.replace(/&amp;/g,"&"):"",t},_setUrl:function(t,e){return t.attr("href",e.url),e},_setText:function(t,e){return e.text=""===e.text?e.url:e.text,t.text(e.text),e},_setTarget:function(t,e){return e.target?t.attr("target","_blank"):t.removeAttr("target"),e}}),p.add("module","table",{popups:{cell:{title:"## table.column ##",width:"300px",form:{width:{type:"input",label:"## table.width ##"},nowrap:{type:"checkbox",text:"## table.nowrap ##"}},footer:{insert:{title:"## buttons.save ##",command:"table.save",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}}},items:{addhead:{title:"## table.add-head ##",command:"table.addHead"},addcolumnafter:{title:"## table.add-column-after ##",command:"table.addColumnAfter"},addcolumnbefore:{title:"## table.add-column-before ##",command:"table.addColumnBefore"},addrowbelow:{title:"## table.add-row-below ##",command:"table.addRowBelow"},addrowabove:{title:"## table.add-row-above ##",command:"table.addRowAbove"},removehead:{title:"## table.remove-head ##",command:"table.removeHead",divider:"top"},removecolumn:{title:"## table.remove-column ##",command:"table.removeColumn"},removerow:{title:"## table.remove-row ##",command:"table.removeRow"},removetable:{title:"## table.delete-table ##",command:"table.removeTable",divider:"top"}},add:function(){var t=this.app.block.add({name:"table",source:this.opts.table.template,caret:"start"}).getFirstCell();t&&this.app.caret.set(t.getBlock(),"start")},observe:function(t,e,i){if(!this.opts.table)return!1;var n=this.app.block.get();return i&&"addbar"===i.getName()?t.command="table.add":n&&n.isType(["table","cell"])&&(t.command="table.popup"),t},popup:function(t,e){this.app.popup.create("table",{items:this.items}),this.app.popup.open({button:e})},addHead:function(){var t=this.app.block.get().getTable().getBlock();this.removeHead();var e=t.find("tr").first().children("td, th").length,i=this.dom("<thead>"),n=this._buildRow(!1,e,"<th>");i.append(n),t.prepend(i),this.app.block.set(n.children("td, th").first(),"start")},addRowBelow:function(){this._addRow("below")},addRowAbove:function(){this._addRow("above")},addColumnBefore:function(){this._addColumn("before")},addColumnAfter:function(){this._addColumn("after")},removeTable:function(){this.app.popup.close(),this.app.block.remove()},removeHead:function(){this.app.popup.close();var t=this.app.block.get().getTable(),e=t.getBlock().find("thead");0!==e.length&&e.remove(),t.getFirst().setCaret("start")},removeRow:function(){this.app.popup.close(),this.app.control.close();var t=this.app.block.get(),e=t.getTable(),i=t.getRow(),n=i.getBlock().closest("thead");0!==n.length?(n.remove(),e.getFirst().setCaret("start")):i.remove()},removeColumn:function(){this.app.popup.close(),this.app.control.close();var t=this.app.block.get().getBlock(),e=t.closest("table"),i=t.closest("tr"),n=0;i.find("td, th").each((function(e,i){e.get()===t.get()&&(n=i)})),e.find("tr").each(function(t){var e=t.find("td, th").get(n);this.dom(e).remove()}.bind(this))},cellSetting:function(t,e){var i=this.app.block.get();this.app.popup.create("cell",this.popups.cell).setData({width:i.getWidth(),nowrap:i.getNowrap()}),this.app.popup.open({button:e,focus:"width"})},save:function(t){this.app.popup.close();var e=t.getData(),i=this.app.block.get();""!==e.width&&i.setWidth(e.width),i.setNowrap(e.nowrap)},_addColumn:function(t){this.app.popup.close();var e=this.app.block.get().getBlock(),i=e.closest("table"),n=e.closest("tr"),s=0;n.find("td, th").each((function(t,i){t.get()===e.get()&&(s=i)}));var o,a=0;i.find("tr").each((function(t,e){t.get()===n.get()&&(a=e)})),i.find("tr").each(function(e,i){var n=e.find("td, th").get(s),r=this.dom(n),l=r.clone();l.html(""),this.app.create("block.cell",l),a===i&&(o=l),r[t](l)}.bind(this)),o&&this.app.block.set(o,"start")},_addRow:function(t){this.app.popup.close();var e="below"===t?"after":"before",i=this.app.block.get().getBlock(),n=i.closest("tr"),s=i.closest("thead"),o=n.children("td, th").length,a=this._buildRow(n,o,"<td>");0!==s.length?s.after(a):n[e](a),this.app.block.set(a.find("td, th").first(),"start")},_buildRow:function(t,e,i){if(!1===t){t=this.dom("<tr>");for(var n=0;n<e;n++){var s=this.dom(i);this.app.create("block.cell",s),t.append(s)}}else(t=t.clone()).find("td, th").html("");return this.app.create("block.row",t),t.find("td, th").each(function(t){this.app.create("block.cell",t)}.bind(this)),t}}),p.add("module","context",{init:function(){this.customButtons={},this.activeClass="active",this.eventname="."+this.prefix+"-context",this.aTags={},this.aTypes={},this.clickOffset=!1},start:function(){this.opts.context&&this._build()},stop:function(){this.app.scroll.isTarget()&&this.app.scroll.getTarget().off(this.eventname),this.opts.context&&this.$context.remove()},isOpen:function(){this.$context.hasClass("open")},close:function(){this.opts.context&&this._close()},add:function(t,e){this.customButtons[t]=e},observe:function(){this.opts.context&&this._observe()},_doOpen:function(t){!1===this.opts.context||this.app.utils.isMobile()||setTimeout(function(){if(this._isSelection())this._open(t);else{if(this._isInstance()&&this.clickOffset&&this.clickOffset.x===t.pageX&&this.clickOffset.y===t.pageY)return this.clickOffset=!1,void this._open(t);this._close(),this.clickOffset={x:t.pageX,y:t.pageY}}}.bind(this),0)},_open:function(t){this.$context.html(""),this._buildButtons(),this._buildCustomButtons(),this._buildActiveButtons(),this._buildPosition(t),this._buildEvents(),this._observe()},_close:function(){this.$context.removeClass("open"),this.$context.hide(),this.app.editor.getEditor().off(this.eventname),this.app.scroll.isTarget()&&this.app.scroll.getTarget().off(this.eventname)},_isSelection:function(){return!this.app.blocks.is()&&(this._isInstance()&&this.app.selection.is()&&!this.app.selection.isCollapsed())},_isInstance:function(){var t=this.app.block.get(),e=t&&t.isEditable(),i=t&&"pre"!==t.getType();return e&&i},_scroll:function(){var t=this.app.selection.getPosition().bottom+this.app.$doc.scrollTop();if(this.$context.css("top",t+2+"px"),this.app.scroll.isTarget()){var e=this.app.scroll.getTarget(),i=e.offset().top+e.height(),n=e.offset().top;t+this.$context.height()>i||n>t?this.$context.hide():this.$context.show()}},_build:function(){this.$context=this.dom("<div>").addClass(this.prefix+"-context "+this.prefix+"-context-"+this.uuid).hide(),this.app.$body.append(this.$context),this.app.editor.getEditor().on("mouseup."+this.prefix+"-context-up",this._doOpen.bind(this))},_buildButtons:function(){for(var t=this.opts.buttons.context,e=d.extend(!0,{},this.opts.buttonsObj),i=0;i<t.length;i++){var n=t[i],s=e[n];this.app.create("button",n,s,this.$context,"context")}},_buildCustomButtons:function(){var t=this.customButtons;for(var e in t)t.hasOwnProperty(e)&&this.app.create("button",e,t[e],this.$context,"context")},_buildPosition:function(t){var e=this.$context.width(),i=this.app.editor.getRect(),n=this.app.selection.getPosition(),s=t.pageX-e/2,o=n.bottom+this.app.$doc.scrollTop();s<i.left&&(s=i.left+4),s+e>i.right&&(s=i.right-e-4),this.$context.css({left:s+"px",top:o+2+"px"}),this.$context.addClass("open"),this.$context.show()},_buildEvents:function(){var t=this.app.editor.getEditor();t.on("mousedown"+this.eventname,this._close.bind(this)),t.on("keydown"+this.eventname,this._close.bind(this)),this.app.scroll.isTarget()&&this.app.scroll.getTarget().on("scroll"+this.eventname,this._scroll.bind(this))},_buildActiveButtons:function(){var t=this.app.observer.buildActiveButtons(this.customButtons);this.aTags=t.tags,this.aTypes=t.types},_observe:function(){if(this._unsetActive(),this.app.observer.isButtons()){var t=this.app.observer.buildButtons(this.aTags,this.aTypes);this._setActiveKeys(t)}},_setActiveKeys:function(t){for(var e=0;e<t.length;e++)this._findButton(t[e]).addClass(this.activeClass)},_unsetActive:function(){this._findButtons().removeClass(this.activeClass)},_findButtons:function(){return this.$context.find("."+this.prefix+"-button-context")},_findButton:function(t){return this.$context.find("[data-name="+t+"]")}}),p.add("module","topbar",{init:function(){this.activeClass="active",this.toggledClass="disable",this.disableClass="disable",this.customButtons={}},start:function(){this._isTopbar()&&this._build()},load:function(){this._buildButtons()},get:function(t){return this._findButton(t)},add:function(t,e){this.customButtons[t]=e},setToggled:function(t){this._isTopbar()&&(this._findButtons().removeClass(this.toggledClass),this._findButton(t).addClass(this.toggledClass))},unsetToggled:function(t){this._isTopbar()&&(t?this._findButton(t):this._findButtons()).removeClass(this.toggledClass)},enable:function(){this._isTopbar()&&this._findButtons().removeClass(this.disableClass)},disable:function(){this._isTopbar()&&this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass)},_isTopbar:function(){return this.opts.topbar},_build:function(){this.$topbar=this.dom("<div>").addClass(this.prefix+"-topbar"),this.app.container.get("toolbar").append(this.$topbar)},_buildButtons:function(){var t=this.app.editor.getButtonsFromArr(this.opts.buttons.topbar);for(var e in t=d.extend(!0,{},t,this.customButtons),this.opts.topbar.add&&(t=d.extend(!0,{},t,this.opts.topbar.add)),t)if(t.hasOwnProperty(e)){if(this.opts.topbar.hide&&-1!==this.opts.topbar.hide.indexOf(e))continue;this.app.create("button",e,t[e],this.$topbar,"topbar")}},_findButtons:function(){return this.$topbar.find("."+this.prefix+"-button-topbar")},_findButton:function(t){return this.$topbar.find("[data-name="+t+"]")}}),p.add("module","control",{init:function(){this.instance=!1,this.customItems={},this.eventName=this.prefix+"-control"},start:function(){this._build()},stop:function(){this._isControl()&&this.$control.remove(),this.instance=!1},getElement:function(){return this.$control},add:function(t,e){this.customItems[t]=e},build:function(){if(this._isControl()){var t=this.app.block.get();t.isFigcaption()||(t.isSecondLevel()&&(t=t.getFirstLevel()),t?this.open(t):this.close())}},open:function(t){if(this._isControl())if(this.instance=t,this.instance){this.$control.show(),this.updatePosition();var e=this.app.scroll.getTarget();e.on("resize."+this.eventName,this.updatePosition.bind(this)),e.on("scroll."+this.eventName,this.updatePosition.bind(this)),this.$button.off("."+this.prefix+"-control-button"),this.app.$win.off("."+this.prefix+"-control-button"),this.opts.control&&this.$button.on("click."+this.prefix+"-control-button",this._click.bind(this)),this.opts.reorder&&this.$button.on("mousedown."+this.prefix+"-control-button touchstart."+this.prefix+"-control-button",this._press.bind(this))}else this.close()},close:function(){if(this._isControl()){if(this.$control.hide(),this.instance){var t=this.instance.getBlock();this.app.content.unfixListMargin(t)}this.app.scroll.getTarget().off("."+this.eventName),this.instance=!1}},updatePosition:function(){if(this._isControl())if(this.instance){if("list"===this.instance.getType()){var t=this.instance.getBlock();this.app.content.fixListMargin(t)}var e=this.instance.isEditable(),i=this.instance.getOffset(),n=this.$control.width(),s=e?-3:4,o=i.top-s-0,a=i.left-n-4;if(this.$control.show(),this.app.scroll.isTarget()){var r=this.app.scroll.getTarget(),l=r.offset().top+r.height(),p=r.offset().top;(o+this.$control.height()>l||p>o)&&this.$control.hide()}this.$control.css({top:o+"px",left:a+"px"})}else this.close()},_isControl:function(){return this.opts.control||this.opts.reorder},_click:function(t){t.preventDefault(),t.stopPropagation();var e={},i={};for(var n in e=this.app.editor.getButtonsFromArr(this.instance.control),e=d.extend(!0,{},e,this.customItems))this.instance.isAllowedButton(n,e[n])&&(i[n]=e[n],i[n].icon=!e[n].icon||e[n].icon,i[n].control=!0);this.app.popup.create("control",{items:i}),this.app.context.close(),this.app.popup.open({control:this.$button})},_press:function(t){t.preventDefault(),t.stopPropagation(),setTimeout(function(){this.app.$win.on("mouseup."+this.prefix+"-control-button touchend."+this.prefix+"-control-button",this._release.bind(this)),this.app.$win.on("mousemove."+this.prefix+"-control-button touchmove."+this.prefix+"-control-button",this._move.bind(this))}.bind(this),0)},_release:function(t){this.$button.removeClass(this.prefix+"-handle"),this.app.$win.off("."+this.prefix+"-control-button"),this.app.observer.trigger=!0,this.app.event.trigger=!1,this.oldY=0,this.dragging=!1,this._trashDragItem(),this.updatePosition(),this.$control.show(),setTimeout(function(){this.app.block.set(this.instance,"start",!0),this.app.event.trigger=!0}.bind(this),2)},_move:function(t){if(t.preventDefault(),!this.$button.hasClass(this.prefix+"-handle")){var e=this.instance.getBlock().get();this.$button.addClass(this.prefix+"-handle"),this.dragging=!0,this.$dragItem=this._makeDragItem(e,t.target),this.$control.hide()}var i=!1,n=0===this.oldY?0:this.oldY-t.pageY;n>0?i="up":n<0&&(i="down"),this._moveItem(this.$dragItem,n),this.oldY=t.pageY;var s=t.pageY,o=this.app.editor.getRect(),a=this.app.$doc.scrollTop(),r=a>o.top?a+40:o.top+40,l=this.app.$win.height()+a-40,p=o.top,c=o.top+this.app.editor.getEditor().height();if(this.app.scroll.isTarget()){var d=this.app.scroll.getTarget(),h=d.offset();p=h.top,r=a>o.top?h.top+40:r,l=(c=h.top+d.height())-40}"up"===i&&s<r&&s>p?this._scroll(-10):"down"===i&&s>l&&s<c&&this._scroll(10);for(var u=this.app.editor.getEditor().children(),m=u.length,f=0;f<m;f++){var g=u.eq(f).get();g!==this.$clickItem.get()&&(this._isOver(this.dom(g))&&this._swapItems(g))}},_build:function(){this.$control=this.dom("<div>").addClass(this.prefix+"-control "+this.prefix+"-control-"+this.uuid).hide(),this.$button=this.dom("<span>").addClass(this.prefix+"-icon-sort "+this.prefix+"-button "+this.prefix+"-button-control"),this.$control.append(this.$button),this.opts.bsmodal&&this.$control.css("z-index",1060),this.app.$body.append(this.$control)},_isOver:function(t){var e=this.$dragItem.offset().top,i=t.offset(),n=t.height();return e>i.top&&e<i.top+n},_scroll:function(t){var e=this.app.scroll.isTarget()?this.app.scroll.getTarget():this.app.$win,i=e.scrollTop();e.scrollTop(i+t)},_swapItems:function(t){var e=this.$dragItem.offset().top,i=this.$clickItem,n=this.dom(t),s=n.offset(),o=n.height()/2;n[o+s.top>e?"before":"after"](i)},_moveItem:function(t,e){var i=t.offset().top;i-=e,t.css("top",i+"px"),this.$control.css("top",i+"px")},_makeDragItem:function(t){this._trashDragItem();var e=this.dom(t),i=e.offset();this.$clickItem=e,this.$clickItem.addClass(this.prefix+"-drag-active");var n=e.clone();n.removeClass(this.prefix+"-drag-active "+this.prefix+"-element-active"),n.css({"font-family":e.css("font-family"),"font-size":e.css("font-size"),"line-height":e.css("line-height"),margin:0,padding:0});var s=this.dom("<div>").addClass(this.prefix+"-dragging");return s.append(n),s.css({opacity:.95,position:"absolute","z-index":999,left:i.left+"px",top:i.top+"px",width:e.width()+"px"}),this.app.$body.append(s),s},_trashDragItem:function(){this.$dragItem&&this.$clickItem&&(this.$clickItem.removeClass(this.prefix+"-drag-active"),this.$clickItem=null,this.$dragItem.remove(),this.$dragItem=null)}}),p.add("class","tool.checkbox",{mixins:["tool"],type:"checkbox",input:{tag:"input",type:"checkbox",classname:"-form-checkbox"},getValue:function(){return this.$input.val()},_buildInput:function(){if(this.$box=this.dom("<label>").addClass(this.prefix+"-form-checkbox-item"),this.$box.append(this.$input),this._has("text")){var t=this.dom("<span>").html(this.lang.parse(this.obj.text));this.$box.append(t)}this.$tool.append(this.$box)}}),p.add("class","tool.input",{mixins:["tool"],type:"input",input:{tag:"input",type:"text",classname:"-form-input"},_buildInput:function(){this.$tool.append(this.$input)}}),p.add("class","tool.number",{mixins:["tool"],type:"number",input:{tag:"input",type:"number",classname:"-form-input"},_buildInput:function(){this.$input.attr("min",0).css("max-width","65px"),this.$tool.append(this.$input)}}),p.add("class","tool.segment",{mixins:["tool"],type:"segment",input:{tag:"input",type:"hidden",classname:"-form-input"},setValue:function(t){this.$segment.find("."+this.prefix+"-form-segment-item").removeClass("active"),this.$segment.find("[data-segment="+t+"]").addClass("active"),this.$input.val(t)},_buildInput:function(){this.$segment=this.dom("<div>").addClass(this.prefix+"-form-segment");var t=this.obj.segments;for(var e in t)if(t.hasOwnProperty(e)){var i=this.dom("<span>").addClass(this.prefix+"-form-segment-item");i.attr("data-segment",e).on("click",this._catchSegment.bind(this)),Object.prototype.hasOwnProperty.call(t[e],"icon")?i.html(t[e].icon):i.addClass(this.prefix+"-icon-"+t[e].prefix+"-"+e),this.$segment.append(i)}this.$segment.append(this.$input),this.$tool.append(this.$segment)},_catchSegment:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-form-segment-item"),i=e.attr("data-segment");this.$segment.find("."+this.prefix+"-form-segment-item").removeClass("active"),e.addClass("active"),this.$input.val(i),this.app.api(this.setter,this.popup)}}),p.add("class","tool.select",{mixins:["tool"],type:"select",input:{tag:"select",classname:"-form-select"},_buildInput:function(){for(var t in this.obj.options)if(this.obj.options.hasOwnProperty(t)){var e=this.dom("<option>");e.val(t),e.html(this.lang.parse(this.obj.options[t])),this.$input.append(e)}this.$tool.append(this.$input)}}),p.add("class","tool.textarea",{mixins:["tool"],type:"textarea",input:{tag:"textarea",classname:"-form-textarea"},setFocus:function(){this.$input.focus(),this.$input.get().setSelectionRange(0,0),this.$input.scrollTop(0)},_buildInput:function(){this._has("rows")&&this.$input.attr("rows",this._get("rows")),this.$input.attr("data-gramm_editor",!1),this.$tool.append(this.$input)}}),p.add("class","tool.upload",{mixins:["tool"],type:"upload",input:{tag:"input",type:"hidden",classname:"-form-input"},setValue:function(t){t=t||"",this.upload&&this.upload.setImage(t),this.$input.val(t)},_buildInput:function(){this.$tool.append(this.$input),this._buildUpload()},_buildUpload:function(){this.$upload=this.dom("<input>").attr("type","file"),this.$tool.append(this.$upload);var t={};this._has("trigger")&&this._get("trigger")&&(t={instance:this,method:"trigger"}),this.upload=this.app.create("upload",this.$upload,this.obj.upload,t)}}),p.add("block","block.address",{mixins:["block"],type:"address",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom("<address>")},handleEnter:function(t){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){var e=this.getBlock(),i=e.children(),n=i.length,s=i.eq(n-1),o=i.eq(n-2),a=e.html().trim();if(-1!==(a=this.app.utils.removeInvisibleChars(a)).search(/<br\s?\/?>$/))return o.remove(),s.remove(),void this.insertEmpty({position:"after",caret:"start"})}return this.app.insertion.insertBreakline(),!0}}),p.add("block","block.cell",{mixins:["block"],type:"cell",editable:!0,create:function(){return this.dom("<td>")},getTable:function(){return this.getParent("table")},getRow:function(){return this.getParent("row")},getNextCell:function(){var t=this.getNext();if(!t){var e=this.getParent("row");if(e){var i=e.getNextRow();i&&(t=i.getChildFirst("cell"))}}return t},getPrevCell:function(){var t=this.getPrev();if(!t){var e=this.getParent("row");if(e){var i=e.getPrevRow();i&&(t=i.getChildLast("cell"))}}return t},getWidth:function(){var t=this.$block.attr("width");return t||""},getNowrap:function(){return this.$block.hasClass(this.prefix+"-nowrap")},setWidth:function(t){this._eachCell((function(e){""===t?e.removeAttr("width"):(t=-1!==t.search("%")?t:t.replace("px",""),e.attr("width",t))}))},setNowrap:function(t){this._eachCell(function(e){var i=this.opts.table.nowrap+" "+this.prefix+"-nowrap";t?e.addClass(i):e.removeClass(i)}.bind(this))},handleArrow:function(t,e,i){var n,s,o=this.getTable(),a=o.getBlock(),r=this.app.caret.is(a,"start"),l=this.app.caret.is(a,"end");return i.is("up-left")&&r?(t.preventDefault(),(n=o.getPrev())?this.app.block.set(n,"end"):this.app.insertion.insertEmptyBlock({current:o,position:"before",caret:"start"}),!0):i.is("down-right")&&l?(t.preventDefault(),(s=o.getNext())?this.app.block.set(s,"start"):this.app.insertion.insertEmptyBlock({current:o,position:"after",caret:"start"}),!0):i.is("up-left")&&this.isCaretStart()?(t.preventDefault(),((n=this.getPrevCell())||(n=this.getFirstLevel().getPrev()))&&this.app.block.set(n,"end"),!0):i.is("down-right")&&this.isCaretEnd()?(t.preventDefault(),((s=this.getNextCell())||(s=this.getFirstLevel().getNext()))&&this.app.block.set(s,"start"),!0):void 0},handleTab:function(t){t.preventDefault();var e=this.getNextCell();return(e||(e=this.getFirstLevel().getNext()))&&this.app.block.set(e,"start"),!0},handleEnter:function(t){return t.preventDefault(),this.app.insertion.insertBreakline(),!0},_eachCell:function(t){var e=0,i=this.$block.closest("table");this.$block.closest("tr").find("td, th").each(function(t,i){t.get()===this.$block.get()&&(e=i)}.bind(this)),i.find("tr").each(function(i){var n=i.find("td, th").get(e),s=this.dom(n);t(s)}.bind(this))}}),p.add("block","block.pre",{mixins:["block"],type:"pre",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom(this.opts.pre.template)},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption")},handleTab:function(t){t.preventDefault();var e=this.opts.pre.spaces,i=document.createTextNode(Array(e+1).join(" "));return this.app.insertion.insertNode(i,"end"),!0},handleEnter:function(t){t.preventDefault();var e=this.$block.html().search(/\n$/);return this.isCaretEnd()&&-1===e?this.app.insertion.insertNewline("after",!0):this.app.insertion.insertNewline(),!0}}),p.add("block","block.embed",{mixins:["block"],type:"embed",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},embed:{title:"## blocks.embed ##",command:"embed.popup",observer:"embed.observe"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom("<figure>")},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption"),this._buildEmbedCode()},addResponsive:function(){var t=this.dom("<div>").addClass(this.opts.embed.responsive),e=this.$block.find("figcaption"),i=e.clone(),n=this.getEmbedCode();e.remove(),t.html(n),this.$block.html("").append(t),0!==i.length&&(this.app.create("block.figcaption",i),this.$block.append(i)),this._buildEmbedCode()},removeResponsive:function(){this.$block.find(this._getEmbedClass()).unwrap()},getEmbedCode:function(){return decodeURI(this.$block.attr("data-embed-code"))},isResponsive:function(){return 0!==this.$block.find(this._getEmbedClass()).length},_buildEmbedCode:function(){var t=this.$block.clone();t.find(this._getEmbedClass()).unwrap(),t.find("figcaption").remove();var e=t.html().trim();this.$block.attr("data-embed-code",encodeURI(e))},_getEmbedClass:function(){return"."+this.opts.embed.responsive.replace(/ +/g,".")}}),p.add("block","block.figcaption",{mixins:["block"],type:"figcaption",editable:!0,toolbar:{bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},create:function(){return this.dom("<figcaption>")},getFigure:function(){return this.$block.closest("figure").dataget("instance")},handleArrow:function(t,e,i){if(i.is("up-left")&&this.isCaretStart()||i.is("down-right")&&this.isCaretEnd()){t.preventDefault();var n=this.getFigure();return this.app.block.set(n),!0}},handleTab:function(t){t.preventDefault();var e=this.getFigure();return this.app.block.set(e),!0},handleEnter:function(t){return t.preventDefault(),this.isEmpty()||this.isCaretEnd()||this.isCaretStart()||this.app.insertion.insertBreakline(),!0}}),p.add("block","block.heading",{mixins:["block"],type:"heading",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom("<h2>")},getTitle:function(){var t=this.lang.get("headings"),e=this.getTag(),i=this.$block.attr("data-title");return"undefined"!==typeof t[e]?t[e]:i},handleEnter:function(t){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd())this.insertEmpty({position:"after",caret:"start",remove:!1});else if(this.isCaretStart())this.insert({instance:this.duplicateEmpty(),position:"before"});else{var e=this.getBlock(),i=this.app.element.split(e);this.app.block.set(i,"start")}return!0}}),p.add("block","block.image",{mixins:["block"],type:"image",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},image:{title:"## blocks.image ##",command:"image.popup",observer:"image.observe"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom("<"+this.opts.image.tag+">")},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption"),this.data={alt:{getter:"getAlt",setter:"setAlt"},width:{getter:"getWidth",setter:"setWidth"},link:{getter:"getLinkUrl",setter:"setLinkUrl"},target:{getter:"getTarget",setter:"setTarget"},caption:{getter:"getCaption",setter:"setCaption"}}},getImage:function(){return this.$block.find("img").eq(0)},getSrc:function(){return this.getImage().attr("src")},getId:function(){return this.getImage().attr("data-image")},getLink:function(){var t=this.getImage().parent();return t="A"===t.get().tagName&&t},getWidth:function(){var t=this.getImage(),e=t.css("width"),i=t.attr("width");return i&&-1!==i.search(/%/)&&(e=i),e},getAlt:function(){var t=this.getImage().attr("alt");return t||""},getLinkUrl:function(){var t=this.getLink();return t?t.attr("href"):""},getTarget:function(){var t=this.getLink();return t?t.attr("target"):this.opts.image.newtab},setWidth:function(t){var e=this.getImage();if(""===(t=t.trim()))e.removeAttr("width");else{var i=-1!==t.search(/%/),n=i?t:parseInt(t),s=e.width()/e.height();if(i)e.removeAttr("height"),e.attr({width:n});else{var o=Math.round(n/s);e.attr({width:n,height:o})}}e.css({width:t,"max-width":t}),this.app.broadcast("image.width",{image:e,width:t})},setAlt:function(t){var e=this.getImage();t=t.replace(/"/g,"'"),e.attr("alt",t)},setTarget:function(t){var e=this.getLink();e&&(t?e.attr("target","_blank"):e.removeAttr("target"))},setLinkUrl:function(t){var e=this.getLink();if(e){if(""===t)return this.removeLink(),void this.app.broadcast("image.unlink",{instance:this});e.attr("href",t)}else if(!e){if(""===t)return;var i=this.getImage();e=this.dom("<a>"),i.wrap(e),e.attr("href",t)}this.app.broadcast("image.link",{instance:this,link:e})},setImage:function(t){var e=this.getImage();e.attr("src",t.url),Object.prototype.hasOwnProperty.call(t,"id")&&e.attr("data-image",t.id),Object.prototype.hasOwnProperty.call(t,"2x")&&e.attr("srcset",t["2x"]+" 2x")},removeLink:function(){var t=this.getLink();t&&t.unwrap()}}),p.add("block","block.line",{mixins:["block"],type:"line",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom("<hr>")}}),p.add("block","block.list",{mixins:["block"],type:"list",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},indent:{title:"## buttons.indent ##",command:"list.indent"},outdent:{title:"## buttons.outdent ##",command:"list.outdent"},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(t){return t&&t.tag?this.dom("<"+t.tag+">"):this.dom("<ul>")},setCaret:function(t){var e=this.$block;"start"===t?e=this.$block.find("li").first():"end"===t&&(e=this.$block.find("li").last()),this.app.caret.set(e,t)},setEmpty:function(){this.$block.html("");var t=this.dom("<li>");this.$block.append(t),this.app.caret.set(t,"start")},isEmpty:function(){var t=this.$block.html();t=this._cleanEmpty(t);var e=this.$block.find("li");return 0===e.length?""===(t=t.trim()):1===e.length&&(t=e.eq(0).html(),""===(t=this._cleanEmpty(t)))},handleTab:function(t){var e=this.app.selection.getBlock(),i=this.app.caret.is(e,"start");if(this.app.element.isEmpty(e)&&(t.preventDefault(),this.app.list.indent()))return!0;if(!this.isCaretStart()&&!this.isCaretEnd()){if(this.opts.tab.spaces&&!i)return;return t.preventDefault(),this.app.list.indent(),!0}var n=this.getNext();if(n)return t.preventDefault(),this.app.block.set(n,"start"),!0},handleEnter:function(t){var e,i,n,s;if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){if(n=this.app.selection.getBlock(),i=this.dom(n),s=this.app.content.isEmptyHtml(n.innerHTML))return i.remove(),this.insertEmpty({position:"after",caret:"start"}),!0;e=this.dom("<li>"),this.app.element.cloneAttrs(n,e),this.dom(n).after(e),this.app.caret.set(e,"start"),this.app.broadcast("list.item",{element:e})}else if(this.isCaretStart())e=this.dom("<li>"),n=this.app.selection.getBlock(),this.app.element.cloneAttrs(n,e),this.dom(n).before(e);else{n=this.app.selection.getBlock(),i=this.dom(n),s=this.app.content.isEmptyHtml(n.innerHTML);var o=this.app.caret.is(n,"start"),a=this.app.caret.is(n,"end",["ul","ol"]);if(e=this.dom("<li>"),this.app.element.cloneAttrs(n,e),s)i.after(e),this.app.caret.set(e,"start");else if(o)i.before(e);else if(a){var r=i.find("ul, ol").first();0!==r.length?(e.append(this.app.utils.createInvisibleChar()),e.append(r),i.after(e)):i.after(e),this.app.caret.set(e,"start")}else{var l=this.app.element.split(n);e=l,this.app.caret.set(l,"start")}this.app.broadcast("list.item",{element:e})}return!0}}),p.add("block","block.paragraph",{mixins:["block"],type:"paragraph",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom("<p>")},handleEnter:function(t){var e;if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){if(e=this.app.block.create(),this.opts.clean.enter||(e=this.duplicateEmpty()).getBlock().removeAttr("id"),!this.opts.clean.enterinline){var i=this.app.selection.getInline();if(i){for(var n,s=this.app.element.getAllInlines(i),o=0;o<s.length;o++)if(0===o)(n=s[o].cloneNode()).removeAttribute("id"),n.innerHTML="";else{var a=s[o].cloneNode();a.removeAttribute("id"),a.innerHTML="",n.appendChild(a)}e=this.app.block.create(n.outerHTML)}}this.insert({instance:e,position:"after",caret:"start",remove:!1})}else if(this.isCaretStart())(e=this.duplicate()).getBlock().html(""),this.insert({instance:e,position:"before"});else{var r=this.getBlock(),l=this.app.element.split(r);this.app.block.set(l,"start")}return!0}}),p.add("block","block.quote",{mixins:["block"],type:"quote",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom(this.opts.quote.template)},build:function(){this._buildCaption(),this._buildItems("p","quoteitem"),this._buildItems("figcaption","figcaption")},getLast:function(){return this._getLast()},getFirst:function(){return this._getFirst()},getFirstElement:function(){return this._getFirst().getBlock()},_getFirst:function(){return this.$block.find("p").first().dataget("instance")},_getLast:function(){return this.$block.find("p").last().dataget("instance")}}),p.add("block","block.quoteitem",{mixins:["block"],type:"quoteitem",editable:!0,create:function(){return this.dom("<p>")},getBlockquote:function(){return this.$block.closest("blockquote").dataget("instance")},handleArrow:function(t,e,i){var n=this.getBlockquote(),s=n.getBlock();if(0!==s.length){var o=this.app.caret.is(s,"start"),a=this.app.caret.is(s,"end");if(i.is("up-left")&&o){t.preventDefault();var r=this.getFirstLevel().getPrev();return r?this.app.block.set(r,"end"):this.app.insertion.insertEmptyBlock({current:n,position:"before",caret:"start"}),!0}if(i.is("down-right")&&a){t.preventDefault();var l=this.getFirstLevel().getNext();return l?this.app.block.set(l,"start"):this.app.insertion.insertEmptyBlock({current:n,position:"after",caret:"start"}),!0}}},handleTab:function(t){t.preventDefault();var e=this.getNext();return e?(this.app.block.set(e,"start"),!0):((e=this.getFirstLevel().getNext())&&this.app.block.set(e,"start"),!0)},handleEnter:function(t){t.preventDefault();var e=this.app.create("block.quoteitem");if(this.isEmpty()||this.isCaretEnd())this.insert({instance:e,position:"after",caret:"start"});else if(this.isCaretStart())this.insert({instance:e,position:"before"});else{var i=this.getBlock(),n=this.app.element.split(i);this.app.block.set(n,"start")}return!0}}),p.add("block","block.row",{mixins:["block"],type:"row",create:function(){return this.dom("<tr>")},getNextRow:function(){var t=this.getNext(),e=this.$block.parent();return t||"TABLE"===e.get().tagName||(t=e.nextElement().find("tr").first().dataget("instance")),t},getPrevRow:function(){var t=this.getPrev(),e=this.$block.parent();return t||"TABLE"===e.get().tagName||(t=e.prevElement().find("tr").last().dataget("instance")),t}}),p.add("block","block.table",{mixins:["block"],type:"table",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe",params:{name:"table"}},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"},tune:{title:"## buttons.column-settings ##",command:"table.cellSetting"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe",params:{name:"table"}},tune:{title:"## buttons.column-settings ##",command:"table.cellSetting",icon:"tune"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom(this.opts.table.template)},build:function(){this._buildItems("tr","row"),this._buildItems("td, th","cell"),this._buildNowrap()},getLast:function(){return this.getLastCell()},getFirst:function(){return this.getFirstCell()},getFirstElement:function(){return this.getFirstCell().getBlock()},getFirstCell:function(){var t=this.$block.find("th, td").first();if(0!==t.length)return t.dataget("instance")},getLastCell:function(){var t=this.$block.find("th, td").last();if(0!==t.length)return t.dataget("instance")},_buildNowrap:function(){this.$block.find("th, td").each(function(t){t.hasClass(this.opts.table.nowrap)&&t.addClass(this.prefix+"-nowrap")}.bind(this))}}),p.add("block","block.layer",{mixins:["block"],type:"layer",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}}}),p.add("block","block.dlist",{mixins:["block"],type:"dlist",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"}},create:function(){return this.dom("<dl>")},getPlainText:function(t){var e="",i=this.$block.find("dt, dd"),n=i.length;return i.each((function(i,s){var o=t?"<br>":"";s===n&&(o=""),e+=i.html()+o})),e},setEmpty:function(){this.$block.html("");var t=this.dom("<dt>");this.$block.append(t),this.app.caret.set(t,"start")},isEmpty:function(){var t=this.$block.html();t=this._cleanEmpty(t);var e=this.$block.find("dt, dd");return 0===e.length?""===(t=t.trim()):1===e.length&&(t=e.eq(0).html(),""===(t=this._cleanEmpty(t)))},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){var n,s=this.app.selection.getBlock(),o=this.dom(s),a=s.tagName.toLowerCase(),r=this.app.content.isEmptyHtml(s.innerHTML);if("dt"===a&&r)return o.remove(),this.insertEmpty({position:"after",caret:"start"}),!0;n="dt"===a?this.dom("<dd>"):this.dom("<dt>"),this.dom(s).after(n),this.app.caret.set(n,"start")}else{if(this.isCaretStart())return!0;this.app.insertion.insertBreakline()}return!0}}),window.RedactorX=p,window.addEventListener("load",(function(){p("[data-redactorx]")})),t.exports&&(t.exports=p,t.exports.RedactorX=p)}()},529:function(t,e){"use strict";e.A={"data-private":!0}},39534:function(t,e,i){"use strict";i.d(e,{x:function(){return s}});const n=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,s=t=>t.match(n)},72134:function(t,e){"use strict";e.A=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},62897:function(t,e){"use strict";class i{static LENGTHS={years:31557600,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60};static ALIASES={year:"years",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes"};static fromSeconds=(t,e="auto")=>new i(t).calculate(e);static fromPeriod=(t,e)=>i._fetchUnitLength(e)*t;static _fetchUnitLength=t=>{const e=i.ALIASES[t];return e&&(t=e),i.LENGTHS[t]};constructor(t){this.seconds=t}calculate=(t="auto")=>{let e=["years","months","weeks","days","hours","minutes"];return"string"===typeof t?("auto"===t&&(t=this.unitForLength(this.seconds)),this.period=i.ALIASES[t]||t,this.value=this.seconds/i._fetchUnitLength(t)):(Array.isArray(t)&&(e=e.filter((e=>t.includes(e)))),e.forEach((t=>{!this.period&&this._matches(t)&&(this.period=t)}))),this.period||(this.period="seconds",this.value=this.seconds),{period:this.period,value:Math.round(this.value)}};unitForLength=t=>{for(const e in i.LENGTHS){const n=i.LENGTHS[e];if(t>=n&&Number.isInteger(t/n))return e}};_matches=t=>{const e=this.seconds/i._fetchUnitLength(t);return Math.round(e)===e&&(this.value=e,!0)}}e.A=i},90885:function(t,e,i){"use strict";i.d(e,{IR:function(){return r},bN:function(){return s.bN},hQ:function(){return a}});var n=i(96540),s=i(69733),o=i(25508);const a=(t,e)=>null==t&&null==e||null!=t&&null!=e&&("function"===typeof t?.equals?t.equals(e):t===e),r=(t,e=null,i=a)=>{const r=e=>e.orm[t],l=(0,n.useMemo)((()=>e?(0,o.Mz)([r],e):r),[e]);return(0,s.d4)(l,{equalityFn:i})}},30712:function(t,e,i){"use strict";i.d(e,{t:function(){return s}});var n=i(69733);const s=(t,e={})=>{const i=(0,n.d4)((e=>e.settings.get(t)));return e.default?null==i?e.default:i:e.transformer?e.transformer(i):i}},41058:function(t,e,i){"use strict";i.d(e,{B:function(){return p}});var n=i(96540),s=i(5556),o=i.n(s),a=i(32389),r=i(12665);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},l.apply(null,arguments)}const p=t=>{const[e,i,s]=(0,a.Bd)(t,{useSuspense:!1}),p=(i,o={})=>s?e(i,o):n.createElement(r.A,{key:i,namespace:t,ready:s,string:i}),c=({i18nKey:i,...o})=>s?n.createElement(a.x6,l({t:e,i18nKey:i},o)):n.createElement(r.A,{key:i,namespace:t,ready:s,string:i});c.propTypes={i18nKey:o().string};const d=[p,i,s];return d.t=p,d.tOrEmptyString=(t,i={})=>s?e(t,i):"",d.i18n=i,d.Trans=c,d}},55955:function(t,e,i){"use strict";i.d(e,{A:function(){return u}});var n=i(51510),s=i(89227),o=i(44591),a=i(76667),r=i(60857);const l=(0,n.Ay)(r.A).withConfig({displayName:"Label"})(["display:inline-block !important;vertical-align:top;cursor:pointer;color:",";font-size:",";font-weight:",";line-height:1.6em;"],(0,s.yW)("Text/Primary"),(0,s.J)("md"),(0,s.Wy)("semibold")),p=(0,n.Ay)(o.A).withConfig({displayName:"Description"})(["width:100%;"]),c=n.Ay.input.attrs((t=>({type:"checkbox"}))).withConfig({displayName:"Input"})(["display:none;"]),d=(0,n.Ay)(a.A).withConfig({displayName:"Checkbox"})(["width:100%;cursor:pointer;font-size:",";"," svg{&:first-child{display:inline-block;vertical-align:top;width:1.3em;height:1.3em;padding:0.3em;color:",";background:",";border:1px "," solid;border-radius:4px;font-size:0.7em;font-weight:",";line-height:calc(1.9em - 1px);text-align:center;}}&:hover{svg{&:first-child{background:",";}}}"," "," "," ",""],(0,s.J)(),(t=>t.withLabel&&(0,n.AH)(["padding-left:",";svg:first-child{float:left;margin-left:-",";margin-top:",";}"],(0,s.Ej)("padding","lg"),(0,s.Ej)("padding","lg"),(0,s.Ej)("padding","xxxs"))),(0,s.yW)("Text/Inverted"),(0,s.yW)("Text/Inverted"),(0,s.yW)("Misc/Divider"),(0,s.Wy)("bold"),(0,s.yW)("light"),(t=>t.disabled&&(0,n.AH)(["pointer-events:none;opacity:",";"],(0,s.ke)("disabled"))),(t=>!t.value&&(0,n.AH)(["svg{&:first-child::before{content:'';}}"])),(t=>t.value&&"boolean"===typeof t.value&&(0,n.AH)(["svg{&:first-child{background:",";}}&:hover{svg{&:first-child{background:",";}}}"],(0,s.yW)("Primary/Base"),(0,s.yW)("Primary/Base"))),(t=>t.value&&"boolean"!==typeof t.value&&(0,n.AH)(["svg{&:first-child{background:",";}}&:hover{svg{&:first-child{background:",";}}}"],(0,s.yW)("light"),(0,s.yW)("light")))),h=n.Ay.div.withConfig({displayName:"CheckboxChildren"})(["padding-left:2em;"]);d.Label=l,d.Description=p,d.Input=c,d.Children=h;var u=d},74310:function(t,e,i){"use strict";i.d(e,{A:function(){return g}});var n=i(51510),s=i(89227),o=i(7120),a=i(45544),r=i(11162),l=i(82517),p=i(40046);const c=(0,n.Ay)(a.A).withConfig({displayName:"Title"})(["padding:"," "," 0 ",";"],(0,s.Ej)("padding","md"),(0,s.Ej)("padding","md"),(0,s.Ej)("padding","md")),d=n.Ay.span.withConfig({displayName:"TitleLink"})(["float:right;font-weight:",";"],(0,s.Wy)("normal")),h=(0,n.Ay)(r.A).withConfig({displayName:"Description"})(["padding:"," "," ",";border-bottom:1px solid ",";",":first-child{margin-top:0;}",":last-child{margin-bottom:0;}"],(0,s.Ej)("padding","sm"),(0,s.Ej)("padding","md"),(0,s.Ej)("padding","md"),(0,s.yW)("Misc/Divider"),l.A,l.A),u=n.Ay.div.withConfig({displayName:"Content"})(["padding:",";","{color:",";}> ",":first-child{margin-top:0;}",""],(0,s.Ej)("padding","md"),l.A,(0,s.yW)("Text/Secondary"),l.A,(({theme:t})=>(0,s.Ch)((0,o.A)(t)))),m=n.Ay.div.withConfig({displayName:"Footer"})(["padding:",";border-top:1px solid ",";",""],(0,s.Ej)("padding","md"),(0,s.yW)("Misc/Divider"),(({theme:t})=>(0,s.Ch)((0,o.A)(t)))),f=n.Ay.div.withConfig({displayName:"ContentBlock"})(["width:100%;"," "," "," background:",";border:1px solid ",";border-radius:",";text-align:",";"," "," "," "," "," "," "," "," "," "," "," "," "," "," ",":first-child{border-top-left-radius:",";}",":last-child{border-top-right-radius:",";}",":first-child{","{border-top:none;}}",":last-child{",":first-child{border-bottom-left-radius:",";}",":last-child{border-bottom-right-radius:",";}}"],(t=>!t.noMax&&(0,n.AH)(["max-width:620px;"])),(t=>t.settingsWidth&&(0,n.AH)(["max-width:927.5px;"])),(t=>t.width&&(0,n.AH)(["width:","px;"],t.width)),(t=>(0,s.yW)(t.backgroundColor||"white")),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderRadius"),(t=>t.textAlign||"left"),(t=>t.clean&&(0,n.AH)(["border:0;> ","{padding:0;}"],u)),(t=>t.paddedTitle&&(0,n.AH)(["","{border-bottom:"," solid ",";margin-bottom:",";padding:"," "," "," ",";}"],c,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("margin","sm"),(0,s.Ej)("padding","md"),(0,s.Ej)("padding","md"),(0,s.Ej)("padding","sm"),(0,s.Ej)("padding","lg"))),(t=>t.tableFit&&(0,n.AH)(["> ","{padding:0;}","{padding:"," "," 0 ",";}",":first-child{padding-left:",";}",":last-child{padding-right:",";}"],u,c,(0,s.Ej)("padding","md"),(0,s.Ej)("padding","md"),(0,s.Ej)("padding","md"),p.A.Cell,(0,s.Ej)("padding","md"),p.A.Cell,(0,s.Ej)("padding","md"))),(t=>t.noBackground&&(0,n.AH)(["border:0;background:transparent;"])),(({backgroundImage:t})=>t&&(0,n.AH)(["background:url(",") no-repeat;background-size:cover;",""],t,(({backgroundColor:t})=>t&&(0,n.AH)(["background-color:",";"],(0,s.yW)(t))))),(({curvedHeaderColor:t})=>t&&(0,n.AH)(["","{padding:"," "," ",";background-color:",";border-top-left-radius:calc("," - 1px);border-top-right-radius:calc("," - 1px);border-bottom-left-radius:59% 22%;border-bottom-right-radius:100% 72%;}"],c,(0,s.Ej)("padding","md"),(0,s.Ej)("padding","md"),(0,s.Ej)("padding","lg"),(0,s.yW)(t),(0,s.Ej)("borderRadius","md"),(0,s.Ej)("borderRadius","md"))),(t=>t.maxHeight&&(0,n.AH)(["min-height:100%;"])),(t=>t.height&&(0,n.AH)(["height:",";"],t.height)),(t=>t.noBorder&&(0,n.AH)(["border:none;"])),(t=>t.relative&&(0,n.AH)(["position:relative;"])),(t=>t.noOverflow&&(0,n.AH)(["overflow:hidden;"])),(t=>t.align&&(0,n.AH)(["> ","{text-align:",";}"],u,t.align)),(({stickyFooter:t})=>t&&(0,n.AH)(["position:relative;> ","{position:sticky;background-color:",";bottom:-90px;border-bottom-left-radius:",";border-bottom-right-radius:",";@media (min-width:1280px){bottom:-","}}"],m,(0,s.yW)("white"),(0,s.Ej)("borderRadius"),(0,s.Ej)("borderRadius"),(0,s.Ej)("padding","lg"))),(({theme:t})=>(0,s.Ch)((0,o.A)(t))),p.A.HeadCell,(0,s.Ej)("borderRadius"),p.A.HeadCell,(0,s.Ej)("borderRadius"),p.A.Row,p.A.Cell,p.A.Row,p.A.Cell,(0,s.Ej)("borderRadius"),p.A.Cell,(0,s.Ej)("borderRadius"));f.Title=c,f.TitleLink=d,f.Description=h,f.Content=u,f.Footer=m;var g=f},34008:function(t,e,i){"use strict";i.d(e,{A:function(){return d}});var n=i(51510),s=i(89227),o=i(62478);const a=n.Ay.div.withConfig({displayName:"DatePickerInput"})(["width:100%;"]),r=n.Ay.div.withConfig({displayName:"ClearButton"})(["right:0;font-size:",";cursor:pointer;&:hover{","{color:",";}}","{font-size:",";}"],(0,s.J)(),o.A,(0,s.yW)("Text/Secondary"),o.A,(0,s.J)()),l=n.Ay.div.withConfig({displayName:"Input"})(["position:relative;box-sizing:border-box;border:"," solid ",";border-radius:",";width:100%;display:inline-block;padding-left:",";padding-right:",";height:",";background:",";&:hover{z-index:1;}"," "," "," "," ","{left:0;pointer-events:none;font-size:1.25em;}",",","{position:absolute;height:",";width:",";font-style:normal;line-height:",";text-align:center;color:",";}input{margin-top:-1px;}"],(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderRadius"),(t=>t.showIcon&&!t.timeOnly?(0,s.Ej)("controlHeight")(t):(0,s.Ej)("padding")(t)),(t=>(0,s.Ej)("padding")(t)),(0,s.Ej)("controlHeight"),(0,s.yW)("white"),(t=>!t.error&&!t.focused&&(0,n.AH)(["&:hover{border-color:",";}"],(0,s.yW)("borderHover"))),(t=>t.focused&&(0,n.AH)(["border-color:",";z-index:1;"],(0,s.yW)("Primary/Base"))),(t=>t.error&&(0,n.AH)(["border-color:",";"],(0,s.yW)("Danger/Base"))),(t=>t.disabled&&(0,n.AH)(["&&&{background:",";&,*{color:"," !important;}pointer-events:none;cursor:default;}"],(0,s.yW)("Background/Base"),(0,s.yW)("Text/Secondary"))),o.A,o.A,r,(0,s.Ej)("controlHeight"),(0,s.Ej)("controlHeight"),(0,s.Ej)("controlHeight"),(0,s.yW)("Text/Tertiary")),p=n.Ay.div.withConfig({displayName:"MobileWrapper"})(["position:fixed;top:0;left:0;height:100%;width:100%;background:",";color:",";z-index:999999999;overflow-y:auto;.DayPicker-Day{min-width:calc((100vw - 30px) / 7) !important;height:calc(((100vw - 30px) / 7) * 1.2) !important;margin:0 !important;}.DayPicker-Weekday{min-width:calc((100vw - 30px) / 7) !important;border-right:"," solid transparent;margin:0 !important;}.DayPicker-Month{padding:0 15px;margin-top:30px;}"],(0,s.yW)("white"),(0,s.yW)("Text/Primary"),(0,s.Ej)("borderWidth")),c=n.Ay.span.withConfig({displayName:"MobileHeader"})(["display:block;padding:",";color:",";border-bottom:"," solid ",";font-size:",";font-weight:",";> span{color:",";}"],(0,s.Ej)("padding","md"),(0,s.yW)("Primary/Base"),(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.J)("md"),(0,s.Wy)("lighter"),(0,s.yW)("Text/Primary"));a.InputContainer=l,a.ClearButton=r,a.MobileWrapper=p,a.MobileHeader=c;var d=a},69739:function(t,e,i){"use strict";i.d(e,{A:function(){return l}});var n=i(51510),s=i(89227);const o=n.Ay.div.withConfig({displayName:"DateTimeInput"})(["width:calc(100% + ",");height:",";margin-left:-",";padding-left:",";&&&{box-sizing:border-box;display:inline-flex;align-items:center;cursor:pointer;","}"],(0,s.Ej)("padding"),(0,s.Ej)("controlHeight"),(0,s.Ej)("padding"),(0,s.Ej)("padding"),(t=>t.disabled&&(0,n.AH)(["opacity:0.9;pointer-events:none;user-select:none;"]))),a=n.Ay.input.withConfig({displayName:"Input"})(["&&&{box-sizing:border-box;display:inherit;width:100%;padding:"," 0px "," 2px;margin:0;height:",";color:"," !important;text-align:center;background:none;font-size:",";font-weight:",";border:none;border-radius:0;cursor:pointer;appearance:textfield;&.DD,&.MM,&.HH,&.hh,&.mm,&.YY{min-width:1px;width:1.5em;opacity:1;}&.A{min-width:1px;width:1.7em;}&.YYYY{min-width:1px;width:2.6em;}&::placeholder{color:",";opacity:1;text-align:left;}&::-ms-input-placeholder{color:",";text-align:left;}&:-ms-input-placeholder{color:",";text-align:left;}&:focus{box-shadow:none;background:none;outline:none;}&:hover:not(:focus){box-shadow:none;background:none;}&[type=number]::-webkit-inner-spin-button,&[type=number]::-webkit-outter-spin-button{display:none;appearance:none;margin:0;}","}"],(0,s.Ej)("padding"),(0,s.Ej)("padding"),(0,s.Ej)("controlHeight"),(0,s.yW)("Text/Primary"),(0,s.J)(),(0,s.Wy)("light"),(0,s.yW)("Text/Tertiary"),(0,s.yW)("Text/Tertiary"),(0,s.yW)("Text/Tertiary"),(t=>t.invalid&&(0,n.AH)(["color:"," !important;"],(0,s.yW)("Danger/Base")))),r=n.Ay.span.withConfig({displayName:"Seperator"})(["box-sizing:border-box;font-size:",";",""],(0,s.J)(),(t=>t.lighter&&(0,n.AH)(["opacity:0.6;"])));o.Input=a,o.Seperator=r;var l=o},50558:function(t,e,i){"use strict";i.d(e,{A:function(){return p}});var n=i(51510),s=i(89227);const o=n.Ay.span.withConfig({displayName:"NavigationButton"})(["position:absolute;top:",";color:",";font-size:"," !important;cursor:pointer;transition:opacity 0.2s ease-in-out;will-change:opacity;&:hover{opacity:0.3;}"],(0,s.zA)("h"),(0,s.yW)("Text/Primary"),(0,s.J)()),a=(0,n.Ay)(o).withConfig({displayName:"NavigationPrevious"})(["left:0;"]),r=(0,n.Ay)(o).withConfig({displayName:"NavigationNext"})(["right:0;"]),l=n.Ay.div.withConfig({displayName:"DayPicker"})(["--cell-size:50px;font-family:",";*{outline:none;}.DayPicker{display:block;}.DayPicker:not(.DayPicker--interactionDisabled) .DayPicker-Day:not(.DayPicker-Day--disabled):not(.DayPicker-Day--selected):not(.DayPicker-Day--outside):hover{background-color:initial;}.DayPicker-wrapper{position:relative;user-select:none;flex-direction:row;padding:0;}.DayPicker-Month{display:block;padding:0;margin:0;border-collapse:collapse;border-spacing:0;user-select:none;}.DayPicker-Caption{display:flex;justify-content:center;align-items:center;color:",";text-align:center;padding:0 ",";margin-bottom:",";& > div{font-size:16px;font-weight:",";}}.DayPicker-Weekdays{display:flex;margin-top:",";}.DayPicker-WeekdaysRow{display:flex;padding-top:",";margin-bottom:",";}.DayPicker-Weekday{display:flex;justify-content:center;align-items:center;width:var(--cell-size);padding:0;font-size:",";font-weight:",";text-align:center;color:",";text-transform:uppercase;}.DayPicker-Weekday abbr[title]{border-bottom:none;text-decoration:none;}.DayPicker-Week{display:flex;&:not(:last-child){margin-bottom:-2px;}}.DayPicker-Day{box-sizing:border-box;display:block;width:var(--cell-size);height:var(--cell-size);padding:0;border:none;border-radius:0;.DayPicker-Day__wrapper{box-sizing:border-box;width:var(--cell-size);height:var(--cell-size);padding:3px;position:relative;}.DayPicker-Day__inner{box-sizing:border-box;display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;border-radius:50%;position:relative;z-index:1;}.DayPicker-Day__date{color:",";font-weight:",";font-size:",";line-height:20px;text-align:center;}.DayPicker-Day__availability-count{position:absolute;bottom:6px;left:50%;color:",";transform:translateX(-50%);font-size:10px;line-height:12px;text-align:center;}&__availability{&.available{.DayPicker-Day__inner{background-color:#60d672cc;}}&.unavailable{.DayPicker-Day__inner{background-color:#e51c2ccc;.DayPicker-Day__date,.DayPicker-Day__availability-count{color:",";}}}&.partial{.DayPicker-Day__inner{background-color:#ffb442cc;.DayPicker-Day__date,.DayPicker-Day__availability-count{color:",";}}}}&--past{.DayPicker-Day__availability-count{display:none;}}&--selected{&:not(.DayPicker-Day--disabled):not(.DayPicker-Day--outside){background-color:transparent;color:initial;}& > .DayPicker-Day__wrapper{border-color:transparent;&::after{content:'';position:absolute;top:0px;bottom:0px;left:0px;right:0px;z-index:10;border:2px solid ",";border-left:none;border-right:none;}}}&--from > .DayPicker-Day__wrapper{&::after{content:'';position:absolute;top:0px;bottom:0px;left:0px;right:0px;z-index:10;border:2px solid ",";border-right:none;border-top-left-radius:50%;border-bottom-left-radius:50%;}}&--to > .DayPicker-Day__wrapper{&::after{content:'';position:absolute;top:0px;bottom:0px;right:0px;left:0px;z-index:10;border:2px solid ",";border-left:none;border-top-right-radius:50%;border-bottom-right-radius:50%;box-sizing:border-box;}}&--today{.DayPicker-Day__date{text-decoration:underline;text-underline-offset:3px;}}&--disabled{cursor:not-allowed;.DayPicker-Day__availability{&.available{.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );.DayPicker-Day__date,.DayPicker-Day__availability-count{color:",";}}}&.unavailable{.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );.DayPicker-Day__date,.DayPicker-Day__availability-count{color:",";}}}&.partial{.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );.DayPicker-Day__date,.DayPicker-Day__availability-count{color:",";}}}}.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );.DayPicker-Day__date,.DayPicker-Day__availability-count{color:","66;}}&:hover{.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );}.DayPicker-Day__availability{&.available{.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );}}&.unavailable{.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );}}&.partial{.DayPicker-Day__inner{background-image:repeating-linear-gradient( 315deg,",","," 6px,"," 6px,"," 7px );}}}}}&--selection:not(.DayPicker-Day--outside){position:relative;&::before{content:'';position:absolute;top:0px;bottom:0px;left:0px;right:0px;background-color:",";}}&--selectionStart:not(.DayPicker-Day--outside){&::before{border-top-left-radius:50%;border-bottom-left-radius:50%;}}&--selectionEnd:not(.DayPicker-Day--outside){&::before{border-top-right-radius:50%;border-bottom-right-radius:50%;}}&:has(.DayPicker-Day__availability-count) .DayPicker-Day__date{transform:translateY(-7px);}&:hover{.DayPicker-Day__inner{background-color:",";}.DayPicker-Day__availability{&.available{.DayPicker-Day__inner{background-color:#40a14fcc;}}&.unavailable{.DayPicker-Day__inner{background-color:#c1000fcc;}}&.partial{.DayPicker-Day__inner{background-color:#e08700cc;}}}}}.DayPicker-Day--from.DayPicker-Day--to > .DayPicker-Day__wrapper{border-radius:50%;&::after{content:'';position:absolute;top:0px;bottom:0px;left:0px;right:0px;z-index:10;width:100%;border:2px solid ",";border-radius:50%;}}@media screen and (min-width:866px){.DayPicker-Months{justify-content:space-between;}}"],(t=>t.theme.font.body),(0,s.yW)("Text/Primary"),(0,s.zA)("4.5"),(0,s.zA)("1.5"),(0,s.Wy)("semibold"),(0,s.zA)("1.5"),(0,s.zA)("1"),(0,s.zA)("1.5"),(0,s.J)("md"),(0,s.Wy)("semibold"),(0,s.yW)("Text/Tertiary"),(0,s.yW)("Text/Primary"),(0,s.Wy)("semibold"),(0,s.J)("md"),(0,s.yW)("Text/Primary"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Warning/Foreground1"),(0,s.yW)("Primary/Outline"),(0,s.yW)("Primary/Outline"),(0,s.yW)("Primary/Outline"),(0,s.yW)("Success/Background1"),(0,s.yW)("Success/Background1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Success/Foreground3"),(0,s.yW)("Danger/Background1"),(0,s.yW)("Danger/Background1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Danger/Foreground3"),(0,s.yW)("Warning/Background1"),(0,s.yW)("Warning/Background1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Warning/Foreground3"),(0,s.yW)("Secondary/Background1"),(0,s.yW)("Secondary/Background1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Text/Primary"),(0,s.yW)("Secondary/Background2"),(0,s.yW)("Secondary/Background2"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Success/Background2"),(0,s.yW)("Success/Background2"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Danger/Background2"),(0,s.yW)("Danger/Background2"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Warning/Background2"),(0,s.yW)("Warning/Background2"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Foreground1"),(0,s.yW)("Primary/Background2"),(0,s.yW)("Primary/Background2"),(0,s.yW)("Primary/Outline"));l.NavigationNext=r,l.NavigationPrevious=a;var p=l},20323:function(t,e,i){"use strict";i.d(e,{L:function(){return s}});var n=i(51510);const s=n.Ay.div.withConfig({displayName:"Disable"})([""," "," ",""],(t=>t.disabled&&(0,n.AH)(["opacity:0.6;"])),(t=>t.disabled&&"hide"===t.strategy&&(0,n.AH)(["display:none;"])),(t=>t.disabled&&(0,n.AH)(["pointer-events:none;"])))},95349:function(t,e,i){"use strict";i.d(e,{A:function(){return l}});var n=i(51510),s=i(89227);const o=n.Ay.div.withConfig({displayName:"BFocalImage"})(["width:",";height:",";background-color:",";position:relative;z-index:1;border:"," solid ",";border-radius:",";"," "," "," "," "," ",""],(t=>t.size?t.size:t.width),(t=>t.size?t.size:t.height),(0,s.yW)("white"),(0,s.Ej)("borderWidth","xs"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderRadius","sm"),(t=>t.selected&&(0,n.AH)(["border-color:",";"],(0,s.yW)("Primary/Base"))),(t=>t.inline&&(0,n.AH)(["display:inline-block;vertical-align:middle;"])),(t=>t.noBorder&&(0,n.AH)(["border:none;"])),(t=>t.noBorderRadius&&(0,n.AH)(["border-radius:0;"])),(t=>t.maintainAspect&&(0,n.AH)(["width:100%;padding-bottom:100% !important;"])),(t=>t.cursor&&(0,n.AH)(["cursor:",";"],t.cursor))),a=n.Ay.img.attrs((t=>({loading:"lazy"}))).withConfig({displayName:"Image"})(["max-width:initial;max-height:initial;width:initial;height:initial;min-width:initial;min-height:initial;",""],(t=>t.isLoading&&(0,n.AH)(["visibility:hidden;"]))),r=n.Ay.img.withConfig({displayName:"Preview"})(["width:100%;height:100%;filter:blur(10px);"]);o.Image=a,o.Preview=r;var l=o},32191:function(t,e,i){"use strict";i.d(e,{A:function(){return o}});var n=i(51510),s=i(11162);var o=(0,n.Ay)(s.A).withConfig({displayName:"Handwriting"})(["font-family:",";z-index:27;position:absolute;"," "," "," "," "," "," "," "," transform:translate(var(--translate-x),var(--translate-y)) rotate(var(--rotate));"],(({theme:t})=>t.font.handwriting),(({width:t})=>t&&(0,n.AH)(["width:","px;"],t)),(({top:t})=>t&&(0,n.AH)(["top:",";"],t)),(({bottom:t})=>t&&(0,n.AH)(["bottom:",";"],t)),(({left:t})=>t&&(0,n.AH)(["left:",";"],t)),(({right:t})=>t&&(0,n.AH)(["right:",";"],t)),(({rotate:t=0})=>(0,n.AH)(["--rotate:","deg;"],t)),(({translateX:t=0})=>(0,n.AH)(["--translate-x:",";"],t)),(({translateY:t=0})=>(0,n.AH)(["--translate-y:",";"],t)))},17530:function(t,e,i){"use strict";i.d(e,{A:function(){return p}});var n=i(51510),s=i(62478),o=i(68709),a=i(89227);const r=(0,n.Ay)(o.A).withConfig({displayName:"Input"})([""," "," ",""],(t=>t.lineThrough&&(0,n.AH)(["text-decoration:line-through;"])),(t=>t.uppercase&&(0,n.AH)(["text-transform:uppercase;&::placeholder{text-transform:none;}"])),(t=>"number"===t.type&&t.hideArrows&&(0,n.AH)(["-moz-appearance:textfield;&::-webkit-outer-spin-button,&::-webkit-inner-spin-button{-webkit-appearance:none;margin:0;}"]))),l=n.Ay.span.withConfig({displayName:"InputContainer"})(["&&&{display:block;position:relative;font-size:",";> ","{position:absolute;height:",";width:",";color:",";font-size:1.25em;font-style:normal;line-height:",";text-align:center;pointer-events:none;& + ","{padding-left:",";}&.fa-spinner-third{color:",";}}}"],(0,a.J)(),s.A,(0,a.Ej)("controlHeight"),(0,a.Ej)("controlHeight"),(0,a.yW)("Text/Tertiary"),(0,a.Ej)("controlHeight"),r,(0,a.Ej)("controlHeight"),(0,a.yW)("Primary/Base"));l.Input=r,l.I=s.A;var p=l},87216:function(t,e,i){"use strict";i.d(e,{A:function(){return v}});var n=i(51510),s=i(89227),o=i(76667),a=i(44591),r=i(59494),l=i(11162),p=i(87980),c=i(59194);const d=(0,n.Ay)(c.fv).withConfig({displayName:"InputField"})(["position:relative;margin-bottom:",";&:last-child{margin-bottom:0;}"," "," ",""],(0,s.Ej)("margin"),(({display:t})=>t&&(0,n.AH)(["display:",";"],t)),(({"data-force-margin":t})=>t&&(0,n.AH)(["margin-bottom:"," !important;"],(0,s.Ej)("margin"))),(({"data-no-margin":t})=>t&&(0,n.AH)(["margin-bottom:0;"]))),h=(0,n.Ay)(l.A).withConfig({displayName:"Error"})(["margin-top:",";font-size:",";color:",";"],(0,s.Ej)("margin","sm"),(0,s.J)(),(0,s.yW)("Danger/Base")),u=n.Ay.span.withConfig({displayName:"Valid"})(["position:absolute;bottom:0;right:0px;height:",";width:",";line-height:",";text-align:center;color:",";",""],(0,s.Ej)("controlHeight"),(0,s.Ej)("controlHeight"),(0,s.Ej)("controlHeight"),(0,s.yW)("Success/Base"),(t=>"select"===t.type&&(0,n.AH)(["display:none;"]))),m=(0,n.Ay)(o.A).withConfig({displayName:"Label"})(["height:1.3em;width:auto;margin-bottom:",";",""],(0,s.Ej)("margin","xs"),(t=>t.descriptionTop&&(0,n.AH)(["margin-bottom:",";"],(0,s.Ej)("margin","xxs")))),f=(0,n.Ay)(p.A).withConfig({displayName:"Link"})(["height:1.3em;width:auto;"]),g=n.Ay.div.withConfig({displayName:"LabelContainer"})(["display:flex;align-items:center;justify-content:space-between;","{margin-bottom:",";}"],r.A,(0,s.Ej)("margin","xs")),b=(0,n.Ay)(a.A).withConfig({displayName:"Description"})(["margin:0.35em 0 0 0;",""],(t=>t.descriptionTop&&(0,n.AH)(["margin:0 0 "," 0;"],(0,s.Ej)("margin","xs"))));d.Label=m,d.Error=h,d.Valid=u,d.Description=b,d.LabelContainer=g,d.Link=f;var v=d},77829:function(t,e,i){"use strict";i.d(e,{A:function(){return l}});var n=i(51510),s=i(89227),o=i(11162),a=i(31408),r=i(87216);var l=(0,n.Ay)(o.A).withConfig({displayName:"InputGroup"})(["display:flex;> ","{margin-bottom:0;}> :first-child:not(:last-child){"," "," &,*,.Select__control{border-top-right-radius:0%;border-bottom-right-radius:0%;","}}> :last-child:not(:first-child){&,*,",",.Select__control{border-top-left-radius:0%;border-bottom-left-radius:0%;}}> :not(:first-child):not(:last-child){&,*,",",.Select__control{border-radius:0;","}}",""],r.A,(t=>t.divider&&t.preserveBorders&&(0,n.AH)(["margin-right:",";"],(0,s.Ej)("borderWidth"))),(t=>!t.noFlex&&(0,n.AH)(["flex:1 1 auto;width:1%;"])),(t=>!t.preserveBorders&&(0,n.AH)(["border-right:0;"])),a.A,a.A,(t=>!t.preserveBorders&&(0,n.AH)(["border-right:0;"])),(t=>{const{sizes:e}=t;let i="";if(e)return e.forEach(((t,e)=>{i+=`\n          > *:nth-child(${e+1}) {\n            flex-basis: ${t};\n          }\n        `})),(0,n.AH)(["",""],i)}))},90211:function(t,e,i){"use strict";i.d(e,{A:function(){return c}});var n=i(51510),s=i(89227),o=i(11162);const a=(0,n.Ay)(o.A).withConfig({displayName:"Paginator"})(["display:flex;align-items:center;height:",";",""],(0,s.Ej)("controlHeight"),(({paginatePosition:t})=>"right"===t&&(0,n.AH)(["float:right;"]))),r=(0,n.Ay)(o.A).withConfig({displayName:"PageContainer"})(["display:flex;margin-right:",";font-size:",";",""],(0,s.Ej)("margin","md"),(0,s.J)("md"),(({paginatePosition:t})=>"right"===t&&(0,n.AH)(["margin-left:",";margin-right:0;"],(0,s.Ej)("margin","md")))),l=(0,n.Ay)(o.A).withConfig({displayName:"Metadata"})(["font-size:",";"],(0,s.J)("sm")),p=(0,n.Ay)(o.A).withConfig({displayName:"Page"})(["display:flex;align-items:center;justify-content:center;width:2em;height:2em;padding:",";border:1px solid ",";background-color:",";border-left:0;text-align:center;cursor:pointer;&:hover{background-color:",";}&:first-child{border-radius:"," 0 0  ",";border-left:1px solid ",";}&:last-child{border-radius:0 "," "," 0;}",""],(0,s.Ej)("padding"),(0,s.yW)("Misc/Divider"),(0,s.yW)("white"),(0,s.yW)("Primary/Background2"),(0,s.Ej)("borderRadius"),(0,s.Ej)("borderRadius"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderRadius"),(0,s.Ej)("borderRadius"),(({active:t})=>t&&(0,n.AH)(["color:",";background-color:",";&:hover{background-color:","}"],(0,s.yW)("Text/Inverted"),(0,s.yW)("Primary/Base"),(0,s.yW)("Primary/Base"))));a.PageContainer=r,a.Page=p,a.Metadata=l;var c=a},71690:function(t,e,i){"use strict";i.d(e,{A:function(){return k}});var n=i(51510),s=i(89227),o=i(70163),a=i(87216),r=i(62478),l=i(11162),p=i(96689);const c=n.Ay.div.withConfig({displayName:"PickerBlock"})([""]),d=n.Ay.div.withConfig({displayName:"HorizontalWrapper"})(["display:flex;flex-flow:row nowrap;align-items:center;"]),h=n.Ay.div.withConfig({displayName:"PickerForm"})(["display:flex;flex-flow:row nowrap;align-items:",";","{flex-basis:100%;}& > ","{margin:0 ",";}"," ",""],(t=>t.verticalAlignment||"center"),c,o.A,(0,s.Ej)("margin","sm"),(({mode:t})=>"fixed_timeslots"===t&&(0,n.AH)(["flex-flow:column nowrap;align-items:stretch;& > "," > ","{margin:0 ",";margin-top:",";}& > "," > ","{flex-basis:100%;}"],d,o.A,(0,s.Ej)("margin","sm"),(0,s.Ej)("margin","lg"),d,c)),(({direction:t})=>"vertical"===t&&(0,n.AH)(["flex-flow:column nowrap;align-items:stretch;& > ","{flex-flow:column nowrap;align-items:stretch;}"],d))),u=n.Ay.span.withConfig({displayName:"Label"})(["color:",";font-size:",";font-weight:",";"],(0,s.yW)("Text/Primary"),(0,s.zA)("2"),(0,s.Wy)("semibold")),m=n.Ay.div.withConfig({displayName:"Field"})(["display:flex;flex-direction:column;gap:",";@container (min-width:550px){&:last-child,&:nth-last-child(2){align-items:flex-end;","{text-align:right;}}}"],(0,s.zA)("h"),u),f=n.Ay.div.withConfig({displayName:"TimeslotLabelWrapper"})(["display:flex;align-items:center;justify-content:space-between;width:100%;",":last-child{text-align:right;}"],u),g=(0,n.Ay)(p.A).withConfig({displayName:"Button"})(["appearance:none;width:fit-content;border:none;border-bottom:"," solid ",";background-color:transparent;color:",";font-size:",";font-weight:",";line-height:28px;padding:"," 0;border-radius:"," "," 0 0;white-space:nowrap;cursor:pointer;transition:border-color 0.1s ease,padding 0.15s ease-in;&:disabled{border-bottom-color:transparent;color:",";cursor:not-allowed;}&:hover:not(:disabled){border-color:",";}"," "," ",""],(0,s.zA)("h"),(0,s.yW)("Misc/Divider"),(0,s.yW)("Text/Primary"),(0,s.J)("lg"),(0,s.Wy)("semibold"),(0,s.zA)("h"),(0,s.zA)("1.5"),(0,s.zA)("1.5"),(0,s.yW)("Text/Tertiary"),(0,s.yW)("Primary/Outline"),(({empty:t})=>t&&(0,n.AH)(["color:",";"],(0,s.yW)("Text/Tertiary"))),(({error:t})=>t&&(0,n.AH)(["border-color:",";color:",";&:disabled{color:",";}"],(0,s.yW)("Danger/Outline"),(0,s.yW)("Danger/Outline"),(0,s.yW)("Danger/Outline"))),(({active:t})=>t&&(0,n.AH)(["background-color:",";color:",";border-color:",";padding:"," ",";"],(0,s.yW)("Primary/Background2"),(0,s.yW)("Primary/Outline"),(0,s.yW)("Primary/Outline"),(0,s.zA)("h"),(0,s.zA)("1.5")))),b=n.Ay.div.withConfig({displayName:"Timeslot"})(["display:flex;justify-content:space-between;align-items:center;width:100%;gap:",";","{font-size:",";}"],(0,s.zA)("5"),o.A,(0,s.zA)("3.5")),v=(0,n.Ay)(l.A).withConfig({displayName:"PickerWrapper"})(["display:flex;align-items:flex-end;gap:",";","{margin-bottom:0;}"],(0,s.zA)("3.5"),a.A),y=n.Ay.div.withConfig({displayName:"Decorator"})(["align-self:flex-end;","{color:",";font-size:20px;transform:translateY(-3px);}"],r.A,(0,s.yW)("Text/Primary"));h.PickerBlock=c,h.HorizontalWrapper=d,h.Field=m,h.Button=g,h.Label=u,h.PickerWrapper=v,h.TimeslotLabelWrapper=f,h.Timeslot=b,h.Decorator=y;var k=h},44073:function(t,e,i){"use strict";i.d(e,{A:function(){return d}});var n=i(51510),s=i(89227);const o=n.Ay.span.withConfig({displayName:"Inner"})(["position:relative;display:block;flex-shrink:0;background:",";color:",";"," box-shadow:",";border-radius:",";line-height:1.2;font-size:",";z-index:10;"," ",""],(0,s.yW)("white"),(0,s.yW)("Text/Primary"),(t=>"primary"===t.color&&(0,n.AH)(["background:",";"],(0,s.yW)("Primary/Base"))),(0,s.Ej)("shadow","md"),(0,s.Ej)("borderRadius","sm"),(0,s.J)("md"),(t=>(!t.interactive||t.defaultPopoverStyling)&&(0,n.AH)(["width:max-content;max-width:","px;padding:"," ",";text-align:left;",""],t.maxWidth||230,(0,s.Ej)("padding","sm"),(0,s.Ej)("padding","md"),(t=>t.center&&(0,n.AH)(["text-align:center;"])))),(({noOverflow:t})=>t&&(0,n.AH)(["overflow:hidden;"]))),a=n.Ay.span.withConfig({displayName:"Arrow"})(['position:absolute;display:block;width:15px;height:100%;overflow:hidden;&::after{content:"";position:absolute;width:10px;height:10px;background:',";box-shadow:",";transform:rotate(45deg);}"," @media screen and (max-width:767px){&::after{display:none;}}"],(0,s.yW)("white"),(0,s.Ej)("shadow","md"),(t=>{if(t.direction)switch(t.direction){case"left":return(0,n.AH)(["top:50%;right:0;transform:translateX(100%) translateY(-50%);&::after{top:50%;left:0;transform:translateX(-50%) translateY(-50%) rotate(45deg);}"]);case"right":return(0,n.AH)(["top:50%;left:0;transform:translateX(-100%) translateY(-50%);&::after{right:0;top:50%;transform:translateX(50%) translateY(-50%) rotate(45deg);}"]);case"bottom":return(0,n.AH)(["top:0;left:50%;width:100%;height:15px;transform:translateX(-50%) translateY(-100%);&::after{bottom:0;left:50%;transform:translateX(-50%) translateY(50%) rotate(45deg);}"]);default:return(0,n.AH)(["bottom:0;left:50%;width:100%;height:15px;transform:translateX(-50%) translateY(100%);&::after{left:50%;top:0;transform:translateX(-50%) translateY(-50%) rotate(45deg);}"])}})),r=n.Ay.span.withConfig({displayName:"Content"})(["position:absolute;display:flex;justify-content:center;opacity:0;pointer-events:none;z-index:100000000;"," "," "," "," "," ",""],(t=>t.disabled&&(0,n.AH)(["opacity:0 !important;"])),(t=>{switch(t.direction){case"left":return(0,n.AH)(["top:50%;left:-10px;transform:translateX(-100%) translateY(-50%);"]);case"right":return(0,n.AH)(["top:50%;right:-10px;transform:translateX(100%) translateY(-50%);"]);case"bottom":return(0,n.AH)(["bottom:-10px;left:50%;transform:translateX(-50%) translateY(100%);"]);default:return(0,n.AH)(["top:-10px;left:50%;transform:translateX(-50%) translateY(-100%);"])}}),(t=>!t.notFixed&&(0,n.AH)(["@media screen and (max-width:767px){position:fixed;display:block;top:50%;left:50%;transform:translate(-50%,-50%);}"])),(t=>t.manual&&(0,n.AH)(["position:fixed;opacity:1;pointer-events:all;top:unset;right:unset;bottom:unset;left:unset;"])),(({transitions:t})=>t&&(0,n.AH)(["transition:all 300ms ease;transition-delay:300ms;"])),(({tippy:t})=>t&&(0,n.AH)(["position:relative;transform:none;top:initial;left:initial;right:initial;bottom:initial;opacity:1;pointer-events:all;"]))),l=n.Ay.div.withConfig({displayName:"Popover"})(["position:relative;width:100%;"," "," &:hover ","{opacity:1;","}"," ",""],(t=>t.inline&&(0,n.AH)(["display:inline;width:auto;vertical-align:middle;"])),(t=>t.inlineBlock&&(0,n.AH)(["display:inline-block;width:auto;vertical-align:middle;"])),r,(t=>t.interactive&&(0,n.AH)(["pointer-events:all;"])),(t=>t.open&&(0,n.AH)(["","{pointer-events:all;opacity:1;transition-delay:0ms;transition:all 100ms ease;}"],r)),(t=>!1===t.open&&(0,n.AH)(["","{opacity:0 !important;transition-delay:0ms;transition:all 100ms ease;}"],r))),p=n.Ay.span.withConfig({displayName:"TippyArrow"})(["position:absolute;width:15px;height:15px;z-index:-1;&:before{content:'';transform:rotate(45deg);background:",";position:absolute;width:12px;height:12px;z-index:-1;","}"],(0,s.yW)("white"),(t=>"primary"===t.color&&(0,n.AH)(["background:",";"],(0,s.yW)("Primary/Base")))),c=n.Ay.span.withConfig({displayName:"Wrapper"})(["",""],(({sticky:t,stickyConfig:e})=>t&&e&&(0,n.AH)(["position:sticky;",""],Object.entries(e).map((([t,e])=>`${t}: ${e};`)).join(" "))));l.Content=r,l.Inner=o,l.Arrow=a,l.TippyArrow=p,l.Wrapper=c;var d=l},80692:function(t,e,i){"use strict";i.d(e,{A:function(){return d}});var n=i(51510),s=i(89227),o=i(68709),a=i(62478);const r=n.Ay.div.withConfig({displayName:"QuantityInput"})(["min-width:85px;"]),l=n.Ay.div.withConfig({displayName:"ControlContainer"})(["position:relative;width:35px;"]),p=n.Ay.a.withConfig({displayName:"Control"})(["position:absolute;display:block;right:0;padding-top:1px;height:50%;width:35px;background:",";color:",";font-size:calc("," - 2px);text-align:center;cursor:pointer;&:hover{background:","99;color:","99;}&:active{background:",";color:",";}","{vertical-align:middle;margin:0 !important;}"," "," ",""],(0,s.yW)("Accent2/Background2"),(0,s.yW)("Accent2/Foreground1"),(0,s.J)(),(0,s.yW)("Accent2/Background2"),(0,s.yW)("Accent2/Foreground1"),(0,s.yW)("Accent2/Controlvariant1"),(0,s.yW)("Accent2/Foreground1"),a.A,(t=>t.plus&&(0,n.AH)(["top:0;border-top-right-radius:",";border-top:1px "," solid !important;border-right:1px "," solid !important;"],(0,s.Ej)("borderRadius"),(0,s.yW)("Misc/Divider"),(0,s.yW)("Misc/Divider"))),(t=>t.minus&&(0,n.AH)(["bottom:0;border-bottom-right-radius:",";border-bottom:1px "," solid !important;border-right:1px "," solid !important;"],(0,s.Ej)("borderRadius"),(0,s.yW)("Misc/Divider"),(0,s.yW)("Misc/Divider"))),(t=>t.disabled&&(0,n.AH)(["background:","33;color:","33;cursor:default;&:hover{background:","33;color:","33;}&:active{background:","33;color:","33;}"],(0,s.yW)("light"),(0,s.yW)("Text/Primary"),(0,s.yW)("light"),(0,s.yW)("Text/Primary"),(0,s.yW)("light"),(0,s.yW)("Text/Primary")))),c=(0,n.Ay)(o.A).attrs((t=>({type:"number"}))).withConfig({displayName:"Input"})(["&&&{appearance:textfield;&::-webkit-inner-spin-button,&::-webkit-outer-spin-button{appearance:none;margin:0;}}"]);r.Control=p,r.ControlContainer=l,r.Input=c;var d=r},40130:function(t,e,i){"use strict";i.d(e,{A:function(){return y}});var n=i(51510),s=i(89227),o=i(33376),a=i(76667),r=i(44591),l=i(31408),p=i(62478),c=i(11162);const d=n.Ay.div.withConfig({displayName:"Buttons"})(["","{","{border-radius:0;}&:first-child{","{border-top-left-radius:",";border-bottom-left-radius:",";}}&:last-child{","{border-top-right-radius:",";border-bottom-right-radius:",";}}}",""],l.A,l.A.Button,l.A.Button,(0,s.Ej)("borderRadius","sm"),(0,s.Ej)("borderRadius","sm"),l.A.Button,(0,s.Ej)("borderRadius","sm"),(0,s.Ej)("borderRadius","sm"),(t=>t.fullWidth&&(0,n.AH)(["width:100%;display:flex;justify-content:center;align-items:center;","{width:100%;","{width:100%;}}"],l.A,l.A.Button))),h=(0,n.Ay)(c.A).withConfig({displayName:"Radio"})(["position:relative;padding:"," ",";padding-left:calc(2.5em - 5px);font-size:",";cursor:pointer;&:last-child{border-bottom:0;}> ","{position:absolute;top:-3px;left:-4px;width:2em;height:2em;background:",";border:1px "," solid;border-radius:50%;font-weight:",";text-align:center;line-height:2em;transform:scale(0.7);cursor:pointer;}&:hover{> ","{background:",";}}"," "," ",""],(0,s.Ej)("padding","sm"),(0,s.Ej)("padding"),(0,s.J)(),p.A,(0,s.yW)("white"),(0,s.yW)("Misc/Divider"),(0,s.Wy)("bold"),p.A,(0,s.yW)("light"),(t=>!t.checked&&(0,n.AH)(["> ","::before{content:'';}"],p.A)),(t=>t.checked&&(0,n.AH)(["> ","{color:",";background:",";border:0;}&:hover > ","{background:",";}"],p.A,(0,s.yW)("Text/Inverted"),(0,s.yW)("Primary/Base"),p.A,(0,s.yW)("Primary/Base"))),(t=>t.bordered&&(0,n.AH)(["padding:"," "," "," calc(5px + ",") !important;border:1px "," solid !important;border-radius:",";display:inline-block;margin-right:",";"," > ","{top:calc("," - 3px);left:calc("," - 5px);}"],(0,s.Ej)("padding","sm"),(0,s.Ej)("padding","md"),(0,s.Ej)("padding","sm"),(0,s.Ej)("padding","xl"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderRadius","sm"),(0,s.Ej)("margin","sm"),(t=>t.checked&&(0,n.AH)(["border-color:"," !important;"],(0,s.yW)("Primary/Base"))),p.A,(0,s.Ej)("padding","sm"),(0,s.Ej)("padding","sm")))),u=n.Ay.div.withConfig({displayName:"RadioGroup"})(["width:100%;"," ","{padding-top:0;&:last-child{padding-bottom:0;}}"," "," ",""],(t=>t.displayGrid&&(0,n.AH)(["@media (min-width:","){display:grid;grid-template-columns:auto auto;gap:",";","}"],(0,s.Ej)("screenSizes","lg"),(0,s.Ej)("margin","md"),(t=>"equalWidth"===t.displayGrid&&(0,n.AH)(["grid-template-columns:50% 50%;"])))),h,(t=>"buttonGroup"===t.type&&!1!==t.centered&&(0,n.AH)(["display:flex;flex-flow:row nowrap;align-items:center;justify-content:center;"])),(({error:t})=>t&&(0,n.AH)([""," > ","{border-color:","}"],h,p.A,(0,s.yW)("Danger/Base"))),(t=>t.bordered&&t.error&&(0,n.AH)(["","{border-color:"," !important;}"],h,(0,s.yW)("Danger/Base")))),m=(0,n.Ay)(o.A).withConfig({displayName:"RadioButton"})(["border-width:2px !important;"]),f=(0,n.Ay)(a.A).withConfig({displayName:"Label"})(["display:block;margin:0;font-weight:",";font-size:",";line-height:1.6em;cursor:pointer;"],(0,s.Wy)("semibold"),(0,s.J)()),g=(0,n.Ay)(r.A).withConfig({displayName:"Description"})(["display:block;margin:4px 0 0;cursor:pointer;"]),b=n.Ay.div.withConfig({displayName:"ChildContainer"})(["margin-top:",";cursor:initial;"],(0,s.Ej)("margin","xs")),v=n.Ay.div.withConfig({displayName:"Error"})(["margin-top:",";color:",";"],(0,s.Ej)("margin","sm"),(0,s.yW)("Danger/Base"));u.Radio=h,u.RadioButton=m,u.Label=f,u.Description=g,u.ChildContainer=b,u.Buttons=d,u.Error=v;var y=u},18248:function(t,e,i){"use strict";i.d(e,{A:function(){return l}});var n=i(51510),s=i(89227),o=i(70163);const a=n.Ay.div.withConfig({displayName:"Container"})(["position:relative;",""],(({isMobile:t})=>t&&(0,n.AH)(["","{position:absolute;pointer-events:none;top:0;right:",";color:",";line-height:",";}"],o.A,(0,s.Ej)("padding","xs"),(0,s.yW)("Text/Tertiary"),(0,s.Ej)("controlHeight")))),r=n.Ay.select.withConfig({displayName:"Select"})(["height:",";padding:0 ",";font-family:",";font-size:",";color:",";background:",";border:"," "," solid;border-radius:",";&:focus{border-color:",";}"," "," "," outline:none;appearance:none;display:block;width:100%;"],(0,s.Ej)("controlHeight"),(0,s.Ej)("padding"),(t=>t.theme.font.body),(0,s.J)(),(0,s.yW)("Text/Primary"),(0,s.yW)("white"),(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderRadius"),(0,s.yW)("Primary/Base"),(({error:t})=>t&&(0,n.AH)(["border-color:",";"],(0,s.yW)("Danger/Base"))),(({disabled:t})=>t&&(0,n.AH)(["background:",";pointer-events:none;"],(0,s.yW)("Background/Base"))),(({isMulti:t})=>t&&(0,n.AH)(["height:auto;min-height:",";"],(0,s.Ej)("controlHeight"))));a.Select=r;var l=a},64652:function(t,e,i){"use strict";i.d(e,{A:function(){return a}});var n=i(51510),s=i(89227),o=i(11162);const a=(0,n.Ay)(o.A).withConfig({displayName:"Spacer"})(["&&&{width:100%;margin-top:",";"," ","}"],(0,s.Ej)("margin"),(t=>!t.vertical&&(0,n.AH)(["display:block !important;"])),(t=>t.vertical&&(0,n.AH)(["display:inline-block;width:0;margin-top:0;margin-left:",";",""],(0,s.Ej)("margin"),(t=>t.border&&(0,n.AH)(["height:1em;margin-left:calc("," / 2);margin-right:calc("," / 2);border-left:1px solid ",";"],(0,s.Ej)("margin"),(0,s.Ej)("margin"),(0,s.yW)("Misc/Divider"))))))},62409:function(t,e,i){"use strict";i.d(e,{A:function(){return s}});var n=i(51510);var s=n.Ay.div.withConfig({displayName:"FloatingColumn"})(["position:absolute;right:0;"," display:grid;grid-template-columns:","px;"," width:","px;padding-left:15px;overflow:hidden;z-index:1;&::before{content:'';position:absolute;left:-5px;height:100%;width:5px;box-shadow:rgba(0,0,0,0.2) 15px 0 6px 0px;z-index:-1;}",""],(({top:t})=>t&&(0,n.AH)(["top:","px;"],t)),(({width:t})=>t),(({align:t,width:e})=>t&&"right"===t&&(0,n.AH)(["grid-template-columns:","px;"],e-15)),(({width:t})=>t),(({show:t})=>!t&&(0,n.AH)(["visibility:hidden;"])))},40046:function(t,e,i){"use strict";i.d(e,{A:function(){return x}});var n=i(51510),s=i(89227),o=i(87216),a=i(62409);const r={left:"flex-start",center:"center",right:"flex-end"},l=n.Ay.div.withConfig({displayName:"Cell"})(["display:flex;align-items:center;width:100%;padding:",";background:",";justify-content:",";color:",";&:hover{color:",";}"," "," "," "," "," > &{white-space:nowrap;}","{width:100%;}"],(0,s.Ej)("padding","sm"),(0,s.yW)("white"),(t=>r[t.align]),(0,s.yW)("Text/Primary"),(0,s.yW)("Text/Primary"),(({border:t})=>"left"===t&&(0,n.AH)(["border-left:1px solid ",";"],(0,s.yW)("Misc/Divider"))),(({border:t})=>"right"===t&&(0,n.AH)(["border-right:1px solid ",";"],(0,s.yW)("Misc/Divider"))),(({colSpan:t})=>t&&(0,n.AH)(["grid-column:span ",";"],t)),(({expandedCell:t})=>t&&(0,n.AH)(["display:block;"])),(t=>t.minWidth&&`min-width: ${t.minWidth};`),o.A),p=n.Ay.div.withConfig({displayName:"HeadCell"})(["padding:",";background:",";border-bottom:"," solid ",";font-weight:",";text-align:",";"," "," white-space:nowrap;"," ",""],(0,s.Ej)("padding","sm"),(0,s.yW)("white"),(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Wy)("bold"),(t=>t.align||"left"),(t=>t.minWidth&&`min-width: ${t.minWidth};`),(t=>t.noBorder&&"border: none !important;"),(({headerVerticalAlign:t})=>"center"===t&&(0,n.AH)(["display:flex;align-items:center;"])),(({cursor:t})=>t&&(0,n.AH)(["cursor:",";"],t))),c=n.Ay.span.withConfig({displayName:"VisibleOnHover"})([""]),d=n.Ay.div.withConfig({displayName:"Row"})(["display:contents;"," & > form{display:contents;}&:not(:last-child) ","{border-bottom:"," solid ",";}&:first-child ","{border-top:"," solid ",";}&.dragging{","{visibility:hidden;}}"," &.dragging ","{border-bottom:"," solid "," !important;border-top:"," solid "," !important;}",""],(t=>{if(t.columns){let e=t.columns.map((t=>t.width&&"number"===typeof t.width?t.width+"%":t.width||"1fr"));return t.select&&(e=["max-content"].concat(e)),(0,n.AH)(["display:grid;grid-template-columns:",";"],e.join(" "))}}),l,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),l,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),a.A,(t=>t.hoverable&&(0,n.AH)(["cursor:pointer;","{visibility:hidden;}&:hover{> *{background:",";}","{visibility:inherit;}}@media  (max-width:1280px){","{visibility:inherit;}}"],c,(0,s.yW)("Background/Base"),c,c)),l,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(t=>t.expanded&&(0,n.AH)(["&:hover > *,> *,label{background:",";color:",";}"],(0,s.yW)("Primary/Base"),(0,s.yW)("Text/Inverted")))),h=n.Ay.div.withConfig({displayName:"Body"})(["display:contents;"]),u=n.Ay.div.withConfig({displayName:"Head"})(["display:contents;&::after{content:none !important;}"]),m=n.Ay.div.withConfig({displayName:"GroupHeader"})(["padding:"," ",";background-color:",";grid-column-start:1;grid-column-end:inherit;"],(0,s.Ej)("padding","xs"),(0,s.Ej)("padding","lg"),(0,s.yW)("Background/Base")),f=n.Ay.span.withConfig({displayName:"GroupHeaderTitle"})(["font-size:",";font-weight:",";line-height:1.4em;color:",";"],(0,s.J)("md"),(0,s.Wy)("semibold"),(0,s.yW)("Text/Secondary")),g=n.Ay.span.withConfig({displayName:"GroupHeaderSubtitle"})(["font-size:",";line-height:1.4em;font-weight:",";color:",";"],(0,s.J)("md"),(0,s.Wy)("lighter"),(0,s.yW)("Text/Secondary")),b=n.Ay.span.withConfig({displayName:"Dragger"})(["margin-right:",";"," cursor:pointer;"],(0,s.Ej)("margin","sm"),(({noMargin:t})=>t&&(0,n.AH)(["margin-right:0;"]))),v=n.Ay.div.withConfig({displayName:"PositionContainer"})(["position:relative;"]),y=n.Ay.div.withConfig({displayName:"DraggableTable"})(["overflow-x:auto;"," "," "," "," "," ",""],(({hideScrollbar:t})=>t&&(0,n.AH)(["-ms-overflow-style:none;scrollbar-width:none;&::-webkit-scrollbar{display:none;}"])),(({normalOverflow:t})=>!t&&(0,n.AH)(["overflow:visible;"])),(t=>t.rowComponent&&(0,n.AH)(["","{& > *{display:contents;}}"],d)),(({noBorderTop:t})=>t&&(0,n.AH)(["",":first-child ","{border-top:0 !important;}"],d,l)),(({borderBottom:t})=>t&&(0,n.AH)(["",":last-child ","{border-bottom:"," solid ",";}"],d,l,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"))),(({inverseBorders:t})=>t&&(0,n.AH)(["",":not(:first-child) ","{border:none;border-top:"," solid ",";}",":first-child ","{border:none;}"],d,l,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),d,l))),k=n.Ay.div.withConfig({displayName:"Table"})([""," "," "," "," "," "," "," & > div:first-child > ","{border-top:none;}"],(({normalOverflow:t})=>!t&&(0,n.AH)(["overflow-x:auto;"])),(({hideScrollbar:t})=>t&&(0,n.AH)(["-ms-overflow-style:none;scrollbar-width:none;&::-webkit-scrollbar{display:none;}"])),(({borderBottom:t})=>t&&(0,n.AH)(["",":last-child ","{border-bottom:"," solid ",";}"],d,l,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"))),(({noBorderTop:t})=>t&&(0,n.AH)(["",":first-child ","{border-top:0 !important;}"],d,l)),(({inverseBorders:t})=>t&&(0,n.AH)(["",":not(:first-child) ","{border-top:"," solid ",";}"],d,l,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"))),(t=>{if(t.columns){let e=t.columns.map((t=>t.width&&"number"===typeof t.width?t.width+"%":t.width||"1fr"));return t.select&&(e=["max-content"].concat(e)),(0,n.AH)(["display:grid;grid-template-columns:",";grid-column-end:",";label{margin-bottom:0;i.fa-check{margin-right:0 !important;}}"],e.join(" "),e.length+1)}}),(t=>t.rowComponent&&(0,n.AH)(["","{& > *{display:contents;}}"],d)),m),_=n.Ay.div.withConfig({displayName:"GroupContainer"})(["display:contents;grid-column-end:inherit;> ","{border-top:"," solid ",";border-bottom:"," solid ",";grid-column-start:1;grid-column-end:inherit;}"],m,(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"));k.Row=d,k.Cell=l,k.HeadCell=p,k.Head=u,k.Body=h,k.VisibleOnHover=c,k.Dragger=b,k.PositionContainer=v,k.DraggableTable=y,k.GroupContainer=_,k.GroupHeader=m,k.GroupHeaderTitle=f,k.GroupHeaderSubtitle=g;var x=k},2670:function(t,e,i){"use strict";i.d(e,{A:function(){return r}});var n=i(51510),s=i(89227),o=i(7120),a=i(54243);var r=(0,n.Ay)(a.A).withConfig({displayName:"TextArea"})([""," "," ",""],(({nowrap:t})=>t&&(0,n.AH)(["white-space:pre;overflow-wrap:normal;overflow-x:scroll;"])),(({monospace:t})=>t&&(0,n.AH)(["font-family:monospace;"])),(({theme:t})=>(0,s.Ch)((0,o.A)(t))))},53908:function(t,e,i){"use strict";var n=i(96540),s=i(5556),o=i.n(s);function a({id:t,children:e}){const i=(0,n.useRef)(null);return(0,n.useEffect)((()=>{new URL(window.location.href).hash.replace("#","")===t&&i.current.scrollIntoView()}),[t]),n.createElement("span",{ref:i,id:t},e)}a.displayName="Anchor",a.propTypes={children:o().node,id:o().string.isRequired},e.A=a},50264:function(t,e,i){"use strict";i.d(e,{A:function(){return u}});var n=i(96540),s=i(5556),o=i.n(s),a=i(37584),r=i.n(a),l=i(55955),p=i(60857),c=i(46784),d=i(79656);function h(){return h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},h.apply(null,arguments)}class u extends n.Component{static displayName="Checkbox";static propTypes=(()=>({id:o().string,label:o().any,labelImage:o().node,description:o().oneOfType([o().node,o().string,o().func]),field:o().object,disabled:o().bool,"data-tid":o().string,form:o().object,children:o().oneOfType([o().node,o().string,o().func]),modifiers:o().any}))();constructor(t){super(t),this.state={id:t.id||r()()}}get icon(){const t=this.props.field.value;return t&&"partial"===t?d.EZy:d.e68}handleChange=t=>{this.props.field&&this.props.field.onChange&&this.props.field.onChange(t.target.checked)};render(){const{label:t,labelImage:e,description:i,field:s,disabled:o,id:a,children:r,modifiers:d,...u}=this.props,m=a||this.state.id,f=s.value||"",g="object"===typeof d?d:{self:d};return n.createElement(n.Fragment,null,n.createElement(l.A,h({modifiers:g.self,withLabel:t,htmlFor:m,disabled:o,value:s.value},u),n.createElement(p.A,{modifiers:g.icon},n.createElement(c.g,{icon:this.icon})),n.createElement(l.A.Input,{id:m,name:s.name,onChange:this.handleChange,checked:f}),e&&e,t&&n.createElement(l.A.Label,{modifiers:g.label,htmlFor:m},t),i&&n.createElement(l.A.Description,null,i)),r&&n.createElement(l.A.Children,null,r))}}u.displayName="Checkbox"},9585:function(t,e,i){"use strict";i.d(e,{A:function(){return S}});var n=i(96540),s=i(40961),o=i(5556),a=i.n(o),r=i(32389),l=i(51510),p=i(89227),c=i(62478),d=i(74310),h=i(55954),u=i(56863),m=i(11162);const f=(0,l.Ay)(m.A).withConfig({displayName:"Cleanstate"})(["position:relative;","{display:flex;justify-content:center;align-items:center;min-height:","px;margin-bottom:0;text-align:center;}","{font-size:",";font-weight:",";margin:"," 0;}","{font-size:",";font-weight:",";color:",";}"],d.A,(t=>t.noMinHeight?"0":"250"),h.A,(0,p.J)("xl"),(0,p.Wy)("semibold"),(0,p.Ej)("margin","sm"),u.A,(0,p.J)("lg"),(0,p.Wy)("lighter"),(0,p.yW)("Text/Secondary")),g=l.Ay.div.withConfig({displayName:"BigIcon"})(["","{color:",";font-size:",";}"],c.A,(0,p.yW)("Text/Secondary"),(0,p.zA)("12"));f.BigIcon=g;var b=f,v=i(8537),y=i(33376),k=i(64652),_=i(28258),x=i(82771),C=i(32191),w=i(65821),A=i(9873);function E(){return E=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},E.apply(null,arguments)}class T extends n.Component{static displayName="Cleanstate";static propTypes=(()=>({icon:a().string,children:a().oneOfType([a().node,a().string,a().func]),loading:a().bool,iconStyle:a().string,arrow:a().object,title:a().oneOfType([a().node,a().string,a().func]),description:a().oneOfType([a().node,a().string,a().func]),link:a().string,modifiers:a().oneOfType([a().string,a().object]),noMinHeight:a().bool,handwriting:a().object,hideIfFoundSelector:a().string,t:a().func}))();componentWillUnmount(){this.timer&&clearTimeout(this.timer)}render(){const{icon:t,loading:e,children:i,iconStyle:o,arrow:a,title:r,description:l,link:p,modifiers:c,noMinHeight:d,handwriting:m,hideIfFoundSelector:f,t:g}=this.props;let T=m;this.timer&&clearTimeout(this.timer),m&&m.hideIfFoundSelector&&(this.timer=setTimeout((()=>{this.forceUpdate()}),200),document.querySelector(m.hideIfFoundSelector)&&(T=!1));const S="object"===typeof c?c:{self:c};return n.createElement(n.Fragment,null,a&&(0,s.createPortal)(n.createElement(x.B,E({color:A.yW.black,width:2,zIndex:29,hideIfFoundSelector:f},a)),document.body),n.createElement(b,{modifiers:S.self,noMinHeight:d},n.createElement(v.A,{noMax:!0,noBackground:!0},!e&&n.createElement(b.BigIcon,null,n.createElement(y.A,{icon:t,style:o||"far"})),e&&n.createElement(_.A,{size:"xxl",color:"primary"}),n.createElement(k.A,{size:"md"}),r&&n.createElement(h.A,{modifiers:S.title},r),l&&n.createElement(u.A,{modifiers:S.description},l),T&&n.createElement(C.A,{id:"handwriting",top:m.top,left:m.left,right:m.right,modifiers:"font-size-xl"},m.text),p&&n.createElement(n.Fragment,null,n.createElement(k.A,null),n.createElement(w.A,{href:p,modifiers:"font-size-mdplus"},g("common.learn_more"))),i)))}}T.displayName="Cleanstate";var S=(0,r.CI)()(T)},60747:function(t,e,i){"use strict";var n=i(96540),s=i(5556),o=i.n(s),a=i(69733),r=i(55373),l=i.n(r),p=i(95950),c=i.n(p),d=i(63375),h=i.n(d),u=i(2404),m=i.n(u),f=i(94506),g=i.n(f),b=i(32389),v=i(23576),y=i(9585),k=i(62704),_=i(64652);function x(){return x=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},x.apply(null,arguments)}class C extends n.Component{static displayName="Collection";static propTypes=(()=>({children:o().node.isRequired,fetchCollection:o().func,onFetchedCollection:o().func,fetchAdditional:o().func,fetchOnMount:o().bool,fetchInterval:o().number,strategy:o().oneOf(["default","append"]),paginate:o().bool,paginatePosition:o().oneOf(["left","right"]),per:o().number,page:o().number,renderCleanstate:o().oneOfType([o().func,o().bool]),sort:o().string,preserveStateSorting:o().bool,filters:o().object,persistParams:o().bool,collection:o().object,hideLoadMore:o().bool,modifiers:o().object,t:o().func}))();static defaultProps={page:1,per:20,filters:{},sort:"-created_at",fetchOnMount:!0,strategy:"default"};constructor(t){super(t),this.state={page:t.page,total:0,meta:{},sort:t.sort,ids:[],filters:t.filters,loading:!1}}componentDidMount=()=>{const{persistParams:t,fetchOnMount:e,page:i,sort:n,filters:s,fetchInterval:o}=this.props;o&&(this.interval=setInterval(this.handleFetchCollection,o)),t?setTimeout((()=>{const t=l().parse(window.location.href.split("?")[1]);t.filters&&Object.keys(t.filters).forEach((e=>{"true"===t.filters[e]&&(t.filters[e]=!0),"false"===t.filters[e]&&(t.filters[e]=!1)})),this.setState({page:t.page||i,sort:t.sort||n,filters:t.filters||s},(()=>{e&&this.handleFetchCollection()}))}),0):e&&this.handleFetchCollection()};componentDidUpdate=t=>{const e=t.fetchCollection?.toString()!==this.props.fetchCollection?.toString(),i=t.children?.type?.toString()!==this.props.children?.type?.toString();!m()(t.filters,this.props.filters)&&this.handleUpdateFilters(),this.props.children&&(e||i)&&this.handleFetchCollection()};componentWillUnmount=()=>{this.interval&&clearInterval(this.interval)};get records(){const{collection:t,preserveStateSorting:e}=this.props,{ids:i}=this.state;if(!t)return[];const n={};return e?t.getById?t.filter((t=>i.includes(t.id))):(Object.keys(t).forEach((e=>{i.includes(e)&&(n[e]=t[e])})),n):t.getById?t.getById(i):(i.forEach((e=>{n[e]=t[e]})),n)}get canLoadMore(){const{per:t,strategy:e}=this.props,{page:i,total:n}=this.state;return i*t<n&&"append"===e}updateURL=()=>{if(!this.props.persistParams)return;const t=l().parse(window.location.href.split("?")[1]),e=(({page:e,sort:i,filters:n})=>({...t,page:e,sort:i,filters:n}))(this.state);window.history.pushState({},"",l().stringify(e,{addQueryPrefix:!0,skipNulls:!0}))};handleSort=t=>{t!==this.state.sort&&this.setState({sort:t},this.handleFetchCollection)};handleUpdateFilters=()=>{this.setState({filters:this.props.filters,page:1},this.handleFetchCollection)};handleFilter=t=>{this.setState({filters:t,page:1},this.handleFetchCollection)};handlePageChange=t=>{this.setState({page:t},this.handleFetchCollection)};handleUpdateCollection=({filters:t,sort:e})=>{const i={};t&&(i.filters=t,i.page=1),e&&(i.sort=e),this.setState(i,this.handleFetchCollection)};handleScroll=t=>{const e=t.target,i=e.scrollHeight-e.clientHeight,n=100/i*100*5;e.scrollTop>=i-n&&this.handleLoadMore()};handleLoadMore=()=>{const{per:t}=this.props,{ids:e,total:i,page:n,loading:s}=this.state;Math.min(e.length,n*t)<i&&!s&&this.setState({page:n+1},this.handleFetchCollection)};handleInsertRecords=t=>{const e=h()(this.state.ids.concat(t));return this.setState({ids:e})};handleFetchCollection=()=>{const{page:t,sort:e,filters:i}=this.state,{per:n,fetchAdditional:s,fetchCollection:o,strategy:a,onFetchedCollection:r}=this.props;if(o)return this.updateURL(),this.setState({loading:!0}),o?.({page:t,per:n,sort:e,filters:i}).then((e=>{let i=[];e.payload.response?.data?i=[e.payload.response.data].flat().map((t=>t.id)):e.payload.records&&(i=c()(e.payload.records));const n=e.payload.response.meta||{},o=g()([n.total_count,n.stats?.total?.count]);"append"===a&&1!==t&&(i=h()(this.state.ids.concat(i))),this.setState({ids:i,total:o,meta:n,loading:!1},(()=>{r&&r(this.records)})),s&&s(i)}))};renderCleanstate=()=>"function"===typeof this.props.renderCleanstate?this.props.renderCleanstate():this.props.renderCleanstate?n.createElement(y.A,{icon:"search",loading:this.state.loading},!this.state.loading&&this.props.t("common.nothing_found")):null;renderLoadMore=()=>{const{per:t}=this.props,{page:e,total:i}=this.state,s=i-e*t,o=Math.min(s,t);return this.canLoadMore?n.createElement(n.Fragment,null,n.createElement(_.A,null),n.createElement(k.A,{block:!0,color:"white","data-tid":"Collection load more",onClick:this.handleLoadMore},this.props.t("common.load_count_more",{count:o}))):null};renderPagination=t=>{const{per:e,paginatePosition:i,modifiers:s}=this.props,{page:o,total:a}=this.state;return n.createElement(v.A,x({paginatePosition:i,page:o,per:e,total:a,onPageChange:this.handlePageChange,modifiers:s?.paginator},t))};render(){const{children:t,paginate:e,per:i,hideLoadMore:s}=this.props,{sort:o,filters:a,page:r,total:l,loading:p,meta:c}=this.state,d=l<=0&&this.renderCleanstate(),h=l-r*i,u=Math.min(h,i);return t?n.createElement(n.Fragment,null,d||(0,n.cloneElement)(t,{records:this.records,sort:o,filters:a,onSort:this.handleSort,onFilter:this.handleFilter,onPageChange:this.handlePageChange,onScroll:this.handleScroll,onLoadMore:this.handleLoadMore,refresh:this.handleFetchCollection,insertRecords:this.handleInsertRecords,updateCollection:this.handleFetchCollection,renderLoadMore:this.renderLoadMore,renderPagination:this.renderPagination,onUpdateCollection:this.handleUpdateCollection,canLoadMore:this.canLoadMore,moreCount:u,total:l,loading:p,...c}),e&&this.renderPagination(),!s&&this.renderLoadMore()):null}}C.displayName="Collection";e.A=(0,b.CI)()((0,a.Ng)(((t,e)=>{let i;return i=e.getCollectionFromState?e.getCollectionFromState(t):t.orm[e.model],{collection:i}}),null)(C))},8537:function(t,e,i){"use strict";i.d(e,{A:function(){return l}});var n=i(96540),s=i(5556),o=i.n(s),a=i(74310);function r(){return r=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r.apply(null,arguments)}class l extends n.Component{static displayName="ContentBlock";static propTypes=(()=>({title:o().oneOfType([o().node,o().object]),description:o().oneOfType([o().node,o().object]),titleLink:o().node,children:o().node,footer:o().node,clean:o().bool,tableFit:o().bool,"data-tid":o().string,modifiers:o().oneOfType([o().string,o().object])}))();render(){const{title:t,titleLink:e,description:i,children:s,footer:o,clean:l,tableFit:p,"data-tid":c,modifiers:d,...h}=this.props,u="object"===typeof d?d:{self:d};return n.createElement(a.A,r({clean:l,"data-tid":c,tableFit:p,modifiers:u.self},h),t&&n.createElement(a.A.Title,{description:i,modifiers:u.title},t,e&&n.createElement(a.A.TitleLink,null,e)),i&&n.createElement(a.A.Description,{modifiers:u.description},i),n.createElement(a.A.Content,{modifiers:u.content},s),o&&n.createElement(a.A.Footer,{modifiers:u.footer},o))}}l.displayName="ContentBlock"},82771:function(t,e,i){"use strict";i.d(e,{B:function(){return p}});var n=i(96540),s=i(5556),o=i.n(s);const a="undefined"===typeof window,r=(t,e,i)=>{let n=Math.min(t,i),s=Math.max(t,i);if(t-2*e+i!==0){const o=(t-e)/(t-2*e+i);if(o>0&&o<1){const a=((t,e,i,n)=>e+(1-n)*(1-n)*(t-e)+n*n*(i-e))(t,e,i,o);n=Math.min(n,a),s=Math.max(s,a)}}return[Math.round(n),Math.round(s)]},l=(t,e,i={x:0,y:0})=>{const n=e.width/2,s=e.height/2;let o;switch(t){case"top":o={x:0,y:-s};break;case"top-right":o={x:n,y:-s};break;case"top-left":o={x:-n,y:-s};break;case"right":o={x:n,y:0};break;case"bottom":o={x:0,y:s};break;case"bottom-right":o={x:n,y:s};break;case"bottom-left":o={x:-n,y:s};break;case"left":o={x:-n,y:0}}return{x:o.x+i.x,y:o.y+i.y}},p=({fromSelector:t="body",toSelector:e=t,fromPosition:i="right",toPosition:s="left",fromOffset:o={x:0,y:0},toOffset:p={x:0,y:0},middleX:c=0,middleY:d=0,width:h=8,color:u="black",hideUnderWidth:m=0,hideIfFoundSelector:f,debugLine:g=!1,zIndex:b=0})=>{const v=(0,n.useRef)(null),y=(0,n.useRef)(null),k=(0,n.useCallback)((()=>{const n=v.current;if(!n)return;const a=document.querySelector(t),y=document.querySelector(e);if(!a||!y)return;if(f&&document.querySelector(f)){const t=n.getContext("2d");if(!t)return;return void t.clearRect(0,0,n.width,n.height)}const k=a.getBoundingClientRect(),_=y.getBoundingClientRect(),x=l(i,k,o),C=l(s,_,p),w=k.left+k.width/2+x.x,A=k.top+k.height/2+x.y+window.scrollY,E=_.left+_.width/2+C.x,T=_.top+_.height/2+C.y+window.scrollY,S={p0x:w,p0y:A,p1x:(w+E)/2+c,p1y:(A+T)/2-d,p2x:E,p2y:T,size:30,lineWidth:h,strokeStyle:u},P=r(S.p0x,S.p1x,S.p2x),O=r(S.p0y,S.p1y,S.p2y),j=S.size-S.lineWidth,D=P[0]-j,$=P[1]+j,B=O[0]-j,N=O[1]+j,I=S.p0x-D,H=S.p0y-B,F=S.p1x-D,W=S.p1y-B,L=S.p2x-D,M=S.p2y-B;n.style.position="absolute",n.style.pointerEvents="none",n.style.top=B+"px",n.style.left=D+"px",n.width=$-D,n.height=N-B,m>0&&(n.style.display=window.matchMedia(`(max-width: ${m}px)`).matches?"none":"inline-block"),b&&(n.style.zIndex=String(b));const R=n.getContext("2d");if(!R)return;g&&(R.arc(I,H,10,0,2*Math.PI),R.stroke(),R.arc(F,W,10,0,2*Math.PI),R.stroke(),R.arc(L,M,10,0,2*Math.PI),R.stroke()),R.strokeStyle=S.strokeStyle,R.lineWidth=S.lineWidth,R.lineJoin="round",R.lineCap="round",R.beginPath(),R.moveTo(I,H),R.quadraticCurveTo(F,W,L,M),R.stroke();const z=Math.atan2(M-W,L-F);R.translate(L,M),R.rotate(z+1),R.beginPath(),R.moveTo(0,S.size),R.lineTo(0,0),R.stroke(),R.rotate(-2),R.lineTo(0,-S.size),R.stroke(),R.rotate(1-z),R.translate(-L,-M)}),[t,e,i,s,o,p,c,d,h,u,m,f,g,b]);return(0,n.useEffect)((()=>{if(a)return;const i=document.querySelector(t),n=document.querySelector(e);return i&&n?(k(),y.current=new ResizeObserver(k),y.current.observe(i),i!==n&&y.current.observe(n),window.addEventListener("resize",k),()=>{y.current?.disconnect(),window.removeEventListener("resize",k)}):void 0}),[k,t,e]),a?null:n.createElement("canvas",{ref:v})};p.displayName="CurvedArrow",p.propTypes={fromSelector:o().string,toSelector:o().string,fromPosition:o().oneOf(["top","top-right","top-left","right","bottom","bottom-right","bottom-left","left"]),toPosition:o().oneOf(["top","top-right","top-left","right","bottom","bottom-right","bottom-left","left"]),fromOffset:o().shape({x:o().number,y:o().number}),toOffset:o().shape({x:o().number,y:o().number}),middleX:o().number,middleY:o().number,width:o().number,color:o().string,hideUnderWidth:o().number,hideIfFoundSelector:o().string,debugLine:o().bool,zIndex:o().number}},25980:function(t,e,i){"use strict";i.d(e,{A:function(){return x}});var n=i(96540),s=i(40961),o=i(5556),a=i.n(o),r=i(69739),l=i(37584),p=i.n(l),c=i(90179),d=i.n(c),h=i(62193),u=i.n(h),m=i(64974),f=i(4124),g=i.n(f);var b=(t,e)=>t([`common.date_time_input_placeholders.${g()(e)}`,e]),v=i(72134),y=i(71233);function k(){return k=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},k.apply(null,arguments)}class _ extends n.Component{static displayName="DateTimeInput";constructor(t){super(t),this.state={errors:{},focused:!1,isValid:null,isDirty:!1},this.splitFormat=this.props.format.split(/[- / :]/gm)}static defaultProps={field:{}};static propTypes=(()=>({size:a().oneOf(["sm","md","lg"]),onClick:a().func,next:a().func,format:a().string.isRequired,placeholder:a().any,disabled:a().bool,inputRef:a().func,onBlur:a().func,field:a().shape({name:a().string,value:a().oneOfType([a().string,a().instanceOf(Date)]),onChange:a().func,onFocus:a().func,onBlur:a().func,onInvalid:a().func,onKeyUp:a().func,validate:a().func}),t:a().func}))();componentDidMount=()=>{this.setStateFromProps(),document.addEventListener("click",this.handleClickOutside,!0)};componentWillUnmount=()=>{document.removeEventListener("click",this.handleClickOutside,!0)};componentDidUpdate=t=>{if(t.format!==this.props.format)return this.splitFormat=this.props.format.split(/[- :]/gm),this.setStateFromProps();t.field.value!==this.props.field.value&&this.setStateFromProps()};valueLengthForUnit=t=>"A"===t?2:t.length;AMPMInFormat=()=>!!this.props.format.match(/A/gm);setStateFromProps=()=>{const{field:t}=this.props,e={isValid:!0,errors:{}},i=t.value?(0,m.Ay)(t.value):(0,m.Ay)();i.isValid()&&(this.splitFormat.forEach((t=>{e[t]=i.format(t)})),this.setState(e))};handleChange=(t,e)=>{let i=e.target.value;if(i.length>this.valueLengthForUnit(t))return!0;if("A"!==t&&!i?.match(/^[0-9]*$/))return!0;if("A"===t&&!i?.match(/^[ap]m?$/i))return!0;if("A"===t&&i?.match(/^[ap]$/i)&&(i=i.toUpperCase()+"M"),this.setState({[t]:i,isDirty:!0},(()=>{t===this.splitFormat[this.splitFormat.length-1]&&this.validateAndUpdateValue()})),i.length===this.valueLengthForUnit(t)){const e=this[this.splitFormat.indexOf(t)+1+"_input"];e?window.setTimeout((()=>{e.focus()}),0):this.props.next?.()}};validateAndUpdateValue=()=>{const t=["YYYY","MM","DD",this.AMPMInFormat()?"hh":"HH","mm"],{field:e,format:i}=this.props;let n=this.props.format;this.splitFormat.forEach((t=>{n=n.replace(t,this.state[t])}));const s=(0,m.Ay)(n,i,!0),o=s.isValid();let a,r=!0;if("function"===typeof e.validate&&(r=e.validate(s)),o&&!0===r)return this.setState({isValid:!0,isDirty:!1,errors:{}}),void e.onChange?.(s.toJSON());a="string"===typeof r?r:t[s.invalidAt()];const l={isValid:!1};a&&(l.errors={[a]:"invalid"}),this.setState(l),e.onInvalid?.()};setFocus=t=>{"INPUT"!==t.target.nodeName&&this.focus(t),this.setState({focused:!0}),this.props.onClick&&this.props.onClick()};focus=t=>{const{field:e}=this.props;e.onFocus?.(t),setTimeout((()=>{const t=this["0_input"];t&&t.focus()}),100)};handleFocus=(t,e)=>{const{field:i}=this.props;this.selectUnit(t,e),i.onFocus&&i.onFocus(e)};handleMouseUp=(t,e)=>{this.selectUnit(t,e)};selectUnit=(t,e)=>{const i=this[this.splitFormat.indexOf(t)+"_input"];i&&i.select()};handleClickOutside=t=>{const e=(0,s.findDOMNode)(this);!this.state.focused||e&&e.contains(t.target)||this.setState({focused:!1})};handleKeyUp=(t,e)=>{const{field:i}=this.props;if("A"===t&&"Backspace"===e.key){const t={target:{value:""}};this.handleChange("A",t)}if("ArrowRight"===e.key&&e.target.selectionStart===this.valueLengthForUnit(t)){const e=this[this.splitFormat.indexOf(t)+1+"_input"];e?.focus()}if("ArrowLeft"===e.key){const e=this[this.splitFormat.indexOf(t)-1+"_input"];e?.focus()}i.onKeyUp?.(e)};handleBlur=(t,e)=>{const{onBlur:i,field:n}=this.props;"YY"!==t&&e.target.value.length<t.length&&this.handleChange(t,{target:{value:`0${e.target.value}`}}),this.state.isDirty?(i?.({target:{value:e.target.value,name:n.name}}),this.validateAndUpdateValue()):t===this.splitFormat[this.splitFormat.length-1]&&i?.({target:{value:e.target.value,name:n.name}})};render(){const{field:t,format:e,placeholder:i,inputRef:s,disabled:o,size:a}=this.props,{focused:l,errors:c}=this.state,h=(0,v.A)(),m=d()(this.props,["value","format","placeholder","inputRef","onKeyUp","onChange","onClick","onBlur"]);return n.createElement(r.A,k({size:a,ampm:this.AMPMInFormat(),ref:s,onClick:this.setFocus,onFocus:this.setFocus,disabled:o},m),t.value instanceof Date||!u()(t.value)||l?e.match(/(\w+|[- / :])/gm).map((t=>{if(t.match(/\w/)){const e=this.splitFormat.indexOf(t);return n.createElement(r.A.Input,{size:a,key:t,ref:t=>{this[e+"_input"]=t},type:"text",name:t,value:this.state[t]||"",invalid:c[t],placeholder:t,className:t,onChange:this.handleChange.bind(null,t),onFocus:this.handleFocus.bind(null,t),onMouseUp:this.handleMouseUp.bind(null,t),onKeyUp:this.handleKeyUp.bind(null,t),onBlur:this.handleBlur.bind(null,t),onTouchEnd:this.handleFocus.bind(null,t),disabled:h||o,autoComplete:"off"})}return n.createElement(r.A.Seperator,{size:a,lighter:":"===t,key:p()()},t)})):n.createElement(r.A.Input,{size:a,onFocus:this.focus,placeholder:b(this.props.t,i),name:t.name||"datetimeinput_placeholder"}))}}_.displayName="DateTimeInput";var x=(0,y.C)()(_)},75906:function(t,e,i){"use strict";i.d(e,{A:function(){return l}});var n=i(96540),s=i(5556),o=i.n(s),a=i(33376),r=i(50558);class l extends n.Component{static displayName="DayPickerNavigation";static propTypes=(()=>({className:o().string,onPreviousClick:o().func.isRequired,onNextClick:o().func.isRequired,showNextButton:o().bool,showPreviousButton:o().bool}))();handleClickNext=()=>{this.props.onNextClick()};handleClickPrevious=()=>{this.props.onPreviousClick()};render(){const{showNextButton:t,showPreviousButton:e,className:i}=this.props;return n.createElement("div",{className:i},e&&n.createElement(r.A.NavigationPrevious,{tabIndex:"0","data-tid":"Previous month",role:"button",onClick:this.handleClickPrevious},n.createElement(a.A,{icon:"chevron-left",svg:!0})),t&&n.createElement(r.A.NavigationNext,{tabIndex:"0","data-tid":"Next month",role:"button",onClick:this.handleClickNext},n.createElement(a.A,{icon:"chevron-right",svg:!0})))}}l.displayName="DayPickerNavigation"},78246:function(t,e,i){"use strict";i.d(e,{A:function(){return P}});var n=i(96540),s=i(5556),o=i.n(s),a=i(50558),r=i(75906);const l=({day:t})=>n.createElement("div",{className:"DayPicker-Day__wrapper"},n.createElement("div",{className:"DayPicker-Day__inner"},n.createElement("div",{className:"DayPicker-Day__date"},t.getDate())));l.displayName="Day",l.propTypes={day:o().instanceOf(Date).isRequired};var p=i(4353),c=i(92317),d=i.n(c),h=i(1882),u=i.n(h),m=i(56449),f=i.n(m),g=i(23805),b=i.n(g),v=i(83602),y=i.n(v),k=i(55378),_=i.n(k),x=i(73916),C=i.n(x),w=i(64974);function A(){return A=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},A.apply(null,arguments)}const E=o().oneOfType([o().shape({before:o().instanceOf(Date),after:o().instanceOf(Date)}),o().shape({from:o().instanceOf(Date),to:o().instanceOf(Date)}),o().shape({daysOfWeek:o().array}),o().func,o().array]);let T="en";T=void 0!==navigator.languages?navigator.languages[0]:navigator.language;let S=1;i(90952)("./"+T).then((()=>{w.Ay.locale(T),S=w.Ay.localeData(T).firstDayOfWeek(),window.booqableOptions&&(window.booqableOptions.locale=T.split("-")[0],window.booqableOptions.firstDayOfWeek=S)})).catch((()=>{S=(0,w.Ay)().locale(navigator.language).weekday(0).day()}));class P extends n.Component{constructor(t){super(t),this.state={from:t.from||null,to:t.to||null,currentSelection:null,hover:null,currentMonth:null}}static displayName="DayPicker";static propTypes=(()=>({from:o().instanceOf(Date),to:o().instanceOf(Date),currentMonth:o().instanceOf(Date),blockedDays:E,modifiers:E,cancelAutofocus:o().bool,firstDayOfWeek:o().any,translate:o().bool,currentSelection:o().string,selection:o().func,onChange:o().func,onRef:o().func,forceUTC:o().bool,withAvailability:o().bool,clearCacheRef:o().func,handleMouseEnter:o().func,handleMouseLeave:o().func,renderDay:o().func}))();static defaultProps=(()=>({currentMonth:new Date,cancelAutofocus:!1,firstDayOfWeek:1,forceUTC:!0}))();componentDidMount=()=>{const{focusFrom:t,focusTo:e}=this;this.props.onRef&&this.props.onRef({focusFrom:t,focusTo:e}),this.props.clearCacheRef?.(this.clearDayStateCache)};componentWillUnmount=()=>{this.props.onRef&&this.props.onRef(null)};componentDidUpdate=t=>{const{from:e,to:i}=this.props,n={};e!==t.from&&(n.from=e),i!==t.to&&(n.to=i),void 0===n.to&&void 0===n.from||this.setState(n)};focusFrom=()=>{this.setState({currentSelection:"from"},(()=>{this.ref.showMonth(this.state.from)}))};focusTo=()=>{this.setState({currentSelection:"to"},(()=>{this.ref.showMonth(this.state.to)}))};clearDayStateCache=()=>{this.dayStateCache={}};handleDayClick=(t,e)=>{if(e.disabled)return;const i={},n=this.state.currentSelection||"from",{cancelAutofocus:s,forceUTC:o}=this.props,a=this.state[n]||new Date,r=(0,w.Ay)(a).format("HH:mm"),l=o?(0,w.Rz)(t).format("YYYY-MM-DD"):(0,w.Ay)(t).format("YYYY-MM-DD");if(t=(0,w.Ay)(`${l} ${r}`),i[n]=t.toDate(),"from"===n){if(s||(i.currentSelection="to"),this.state.to){(0,w.Ay)(this.state.to).diff(t,"months",!0)>1&&(i.currentMonth=(0,w.Ay)(this.state.to).subtract(1,"month").toDate())}if(t>=this.state.to){const e=(0,w.Ay)(this.state.to).hour(),n=(0,w.Ay)(this.state.to).minutes(),s=t.clone().hour(e).minutes(n).toDate(),o=t.clone().toDate();s.getTime()>o.getTime()?i.to=s:i.to=o}}else if(s||(i.currentSelection="from",i.hover=null),t<=this.state.from){const e=(0,w.Ay)(this.state.from).hour(),n=(0,w.Ay)(this.state.from).minutes(),s=t.clone().hour(e).minutes(n).toDate(),o=t.clone().subtract(1,"hour").toDate();s.getTime()>o.getTime()?i.from=s:i.from=o}this.setState(i,this.handleChange)};handleChange=()=>{const{from:t,to:e}=this.state;t&&e&&this.props.onChange&&this.props.onChange({from:t,to:e})};handleMouseEnter=t=>{this.setState({hover:t}),this.props.handleMouseEnter?.(t)};handleMouseLeave=t=>{const{hover:e}=this.state;(e&&e.getTime())===(t&&t.getTime())&&this.setState({hover:null}),this.props.handleMouseLeave?.(t)};selectionToRange=t=>{const{currentSelection:e,hover:i}=t;let n=new Date(t.from&&t.from.getTime()),s=new Date(t.to&&t.to.getTime());return null!==i&&n?(n&&(n=(0,w.Ay)(n).startOf("day").toDate()),s&&(s=(0,w.Ay)(s).endOf("day").toDate()),"from"===(this.props.currentSelection||e||"from")?i>s?{}:{from:i,to:s}:{to:i,from:n}):{}};offsetModifiers=t=>this.props.forceUTC?u()(t)?e=>t((0,w.Rz)(e)):y()(t)?(0,w.sp)(t,!0).toDate():f()(t)?_()(t,(t=>this.offsetModifiers(t))):b()(t)?C()(t,(t=>this.offsetModifiers(t))):t:t;isDayDisabled=({disabledDays:t,modifierFrom:e},i)=>{const n=this.state.currentSelection||this.props.currentSelection;let s;if(this.dayStateCache=this.dayStateCache||{},s="from"===n?i.getTime():`${e.getTime()}-${i.getTime()}`,this.dayStateCache[s])return this.dayStateCache[s];{const e=this.offsetModifiers(t),n=c.ModifiersUtils.dayMatchesModifier(i,e);return this.dayStateCache[s]=n,n}};renderDay=t=>n.createElement(l,{day:t});render(){const{currentSelection:t,from:e,to:i}=this.state,{currentMonth:s,modifiers:o,blockedDays:l,selection:c,translate:h,...u}=this.props,m=(c||this.selectionToRange)(this.state),f=m?.from,g=m?.to,b=(0,w.Ay)(e).startOf("day").toDate(),v={from:b,to:i,selection:m,selected:{from:b,to:i},selectionStart:f,selectionEnd:g,past:{before:new Date},...o};if((0,w.Ay)(f).isSame((0,w.Ay)(i),"day")&&e<f&&(v.selectionStartWithPeviousPeriod=f),i){let e=this.state[this.props.currentSelection||t||"from"];e&&(e=(0,w.Ay)(e).startOf("day").toDate()),v.focused=e}let y=[].concat(l);return"to"===t&&(y=y.concat([{before:b}])),S=null!=this.props.firstDayOfWeek?parseInt(this.props.firstDayOfWeek):parseInt(h?S:"1"),n.createElement(a.A,null,n.createElement(d(),A({navbarElement:r.A,modifiers:this.offsetModifiers(v),disabledDays:this.isDayDisabled.bind(null,{disabledDays:y,modifierFrom:b}),onDayClick:this.handleDayClick,month:this.state.currentMonth||s},u,{onDayMouseEnter:t=>{this.handleMouseEnter(t)},onDayMouseLeave:t=>{this.handleMouseLeave(t)},renderDay:this.props.renderDay||this.renderDay,ref:t=>this.ref=t,localeUtils:p.default,locale:window.locale,firstDayOfWeek:S,tabIndex:-1})))}}P.displayName="DayPicker"},6917:function(t,e,i){"use strict";var n=i(96540),s=i(5556),o=i.n(s),a=i(57389),r=i(62193),l=i.n(r),p=i(95349);const c=t=>{const[e,i]=(0,n.useState)(!0),s=(0,n.useRef)();(0,n.useEffect)((()=>{i(!0),o()}),[t.coordinates]);const o=()=>{if(s.current&&s.current.src){const e=l()(t.coordinates)?{x:0,y:0}:t.coordinates;new a.N(s.current,{focus:e}),i(!1)}};return n.createElement(p.A,{size:t.size,width:t.width,height:t.height,selected:t.selected,noBorder:t.noBorder,noBorderRadius:t.noBorderRadius,maintainAspect:t.maintainAspect,onClick:t.onClick,"data-tid":t.target,"data-tip":t.tip,cursor:t.cursor,inline:t.inline},t.children&&(0,n.cloneElement)(t.children),t.preview&&e&&n.createElement(p.A.Preview,{src:`data:image/jpeg;base64,${t.preview}`}),n.createElement(p.A.Image,{isLoading:e,src:t.url,ref:s,onLoad:o,alt:t.alt}))};c.displayName="FocalImage",c.displayName="FocalImage",c.propTypes={coordinates:o().object,url:o().string,selected:o().bool,children:o().node,size:o().string,width:o().string,height:o().string,noBorder:o().bool,noBorderRadius:o().bool,preview:o().string,maintainAspect:o().bool,onClick:o().func,target:o().string,tip:o().string,cursor:o().string,alt:o().string,inline:o().bool},e.A=c},59194:function(t,e,i){"use strict";i.d(e,{fv:function(){return g},fI:function(){return p}});var n=i(96540),s=i(5556),o=i.n(s),a=i(23197),r=i(53908);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},l.apply(null,arguments)}class p extends n.Component{static displayName="Row";static propTypes=(()=>({children:o().node,anchor:o().bool,id:o().string}))();render(){const{children:t,anchor:e,id:i,...s}=this.props;return n.createElement(a.A,l({className:"row",id:i},s),e&&n.createElement(r.A,{id:i}),t)}}p.displayName="Row";var c=i(44383),d=i.n(c),h=i(52420),u=i.n(h),m=i(21227);function f(){return f=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},f.apply(null,arguments)}class g extends n.Component{static displayName="col";static propTypes=(()=>({children:o().node}))();computeClassName(){const t=["xs","sm","md","lg"],e=d()(this.props,t),i=d()(this.props?.offset,t),n=[];return u()(e,((t,e)=>{n.push(`col-${e}-${t}`)})),u()(i,((t,e)=>{n.push(`col-${e}-offset-${t}`)})),[...n,...this.props.classes||[]].join(" ")}render(){const{children:t,xs:e,sm:i,md:s,lg:o,xl:a,...r}=this.props;return n.createElement(m.A,f({className:this.computeClassName(),children:t},r))}}g.displayName="Col"},45517:function(t,e,i){"use strict";var n=i(96540),s=i(5556),o=i.n(s),a=i(17530),r=i(33376);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},l.apply(null,arguments)}const p=({field:t,type:e="text",size:i="md",loading:s,icon:o,inputRef:p,autoFocus:c,preventFocusScroll:d,...h})=>{const u=(0,n.useRef)();(0,n.useEffect)((()=>{if(!u.current)return;if(!c||!d)return;const t=window.scrollY;u.current.focus(),setTimeout((()=>{window.scrollTo(0,t)}),0)}),[c,d]);const m=void 0!==t.value?t.value:"",f=s?"spinner-third":o;return n.createElement(a.A,{size:i},o&&n.createElement(r.A,{icon:f,spin:s}),n.createElement(a.A.Input,l({ref:t=>{u.current=t,p?.(t)},type:e,size:i},t,{value:m},h,{autoFocus:c&&!d})))};p.displayName="Input",p.propTypes={field:o().object,type:o().string,size:o().oneOf(["sm","md","lg"]),icon:o().oneOfType([o().string,o().bool]),autoFocus:o().bool,preventFocusScroll:o().bool,inputRef:o().func,loading:o().bool},e.A=p},29121:function(t,e,i){"use strict";i.d(e,{A:function(){return sn}});var n=i(96540),s=i(5556),o=i.n(s),a=i(37584),r=i.n(a),l=i(85015),p=i.n(l),c=i(87216),d=i(33376),h=i(2123),u=i(45517),m=i(98412),f=i(82252),g=i(62193),b=i.n(g),v=i(44826),y=i.n(v),k=i(98103),_=i.n(k),x=i(17530),C=i(58311);function w(){return w=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},w.apply(null,arguments)}class A extends n.Component{static displayName="PriceInput";static propTypes=(()=>({id:o().string,currency:o().string,cents:o().bool,hidePrefix:o().bool,field:o().object.isRequired,size:o().oneOf(["sm","md","lg"]),className:o().string,error:o().any,autoFocus:o().bool,inputRef:o().func,disabled:o().bool}))();static defaultProps={size:"md"};constructor(t){super(t),this.state={displayValue:void 0}}componentDidUpdate=t=>{null!=this.props.field.value&&this.props.field.value!==t.field.value&&(this.props.cents?this.props.field.value!==C.Ay.parsePriceToCents(this.state.displayValue)&&this.setState({displayValue:C.Ay.money(this.props.field.value,{format:"%v"})}):this.setState({displayValue:this.props.field.value}))};handleChange=t=>{const{cents:e}=this.props,i=t.target.value,n=this.props.field.onChange;if(b()(y()(i)))n(0),this.setState({displayValue:""});else if(e){n(C.Ay.parsePriceToCents(i)),this.setState({displayValue:i})}else n(i),this.setState({displayValue:i})};renderValue=t=>{const{cents:e}=this.props,{displayValue:i}=this.state;return null===t||void 0===t?"":null!==i&&void 0!==i?i:e?C.Ay.money(t,{symbol:""}):t};render(){const{hidePrefix:t,size:e,error:i,id:s,className:o,inputRef:a,disabled:r,...l}=this.props,{name:p,...c}=this.props.field,d=this.renderValue(this.props.field.value),h=this.props.currency||_().settings.currency.symbol;return n.createElement(x.A,{size:e},h&&!t&&n.createElement(x.A.I,{size:e},h),n.createElement(x.A.Input,w({id:s,ref:t=>{this.ref=t,a&&a(t)}},c,{name:p,type:"text",onChange:this.handleChange,value:d,size:e,error:i,className:o,disabled:r},l)))}}A.displayName="PriceInput";var E=i(2670);function T(){return T=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},T.apply(null,arguments)}class S extends n.Component{static displayName="TextArea";static propTypes=(()=>({field:o().object,size:o().oneOf(["sm","md","lg"])}))();static defaultProps={size:"md"};render(){const{field:t,size:e,...i}=this.props;return t.value=t.value||"",delete i.noMargin,delete i.i18n,delete i.tOrEmptyString,delete i.tOrLoadingBar,delete i.Trans,delete i.tReady,n.createElement(E.A,T({size:e},t,i))}}S.displayName="Input";var P=i(40961),O=i(69733),j=i(64974),D=i(34008),$=i(78246),B=i(25980),N=i(85272),I=i(19562),H=i(11162);function F(){return F=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},F.apply(null,arguments)}class W extends n.Component{static displayName="DateTimePickerInput";static propTypes=(()=>({label:o().any,size:o().oneOf(["sm","md","lg"]),timeOnly:o().bool,translate:o().bool,format:o().string,brandingColor:o().string,error:o().oneOfType([o().string,o().array]),field:o().object,usePortal:o().bool,direction:o().string,disabled:o().bool,clearable:o().bool,isMobile:o().bool,showIcon:o().bool,firstDayOfWeek:o().number,globalDateFormat:o().string,blockedDays:o().any,placeholder:o().any,forceUTC:o().bool,inputRef:o().func,footer:o().node,onFocus:o().func}))();static defaultProps={field:{},direction:"bottom",clearable:!0,forceUTC:!0};constructor(t){super(t);const e=(0,j.Ay)(this.props.field.value||"").toJSON();this.state={value:e,focused:!1,valid:!1,currentMonth:e,hover:null,popoverOpen:!1}}componentDidMount=()=>{document.addEventListener("click",this.handleClickOutside,!0)};componentWillUnmount=()=>{document.removeEventListener("click",this.handleClickOutside,!0)};componentDidUpdate=t=>{const e=(0,j.Ay)(this.props.field.value||"").toJSON();t.field.value!==this.props.field.value&&this.setState({value:e})};defaultValue=()=>{let t={};return this.state.value||(t={value:(new Date).toJSON()}),t};handleClickOutside=t=>{const e=(0,P.findDOMNode)(this);this.state.focused&&(e&&e.contains(t.target)||this.setState({focused:!1}))};handleDayClick=(t,e)=>{if(e.disabled)return;const{field:i,forceUTC:n}=this.props;t=n?(0,j.Rz)(t).toJSON():(0,j.Ay)(t).toJSON(),i.onChange&&i.onChange(t,!0),this.setState({value:t,focused:!1},(()=>{this.handlePopoverClose()})),i.onBlur&&i.onBlur({target:{name:i.name,value:t}})};handleChangeInput=t=>{const{field:e}=this.props,i={value:t,currentMonth:t,valid:!0};t=(0,j.Ay)(t).toJSON(),this.setState(i),e.onChange&&e.onChange(t)};handleFocusInput=t=>{this.state.focused&&this.isMobile()&&setTimeout((()=>{document.activeElement.blur(),t.target&&t.target.blur()}),10),this.props.onFocus&&this.props.onFocus(t),setTimeout((()=>this.setState({focused:!0,popoverOpen:!0})))};handleClear=()=>{const{field:t}=this.props;this.setState({value:null,focused:!1,currentMonth:""}),this.setState({value:null,focused:!1}),t.onChange&&t.onChange(null),t.onBlur&&t.onBlur({target:{name:t.name}})};handlePopoverClose=()=>{this.setState({popoverOpen:!1}),this.handleFieldBlur()};handleFieldBlur=()=>{const{field:t}=this.props;this.setState({focused:!1}),t.onBlur?.({target:{name:t.name}})};isMobile=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);renderDatePicker=t=>{const{brandingColor:e,translate:i,timeOnly:s,blockedDays:o,forceUTC:a,footer:r,firstDayOfWeek:l,...p}=this.props;if(s)return null;const{value:c,currentMonth:d,hover:h}=this.state,u=d&&(0,j.Ay)(d).toDate()||new Date;return n.createElement(H.A,{modifiers:"padding-md"},n.createElement($.A,F({brandingColor:e,numberOfMonths:1,blockedDays:o,from:c&&new Date(c),to:c&&(0,j.Ay)(c).endOf("day").toDate(),onDayClick:this.handleDayClick,onDayTouchEnd:(t,e,i)=>{i.preventDefault(),this.handleDayClick(t,this.handlePopoverClose)},onDayMouseEnter:t=>{this.setState({hover:t})},onDayMouseLeave:t=>{h.getTime()===t.getTime()&&this.setState({hover:null})},enableOutsideDaysClick:!1,firstDayOfWeek:l,month:c?new Date(c):u,translate:i,forceUTC:a},p)),r)};renderInput=()=>{const{field:t,size:e,error:i,timeOnly:s,placeholder:o,disabled:a,clearable:r,showIcon:l,inputRef:p}=this.props,{value:c,focused:h}=this.state,u=this.props.format||this.props.globalDateFormat,m={name:t.name,onChange:this.handleChangeInput,onFocus:this.handleFocusInput,onInvalid:()=>{this.setState({valid:!1})},value:c};return p?.(this.handleFocusInput),n.createElement(D.A,{size:e},n.createElement(D.A.InputContainer,{focused:h,size:e,error:!a&&i,timeOnly:s,showIcon:l,disabled:a},l&&!s&&n.createElement(d.A,{icon:"calendar"}),c&&!a&&r&&n.createElement(D.A.ClearButton,{onClick:this.handleClear,size:e},n.createElement(d.A,{icon:"times"})),n.createElement(B.A,{size:e,format:u,placeholder:o||u,field:m,focused:h,onBlur:this.handleFieldBlur,disabled:a})))};renderMobile(t){const{label:e}=this.props;return n.createElement(n.Fragment,null,this.renderInput(),n.createElement(I.A,{open:t},n.createElement(D.A.MobileWrapper,null,n.createElement(D.A.MobileHeader,{onClick:this.handlePopoverClose},n.createElement(d.A,{icon:"chevron-left",style:"fas"}),"  ",n.createElement("span",null,e)),this.renderDatePicker())))}render(){const{timeOnly:t,isMobile:e,disabled:i,direction:s}=this.props,o=!t&&!i&&this.state.popoverOpen;return e?this.renderMobile(o):n.createElement(N.A,{direction:s,content:!i&&this.renderDatePicker,open:o,onClose:this.handlePopoverClose,fallbackPlacements:["top","right","left"],method:"manual",fixed:!0},this.renderInput())}}W.displayName="DateTimePickerInput";var L=(0,O.Ng)((t=>({firstDayOfWeek:t.settings.get("dates.first_day_of_week",1),globalDateFormat:t.settings.get("dates.format")})))(W),M=i(50264),R=i(51510),z=i(89227),U=i(55955),q=i(62478);const V=U.A.Label,G=(0,R.Ay)(H.A).withConfig({displayName:"CheckboxGroup"})(["width:100%;","{width:auto;display:inline-block;margin-bottom:0;"," "," ","}","{display:inline-block;","}"],U.A,(t=>!t.noInline&&(0,R.AH)(["&:not(:last-child){margin-bottom:",";margin-right:",";","}"],(0,z.Ej)("margin"),(0,z.Ej)("margin"),(t=>t.compact&&(0,R.AH)(["margin-bottom:",";margin-right:",";"],(0,z.Ej)("margin","sm"),(0,z.Ej)("margin","sm"))))),(t=>t.noInline&&(0,R.AH)(["display:block;margin-bottom:",";"],(0,z.Ej)("margin"))),(t=>t.bordered&&(0,R.AH)(["position:relative;padding:"," "," "," calc(5px + ",");border:1px "," solid !important;border-radius:",";margin-bottom:",";",":first-child{position:absolute;left:36px;","}"],(0,z.Ej)("padding","sm"),(0,z.Ej)("padding","sm"),(0,z.Ej)("padding","sm"),(0,z.Ej)("padding","xl"),(0,z.yW)("Misc/Divider"),(0,z.Ej)("borderRadius","sm"),(0,z.Ej)("margin","xs"),q.A,(t=>t.withOptionDescriptions&&(0,R.AH)(["top:20px;"])))),V,(t=>t.noInline&&(0,R.AH)(["display:block;"]))),J=R.Ay.div.withConfig({displayName:"Checkbox"})(["position:relative;"]);G.Box=J;var K=G;class Y extends n.Component{static displayName="CheckboxGroup";static propTypes=(()=>({options:o().arrayOf(o().shape({value:o().oneOfType([o().string,o().number,o().bool]).isRequired,label:o().any,labelImage:o().node,description:o().any,children:o().node})).isRequired,onChange:o().func,field:o().object,noInline:o().bool,disabled:o().bool,bordered:o().bool,withOptionDescriptions:o().bool,compact:o().bool,modifiers:o().oneOfType([o().string,o().object])}))();handleChange=(t,e)=>{const{onChange:i,onBlur:n}=this.props.field,s=[...this.props.field.value],o=s.indexOf(t);-1===o?s.push(t):s.splice(o,1),n&&n({target:{name:this.props.field.name}}),i&&i(s)};renderOptions=t=>{const{field:e,disabled:i,modifiers:s}=this.props,{name:o,value:a}=e,r="object"===typeof s?s:{self:s};return t.map((t=>{const e={value:-1!==(a||[]).indexOf(t.value),onChange:this.handleChange.bind(null,t.value)};return n.createElement(M.A,{label:t.label,labelImage:t.labelImage,description:t.description,children:t.children,field:e,id:`${o}_${t.value}`,key:t.value,disabled:i,"data-tid":`Checkbox ${t.value}`,modifiers:{self:r.checkbox,label:r.checkboxLabel,icon:r.checkboxIcon}})}))};render(){const{options:t,noInline:e,bordered:i,withOptionDescriptions:s,compact:o,modifiers:a}=this.props,r="object"===typeof a?a:{self:a};return n.createElement(K,{noInline:e,compact:o,bordered:i,withOptionDescriptions:s,modifiers:r.checkboxGroup},this.renderOptions(t))}}Y.displayName="CheckboxGroup";var X=i(38221),Z=i.n(X),Q=i(90179),tt=i.n(Q),et=i(13222),it=i.n(et);class nt extends n.Component{static displayName="InputDebounceWrapper";static propTypes=(()=>({wait:o().number,debounceOptions:o().shape({leading:o().bool,maxWait:o().number,trailing:o().bool}),component:o().oneOfType([o().func,o().node]),field:o().shape({onChange:o().func.isRequired,onBlur:o().func,value:o().any}).isRequired,skipChangeOnBlur:o().bool,verifyChange:o().bool}))();static defaultProps={wait:500};constructor(t){super(t),this.state={value:t.field.value,debounceStarted:!1}}get wait(){return window.testMode?0:this.props.wait}componentDidMount=()=>{this.initializeOnChange()};componentWillUnmount=()=>{this.onChange.flush()};componentDidUpdate=t=>{t.field.value!==this.props.field.value&&this.state.value!==this.props.field.value&&this.setState({value:this.props.field.value})};initializeOnChange=()=>{const{debounceOptions:t}=this.props;this.onChange=Z()(this.sendChange,this.wait,t)};sendChange=t=>{this.props.field.onChange(t),this.setState({debounceStarted:!1}),this.props.verifyChange&&setTimeout((()=>{this.props.field.value!==this.state.value&&this.setState({value:this.props.field.value})}),100)};handleBlur=t=>{const{onBlur:e,onChange:i}=this.props.field,{skipChangeOnBlur:n}=this.props;let s;s=t.target&&void 0!==t.target.value?t.target.value:t,e&&e(s),n||this.state.debounceStarted&&(this.onChange.cancel(),i(s),this.setState({debounceStarted:!1}),this.initializeOnChange())};handleChange=t=>{let e;e=t.target&&void 0!==t.target.value?t.target.value:t,this.setState({value:e,debounceStarted:!0}),this.onChange(e)};render(){const{component:t}=this.props,{onChange:e,onBlur:i,value:s,...o}=this.props.field,a=tt()(this.props,["options","component","field","verifyChange"]);return a.wait=this.wait,(0,n.createElement)(t,{field:{onChange:this.handleChange,value:"Input"===t.name?it()(this.state.value):this.state.value,onBlur:this.handleBlur,...o},"data-debounce":this.props.wait,...a})}}nt.displayName="InputDebounceWrapper";var st=i(7612),ot=i(68709);const at=R.Ay.div.withConfig({displayName:"ColorPicker"})(["position:relative;","{position:absolute;right:calc("," / 2);top:15px;width:calc("," - ",");height:calc("," - ",");cursor:pointer;}"],q.A,(0,z.Ej)("padding"),(0,z.Ej)("controlHeight"),(0,z.Ej)("padding"),(0,z.Ej)("controlHeight"),(0,z.Ej)("padding")),rt=(0,R.Ay)(ot.A).withConfig({displayName:"Input"})([""]),lt=R.Ay.div.attrs((t=>({style:{background:t.value}}))).withConfig({displayName:"Preview"})(["position:absolute;right:calc("," / 2);top:calc("," / 2);width:calc("," - ",");height:calc("," - ",");border-radius:4px;border:"," solid ",";cursor:pointer;"],(0,z.Ej)("padding"),(0,z.Ej)("padding"),(0,z.Ej)("controlHeight"),(0,z.Ej)("padding"),(0,z.Ej)("controlHeight"),(0,z.Ej)("padding"),(0,z.Ej)("borderWidth"),(0,z.yW)("Misc/Divider")),pt=R.Ay.div.withConfig({displayName:"Picker"})(["max-width:calc(200px + "," * 2);padding:",";"],(0,z.Ej)("padding","sm"),(0,z.Ej)("padding","sm")),ct=R.Ay.div.withConfig({displayName:"Palette"})(["display:flex;flex-flow:row wrap;align-items:center;gap:3px;"]),dt=R.Ay.div.withConfig({displayName:"Color"})(["width:",";height:",";border-radius:",";cursor:pointer;background:",";"],(0,z.Ej)("controlHeight","xs"),(0,z.Ej)("controlHeight","xs"),(0,z.Ej)("borderRadius","xs"),(t=>t.value));at.Input=rt,at.Preview=lt,at.Picker=pt,at.Palette=ct,at.Color=dt;var ht=at,ut=i(72735),mt=i(64652);function ft(){return ft=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ft.apply(null,arguments)}class gt extends n.Component{static displayName="ColorPicker";static propTypes=(()=>({field:o().object,error:o().any,size:o().oneOf(["sm","md","lg"])}))();static defaultProps={size:"md",field:{}};get defaultColors(){return["#D9E3F0","#F47373","#697689","#37D67A","#2CCCE4","#555555","#DCE775","#FF8A65","#BA68C8"]}get valid(){return(0,z.Bi)(this.props.field.value)}handlePickColor=t=>{const{field:e}=this.props;e.onChange&&e.onChange({target:{value:t.toUpperCase()}})};handleBlur=t=>{const{onBlur:e,onChange:i,value:n}=this.props.field;if((0,z.Bi)("#"+n)&&i("#"+n),(0,z.Bi)(n)&&4===n.length){const t=n.replace("#","").split("").map((t=>t+t)).join("");i("#"+t?.toUpperCase())}e(t)};render(){const{field:t,...e}=this.props,i=t.value||"";return n.createElement(ht,null,n.createElement(ht.Input,ft({},t,{onBlur:this.handleBlur,value:i},e,{type:"text"})),n.createElement(N.A,{direction:"right",fallbackPlacements:["left"],content:this.renderColorPicker,method:"click"},n.createElement(n.Fragment,null,n.createElement(ht.Preview,{value:i}),!this.valid&&n.createElement(d.A,{icon:"eye-dropper"}))))}renderColorPicker=()=>n.createElement(ht.Picker,null,n.createElement(st.jI,{color:this.props.field.value,onChange:this.handlePickColor}),n.createElement(mt.A,{size:"sm"}),n.createElement(ut.A,{noMargin:!0}),n.createElement(mt.A,{size:"sm"}),n.createElement(ht.Palette,null,this.defaultColors.map((t=>n.createElement(ht.Color,{key:t,value:t,title:t,onClick:this.handlePickColor.bind(null,t)})))))}gt.displayName="ColorPicker";class bt extends n.Component{static displayName="TimeInput";static propTypes=(()=>({format:o().string,field:o().object,useAmPm:o().bool}))();static defaultProps={field:{}};formatValue=()=>(0,j.Ay)(`2000-01-01 ${this.props.field.value}`).toISOString();onChange=t=>{const e=(0,j.Ay)(t);this.props.field.onChange(`${e.format("HH:mm")}`)};render(){const{field:t,format:e,useAmPm:i}=this.props,s=e||i?"hh:mm A":"HH:mm",o=this.formatValue(),a={onChange:this.onChange,onBlur:t.onBlur,value:o};return n.createElement(L,{timeOnly:!0,format:s,field:a})}}bt.displayName="TimeInput";var vt=(0,O.Ng)((t=>({useAmPm:t.settings.get("dates.use_am_pm")})))(bt),yt=i(96579);function kt(){return kt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},kt.apply(null,arguments)}class _t extends n.Component{static displayName="TimeSelect";static propTypes=(()=>({value:o().any,intervalInMinutes:o().number,format:o().string,disabledTimes:o().shape({before:o().any,after:o().any}),isTimeSelectable:o().func,useAMOrPM:o().bool,everythingIsSelectable:o().bool,disabled:o().bool}))();static defaultProps={intervalInMinutes:15};state={selectOptions:[]};componentDidMount=()=>{this.selectOptions()};componentDidUpdate=t=>{const{currentSelection:e,intervalInMinutes:i}=this.props;t[e]?.getTime()===this.props[e]?.getTime()&&t.intervalInMinutes===i&&t.operatingRules===this.props.operatingRules&&t.disabled===this.props.disabled&&t.isTimeSelectable===this.props.isTimeSelectable||this.selectOptions()};get forcedValue(){const{field:t}=this.props;if(t.value)return{label:this.getLabel(t.value),value:t.value}}get momentFormat(){return this.props.useAMOrPM?"hh:mm A":"HH:mm"}getLabel=t=>(j.Ay.isMoment(t)||(t=(0,j.Ay)(t,"HH:mm")),t.format(this.momentFormat));selectOptions=()=>{const{everythingIsSelectable:t,isTimeSelectable:e,disabledTimes:i,disabled:n,field:s}=this.props,o=[];if(n&&s?.value&&(o.push(this.forcedValue),this.setState({selectOptions:o})),n)return o;for(let a=0;a<24;a++)for(let n=0;n<60;n+=this.props.intervalInMinutes){const s=(0,j.Ay)().hour(a).minute(n);if(i&&i.before){if((0,j.Ay)(i.before).hour(a).minute(n)<(0,j.Ay)(i.before))continue}if(i&&i.after){if((0,j.Ay)(i.after).hour(a).minute(n)>(0,j.Ay)(i.after))continue}const r=this.getLabel(s),l=s.format("HH:mm");t&&o.push({label:r,value:l}),e&&e(l)&&o.push({label:r,value:l})}this.setState({selectOptions:o})};render(){const t={};return 15!==this.props.intervalInMinutes&&(t.forceValue=!0,t.value=this.forcedValue),n.createElement(f.A,kt({},this.props,t,{options:this.state.selectOptions}))}}_t.displayName="TimeSelect";var xt=(0,O.Ng)(((t,e)=>({operatingRules:t.orm.operating_rules})))(_t),Ct=i(18987);var wt=R.Ay.span.withConfig({displayName:"PhoneInput"})([".PhoneInput{vertical-align:middle;width:100%;height:",";padding:0 ",";color:",";background:",";border:"," solid ",";border-radius:",";box-sizing:border-box;.PhoneInputCountryIcon{box-shadow:none;img{vertical-align:top;}}input{border:0;font-size:",";font-weight:400;line-height:1;outline:0;border-top:inherit;border-bottom:inherit;height:",";border-radius:0;&::placeholder{color:"," !important;font-size:"," !important;}}"," "," "," &--focus{border-color:"," !important;&:hover{border-color:"," !important;}}"," ","}"],(0,z.Ej)("controlHeight"),(0,z.Ej)("padding"),(0,z.yW)("Text/Primary"),(0,z.yW)("white"),(0,z.Ej)("borderWidth"),(0,z.yW)("Misc/Divider"),(0,z.Ej)("borderRadius"),(0,z.J)(),(0,z.Ej)("controlHeight"),(0,z.yW)("Text/Tertiary"),(0,z.J)(),(t=>t.readOnly&&(0,R.AH)(["color:"," !important;border-color:"," !important;"],(0,z.yW)("Text/Tertiary"),(0,z.yW)("Misc/Divider"))),(t=>t.error&&(0,R.AH)(["border-color:",";&:hover:not(:focus){border-color:",";}&:hover{border-color:",";}&:focus{border-color:",";&:hover{border-color:",";}}"],(0,z.yW)("Danger/Base"),(0,z.yW)("Danger/Base"),(0,z.yW)("Danger/Base"),(0,z.yW)("Danger/Base"),(0,z.yW)("Danger/Base"))),(t=>!t.error&&(0,R.AH)(["&:hover{border-color:",";}&:focus{border-color:",";&:hover{border-color:",";}}"],(0,z.yW)("borderHover"),(0,z.yW)("Primary/Base"),(0,z.yW)("Primary/Base"))),(0,z.yW)("Primary/Base"),(0,z.yW)("Primary/Base"),(t=>t.disabled&&(0,R.AH)(["background:",";pointer-events:none;"],(0,z.yW)("Background/Base"))),(t=>t.valid&&(0,R.AH)(["border-color:",";&:hover{border-color:",";}"],(0,z.yW)("Success/Base"),(0,z.yW)("Success/Base")))),At=(i(3966),i(58238)),Et=i(529);function Tt(){return Tt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Tt.apply(null,arguments)}class St extends n.Component{static displayName="PhoneNumberInput";static propTypes=(()=>({field:o().object,placeholder:o().any,readOnly:o().bool,error:o().any,valid:o().bool,disabled:o().bool,countryCode:o().string}))();static defaultProps={size:"md",field:{}};state={countryCode:null};componentDidMount=()=>{this.handleIdentification()};handleIdentification=async()=>{const t=Ct.A.get("identification.location");if(t)this.setState({countryCode:t});else{let t;try{t=await fetch("https://identify.booqable.com/location.json")}catch{return}if(t.ok){const e=await t.json();Ct.A.set("identification.location",e.country_code,{expires:1}),this.setState({countryCode:e.country_code})}}};render(){const{field:t,placeholder:e,readOnly:i,error:s,valid:o,disabled:a}=this.props,{countryCode:r}=this.state;return n.createElement(wt,{readonly:i,error:s,valid:o,disabled:a},n.createElement(At.Ay,Tt({placeholder:e,onFocus:this.handlefocus,onBlur:this.handleBlur,defaultCountry:r,smartCaret:!1},Et.A,t)))}}St.displayName="PhoneInput";var Pt=i(83673),Ot=i.n(Pt),jt=i(63375),Dt=i.n(jt),$t=i(66675),Bt=i.n($t);var Nt=i(88267);function It(t=null){let e,i;if(t?e=t:(i=this.app.block.get(),e=i.getHtml()),e=(0,Nt.prependProtocol)(e),t)return e;i.setHtml(e)}class Ht extends n.Component{static displayName="ContentEditor";static propTypes=(()=>({field:o().shape({name:o().string,value:o().string,onChange:o().func}),autoFocus:o().bool,image:o().bool,inlineControls:o().bool,table:o().oneOfType([o().bool,o().object]),embed:o().bool,value:o().string,plugins:o().array,onInitialize:o().func}))();constructor(t){super(t),this.editor=(0,n.createRef)()}get addBar(){const{embed:t}=this.props;let e=this.props.image,i=this.props.table;return void 0===e&&(e=!0),void 0===i&&(i=!0),Ot()(["paragraph",e&&"image",i&&"table",t&&"embed","line"])}get editorProps(){const{autoFocus:t,inlineControls:e,image:i,table:n,plugins:s}=this.props,o=e?{control:!0,context:!0,toolbar:!1}:{},a={source:!1,format:["p","h1","h2","h3","ul","ol"],image:{upload:!1,url:void 0===i||i},buttons:{addbar:this.addBar,context:["bold","italic","mark","link"]},subscribe:{"editor.keyup":this.handleChange,"editor.paste":this.handleChange,"editor.cut":this.handleChange,"link.add":this.handleChange,"link.remove":this.handleChange,"block.add":this.handleChange,"block.remove":this.handleChange,"block.format":this.handleChange,"inline.format":this.handleChange},plugins:["linkValidate"],link:{size:500},...o};return n&&(a.table=n),t&&(a.editor={focus:!0}),s&&(a.plugins=Dt()([...a.plugins,...s])),a}componentDidMount=()=>{window.alignPluginInitialized||(Bt().add("plugin","alignment",{translations:{en:{alignment:{alignment:"Alignment"}}},defaults:{align:{left:"align-left",center:"align-center",right:"align-right",justify:"align-justify"}},start(){this.app.toolbar.add("alignment",{title:"## alignment.alignment ##",command:"alignment.popup",blocks:{all:"editable"}})},popup(t,e){const i={},n=this.opts.alignment.align;for(const s in n)n[s]&&(i[s]={name:n[s],prefix:"align"});this.app.popup.create("alignment",{setter:"alignment.setAlign",getter:"alignment.getAlign",form:{align:{type:"segment",label:"## alignment.alignment ##",segments:i}}}),this.app.popup.open({button:e})},getAlign(){const t=this.opts.alignment.align;if(!t)return!1;const e=this.app.block.get().getBlock();let i="left";for(const n in t)e.hasClass(t[n])&&(i=n);return{align:i}},setAlign(t){this.app.popup.close();const e=t.getData();this.app.block.get().setClassFromObj(this.opts.alignment.align,e.align)}}),window.alignPluginInitialized=!0),window.linkValidatePluginInitialized||(Bt().add("plugin","linkValidate",{subscribe:{"link.add":function(){this.validateLink()},"link.change":function(){this.validateLink()}},validateLink:It}),window.linkValidatePluginInitialized=!0),this.handleInitializeEditor()};componentWillUnmount=()=>{this.app.stop()};handleInitializeEditor=()=>{const{onInitialize:t}=this.props;this.app=Bt()(this.editor.current,this.editorProps),t?.(this.app)};handleChange=()=>{const{field:t}=this.props,e=this.app.editor.getContent();t?.onChange(e)};render(){const{field:t}=this.props;return n.createElement("textarea",{defaultValue:t.value||"",ref:this.editor})}}Ht.displayName="ContentEditor";var Ft=i(60747),Wt=i(71233),Lt=i(42088),Mt=i(82517),Rt=i(95349);const zt=R.Ay.div.withConfig({displayName:"UrlSelect"})(["","{position:relative;top:initial;left:initial;right:initial;bottom:initial;margin-right:",";line-height:32px;}"],q.A,(0,z.Ej)("margin","xs")),Ut=R.Ay.div.withConfig({displayName:"Value"})(["display:flex;align-items:center;flex-flow:row nowrap;flex:1;& > .Select__single-value{overflow:hidden;width:60%;.Select__single-value{overflow:hidden;width:80%;}input{width:100% !important;}}"," ",""],(({withIcon:t})=>t&&(0,R.AH)(["& > .Select__single-value{padding-left:",";width:60%;}"],(0,z.Ej)("padding","lg"))),(({isCategory:t})=>t&&(0,R.AH)([".Select__single-value{color:",";}"],(0,z.yW)("Text/Tertiary")))),qt=R.Ay.div.withConfig({displayName:"Menu"})([".Select__menu-list{padding:0;}"]),Vt=R.Ay.div.withConfig({displayName:"LoaderContainer"})(["display:flex;justify-content:center;align-items:center;padding:",";"],(0,z.Ej)("padding","md")),Gt=R.Ay.div.withConfig({displayName:"MenuHeader"})(["display:flex;align-items:center;padding:4px ",";border-bottom:"," solid ",";user-select:none;cursor:pointer;&:hover{background-color:","66;}","{margin:0;color:",";&:last-child{margin-left:auto;opacity:0.6;}}"],(0,z.Ej)("padding","sm"),(0,z.Ej)("borderWidth"),(0,z.yW)("Misc/Divider"),(0,z.yW)("light"),Mt.A,(0,z.yW)("Text/Primary")),Jt=R.Ay.div.withConfig({displayName:"OptionCell"})(["display:flex;align-items:center;padding:"," 0;"],(0,z.Ej)("padding","xs")),Kt=R.Ay.div.withConfig({displayName:"Option"})(["overflow-wrap:break-word;cursor:pointer;"," ",",","{margin-left:",";}.Select__option{background:transparent !important;}"," "," "," "," ",""],(({columns:t})=>t&&(0,R.AH)(["display:grid;grid-template-columns:",";"],t.join(" "))),Rt.A,q.A,(0,z.Ej)("margin","sm"),(({isFocused:t})=>t&&(0,R.AH)(["background-color:","66;"],(0,z.yW)("light"))),(({isSelected:t})=>t&&(0,R.AH)(["background-color:",";","{","}"],(0,z.yW)("Primary/Base",.4),q.A,(t=>{const e=(0,z.HD)((0,z.yW)("Primary/Base")(t))?"Text/Inverted":"Text/Primary";return{color:`${(0,z.yW)(e)(t)} !important`}}))),(({noPadding:t})=>t&&(0,R.AH)(["","{padding:0;}"],Jt)),(({isCollection:t})=>t&&(0,R.AH)([""," ","{margin:0 auto;font-size:",";}.Select__option{padding-left:0 !important;}"],Jt,q.A,(0,z.J)("lg"))),(({borderBottom:t})=>t&&(0,R.AH)(["border-bottom:"," solid ",";"],(0,z.Ej)("borderWidth"),(0,z.yW)("Misc/Divider"))));zt.Value=Ut,zt.Menu=qt,zt.MenuHeader=Gt,zt.LoaderContainer=Vt,zt.Option=Kt,zt.OptionCell=Jt;var Yt=zt,Xt=i(23203);const Zt=t=>t?t.startsWith("tel:")?"phone":t.startsWith("mailto:")?"email":"external-link":null;function Qt(){return Qt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Qt.apply(null,arguments)}const te={products:"box",pages:"file",collections:"box"},ee={"external-link":"external-link",phone:"phone",email:"envelope"},ie=t=>{const e="link"===t.selectProps?.type,i=Zt(t.selectProps?.value?.value),s=t.selectProps?.category===t.selectProps?.value?.value,o=t.selectProps?.category||t.selectProps?.value?.value?.match(/booqable:\/\/(products)\//)?.[1];return n.createElement(Yt.Value,Qt({},t.innerProps,{isLink:e,isCategory:s,withIcon:s||e||!!o}),!t.hideLinkIcon&&e&&n.createElement(d.A,{icon:ee[i]}),o&&!e&&n.createElement(d.A,{icon:te[o]}),n.createElement(Xt.F.SingleValue,t))};ie.displayName="ValueContainer",ie.displayName="UrlContainer",ie.propTypes={selectProps:o().shape({type:o().any,category:o().string,value:o().shape({value:o().string})}),hideLinkIcon:o().bool,innerProps:o().object};var ne=ie,se=i(28258);const oe=t=>{const e=t.selectProps?.loading,i=t.selectProps?.onBackClick,s=t.selectProps.total||t.options?.length,o=e?"...":`${s} item${1!==s?"s":""}`;return n.createElement(Yt.Menu,null,n.createElement(Xt.F.Menu,t,n.createElement(Yt.MenuHeader,{onClick:i},n.createElement(d.A,{icon:"chevron-left"}),n.createElement(Mt.A,null,t.t("common.actions.back")),n.createElement(Mt.A,null,o)),e?n.createElement(Yt.LoaderContainer,null,n.createElement(se.A,{color:"primary",size:"lg"})):n.createElement(Xt.F.MenuList,t)))};oe.displayName="Menu",oe.propTypes={selectProps:o().shape({loading:o().bool,onBackClick:o().func,total:o().number}),options:o().array,children:o().node,t:o().func,innerProps:o().object};var ae=(0,Wt.C)()(oe),re=i(6917),le=i(13390);function pe(){return pe=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},pe.apply(null,arguments)}const ce=t=>{const e="item"===t.data.type;return n.createElement(Yt.Option,pe({},t.innerProps,{isSelected:t.isSelected,isFocused:t.isFocused,columns:["64px","1fr"],isCollection:!0,borderBottom:!e}),n.createElement(Yt.OptionCell,null,e?n.createElement(re.A,{size:"40px",coordinates:t.data.photo?.coordinates??{x:0,y:0},url:t.data.photo?.original_url||le}):n.createElement(d.A,{icon:"box"})),n.createElement(Yt.OptionCell,null,n.createElement(Xt.F.Option,t)))};ce.displayName="Product",ce.propTypes={isSelected:o().bool,isFocused:o().bool,innerProps:o().object,data:o().shape({type:o().string,photo:o().shape({coordinates:o().shape({x:o().number,y:o().number}),original_url:o().string})})};var de=ce;function he(){return he=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},he.apply(null,arguments)}const ue={"external-link":"external-link",email:"envelope",phone:"phone",products:"box",pages:"file",collections:"box"},me=t=>{const e=(0,Nt.stringIsLink)(t.children),i=ue[e?Zt(t.children):t.children.toLowerCase()];return n.createElement(Yt.Option,he({},t.innerProps,{isSelected:t.isSelected,isFocused:t.isFocused,columns:e?["30px","calc(100% - 30px)"]:["30px","1fr","30px"],onMouseEnter:e&&t.onEnterOption,onMouseLeave:e&&t.onLeaveOption,noPadding:!0}),n.createElement(Yt.OptionCell,null,n.createElement(d.A,{icon:i})),n.createElement(Yt.OptionCell,null,n.createElement(Xt.F.Option,t)),!t.data?.type&&n.createElement(Yt.OptionCell,null,n.createElement(d.A,{icon:"chevron-right"})))};me.displayName="Menu",me.propTypes={children:o().node,isSelected:o().bool,isFocused:o().bool,onEnterOption:o().func,onLeaveOption:o().func,data:o().shape({type:o().string}),innerProps:o().object};var fe=me;function ge(){return ge=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ge.apply(null,arguments)}const be=t=>n.createElement(Yt.Option,ge({},t.innerProps,{isSelected:t.isSelected,isFocused:t.isFocused,columns:["30px","1fr"],isCollection:!0}),n.createElement(Yt.OptionCell,null,n.createElement(d.A,{icon:"file"})),n.createElement(Yt.OptionCell,null,n.createElement(Xt.F.Option,t)));be.displayName="Page",be.propTypes={isSelected:o().bool,isFocused:o().bool,innerProps:o().object};var ve=be;function ye(){return ye=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ye.apply(null,arguments)}const ke=t=>n.createElement(Yt.Option,ye({},t.innerProps,{isSelected:t.isSelected,isFocused:t.isFocused,columns:["30px","1fr"],isCollection:!0,borderBottom:"booqable://collections/"===t.value}),n.createElement(Yt.OptionCell,null,n.createElement(d.A,{icon:"box"})),n.createElement(Yt.OptionCell,null,n.createElement(Xt.F.Option,t)));ke.displayName="Collection",ke.propTypes={isSelected:o().bool,isFocused:o().bool,value:o().string,innerProps:o().object};var _e=ke;function xe(){return xe=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},xe.apply(null,arguments)}const Ce=t=>n.createElement(Yt.Option,xe({},t.innerProps,{isSelected:t.isSelected,isFocused:t.isFocused,onMouseEnter:t.onEnterOption,onMouseLeave:t.onLeaveOption,borderBottom:t.data?.divider}),n.createElement(Xt.F.Option,t));Ce.displayName="Link",Ce.propTypes={isSelected:o().bool,isFocused:o().bool,onEnterOption:o().func,onLeaveOption:o().func,data:o().shape({divider:o().bool}),innerProps:o().object};var we=Ce;const Ae={null:fe,products:de,pages:ve,collections:_e},Ee=t=>{const e=t.children?.startsWith?.("Create")||t.value.startsWith("booqable://")&&!t.selectProps?.category?we:Ae[t.selectProps?.category]||fe;return n.createElement(e,t)};Ee.displayName="Option",Ee.propTypes={children:o().node,value:o().string,selectProps:o().shape({category:o().string})};var Te=Ee;function Se(){return Se=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Se.apply(null,arguments)}class Pe extends n.Component{static displayName="UrlSelect";static propTypes=(()=>({value:o().oneOfType([o().object,o().string]),records:o().oneOfType([o().object,o().array]),total:o().number,field:o().object,placeholder:o().any,category:o().string,type:o().string,photos:o().object,options:o().array,handleSetValues:o().func,onCreate:o().func,onGoBack:o().func,onFilter:o().func,loading:o().bool,canLoadMore:o().bool,onLoadMore:o().func,t:o().func}))();state={closeOnClick:!1};toggleCloseOnClick=t=>{this.state.closeOnClick!==t&&this.setState({closeOnClick:t})};get value(){const{field:t,type:e}=this.props;if(t.value)return"link"===e?{label:t.value,value:t.value}:this.options.find((e=>e.value===t.value))}get options(){const{records:t,category:e,type:i,field:n,t:s}=this.props;if(t.size){return[...this.getCategoryDefaultOptions(e),...t.map((t=>this.getCategoryOption(e,t))).sort(((t,e)=>t.label.localeCompare(e.label)))]}return[...n.value&&"link"===i?[{label:n.value,value:n.value,type:"link"}]:[],{label:s("settings.menus.homepage"),type:"link",value:"booqable://root/",divider:!0},{label:s("common.resources.product_other"),value:"products"},{label:s("common.resources.collection_other"),value:"collections"},{label:s("common.resources.page_other"),value:"pages"}]}get components(){const{category:t}=this.props,e={Option:t=>n.createElement(Te,Se({},t,{onEnterOption:this.toggleCloseOnClick.bind(null,!0),onLeaveOption:this.toggleCloseOnClick.bind(null,!1)}))};return!!t&&(e.Menu=ae),(this.value||this.props.value)&&(e.ValueContainer=ne),e}getCategoryOption=(t,e)=>{const{photos:i}=this.props;switch(t){case"products":{const n=i.getById(e.photo);return{label:e.name,value:`booqable://${t}/${e.slug}`,type:"item",photo:n}}case"pages":return{label:e.title,value:`booqable://${t}/${e.slug}`,type:"page"};case"collections":return{label:e.hierarchical_name.join(" > "),value:`booqable://${t}/${e.slug}`,type:"collection"}}};getCategoryDefaultOptions=t=>{const{t:e}=this.props;switch(t){case"pages":return[];case"products":return[{label:e("common.resource_actions.all",{resource:e("common.resources.product_other")}),value:"booqable://products/",type:"menu-item"}];case"collections":return[{label:e("common.resource_actions.all",{resource:e("common.resources.collection_other")}),value:"booqable://collections/",type:"menu-item"}];default:return[{label:e("common.resource_actions.all",{resource:e(`common.resources.${(0,Lt.ES)(t)}_other`)}),value:`booqable://${t}/`,type:"menu-item"}]}};getNoOptionsMessage=()=>{const{t:t,category:e}=this.props;switch(e){case"pages":case"products":case"collections":return t("settings.menus.no_options_resource",{resource:t(`common.resources.${(0,Lt.ES)(e)}_other`)});default:return t("settings.menus.no_options")}};componentDidUpdate=()=>{this.props.field.value&&this.props.field.value!==this.props.value?.value&&this.options.size&&this.props.handleSetValues({value:this.value})};handleChange=t=>{const{category:e}=this.props;if(!t)return this.props.field?.onChange(null),this.props.handleSetValues({category:null,type:null,value:null});const i=this.options.find((e=>e.value===t));return e||"link"===i.type?(this.props.field.onChange?.(i.value),this.props.handleSetValues({type:i.value.startsWith("booqable://")?"option":"link",value:i})):this.props.handleSetValues({category:t})};handleOptionValid=t=>!!t&&(0,Nt.stringIsLink)(t);handleSearch=t=>{const{onFilter:e}=this.props;e({name:{match:t}})};render(){const{category:t,field:e,type:i,onGoBack:s,onCreate:o,loading:a,total:r,placeholder:l,canLoadMore:p,onLoadMore:c,records:d}=this.props,{closeOnClick:h}=this.state,u=this.components;return n.createElement(Yt,null,n.createElement(f.A,Se({},e,{value:this.value||this.props.value,options:this.options,onChange:this.handleChange,onCreateOption:o,onBackClick:s,closeMenuOnSelect:!!t||h,controlShouldRenderValue:!!this.value||!!this.props.value,components:u,type:i,category:t,total:r,isValidNewOption:this.handleOptionValid,isClearable:!!this.value||!!this.props.value,loading:0===d.size?.()&&a,placeholder:l,isSearchable:!0,forceValue:!0,forceOnChange:!0,creatable:!0,noOptionsMessage:this.getNoOptionsMessage,onMenuScrollToBottom:p&&c,onInputChange:this.handleSearch})))}}Pe.displayName="UrlSelect";var Oe=(0,Wt.C)("settings")(Pe);class je extends n.Component{static displayName="UrlSelectWrapper";static propTypes=(()=>({field:o().object,photos:o().object,fetchItems:o().func,fetchPages:o().func,fetchCollections:o().func}))();state={category:null,type:null,fetchCollection:null};componentDidMount=()=>{const{field:t}=this.props;t.value&&this.handleSetCategory()};componentDidUpdate=t=>{const{field:e}=this.props;e.value&&e.value!==t.field.value&&this.handleSetCategory()};handleGetFetchCollection=t=>{switch(t){case"products":return this.props.fetchItems;case"pages":return this.props.fetchPages;case"collections":return this.props.fetchCollections;default:return null}};handleGetCollection=t=>{const{category:e}=this.state;switch(e){case"products":return t.orm.items;case"pages":return t.orm.pages;case"collections":return t.orm.collections;default:return null}};handleSetCategory=()=>{const{field:t}=this.props;if(!t.value)return;if((0,Nt.stringIsLink)(t.value))return this.setState({value:t.value,type:"link"});const e=t.value.match(/booqable:\/\/(products|pages|collections)\//)?.[1],i=this.handleGetFetchCollection(e);this.setState({category:e,fetchCollection:i})};handleCreate=t=>{t=(0,Nt.prependProtocol)(t),this.setState({type:"link",value:{label:t,value:t},category:null,fetchCollection:null},(()=>this.props.field.onChange?.(t)))};handleSetValues=({category:t,type:e,value:i})=>{const n={category:t,type:e,value:{...i}};Object.keys(n).forEach((t=>void 0===n[t]&&delete n[t])),t&&(n.fetchCollection=this.handleGetFetchCollection(t)),this.setState(n)};handleGoBack=()=>{const{field:t}=this.props,{type:e}=this.state,i={category:null};!!t.value&&"link"===e||(i.type=null),this.setState(i)};render(){const{field:t,photos:e}=this.props,{category:i,type:s,fetchCollection:o,value:a,placeholder:r}=this.state;return n.createElement(Ft.A,{fetchCollection:o,getCollectionFromState:this.handleGetCollection,fetchOnMount:!1,strategy:"append",hideLoadMore:!0},n.createElement(Oe,{value:a,field:t,category:i,type:s,photos:e,handleSetValues:this.handleSetValues,onCreate:this.handleCreate,onGoBack:this.handleGoBack,placeholder:r}))}}je.displayName="UrlSelectWrapper";var De=(0,O.Ng)(((t,e)=>({productGroups:t.orm.product_groups.getAll(),photos:t.orm.photos})),((t,e)=>({fetchPages:t=>e.fetchActions.pages.fetchAll({fields:{pages:"id,title,slug"},page:{number:t.page,per:t.per}}),fetchItems:({page:t,per:i,filters:n})=>{let s={show_in_store:!0,type:["ProductGroup","Bundle"]};return n?.name?.match&&(s={...s,...n}),e.fetchActions.products.fetchAll({apiVersion:"boomerang",stateKey:"items",filter:s,fields:{product_groups:"id,name,slug"},include:"photo",page:{number:t,per:i}})},fetchCollections:t=>{const i={fields:{collection:"id,name,slug"},filter:{system:!1},extra_fields:{collections:"hierarchical_name,all_children"},page:{number:t.page,per:t.per}};return t.filters?.name?.match&&(i.filter={...i.filter,...t.filters}),e.fetchActions.collections.fetchAll(i)}})))(je);var $e=R.Ay.div.attrs((({font:t})=>({style:{fontFamily:t}}))).withConfig({displayName:"FontSelect"})(["font-size:",";font-family:sans-serif;"],(0,z.J)("mdplus"));const Be=t=>n.createElement(n.Fragment,null,n.createElement("link",{href:"https://fonts.bunny.net/css?family="+t.value,rel:"stylesheet"}),n.createElement($e,{font:t.label},n.createElement(Xt.F.Option,t)));Be.displayName="Option",Be.propTypes={value:o().string,label:o().any};var Ne=Be;const Ie=t=>n.createElement(n.Fragment,null,n.createElement("link",{href:"https://fonts.bunny.net/css?family="+t.data.value,rel:"stylesheet"}),n.createElement($e,{font:t.data.label},n.createElement(Xt.F.SingleValue,t,t.children)));Ie.displayName="SingleValue",Ie.propTypes={data:o().object,children:o().node};var He=Ie;class Fe extends n.Component{static displayName="FontSelect";static propTypes=(()=>({field:o().object,pageSize:o().number}))();static defaultProps={pageSize:15};state={page:1,query:null,loading:!1,options:[]};get currentOption(){const{field:t}=this.props,{options:e}=this.state;return e.find((e=>e.value.includes(t.value.split("_")[0])))}componentDidMount=()=>{this.handleLoadOptions()};componentDidUpdate=t=>{const{field:e}=this.props;e.value!==t.field.value&&this.handleLoadOptions()};handleLoadOptions=async()=>{const{page:t,query:e}=this.state,{field:n,pageSize:s}=this.props;this.setState({loading:!0});const o=await i.e(491).then(i.t.bind(i,69491,19)).then((t=>t.default)),a=n.value?o.find((t=>t.value===n.value.split("_")[0])):null;if(e){const i=[a,...o.filter((t=>a?t!==a&&t.label.toLowerCase().includes(e.toLowerCase()):t.label.toLowerCase().includes(e.toLowerCase()))).slice(0,t*s)].filter((t=>!!t));return this.setState({options:i,loading:!1})}const r=[a,...o.filter((t=>t!==a)).slice(0,t*s)].filter((t=>!!t));this.setState({options:r,loading:!1})};handleScrollToBottom=()=>{this.setState({page:this.state.page+1},this.handleLoadOptions)};handleSearch=t=>{this.setState({query:t,page:1},this.handleLoadOptions)};handleFontChange=t=>{const{field:e}=this.props;e.onChange(t)};render(){const{options:t,loading:e}=this.state;return n.createElement(n.Fragment,null,n.createElement(f.A,{field:{name:"font",onChange:this.handleFontChange,value:this.currentOption?.value},components:{Option:Ne,SingleValue:He},options:t,onMenuScrollToBottom:this.handleScrollToBottom,onInputChange:this.handleSearch,isLoading:e}))}}function We(){return We=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},We.apply(null,arguments)}Fe.displayName="FontSelect";class Le extends n.Component{static displayName="CodeInput";render(){return n.createElement(S,We({},this.props,{monospace:!0}))}}Le.displayName="CodeInput";const Me=R.Ay.div.withConfig({displayName:"Duration"})([""]),Re=R.Ay.div.withConfig({displayName:"Fields"})(["display:flex;align-items:center;width:100%;> *{margin-right:",";width:50%;&:last-child{margin-right:0;}}"],(0,z.Ej)("padding","sm"));Me.Fields=Re;var ze=Me,Ue=i(20323),qe=i(62897);class Ve extends n.Component{static displayName="Duration";static propTypes=(()=>({name:o().string,field:o().object,error:o().any,valid:o().bool,disabled:o().bool,options:o().array,t:o().func.isRequired,size:o().string,allowZero:o().bool,min:o().number}))();static defaultProps={size:"md",options:["hours","days","weeks","months","years"]};get selectOptions(){const{t:t,options:e}=this.props;return e.map((e=>({value:e,label:t(`common.periods.${e}`)})))}constructor(t){super(t);const e=t.field.value;if(void 0!==e){const i=qe.A.fromSeconds(e,t.options);this.state={period:0===i.value?"hours":i.period,quantity:i.value}}else this.state={quantity:1,period:"days",value:86400},this.props.field.onChange(86400)}componentDidUpdate=t=>{const e=this.props.field.value;if(e!==t.field.value&&e!==this.state.value){const t=qe.A.fromSeconds(e);this.setState({period:0===t.value?"hours":t.period,quantity:t.value})}};handleChangeQuantity=t=>{const e=qe.A.fromPeriod(t,this.state.period);this.setState({value:e,quantity:t}),this.props.field.onChange(e)};handleChangePeriod=t=>{const e=qe.A.fromPeriod(this.state.quantity,t);this.setState({value:e,period:t}),this.props.field.onChange(e)};render(){const{field:t,min:e,size:i,error:s,valid:o,disabled:a,allowZero:r,...l}=this.props,{quantity:p,period:c}=this.state;let d;return d=0===e?0:e||(r?0:1),n.createElement(Ue.L,{disabled:a},n.createElement(ze.Fields,l,n.createElement(m.A,{min:d,error:s,valid:o,size:i,"data-tid":`${t.name} quantity`,field:{onChange:this.handleChangeQuantity,value:p}}),n.createElement(f.A,{options:this.selectOptions,error:s,valid:o,size:i,"data-tid":`${t.name} period`,field:{onChange:this.handleChangePeriod,value:c}})))}}Ve.displayName="Duration";var Ge=(0,Wt.C)("common")(Ve),Je=i(70163);const Ke=R.Ay.div.withConfig({displayName:"Option"})(["display:flex;padding:"," ",";padding-right:",";border-radius:",";background-color:",";position:relative;","{position:relative;top:0;right:0;line-height:",";pointer-events:all;transition:color 0.2s ease-in-out;}",""],(0,z.Ej)("padding","xs"),(0,z.Ej)("padding","sm"),(0,z.Ej)("padding","xs"),(0,z.Ej)("borderRadius","xxl"),(0,z.yW)("light"),Je.A,(0,z.J)("md"),(({invalid:t})=>t&&(0,R.AH)(["background-color:",";color:",";","{color:",";}"],(0,z.yW)("Danger/Base"),(0,z.yW)("Text/Inverted"),Je.A,(0,z.yW)("Text/Inverted")))),Ye=R.Ay.span.withConfig({displayName:"Label"})(["font-size:",";line-height:",";padding:0;margin:0;margin-right:",";"],(0,z.J)("md"),(0,z.J)("mdplus"),(0,z.Ej)("margin","xs")),Xe=R.Ay.span.withConfig({displayName:"Remove"})(["display:flex;align-items:center;justify-content:center;&:hover{color:",";}"],(0,z.yW)("Text/Secondary"));Ke.Label=Ye,Ke.Remove=Xe;var Ze=Ke,Qe=i(39534);const ti=t=>{const e=(0,n.useMemo)((()=>!(0,Qe.x)(t.data.value.trim())),[t.data]);return n.createElement(Ze,{invalid:e},t.children)};ti.displayName="OptionComponent",ti.propTypes={children:o().node.isRequired,data:o().shape({label:o().any.isRequired,value:o().string.isRequired})};const ei=(0,n.memo)(ti),ii=t=>n.createElement(Ze.Label,null,t.data.label);ii.displayName="LabelComponent",ii.propTypes={data:o().object.isRequired};const ni=(0,n.memo)(ii),si=t=>{const{onMouseDown:e,onClick:i,onTouchEnd:s}=t.innerProps;return n.createElement(Ze.Remove,{onClick:i,onMouseDown:e,onTouchEnd:s,"data-tid":`Remove ${t.data.label}`},n.createElement(d.A,{icon:"times"}))};si.displayName="RemoveComponent",si.propTypes={innerProps:o().object.isRequired,data:o().object.isRequired};const oi=(0,n.memo)(si);function ai(){return ai=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ai.apply(null,arguments)}const ri=t=>({value:t.trim(),label:t.trim()}),li=({field:t,delimiter:e=",",useOptions:i=!1,...s})=>{const[o,a]=(0,n.useState)(t.value?t.value.split(e).map(ri):[]),[r,l]=(0,n.useState)(""),p=(0,n.useMemo)((()=>({DropdownIndicator:i?Xt.F.DropdownIndicator:null,MultiValueContainer:ei,MultiValueLabel:ni,MultiValueRemove:oi})),[s.options]),c=(0,n.useCallback)((e=>{r&&[" ","Enter","Tab",","].includes(e.key)&&(e.preventDefault(),t.value?t.onChange(`${t.value},${r}`):t.onChange(r),a((t=>[...t,ri(r)])),l(""))}),[t.value,r]),d=(0,n.useCallback)((i=>{const n=i?.map(ri)||[];t.onChange(n?.map((t=>t.value)).join(e)||""),a(n)}),[]);return n.createElement(f.A,ai({},s,{components:p,inputValue:r,onKeyDown:c,field:t,value:o,onChange:d,onInputChange:l},!i&&{menuIsOpen:!1},{name:t.name,form:t.name,styles:{valueContainer:t=>({...t,gap:6})},forceOnChange:!0,forceValue:!0,isMulti:!0,isClearable:!0}))};li.displayName="MultiSelectInput",li.propTypes={field:o().object,delimiter:o().string,useOptions:o().bool};var pi=li;const ci=R.Ay.div.withConfig({displayName:"Slider"})(["display:flex;align-items:center;gap:",";"],(0,z.Ej)("margin","xs")),di=R.Ay.div.withConfig({displayName:"Range"})(["flex:1;",'[type="range"]{display:block;appearance:none;-webkit-appearance:none;background-color:',";height:4px;padding:0;border:none;border-radius:",";&::-webkit-slider-thumb{appearance:none;-webkit-appearance:none;width:16px;height:16px;margin-top:-7px;background-color:",";border-radius:50%;cursor:grab;transition:transform 0.2s ease-in-out;&:active{transform:scale(1.1);cursor:grabbing;}}&::-webkit-slider-runnable-track{height:4px;border:none;border-radius:",";cursor:pointer;","}}"],ot.A,(0,z.yW)("Misc/Divider"),(0,z.Ej)("borderRadius","xxs"),(0,z.yW)("Primary/Base"),(0,z.Ej)("borderRadius","xxs"),(({progress:t})=>(0,R.AH)(["background-image:linear-gradient( to right,"," 0%,"," ","%,"," ","%,"," 100% );"],(0,z.yW)("Primary/Base"),(0,z.yW)("Primary/Base"),t,(0,z.yW)("Misc/Divider"),t,(0,z.yW)("Misc/Divider"))));ci.Range=di;var hi=ci,ui=i(76667),mi=i(60857);function fi(){return fi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},fi.apply(null,arguments)}const gi=({field:t,label:e,unit:i="%",min:s=0,max:o=100,...a})=>{const r=(t.value-s)/(o-s)*100;return n.createElement(n.Fragment,null,e&&n.createElement(ui.A,null,e),n.createElement(hi,null,n.createElement(hi.Range,{progress:r},n.createElement(ot.A,fi({type:"range"},a,{value:t.value,onChange:e=>{t.onChange(e.target.value)},min:s,max:o}))),n.createElement(mi.A,null,t.value," ",i)))};gi.displayName="Slider",gi.propTypes={field:o().object,label:o().any,unit:o().string,min:o().number,max:o().number};var bi=gi,vi=i(30712),yi=i(45591);function ki(){return ki=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ki.apply(null,arguments)}const _i=({onBlur:t,...e})=>{const i=(0,j.Ay)(e.field.value||"").toJSON(),[s,o]=(0,n.useState)(i),{focusedDate:a,setFocusedDate:r}=(0,n.useContext)(yi.j),l=(0,vi.t)("dates.first_day_of_week",{default:1,transformer:t=>parseInt(t)}),{onMonthChange:p,...c}=e;return e.timeOnly?null:n.createElement($.A,ki({numberOfMonths:e.numberOfMonths||1,from:s&&new Date(s),onDayClick:(t,i)=>{if(i.disabled)return;const{field:n,forceUTC:s,handleClose:l}=e;t=s?(0,j.Rz)(t).toJSON():(0,j.Ay)(t).toJSON(),n.onChange?.(t,!0),o(t);const p=(0,j.Ay)(t),c=(0,j.Ay)(a);p.diff(c,"months")>e.numberOfMonths&&r(new Date(t)),n.onBlur?.({target:{name:n.name,value:t}}),l()},enableOutsideDaysClick:!1,firstDayOfWeek:l,month:a,onMonthChange:t=>{a.getFullYear()===t.getFullYear()&&a.getMonth()===t.getMonth()||r(t),p?.(t)}},c))};_i.displayName="DatePicker",_i.propTypes={field:o().object,forceUTC:o().bool,timeOnly:o().bool,handleClose:o().func,numberOfMonths:o().number,onBlur:o().func,onMonthChange:o().func};var xi=i(71690),Ci=i(16555);function wi(){return wi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},wi.apply(null,arguments)}const Ai=({paddingVertical:t=!0,paddingHorizontal:e=!0,...i})=>{const[s,o]=(0,n.useState)(!1),a=(0,Ci.k)();(0,n.useEffect)((()=>{if(!i.usePortal)return;const t=a.selection===i.mode;o(t),i.onTrigger?.(),t?i.onOpen?.():i.onHide?.()}),[a.selection,i.mode,i.usePortal]);const r=i.field.value?.format?.(Nt.Format.dateFormat("date"))??i.placeholder,l=s=>{const o=[t&&"padding-top-md padding-bottom-md",e&&"padding-left-md padding-right-md"].filter(Boolean).join(" ");return n.createElement(H.A,{"data-tid":`Date picker: ${i.mode}`,modifiers:o},n.createElement(_i,wi({},i,s)))},p=t=>{t.preventDefault(),s?(a.setSelection(null),i.onHide?.()):(a.setSelection(i.mode),i.onOpen?.()),o((t=>!t)),i.onTrigger?.()},c=()=>{o(!1),i.onHide?.()};if(i.usePortal){const t=i.isMobile?s:s||a.calendar===i.mode;return n.createElement(n.Fragment,null,n.createElement(xi.A.Button,{type:"button",active:s,onClick:p,empty:!i.field.value,disabled:i.disabled,"data-value":i["data-value"],"data-active":String(s),error:i.error},r),n.createElement(I.A,{open:t,containerRef:i.portalRef},l({handleClose:c})))}return n.createElement(N.A,wi({},i.popoverOptions||{},{innerRef:i.innerRef,content:l,method:"click",direction:"bottom",offset:15,onTrigger:()=>{o(!0),i.onTrigger?.()},onHide:c,onOpen:()=>{o(!0),a.setSelection(i.mode),i.onOpen?.()},delay:[200,null]}),n.createElement(xi.A.Button,{type:"button",active:s,empty:!i.field.value,disabled:i.disabled,"data-value":i["data-value"],"data-active":String(s),onClick:t=>{t.preventDefault(),o(!0)},error:i.error},r))};Ai.displayName="DatePickerButton",Ai.propTypes={field:o().shape({value:o().oneOfType([o().string,o().instanceOf(Date),o().object]),onChange:o().func,onFocus:o().func,onBlur:o().func,onInvalid:o().func,validate:o().func}),error:o().bool,mode:o().string,onSelectionChange:o().func,popoverOptions:o().object,placeholder:o().any,disabled:o().bool,usePopover:o().bool,innerRef:o().func,onOpen:o().func,onTrigger:o().func,onHide:o().func,format:o().string,"data-value":o().string,usePortal:o().bool,portalRef:o().any,paddingVertical:o().bool,paddingHorizontal:o().bool,isMobile:o().bool};var Ei=i(56863);const Ti=R.Ay.div.withConfig({displayName:"Section"})(["position:relative;"]),Si=R.Ay.div.withConfig({displayName:"Wrapper"})(["display:flex;flex-direction:column;max-height:",";overflow-y:auto;gap:",";padding:"," ",";background-color:",";border-radius:",";&:has(","){padding-top:0;}"],(({maxHeight:t})=>t),(0,z.zA)("1.5"),(0,z.zA)("3.5"),(0,z.zA)("2"),(0,z.yW)("Background/Primary"),(0,z.zA)("1.5"),Ti),Pi=R.Ay.div.withConfig({displayName:"Header"})(["display:flex;justify-content:center;align-items:center;position:sticky;top:0;left:0;right:0;padding:"," 0;text-align:center;background-color:",";color:",";font-size:",";font-weight:",";border-bottom:"," solid ",";z-index:10;"],(0,z.zA)("2"),(0,z.yW)("Background/Primary"),(0,z.yW)("Text/Tertiary"),(0,z.J)("md"),(0,z.Wy)("semibold"),(0,z.zA)("o"),(0,z.yW)("Misc/Divider")),Oi=R.Ay.div.withConfig({displayName:"Cleanstate"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;width:",";padding:"," 0;text-align:center;","{font-size:",";font-weight:",";color:",";}","{margin-bottom:0;font-size:",";color:",";}"],(({width:t})=>t),(0,z.zA)("12"),Ei.A,(0,z.zA)("3.5"),(0,z.Wy)("semibold"),(0,z.yW)("Text/Primary"),Mt.A,(0,z.zA)("3"),(0,z.yW)("Text/Tertiary")),ji=R.Ay.div.withConfig({displayName:"Timeslots"})(["display:grid;grid-template-columns:repeat(2,1fr);grid-column-gap:",";",""],(0,z.zA)("1.5"),(({columns:t})=>(0,R.AH)(["grid-template-columns:repeat(",",1fr);"],t))),Di=R.Ay.button.withConfig({displayName:"Timeslot"})(["appearance:none;border:none;background:transparent;display:flex;justify-content:center;align-items:center;gap:",";padding:"," ",";border-radius:",";color:",";font-size:",";font-weight:",";cursor:pointer;&:not(:disabled):hover{background-color:",";}&:disabled{cursor:not-allowed;}"," ",""],(0,z.zA)("1"),(0,z.zA)("1.5"),(0,z.zA)("2"),(0,z.zA)("1.5"),(0,z.yW)("Text/Primary"),(0,z.J)("md"),(0,z.Wy)("semibold"),(0,z.yW)("Secondary/Background1"),(({isActive:t})=>t&&(0,R.AH)(["background-color:",";&:hover{background-color:",";}"],(0,z.yW)("Primary/Background2"),(0,z.yW)("Primary/Background2"))),(({status:t})=>{if("unavailable"===t)return(0,R.AH)(["color:",";font-weight:",";"],(0,z.yW)("Text/Tertiary"),(0,z.Wy)("lighter"))})),$i=R.Ay.span.withConfig({displayName:"AvailabilityIndicator"})(["width:",";height:",";border-radius:50%;",""],(0,z.zA)("1.5"),(0,z.zA)("1.5"),(({status:t})=>{switch(t){case"available":return(0,R.AH)(["background-color:",";"],(0,z.yW)("Success/Base"));case"unavailable":return(0,R.AH)(["background-color:",";"],(0,z.yW)("Danger/Base"));default:return(0,R.AH)(["background:#000000;opacity:0.15;animation:pulse 1.5s infinite ease-in-out;@keyframes pulse{0%{opacity:0.05;}50%{opacity:0.15;}100%{opacity:0.05;}}"])}}));Si.Header=Pi,Si.Cleanstate=Oi,Si.Section=Ti,Si.Timeslots=ji,Si.Timeslot=Di,Si.AvailabilityIndicator=$i;var Bi=Si;const Ni=(0,n.memo)((t=>{const e=(0,n.useMemo)((()=>"timeslots"===t.availabilityMode?t.availabilities?.find((e=>e.value===t.field.value)):t.availabilities?.toList?.().find((e=>`${e.hour}:${e.minute}`===t.data.value))),[t.availabilities,t.availabilityMode,t.field,t.data.value]);return n.createElement(Bi.Timeslot,{isActive:t.data.value===t.field.value,onClick:e=>{e.preventDefault(),t.onSelect(t.data.value)},type:"button","data-value":t.data.value,"data-label":t.label},(t.availabilities?.size?t.availabilities?.size():t.availabilities?.length)>0&&t.showAvailability&&n.createElement(Bi.AvailabilityIndicator,{status:e?.status,className:e?.status}),t.label)}));Ni.displayName="TimeButton",Ni.propTypes={data:o().object,field:o().shape({value:o().oneOfType([o().string,o().instanceOf(Date),o().object]),onChange:o().func,onFocus:o().func,onBlur:o().func,onInvalid:o().func,validate:o().func}),onSelect:o().func,showAvailability:o().oneOf([!0,!1,"count"]),availabilities:o().oneOfType([o().array,o().object]),availabilityMode:o().string,label:o().any};const Ii=t=>{const e=Nt.Format.dateFormat("time");return j.Ay.isMoment(t)?t.format(e):(0,j.Ay)(t,"HH:mm").format(e)};var Hi=i(41058);function Fi(){return Fi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Fi.apply(null,arguments)}const Wi=({maxHeight:t,width:e="250px",handleClose:i=()=>{},...s})=>{const{t:o}=(0,Hi.B)("user"),a=(()=>{switch(Nt.Settings.get("store.time_increment")){case 15:return 4;case 30:return 2;default:return 1}})(),r=t=>{s.onSelect(t),i()};if(!s.options?.length)return n.createElement(Bi,{maxHeight:t||"300px"},n.createElement(Bi.Cleanstate,{width:e},n.createElement(Ei.A,null,o(s.translate?"user.store.no_time_available_header":"common.time_picker.no_options_header")),n.createElement(Mt.A,null,o(s.translate?"user.store.no_time_available_text":"common.time_picker.no_options_body"))));if(s.useAMOrPM){const{am:e,pm:i}=s.options.reduce(((t,e)=>(e.label.includes("AM")&&t.am.push(e),e.label.includes("PM")&&t.pm.push(e),t)),{am:[],pm:[]});return n.createElement(Bi,{"data-tid":s["data-tid"],maxHeight:t||"300px"},e.length>0&&n.createElement(Bi.Section,null,n.createElement(Bi.Header,null,"AM"),n.createElement(Bi.Timeslots,{columns:s.columns||a},e.map((t=>{const e=t.label.replace(/\s?(AM|PM)/gi,"");return n.createElement(Ni,Fi({key:t.value},s,{data:t,label:e,onSelect:r}))})))),i.length>0&&n.createElement(Bi.Section,null,n.createElement(Bi.Header,null,"PM"),n.createElement(Bi.Timeslots,{columns:s.columns||a},i.map((t=>{const e=t.label.replace(/\s?(AM|PM)/gi,"");return n.createElement(Ni,Fi({key:t.value},s,{data:t,label:e,onSelect:r}))})))))}return n.createElement(Bi,{"data-tid":s["data-tid"],maxHeight:t||"300px"},n.createElement(Bi.Timeslots,{columns:s.columns||a},s.options.map((t=>n.createElement(Ni,Fi({key:t.value},s,{data:t,label:t.label,onSelect:r}))))))};function Li(){return Li=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Li.apply(null,arguments)}Wi.displayName="Content",Wi.propTypes={field:o().shape({value:o().oneOfType([o().string,o().instanceOf(Date),o().object]),onChange:o().func,onFocus:o().func,onBlur:o().func,onInvalid:o().func,validate:o().func}),columns:o().number,useAMOrPM:o().bool,options:o().arrayOf(o().shape({label:o().any,value:o().string})),onSelect:o().func,availabilityMode:o().string,translate:o().bool,maxHeight:o().string,width:o().string,"data-tid":o().string,handleClose:o().func};const Mi=t=>{const[e,i]=(0,n.useState)(!1),s=(0,Ci.k)();(0,n.useEffect)((()=>{if(!t.usePortal)return;const e=s.selection===t.mode;i(e),t.onTrigger?.(),e?t.onOpen?.():t.onHide?.()}),[s.selection,t.mode,t.usePortal]);const o=(({isTimeSelectable:t,disabledTimes:e,disabled:i,field:s,everythingIsSelectable:o,intervalInMinutes:a=15,operatingRules:r,from:l,to:p})=>{const[c,d]=(0,n.useState)([]),h=()=>{const n=[];if(i&&s?.value&&d([{label:Ii(s.value),value:s.value}]),!i){for(let i=0;i<24;i++)for(let s=0;s<60;s+=a){const a=(0,j.Ay)().hour(i).minute(s);if(e?.before&&(0,j.Ay)(e.before).hour(i).minute(s)<(0,j.Ay)(e.before))continue;if(e?.after&&(0,j.Ay)(e.after).hour(i).minute(s)>(0,j.Ay)(e.after))continue;const r=Ii(a),l=a.format("HH:mm");o&&n.push({label:r,value:l}),t&&t(l)&&n.push({label:r,value:l})}d(n)}};return(0,n.useEffect)((()=>{h()}),[]),(0,n.useEffect)((()=>{h()}),[l?.getTime(),p?.getTime(),r,a,i,t]),c})(t),a=t.field.value?(0,j.Ay)(t.field.value,"HH:mm").format(Nt.Format.dateFormat("time")):t.placeholder,r=e=>{t.field.onChange(e),i(!1)},l=n=>{n.preventDefault(),e?(s.setSelection(null),t.onHide?.()):(s.setSelection(t.mode),t.onOpen?.()),i((t=>!t)),t.onTrigger?.()};return t.usePortal?n.createElement(n.Fragment,null,n.createElement(xi.A.Button,{type:"button",active:e,empty:!t.field.value,disabled:t.disabled,"data-value":t["data-value"],"data-active":String(e),onClick:l,mobile:t.mobile,error:t.error},a),n.createElement(I.A,{open:e,containerRef:t.portalRef},n.createElement(Wi,Li({},t,{options:o,onSelect:r,showAvailability:t.showAvailability&&!!t.lineCount,"data-tid":"Time popover"})))):n.createElement(N.A,Li({},t.popoverOptions||{},{innerRef:t.innerRef,content:n.createElement(Wi,Li({},t,{options:o,onSelect:r,showAvailability:t.showAvailability&&!!t.lineCount,"data-tid":"Time popover"})),method:"click",direction:"bottom",offset:15,onTrigger:()=>{i(!0),t.onTrigger?.()},onHide:()=>{i(!1),t.onHide?.()},onOpen:()=>{i(!0),s.setSelection(t.mode),t.onOpen?.()},delay:[200,null]}),n.createElement(xi.A.Button,{type:"button",active:e,empty:!t.field.value,disabled:t.disabled,"data-value":t["data-value"],"data-active":String(e),error:t.error,onClick:t=>{t.preventDefault(),i(!0)}},a))};function Ri(){return Ri=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Ri.apply(null,arguments)}Mi.displayName="TimeButton",Mi.propTypes={field:o().shape({value:o().oneOfType([o().string,o().instanceOf(Date),o().object]),onChange:o().func,onFocus:o().func,onBlur:o().func,onInvalid:o().func,validate:o().func}),error:o().bool,popoverOptions:o().object,inline:o().bool,mode:o().string,onSelectionChange:o().func,disabled:o().bool,useAMOrPM:o().bool,showAvailability:o().oneOf([!0,!1,"count"]),lineCount:o().oneOfType([o().number,o().bool]),placeholder:o().any,onOpen:o().func,onTrigger:o().func,onHide:o().func,"data-tid":o().string,"data-value":o().string,usePortal:o().bool,mobile:o().bool,innerRef:o().func,portalRef:o().any};const zi=t=>{const[e,i]=(0,n.useState)(!1),{t:s}=(0,Hi.B)("user"),o=(0,Ci.k)();(0,n.useEffect)((()=>{if(!t.usePortal)return;const e="timeslot"===o.selection;i(e),t.onTrigger?.(),e?t.onOpen?.():t.onHide?.()}),[o.selection,t.usePortal]);const a=(t.options||[]).find((e=>e.value===t.field.value))?.label,[r,l]=a?.split(" - ")??"",p=e=>{t.field.onChange(e),i(!1)},c=n=>{n.preventDefault(),e?(o.setSelection(null),t.onHide?.()):(o.setSelection("timeslot"),t.onOpen?.()),i((t=>!t)),t.onTrigger?.()};return t.usePortal?n.createElement(n.Fragment,null,n.createElement(xi.A.Button,{type:"button",active:e,empty:!a,error:t.error,disabled:t.disabled,onClick:c,"data-tid":t["data-tid"],modifiers:"width-100p"},a&&n.createElement(xi.A.Timeslot,null,r,n.createElement(d.A,{icon:"arrow-right"}),l),!a&&n.createElement(xi.A.Timeslot,null,s(t.translate?"user.store.timeslot_from":"common.start.present"),n.createElement(d.A,{icon:"arrow-right"}),s(t.translate?"user.store.timeslot_until":"common.stop.present"))),n.createElement(I.A,{open:e,containerRef:t.portalRef},n.createElement(Wi,Ri({},t,{onSelect:p,showAvailability:t.showAvailability&&!!t.lineCount,useAMOrPM:!1,"data-tid":"Timeslots popover"})))):n.createElement(N.A,Ri({},t.popoverOptions||{},{innerRef:e=>{t.inputRef.current=e},content:n.createElement(Wi,Ri({},t,{onSelect:p,showAvailability:t.showAvailability&&!!t.lineCount,useAMOrPM:!1,"data-tid":"Timeslots popover"})),method:"click",direction:"bottom",offset:15,onTrigger:()=>{i(!0),t.onTrigger?.()},onHide:()=>{i(!1),t.onHide?.()},onOpen:()=>{i(!0),o.setSelection("timeslot"),t.onOpen?.()},delay:[200,null]}),n.createElement(xi.A.Button,{type:"button",active:e,empty:!a,error:t.error,disabled:t.disabled,"data-tid":t["data-tid"],onClick:t=>{t.preventDefault(),i(!0)}},a&&n.createElement(xi.A.Timeslot,null,r,n.createElement(d.A,{icon:"arrow-right"}),l),!a&&n.createElement(xi.A.Timeslot,null,s(t.translate?"user.store.timeslot_from":"common.start.present"),n.createElement(d.A,{icon:"arrow-right"}),s(t.translate?"user.store.timeslot_until":"common.stop.present"))))};zi.displayName="Timeslots",zi.propTypes={options:o().arrayOf(o().shape({label:o().any,value:o().string})),field:o().shape({value:o().oneOfType([o().string,o().instanceOf(Date),o().object]),onChange:o().func,onFocus:o().func,onBlur:o().func,onInvalid:o().func,validate:o().func}),popoverOptions:o().object,error:o().bool,disabled:o().bool,useAMOrPM:o().bool,showAvailability:o().oneOf([!0,!1,"count"]),lineCount:o().oneOfType([o().number,o().bool]),placeholder:o().any,onOpen:o().func,onTrigger:o().func,onSelectionChange:o().func,onHide:o().func,"data-tid":o().string,inputRef:o().any,portalRef:o().any,inline:o().bool,translate:o().bool,usePortal:o().bool};const Ui=R.Ay.div.withConfig({displayName:"Wrapper"})(["display:flex;flex-direction:column;max-height:",";overflow-y:auto;gap:",";padding:"," ",";background-color:",";border-radius:",";"],(({maxHeight:t})=>t),(0,z.zA)("1.5"),(0,z.zA)("3.5"),(0,z.zA)("2"),(0,z.yW)("Background/Primary"),(0,z.zA)("1.5")),qi=R.Ay.div.withConfig({displayName:"Cleanstate"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:400px;width:",";text-align:center;","{font-size:",";font-weight:",";color:",";}","{font-size:",";color:",";}"],(({width:t})=>t),Ei.A,(0,z.zA)("3.5"),(0,z.Wy)("semibold"),(0,z.yW)("Text/Primary"),Mt.A,(0,z.zA)("3"),(0,z.yW)("Text/Tertiary")),Vi=R.Ay.div.withConfig({displayName:"Durations"})(["display:grid;grid-template-columns:1fr;"]),Gi=R.Ay.button.withConfig({displayName:"Duration"})(["appearance:none;border:none;background:transparent;display:flex;justify-content:center;align-items:center;gap:",";margin:0 ",";padding:"," ",";border-radius:",";color:",";font-size:",";font-weight:",";font-family:",";cursor:pointer;white-space:nowrap;&:not(:disabled):hover{background-color:",";}&:disabled{cursor:not-allowed;}",""],(0,z.zA)("1"),(0,z.zA)("1.5"),(0,z.zA)("1.5"),(0,z.zA)("2"),(0,z.zA)("1.5"),(0,z.yW)("Text/Primary"),(0,z.J)("md"),(0,z.Wy)("semibold"),(({theme:t})=>t.font.body),(0,z.yW)("Secondary/Background1"),(({isActive:t})=>t&&(0,R.AH)(["background-color:",";&:hover{background-color:",";}"],(0,z.yW)("Primary/Background2"),(0,z.yW)("Primary/Background2"))));Ui.Cleanstate=qi,Ui.Durations=Vi,Ui.Duration=Gi;var Ji=Ui;function Ki(){return Ki=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Ki.apply(null,arguments)}const Yi=t=>n.createElement(Ji.Duration,{isActive:t.data.value===t.field.value,onClick:()=>t.onSelect(t.data.value),type:"button"},t.data.label);Yi.displayName="DurationButton",Yi.propTypes={data:o().object,field:o().shape({value:o().oneOfType([o().string,o().instanceOf(Date),o().object]),onChange:o().func,onBlur:o().func,onInvalid:o().func,validate:o().func}),onSelect:o().func};const Xi=({maxHeight:t="420px",...e})=>{const{t:i}=(0,Hi.B)("user"),s=t=>{e.onSelect(t)};return e.options.length?n.createElement(Ji,{"data-tid":"Durations popover",maxHeight:t},n.createElement(Ji.Durations,null,e.options.map((t=>n.createElement(Yi,Ki({key:t.value},e,{data:t,onSelect:s})))))):n.createElement(Ji,{"data-tid":"Durations popover",maxHeight:t},n.createElement(Ji.Cleanstate,null,n.createElement(Ei.A,null,i(e.translate?"user.store.no_time_available_header":"common.time_picker.no_options_header")),n.createElement(Mt.A,null,i(e.translate?"user.store.no_time_available_text":"common.time_picker.no_options_body"))))};Xi.displayName="DurationsPopoverContent",Xi.propTypes={options:o().arrayOf(o().shape({label:o().any,value:o().any})),onSelect:o().func,handleClose:o().func,maxHeight:o().string,translate:o().bool};const Zi=t=>{const[e,i]=(0,n.useState)(!1),s=(0,Ci.k)();(0,n.useEffect)((()=>{if(!t.usePortal)return;const e="duration"===s.selection;i(e),t.onTrigger?.(),e?t.onOpen?.():t.onHide?.()}),[s.selection,t.usePortal]);const o=t.options.find((e=>e.value===t.field.value))?.label,a=e=>{t.field.onChange(e),i(!1)},r=n=>{n.preventDefault(),e?(s.setSelection(null),t.onHide?.()):(s.setSelection("duration"),t.onOpen?.()),i((t=>!t)),t.onTrigger?.()};return t.usePortal?n.createElement(n.Fragment,null,n.createElement(xi.A.Button,{type:"button",onClick:r,active:e,empty:!t.field.value,"data-tid":t["data-tid"]},o||t.placeholder),n.createElement(I.A,{open:e,containerRef:t.portalRef},n.createElement(Xi,Ki({onSelect:a},t)))):n.createElement(N.A,Ki({innerRef:t.innerRef,content:n.createElement(Xi,Ki({onSelect:a},t)),method:"click",direction:"bottom",offset:15,onTrigger:()=>{i(!0),t.onTrigger?.()},onHide:()=>{i(!1),t.onHide?.()},onOpen:()=>{s.setSelection("duration"),t.onOpen?.()}},t.popoverOptions||{}),n.createElement(xi.A.Button,{type:"button",active:e,empty:!t.field.value,onClick:t=>{t.preventDefault(),i(!0)},"data-tid":t["data-tid"]},o||t.placeholder))};function Qi(){return Qi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Qi.apply(null,arguments)}Zi.displayName="Durations",Zi.propTypes={options:o().arrayOf(o().shape({label:o().any,value:o().string})),field:o().shape({value:o().oneOfType([o().string,o().instanceOf(Date),o().object]),onChange:o().func,onFocus:o().func,onBlur:o().func,onInvalid:o().func,validate:o().func}),popoverOptions:o().object,placeholder:o().any,onOpen:o().func,onTrigger:o().func,onHide:o().func,onSelectionChange:o().func,inline:o().bool,"data-tid":o().string,innerRef:o().func,portalRef:o().any,usePortal:o().bool};const tn={text:u.A,number:u.A,password:u.A,email:u.A,quantity:m.A,select:f.A,price:A,textarea:S,color:gt,checkbox:M.A,checkboxGroup:Y,datepicker:L,time:vt,buttonGroup:yt.A,radioGroup:yt.A,radio:yt.A,phone:St,timeSelect:xt,contentEditor:Ht,url:De,fontPicker:Fe,code:Le,search:u.A,duration:Ge,multiInput:pi,range:bi,dateButton:Ai,timeButton:Mi,timeslots:zi,durations:Zi},en=["text","password","email"];class nn extends n.Component{static displayName="InputField";static propTypes=(()=>({id:o().string,type:o().oneOf(["text","textarea","number","password","quantity","select","price","email","color","time","datepicker","checkboxGroup","buttonGroup","radio","radioGroup","checkbox","timeSelect","phone","contentEditor","url","font","code","search","duration","multiInput","dateButton","timeButton","timeslots","durations"]),field:o().shape({name:o().any,onChange:o().func,onBlur:o().func,value:o().any}),link:o().string,href:o().string,settingsBackLink:o().node,debounce:o().number,debounceOptions:o().object,form:o().object,error:o().any,errorOnSubmit:o().bool,hideErrorLabel:o().bool,label:o().any,description:o().any,descriptionTop:o().bool,touched:o().any,autoFocus:o().bool,autoSelect:o().bool,fast:o().bool,required:o().bool,hideRequiredAsterisk:o().bool,forceMargin:o().bool,noMargin:o().bool,showIfValid:o().bool,initialError:o().bool,disabled:o().any,"data-tid":o().string,hideLabel:o().bool,hidePreviewLink:o().bool,autoComplete:o().string,display:o().any,preventTargetAssign:o().bool,t:o().func,modifiers:o().oneOfType([o().string,o().object])}))();static defaultProps={type:"text"};constructor(t){super(t),this.state={id:t.id||r()(),value:t.field.value}}componentDidUpdate=t=>{const{fast:e,field:i}=this.props;void 0===i.value||!p()(i.value)&&isNaN(i.value)||e&&t.field.value!==i.value&&this.handleUpdateValue(i.value)};handleUpdateValue=t=>{this.setState({value:t})};fieldProps=()=>{const{field:t,fast:e,form:i,error:n,type:s}=this.props;let{autoSelect:o}=this.props;!1!==o&&-1!==["quantity","number","price"].indexOf(s)&&(o=!0);let a={};if(!n&&e){const{onChange:e,onBlur:n,name:s}=t;a.name=s,a.value=this.state.value,a.onChange=t=>{let n;n=t&&t.target?t.target.value:t,this.setState({value:n}),i.dirty||e(t)},a.onBlur=t=>{e(t),n(t)},a.onKeyDown=t=>{"Enter"===t.key&&e(t)}}else a=t;if(o){const t=a.onFocus;a.onFocus=e=>{t&&t(),e.target.select()}}return a};render(){const{label:t,link:e,href:i,settingsBackLink:s,description:o,descriptionTop:a,error:r,type:l,touched:p,form:u,field:m,hideErrorLabel:f,debounce:g,debounceOptions:b,required:v,hideRequiredAsterisk:y,forceMargin:k,noMargin:_,showIfValid:x,initialError:C,disabled:w,autoComplete:A,display:E,hidePreviewLink:T,modifiers:S,errorOnSubmit:P,t:O,preventTargetAssign:j,...D}=this.props,$=!!m?.value&&"string"===typeof m.value&&"url"===l&&(0,Nt.stringIsLink)(m.value),B=this.state.id,N=tn[l],I=u&&u.dirty,H=u&&u.submitCount>0,F=P?H&&r:C&&I&&r||H&&r||p&&r,W=x&&p&&!r&&(m.value&&m.value.length>0||"boolean"===typeof m.value),L=r&&"object"===typeof r?r:[r];let M=this.props.hideLabel||!1;"select"===l&&(m.onBlur=()=>u&&u.setFieldTouched(m.name));const R="object"===typeof S?S:{self:S},z={type:l,error:F,valid:W,id:B,label:t,noMargin:_,...D,field:this.fieldProps(),autoComplete:A||"off",modifiers:R.inputModifiers};if("checkbox"===l&&(z.description=o,M=!0),en.includes(l))for(const[n,c]of Object.entries(Et.A))z[n]=c;if(F&&(z["data-error"]=r),!N){const t=new Error(`Component of type ${l} missing for InputField`);return window.appsignal?.sendError(t),null}"textarea"===l&&delete z.fast,m.value&&z.defaultValue&&delete z.defaultValue;const U=o&&!M;return n.createElement(c.A,{"data-tid":j?void 0:this.props["data-tid"],"data-force-margin":k,"data-no-margin":_,className:r?"error":null,display:E,modifiers:R.self},(!M||e&&i||s||$)&&n.createElement(c.A.LabelContainer,null,t&&n.createElement(c.A.Label,{modifiers:R.label,htmlFor:B,descriptionTop:a},t," ",v&&!y&&"*"),e&&i&&n.createElement(c.A.Link,{href:i,onClick:Nt.Routing.navigateLink},e),s&&s,$&&!T&&n.createElement(h.A,{href:m.value,icon:"external-link",iconColor:"grey",target:"_blank",title:O("common.resource_actions.preview",{resource:O("common.resources.link_one")}),noBlankIcon:!0})),a&&U&&n.createElement(c.A.Description,{descriptionTop:!0,modifiers:R.description},o),g>0&&n.createElement(nt,Qi({component:N,wait:g,debounceOptions:b,disabled:w},z)),!g&&n.createElement(N,Qi({disabled:w},z)),F&&!f&&n.createElement(c.A.Error,null,n.createElement(d.A,{icon:"exclamation-triangle",style:"far"})," ",L?.join(", ")),W&&n.createElement(c.A.Valid,{type:l},n.createElement(d.A,{icon:"check"})),!a&&U&&n.createElement(c.A.Description,{modifiers:R.description},o))}}nn.displayName="InputField";var sn=(0,Wt.C)()(nn)},23576:function(t,e,i){"use strict";var n=i(96540),s=i(5556),o=i.n(s),a=i(23181),r=i.n(a),l=i(71233),p=i(33376),c=i(90211),d=i(13315);class h extends n.Component{static displayName="Paginator";static propTypes=(()=>({page:o().oneOfType([o().number,o().string]),per:o().number,padding:o().number,total:o().number,paginatePosition:o().oneOf(["left","right"]),onPageChange:o().func,modifiers:o().string,Trans:o().func,size:o().string}))();static defaultProps={per:50,padding:2};get from(){return(this.props.page-1)*this.props.per+1}get till(){return Math.min(this.from+this.props.per-1,this.props.total)}get pages(){return Math.ceil(this.props.total/this.props.per)}get page(){return Math.min(this.props.page,this.pages)}handleClickPage=t=>{this.props.onPageChange(t)};handleClickFirst=()=>{this.props.onPageChange(1)};handleClickLast=()=>{this.props.onPageChange(this.pages)};handleClickPrev=()=>{this.props.onPageChange(this.page-1)};handleClickNext=()=>{this.props.onPageChange(this.page+1)};renderPages=()=>{const t=this.pages,{padding:e,size:i}=this.props,s=r()(1,t+1),o=2*e+1;let a=Math.min(t,this.page+e);const l=Math.max(0,a-o);return a=l+o,s.slice(l,a).map((t=>{const e=t===this.page;return n.createElement(c.A.Page,{key:t,active:e,size:i,onClick:e?void 0:this.handleClickPage.bind(null,t)},t)}))};render(){if(0===this.props.total)return null;const{from:t,till:e,page:i,pages:s}=this,{total:o,paginatePosition:a,modifiers:r,size:l,Trans:h}=this.props,{PageContainer:u,Page:m,Metadata:f}=c.A;return n.createElement(c.A,{modifiers:r,paginatePosition:a},"right"===a&&n.createElement(f,null,n.createElement(h,{i18nKey:"common.pagination.showing",values:{from:t,till:e,total:o},components:{Bold:n.createElement(d.A,null)}})),s>1&&n.createElement(u,{paginatePosition:a},1!==i&&n.createElement(n.Fragment,null,n.createElement(m,{onClick:this.handleClickFirst,size:l},n.createElement(p.A,{icon:"angle-double-left"})),n.createElement(m,{onClick:this.handleClickPrev,size:l},n.createElement(p.A,{icon:"angle-left"}))),this.renderPages(),i!==s&&n.createElement(n.Fragment,null,n.createElement(m,{onClick:this.handleClickNext,size:l},n.createElement(p.A,{icon:"angle-right"})),n.createElement(m,{onClick:this.handleClickLast,size:l},n.createElement(p.A,{icon:"angle-double-right"})))),"right"!==a&&n.createElement(f,null,n.createElement(h,{i18nKey:"common.pagination.showing",values:{from:t,till:e,total:o},components:{Bold:n.createElement(d.A,null)}})))}}h.displayName="Paginator",e.A=(0,l.C)()(h)},45591:function(t,e,i){"use strict";i.d(e,{L:function(){return c},j:function(){return p}});var n=i(96540),s=i(5556),o=i.n(s),a=i(7425),r=i(16555);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},l.apply(null,arguments)}const p=(0,n.createContext)(),c=({components:t,...e})=>{const i=(0,r.k)(),s=(0,a.j7)(),o=s.values.starts_at?new Date(s.values.starts_at):new Date,[c,d]=(0,n.useState)(o);let h=t.Free;switch(i.mode){case"timeslot_duration":h=t.Durations;break;case"timeslot_fixed":h=t.Timeslots;break;default:h=t.Free}return n.createElement(p.Provider,{value:{focusedDate:c,setFocusedDate:d}},n.createElement(h,l({},e,{timeslots:i.getSelectableTimeslots(s.values.starts_at)})))};c.displayName="Picker",c.propTypes={components:o().shape({Free:o().func,Durations:o().func,Timeslots:o().func})}},32273:function(t,e,i){"use strict";i.d(e,{B:function(){return l},q:function(){return r}});var n=i(96540),s=i(5556),o=i.n(s),a=i(30712);const r=(0,n.createContext)({mode:null,selection:"from",calendar:"from",type:null,openingHours:null,allowPast:!1,hasInitialValues:!1,setSelection:()=>{},onChange:()=>{},onValidate:()=>{},isDaySelectable:()=>{},isTimeSelectable:()=>{},getSelectableTimeslots:()=>{},setDefaultTime:()=>{},refs:{fromLocationRef:{current:null},toLocationRef:{current:null},fromDateRef:{current:null},fromTimeRef:{current:null},tillDateRef:{current:null},tillTimeRef:{current:null},timeslotsRef:{current:null},durationsRef:{current:null}}}),l=({mode:t,type:e="order",openingHours:i,useTimes:s,allowPast:o,hasInitialValues:l,isDaySelectable:p,isTimeSelectable:c,getSelectableTimeslots:d,setDefaultTime:h,onValidate:u,children:m})=>{const f=(0,n.useRef)(null),g=(0,n.useRef)(null),b=(0,n.useRef)(null),v=(0,n.useRef)(null),y=(0,n.useRef)(null),k=(0,n.useRef)(null),_=(0,n.useRef)(null),x=(0,n.useRef)(null),[C,w]=(0,n.useState)("from"),[A,E]=(0,n.useState)("from"),T=(0,a.t)("store.use_times"),S=(0,a.t)("store.period_type"),P=t||S,O="timeslot_fixed"!==P&&(void 0!==s?s:T),j=(0,n.useCallback)((t=>{switch(t){case"from":case"to":E(t);break;default:throw new Error(`\n          Invalid calendar value "${t}" passed to "setCalendar".\n          Allowed values are: "from", "to".\n        `)}}),[]),D=(0,n.useCallback)((t=>{switch(t){case"from":case"from_time":case"to":case"to_time":case"timeslot":case"duration":case null:w(t);break;default:throw new Error(`\n          Invalid selection value "${t}" passed to "setSelection".\n          Allowed values are: "from", "from_time", "to", "to_time", "timeslot", "duration", null.\n        `)}switch(t){case"from":j("from");break;case"to":j("to")}}),[]),$=(0,n.useCallback)((t=>{switch(t){case"from":if(j("to"),O)return D("from_time"),setTimeout((()=>{v.current?._tippy?.show()}),1);D("to"),setTimeout((()=>{y.current?._tippy?.show()}),1);break;case"from_time":D("to"),setTimeout((()=>{y.current?._tippy?.show()}),1);break;case"to":if(j("from"),O)return D("to_time"),setTimeout((()=>{k.current?._tippy?.show()}),1);break;case"to_time":j("from"),D(null)}}),[O,e]),B=(0,n.useCallback)((t=>{switch(t){case"from":if(O)return D("from_time"),setTimeout((()=>{v.current?._tippy?.show()}),1);D(null);break;case"from_time":D("to_time"),setTimeout((()=>{k.current?._tippy?.show()}),1);break;case"to_time":D(null);break;case"duration":x.current?._tippy?.hide(),D("from"),setTimeout((()=>{b.current?._tippy?.show()}),1)}}),[O,e]),N=(0,n.useCallback)((t=>{switch(t){case"from":return D("timeslot"),setTimeout((()=>{_.current?._tippy?.show()}),1);case"timeslot":_.current?._tippy?.hide(),D(null)}}),[O,e]),I=(0,n.useCallback)((t=>{switch(P){case"freely":return $(t);case"timeslot_duration":return B(t);case"timeslot_fixed":return N(t);default:throw new Error(`\n            Invalid mode value "${P}" passed used in PickerProvider.\n            Allowed values are: "freely", "timeslot_duration", "timeslot_fixed".\n          `)}}),[P,O,$,B,N]);return n.createElement(r.Provider,{value:{mode:P,allowPast:o,useTimes:O,selection:C,calendar:A,type:e,openingHours:i,hasInitialValues:l,onChange:I,onValidate:u,setSelection:D,isDaySelectable:p,isTimeSelectable:c,getSelectableTimeslots:d,setDefaultTime:h,refs:{fromLocationRef:f,toLocationRef:g,fromDateRef:b,fromTimeRef:v,tillDateRef:y,tillTimeRef:k,timeslotsRef:_,durationsRef:x}}},m)};l.displayName="PickerContextProvider",l.propTypes={children:o().node.isRequired,mode:o().oneOf(["freely","timeslot_duration","timeslot_fixed","undefined"]),type:o().oneOf(["order","cart"]).isRequired,openingHours:o().object,allowPast:o().bool,useTimes:o().bool,hasInitialValues:o().bool.isRequired,isDaySelectable:o().func.isRequired,isTimeSelectable:o().func.isRequired,getSelectableTimeslots:o().func.isRequired,setDefaultTime:o().func.isRequired,onValidate:o().func}},16555:function(t,e,i){"use strict";i.d(e,{F:function(){return h},k:function(){return d}});var n=i(96540),s=i(7425),o=i(32273),a=i(90885),r=i(30712),l=i(64974),p=i(18481),c=i(91718);const d=()=>{const t=(0,n.useContext)(o.q);if(!t)throw Error('"usePicker" should be used within "PickerProvider"');return t},h=t=>{const e=(0,n.useRef)(null),[i,o]=(0,n.useState)({duration:void 0,durationObject:void 0}),d=(0,s.j7)(),h=(0,a.IR)("operating_rules",(t=>t.getAll({data_type:"timeslot_duration"}))),u=(0,r.t)("orders.start_fixed_at",{default:c.D2.start}),m=(0,r.t)("orders.stop_fixed_at",{default:c.D2.stop}),f=(t,e={},n)=>{if(!t)return{};const s=(n||i.durationObject).data,o=(0,l.Ay)(t),a={start:(0,p._l)(u),stop:(0,p._l)(m)};e.starts_at||o.set({h:a.start.hour,m:a.start.minute});const r=(0,c.t)({startTime:o,duration:s.duration,period:s.period,defaultTimes:a});if(e.stops_at&&"hour"!==n.data.period){const t=(0,l.Ay)(e.stops_at);r.set({h:t.hours(),m:t.minutes()})}return{from:o.toDate(),to:r.toDate()}},g=({duration:n,durationObject:s,changePeriod:a=!1})=>{if(e.current?.(),o({duration:n,durationObject:s}),!a)return;const r=d.values.starts_at;if(r){const t=i.durationObject?.get("data").period,e=s.get("data").period,o="hour"===t&&"hour"!==e?null:d.values.stops_at,a=f(r,{starts_at:r,stops_at:o},s);d.setValues({...d.values,starts_at:a.from.toJSON(),stops_at:a.to.toJSON(),charge_in_seconds:parseInt(n)})}t?.(n,s)};return(0,n.useEffect)((()=>{if(i.duration||!h||h.size()<1)return;let t,e;if(1===h.size())e=h.first(),t=e.data.duration;else if(d.values.starts_at&&d.values.stops_at){const i=(0,l.Ay)(d.values.stops_at).diff((0,l.Ay)(d.values.starts_at),"seconds");e=h.toArray().reduce(((t,e)=>{const n=f(d.values.starts_at,d.values,e),s=f(d.values.starts_at,d.values,t),o=(n.to-n.from)/1e3,a=(s.to-s.from)/1e3;return Math.abs(o-i)<Math.abs(a-i)?e:t})),t=e.data.length}else{e=h.toArray().reduce(((t,e)=>e.get("data").length<t.get("data").length?e:t),h.first()),t=e.data.duration}t&&g({duration:t,durationObject:e})})),{clearCacheRef:e,duration:i.duration,durationObject:i.durationObject,onChange:g,getRange:f}}},91718:function(t,e,i){"use strict";i.d(e,{BO:function(){return g},D2:function(){return w},Fr:function(){return x},S:function(){return y},bn:function(){return v},o8:function(){return k},rr:function(){return b},t:function(){return C},tf:function(){return _},zS:function(){return f}});var n=i(64974),s=i(5287),o=i.n(s),a=i(66245),r=i.n(a),l=i(42426),p=i.n(l),c=i(82637),d=i(18481),h=i(90397);const u={weekday:[1,2,3,4,5],weekend:[0,6],mon:[1],tue:[2],wed:[3],thu:[4],fri:[5],sat:[6],sun:[0]},m=(t,e)=>(0,n.Ay)(t).set({hour:e.split(":")[0],minute:e.split(":")[1]}),f=(t,e)=>{const i=Object.keys(e.data)[0],n=e.data[i].from,s=e.data[i].till;return[m(t,n),m(t,s)]},g=({type:t,date:e,openingHours:i,defaultStartTime:s,forceDefaultTime:o=!1,allowPast:a})=>{const r=!!i,l=(0,n.Ay)(e),p=(0,n.Rz)(new Date);l.set({hour:p.hour(),minute:p.minute()});let c=d.Ay.defaultTime(t,{date:l,useOpeningHours:r,operatingRules:i,skipTimeslots:!0,defaultStartTime:s,dontChangeDate:"start"===t,allowPast:a});return"start"===t&&(c.day()===l.day()||o||(c=l.set({hour:c.hour(),minute:c.minute()}))),c},b=({date:t,openingHours:e,allowPast:i=!0})=>{const s=e?(({openingHours:t})=>{const e=[];let i=[0,1,2,3,4,5,6];return t.forEach((t=>{switch(t.data_type){case"hours":{const e=u[Object.keys(t.data)[0]];i=r()(i,e);break}case"away":{const i=t.data.away;e.push({from:(0,n.Ay)(i.from).toDate(),to:(0,n.Ay)(i.till).toDate()})}}})),i.length<7&&e.push({daysOfWeek:i}),e})({openingHours:e}):[];return!(!(0,n.Ay)(t).isBefore((0,n.Rz)(),"day")||i)||0!==s.length&&p()(s,(e=>e.daysOfWeek?e.daysOfWeek.indexOf((0,n.Ay)(t).day())>=0:e.from?(0,n.Ay)(t).isBetween((0,n.Ay)(e.from),(0,n.Ay)(e.to),"day","[]"):void 0))},v=t=>{const{type:e,date:i,openingHours:s,values:o,durationData:a,minDate:r,allowPast:l,defaultTimes:p}=t;if(b({date:i,openingHours:s}))return!1;if(s&&!l&&(0,n.Ay)(i).isBefore((0,n.Rz)(),"day"))return!1;if(r&&(0,n.Ay)(i).isBefore((0,n.Ay)(r),"day"))return!1;if("start"===e&&a){const{duration:e,period:s}=a,o=(0,n.Ay)(i),r=C({startTime:o,duration:e,period:s,defaultTimes:p});if(!v({...t,type:"predictive-stop",date:r}))return!1}return"stop"!==e||!(0,n.Ay)(i).isBefore((0,n.Ay)(o.starts_at),"day")},y=({type:t,timestring:e,openingHours:i,values:s,durationData:o,allowPast:a})=>{const r="start"===t?s.starts_at:s.stops_at;let l;if(l=e?m(r,e):(0,n.Ay)(r),!r||!l.isValid())return!0;if(i){if(!c.Ay.isTimeSelectable(l,{operatingRules:i,skipTimeslots:!0,allowPast:a}))return!1;if("start"===t&&o){const t=(0,n.Ay)(l).add(o.length,"seconds");if("hour"===o.period&&o.length<=86400&&!c.Ay.isTimeSelectable(t,{operatingRules:i,skipTimeslots:!0,allowPast:a}))return!1}}return"stop"!==t||!l.isSame((0,n.Ay)(s.starts_at))&&!l.isBefore((0,n.Ay)(s.starts_at))},k=({type:t,location:e,values:i,locations:n})=>{if(!n)return!0;if("start"===t&&!i.stop_location_id)return!0;if("stop"===t&&!i.start_location_id)return!0;if(!i.start_location_id&&!i.stop_location_id)return!0;e=e||n.getById("start"===t?i.start_location_id:i.stop_location_id);const s=n.getById("start"===t?i.stop_location_id:i.start_location_id);if(!e||!s)return!0;if(e.id===s.id)return!0;return o()(e.cluster_ids,s.cluster_ids).length>0},_=({values:t,locations:e,openingHours:i,allowPast:n})=>{const s={};return t?(k({type:"stop",values:t,locations:e})||(s.stop_location_id="cannot be selected"),v({type:"start",date:t.starts_at,values:t,openingHours:i,allowPast:n})||(s.starts_at={date:"not available"}),v({type:"stop",date:t.stops_at,values:t,openingHours:i,allowPast:n})||(s.stops_at={date:"not available"}),y({type:"start",values:t,openingHours:i,allowPast:n})||(s.starts_at=s.starts_at||{},s.starts_at.time="not available"),y({type:"stop",values:t,openingHours:i,allowPast:n})||(s.stops_at=s.stops_at||{},s.stops_at.time="not available"),s):{start_location_id:"required",stop_location_id:"required",starts_at:{date:"required",time:"required"},stops_at:{date:"required",time:"required"}}},x=(t,e={})=>{const i=h.Ay.get("store.behaviors.location_picker","start_stop");if(e.scope&&"order"===e.scope)return!0;switch(t){case"both":return"auto"!==i;case"start":return["start_stop","start"].includes(i);case"stop":return"start_stop"===i;default:return!1}},C=({startTime:t,duration:e,period:i,defaultTimes:s})=>{if(!t||!n.Ay.isMoment(t))throw new Error("startTime must be a momentjs object");const o=t.clone().add(e,i),a=n.Ay.duration(e,i).asSeconds()>=86400;"day"===i&&a&&o.subtract(1,"day");const r=s.stop.hour<=s.start.hour&&s.stop.minute<=s.start.minute;return"day"===i&&r&&o.add(1,"day"),"hour"!==i&&o.set({h:s.stop.hour,m:s.stop.minute}),o},w={start:"09:00",stop:"15:00"}},85272:function(t,e,i){"use strict";i.d(e,{A:function(){return y}});var n=i(96540),s=i(5556),o=i.n(s),a=i(51504),r=i(79244),l=(i(41587),i(44073));const p=({opened:t,useContentWrapper:e,content:i,contentProps:s,target:o,isMobile:a,useArrow:r,noOverflow:p,color:c,defaultPopoverStyling:d})=>t&&i?e?n.createElement(l.A.Content,{"data-tid":o,interactive:!0,tippy:!0,notFixed:!0},n.createElement(l.A.Inner,{color:c,noOverflow:p,interactive:!0,defaultPopoverStyling:d},"function"===typeof i?i(s):(0,n.cloneElement)(i,s),!a&&r&&!p&&n.createElement(l.A.TippyArrow,{color:c,className:"tippy-arrow","data-popper-arrow":""})),!a&&r&&p&&n.createElement(l.A.TippyArrow,{color:c,className:"tippy-arrow","data-popper-arrow":""})):"function"===typeof i?i(s):(0,n.cloneElement)(i,s):null;p.propTypes={opened:o().bool,content:o().oneOfType([o().func,o().node,o().string]),contentProps:o().object,useArrow:o().bool,useContentWrapper:o().bool,isMobile:o().bool,target:o().string,defaultPopoverStyling:o().bool,noOverflow:o().bool,color:o().string};var c=p;function d(){return d=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},d.apply(null,arguments)}const h={followCursor:r.M};class u extends n.Component{static displayName="AutomaticPopover";static propTypes=(()=>({children:o().oneOfType([o().func,o().node,o().string]),content:o().oneOfType([o().func,o().node,o().string]),isMobile:o().bool,offset:o().number,direction:o().oneOf(["top","right","bottom","left","top-start","top-end","right-start","right-end","bottom-start","bottom-end","left-start","left-end"]),method:o().oneOf(["click","hover"]),onOpen:o().func,onHide:o().func,onHidden:o().func,fixed:o().bool,delay:o().oneOfType([o().number,o().array]),animation:o().string,useContentWrapper:o().bool,useArrow:o().bool,fallbackPlacements:o().array,zIndex:o().number,target:o().string,noContentOverflow:o().bool,interactive:o().bool,defaultPopoverStyling:o().bool,unmountOnClose:o().bool,sticky:o().bool,stickyConfig:o().object,innerRef:o().func,withInertia:o().bool,plugins:o().object,appendTo:o().oneOfType([o().string,o().element])}))();static defaultProps={method:"click",direction:"right",animation:"shift-toward",offset:10,useArrow:!0,useContentWrapper:!0,interactive:!0,unmountOnClose:!0,onOpen:()=>{},onClose:()=>{},onHide:()=>{},onHidden:()=>{},zIndex:999999999};state={opened:!1};get modifiers(){const t=[],{useArrow:e,fallbackPlacements:i}=this.props;if(e&&t.push({name:"arrow",options:{element:this.arrow}}),i&&t.push({name:"flip",options:{fallbackPlacements:i}}),window.tippyNoFlip){const e=t.find((t=>"flip"===t.name));e?e.enabled=!1:t.push({name:"flip",enabled:!1})}return t}get plugins(){const{plugins:t}=this.props,e=[],i={};for(const n in t){if(!["followCursor"].includes(n))return null;e.push(h[n]),i[n]=t[n]}return{plugins:e,...i}}onOpen=()=>{const{onOpen:t}=this.props;this.setState({opened:!0}),t&&t()};onHidden=()=>{const{onHidden:t,unmountOnClose:e}=this.props;e&&this.setState({opened:!1}),t?.()};handleCreate=t=>{this.tippy=t};render(){const{children:t,content:e,direction:i,method:s,offset:o,isMobile:r,fixed:p,delay:h,useContentWrapper:u,animation:m,useArrow:f,zIndex:g,target:b,noContentOverflow:v,interactive:y,defaultPopoverStyling:k,sticky:_,stickyConfig:x,innerRef:C,withInertia:w,appendTo:A,onHide:E}=this.props,T="hover"===s?"mouseenter focus":s,S={handleClose:this.tippy&&this.tippy.hide};return n.createElement(a.Ay,d({ref:t=>C?.(t),zIndex:g,placement:i,interactive:y,interactiveBorder:10,offset:[0,o],animation:m,onCreate:this.handleCreate,onShow:this.onOpen,onHidden:this.onHidden,onHide:E,appendTo:A||document.body,trigger:T,delay:h},w?{inertia:!0,moveTransition:"transform 250ms cubic-bezier(.860, 0, .070, 1)"}:{},this.plugins,{popperOptions:{strategy:p?"fixed":"absolute",modifiers:this.modifiers},content:n.createElement(c,{opened:this.state.opened,useContentWrapper:u,content:e,contentProps:S,useArrow:f,target:b,isMobile:r,noOverflow:v,defaultPopoverStyling:k})}),n.createElement(l.A.Wrapper,{sticky:_,stickyConfig:x},t))}}function m(){return m=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},m.apply(null,arguments)}u.displayName="AutomaticPopover";const f={followCursor:r.M};class g extends n.Component{static displayName="ControlledPopover";static propTypes=(()=>({children:o().oneOfType([o().node,o().string,o().func]),content:o().oneOfType([o().node,o().string,o().func]),isMobile:o().bool,open:o().bool.isRequired,forceOpen:o().bool,color:o().oneOf(["primary"]),offset:o().number,direction:o().oneOf(["top","right","bottom","left","top-start","top-end","right-start","right-end","bottom-start","bottom-end","left-start","left-end"]),onOpen:o().func,onClose:o().func,onHide:o().func,onHidden:o().func,fixed:o().bool,animation:o().string,useContentWrapper:o().bool,useArrow:o().bool,fallbackPlacements:o().array,zIndex:o().number,target:o().string,noContentOverflow:o().bool,interactive:o().bool,defaultPopoverStyling:o().bool,sticky:o().bool,stickyConfig:o().object,innerRef:o().func,withInertia:o().bool,plugins:o().object,appendTo:o().oneOfType([o().string,o().element])}))();static defaultProps={method:"click",direction:"right",animation:"shift-toward",offset:10,useArrow:!0,useContentWrapper:!0,interactive:!0,open:!1,onOpen:()=>{},onClose:()=>{},onHide:()=>{},onHidden:()=>{},zIndex:999999999};state={opened:!1};get modifiers(){const t=[],{useArrow:e,fallbackPlacements:i}=this.props;if(e&&t.push({name:"arrow",options:{element:this.arrow}}),i&&t.push({name:"flip",options:{fallbackPlacements:i}}),window.tippyNoFlip){const e=t.find((t=>"flip"===t.name));e?e.enabled=!1:t.push({name:"flip",enabled:!1})}return t}get plugins(){const{plugins:t}=this.props,e=[],i={};for(const n in t){if(!["followCursor"].includes(n))return null;e.push(f[n]),i[n]=t[n]}return{plugins:e,...i}}componentDidUpdate=t=>{t.open!==this.props.open&&this.props.open&&(this.state.opened||this.setState({opened:!0}))};render(){const{children:t,content:e,direction:i,offset:s,onOpen:o,onClose:r,onHide:p,onHidden:d,isMobile:h,fixed:u,useContentWrapper:f,animation:g,useArrow:b,zIndex:v,target:y,noContentOverflow:k,sticky:_,stickyConfig:x,interactive:C,defaultPopoverStyling:w,innerRef:A,withInertia:E,forceOpen:T,color:S,appendTo:P}=this.props,O={handleClose:r};return n.createElement(a.Ay,m({ref:t=>A?.(t),zIndex:v,placement:i,interactive:C,interactiveBorder:10,offset:[0,s],animation:g,onShow:o,onHide:p,onHidden:d,appendTo:P||document.body,visible:this.props.open,onClickOutside:r},E?{inertia:!0,moveTransition:"transform 250ms cubic-bezier(.860, 0, .070, 1)"}:{},this.plugins,{popperOptions:{strategy:u?"fixed":"absolute",modifiers:[{name:"preventOverflow",options:{altAxis:!0,tether:!1}},...this.modifiers]},content:n.createElement(c,{opened:this.state.opened||T,useContentWrapper:f,content:e,contentProps:O,useArrow:b,target:y,isMobile:h,noOverflow:k,color:S,defaultPopoverStyling:w})}),n.createElement(l.A.Wrapper,{sticky:_,stickyConfig:x},t))}}function b(){return b=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},b.apply(null,arguments)}g.displayName="ControlledPopover";const v=({method:t,...e})=>"manual"===t?n.createElement(g,e):n.createElement(u,b({method:t},e));v.displayName="Popover",v.propTypes={method:o().string};var y=v},19562:function(t,e,i){"use strict";var n=i(96540),s=i(40961),o=i(5556),a=i.n(o);const r=({open:t=!1,children:e,containerRef:i})=>{const o=(0,n.useRef)(null),[a,r]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(!i){const t=document.createElement("div");return document.body.appendChild(t),o.current=t,r(t),()=>{o.current&&document.body.removeChild(o.current)}}r(i.current)}),[i]),t&&a?(0,s.createPortal)(e,a):null};r.displayName="PortalWrapper",r.propTypes={children:a().node,open:a().bool,containerRef:a().shape({current:a().instanceOf(Element)})},e.A=r},98412:function(t,e,i){"use strict";i.d(e,{A:function(){return d}});var n=i(96540),s=i(5556),o=i.n(s),a=i(80692),r=i(77829),l=i(33376),p=i(90336);function c(){return c=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},c.apply(null,arguments)}class d extends n.Component{static displayName="QuantityInput";static propTypes=(()=>({min:o().number,max:o().number,field:o().object,size:o().oneOf(["sm","md","lg"]),disabled:o().bool,disabledTooltip:o().any,autoFocus:o().bool,allowEmpty:o().bool}))();static defaultProps={size:"md",field:{}};state={value:this.props.field.value};componentDidUpdate=t=>{let e=parseInt(this.props.field.value);t.field.value!==this.props.field.value&&this.state.value!==e&&(isNaN(e)&&(e=this.props.field.value),this.setState({value:e}))};handleAdd=()=>{const{onChange:t,value:e}=this.props.field,{max:i}=this.props;let n=e;if("string"===typeof e&&(n=parseInt(e)),null==i||n+1<=i){const e=+n+1;t(e),this.setState({value:e})}};handleSubtract=()=>{const{onChange:t,value:e}=this.props.field,{min:i}=this.props;let n=e;if("string"===typeof e&&(n=parseInt(e)),null==i||n-1>=i){const e=+n-1;t(e),this.setState({value:e})}};handleChange=t=>{const{onChange:e}=this.props.field,{min:i,max:n,allowEmpty:s}=this.props;if(""===t.target.value)return s&&e(t.target.value),void this.setState({value:t.target.value});let o=t&&Number(t.target.value);void 0!==i&&i>o?o=i:void 0!==n&&n<o&&(o=n),e(o),this.setState({value:o})};handleBlur=t=>{const{value:e,onBlur:i}=this.props.field;this.setState({value:e}),i&&i(t)};render(){const{field:t,disabled:e,size:i,max:s,min:o,autoFocus:d,disabledTooltip:h,...u}=this.props,m=t.value>=s,f=t.value<=o,{value:g}=this.state;return n.createElement(a.A,{disabled:e,size:i},n.createElement(r.A,{preserveBorders:!0},n.createElement(a.A.Input,c({max:s,min:o},t,u,{value:g,disabled:e,size:i,autoFocus:d,onChange:this.handleChange,onBlur:this.handleBlur})),n.createElement(a.A.ControlContainer,null,n.createElement(a.A.Control,{plus:!0,disabled:m||e,onClick:m||e?void 0:this.handleAdd,size:i},n.createElement(p.A,{direction:"top",content:(m||e)&&(h?.max||null)},n.createElement(l.A,{icon:"plus","data-tid":"Bump up order weight"}))),n.createElement(a.A.Control,{minus:!0,disabled:f||e,onClick:f||e?void 0:this.handleSubtract,size:i},n.createElement(p.A,{direction:"bottom",content:(f||e)&&(h?.min||null)},n.createElement(l.A,{icon:"minus","data-tid":"Bump down order weight"}))))))}}d.displayName="QuantityInput"},96579:function(t,e,i){"use strict";i.d(e,{A:function(){return h}});var n=i(96540),s=i(5556),o=i.n(s),a=i(40130);class r extends n.Component{static displayName="RadioBox";static propTypes=(()=>({checked:o().bool,label:o().any,description:o().any,children:o().node,onClick:o().func,exclusive:o().bool,bordered:o().bool,"data-tid":o().string,modifiers:o().oneOfType([o().string,o().object])}))();render(){const{checked:t,label:e,description:i,children:s,onClick:o,exclusive:r,bordered:l,modifiers:p,"data-tid":c}=this.props,d=s&&!r||s&&t,h="object"===typeof p?p:{self:p};return n.createElement(a.A.Radio,{modifiers:h.radioGroup,checked:t,onClick:o,bordered:l,"data-tid":c},n.createElement(a.A.RadioButton,{icon:"circle",modifiers:h.radioGroupIcon}),n.createElement(a.A.Label,{modifiers:h.radioGroupLabel},e),i&&n.createElement(a.A.Description,null,i),d&&n.createElement(a.A.ChildContainer,null,s))}}r.displayName="RadioBox";var l=i(62704);class p extends n.Component{static displayName="ButtonBox";static propTypes=(()=>({checked:o().bool,label:o().any,onClick:o().func,size:o().string,icon:o().string}))();render(){const{checked:t,label:e,onClick:i,size:s,icon:o}=this.props;return n.createElement(l.A,{onClick:i,color:t?"primary":"white",size:s,"data-tid":`Radio button: ${e}`,icon:o},e)}}p.displayName="ButtonBox";var c=i(33376);function d(){return d=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},d.apply(null,arguments)}class h extends n.Component{static displayName="RadioGroup";static propTypes=(()=>({options:o().arrayOf(o().shape({value:o().oneOfType([o().string,o().number,o().bool]),label:o().any.isRequired,description:o().any,children:o().node})).isRequired,onChange:o().func,field:o().object,exclusive:o().bool,centered:o().bool,type:o().string,form:o().object,size:o().string,displayGrid:o().any,bordered:o().bool,errorOnSubmit:o().bool,"data-tid":o().string,modifiers:o().oneOfType([o().string,o().object]),initialError:o().any,error:o().any,touched:o().any,hideErrorLabel:o().any}))();onChange=t=>{const{field:e,form:i}=this.props;e.onChange(t),setTimeout((()=>{i&&i.setFieldTouched(e.name,!0,!0)}),1)};renderOptions=t=>{const{exclusive:e,field:i,type:s,size:o,bordered:l,modifiers:c,...h}=this.props,{value:u}=i;return"buttonGroup"===s?n.createElement(a.A.Buttons,h,t.map((t=>n.createElement(p,d({size:o},t,{checked:u===t.value,key:t.value,onClick:this.onChange.bind(this,t.value),modifiers:c}))))):t.map((t=>n.createElement(r,d({},t,{checked:u===t.value,key:t.value,onClick:this.onChange.bind(this,t.value),exclusive:e,bordered:l,"data-tid":`Checked ${u===t.value}`,modifiers:c}))))};render(){const{options:t,type:e,initialError:i,error:s,form:o,touched:r,hideErrorLabel:l,errorOnSubmit:p,bordered:d,"data-tid":h,modifiers:u,displayGrid:m}=this.props,f=o&&o.dirty,g=o&&o.submitCount>0,b=p&&s&&g||i&&f&&s||g&&!r&&s,v="object"===typeof u?u:{self:u};return n.createElement(a.A,{type:e,centered:!1,error:b&&s,bordered:d,"data-tid":h,modifiers:v.self,displayGrid:m},this.renderOptions(t),b&&!l&&n.createElement(a.A.Error,null,n.createElement(c.A,{icon:"exclamation-triangle",style:"far"})," ",s))}}h.displayName="RadioGroup"},82252:function(t,e,i){"use strict";i.d(e,{A:function(){return C}});var n=i(96540),s=i(5556),o=i.n(s),a=i(6251),r=i(83089),l=i(96729),p=i(51510),c=i(7309),d=i.n(c),h=i(55364),u=i.n(h),m=i(71233),f=i(89227);var g=p.Ay.div.withConfig({displayName:"ReactSelect"})([".Select__value-container--is-multi.Select__value-container--has-value{padding:4px 0 6px;.Select__input{height:auto !important;& > input{height:auto !important;}}div:last-child{height:auto !important;}}.Select{&__indicator-separator{display:none;}&__menu{z-index:5;}&__indicators{height:",";}&__single-value{overflow:visible;color:",";&--is-disabled{color:"," !important;}}&__value-container{height:"," !important;padding:0;","}&__input{height:"," !important;& > input{height:"," !important;}}&__multi-value{margin:0;margin-top:4px;margin-right:4px;}&__control{padding:0 0 0 ",";height:"," !important;min-height:",";color:",";background:",";border:"," "," solid;border-radius:",";font-size:",";overflow:visible !important;cursor:pointer;"," "," "," "," &--is-focused{box-shadow:none;border-color:"," !important;&:hover{border-color:"," !important;}}}&-input,&-value-label,&-placeholder{line-height:calc("," - 2px) !important;font-size:",";font-weight:",";}&-value{padding:0 0 0 "," !important;}&-placeholder{display:inline;padding:0;position:static;color:",";}&-input{position:absolute;top:0;left:0;padding:0 0 0 ",";}&.is-open{> .Select__indicators{border-color:",";border-bottom-left-radius:0;border-bottom-right-radius:0;}.Select-menu-outer{border-top-color:",";}}&--is-disabled{pointer-events:none;.Select__control{background:",";}}}"],(0,f.Ej)("controlHeight"),(0,f.yW)("Text/Primary"),(0,f.yW)("Text/Secondary"),(0,f.Ej)("controlHeight"),(({isMulti:t})=>t&&(0,p.AH)(["height:auto !important;min-height:"," !important;"],(0,f.Ej)("controlHeight"))),(0,f.Ej)("controlHeight"),(0,f.Ej)("controlHeight"),(0,f.Ej)("padding"),(0,f.Ej)("controlHeight"),(0,f.Ej)("controlHeight"),(0,f.yW)("Text/Primary"),(0,f.yW)("white"),(0,f.Ej)("borderWidth"),(0,f.yW)("Misc/Divider"),(0,f.Ej)("borderRadius"),(0,f.J)(),(t=>t.valid&&(0,p.AH)(["border-color:"," !important;box-shadow:none !important;"],(0,f.yW)("Success/Base"))),(t=>t.error&&(0,p.AH)(["border-color:"," !important;box-shadow:none !important;"],(0,f.yW)("Danger/Base"))),(t=>!t.error&&(0,p.AH)(["&:hover{border-color:"," !important;}&:focus{border-color:"," !important;&:hover{border-color:"," !important;}}"],(0,f.yW)("borderHover"),(0,f.yW)("Primary/Base"),(0,f.yW)("Primary/Base"))),(({isMulti:t})=>t&&(0,p.AH)(["height:auto !important;min-height:"," !important;"],(0,f.Ej)("controlHeight"))),(0,f.yW)("Primary/Base"),(0,f.yW)("Primary/Base"),(0,f.Ej)("controlHeight"),(0,f.J)(),(0,f.Wy)("lighter"),(0,f.Ej)("padding"),(0,f.yW)("Text/Tertiary"),(0,f.Ej)("padding"),(0,f.yW)("Primary/Base"),(0,f.yW)("Primary/Base"),(0,f.yW)("Background/Base")),b=i(18248),v=i(33376);function y(){return y=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},y.apply(null,arguments)}const k=(t,e)=>{if(t.isDisabled)return`${(0,f.yW)("light")} !important`;if(t.isSelected){const t=(0,f.HD)((0,f.yW)("Primary/Base")(e))?"Text/Inverted":"Text/Primary";return`${(0,f.yW)(t)(e)} !important`}return`${(0,f.yW)("Text/Primary")(e)} !important`},_=(t,e)=>t.isSelected?`${(0,f.yW)("Primary/Base")(e)}66 !important`:t.isFocused?`${(0,f.yW)("light")(e)}66 !important`:null;class x extends n.Component{static displayName="Select";static propTypes=(()=>({label:o().any,field:o().object,error:o().any,valid:o().bool,disabled:o().bool,options:o().array,size:o().oneOf(["xs","sm","md","lg"]),usePortal:o().bool,inputRef:o().any,isMulti:o().bool,isSearchable:o().bool,creatable:o().bool,forceValue:o().bool,forceOnChange:o().bool,renderNativeOnMobile:o().bool,placeholder:o().any,theme:o().object,styles:o().object,"data-tid":o().string,value:o().any,onChange:o().func,t:o().func}))();static defaultProps={size:"md",clearable:!1,clearableValue:!1,backspaceRemoves:!1,placeholder:!1,renderNativeOnMobile:!0};get customStyles(){let t={input:()=>({height:`${(0,f.Ej)("controlHeight")(this.props)} !important`,margin:"-1px 0",padding:0}),menuPortal:t=>({...t,zIndex:10000001,fontFamily:this.props.theme.font.body}),menuList:t=>({...t,fontSize:14,fontWeight:400}),option:(t,e)=>({...t,cursor:e.isDisabled?"default":"pointer",color:k(e,this.props),background:_(e,this.props)})};return this.props.styles&&(t=u()(t,this.props.styles)),t}get value(){if(this.props.forceValue)return this.props.value;let t=null;const{options:e,field:i}=this.props;return e?(Array.isArray(i.value)?(t=[],i.value.forEach((e=>{t.push(this.optionFromValue(e))}))):t=this.optionFromValue(i.value),t):void 0}optionFromValue=t=>{const{options:e}=this.props;let i;return e.forEach((e=>{if(e.options){const n=d()(e.options,["value",t]);i=i||n}else e.value===t?i=e:t&&!i&&(i={value:t,label:t})})),i};isMobile=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);handleChange=t=>{let e;if(e=t&&t.target?t.target.value:t?Array.isArray(t)?t.map((t=>t.value)):t.value:null,this.props.onChange&&this.props.forceOnChange)return this.props.onChange(e);setTimeout((()=>{this.props.field.onChange(e)}),0)};renderMobileSelect=()=>{const{field:t,disabled:e,options:i,size:s,error:o,placeholder:a}=this.props,r=!t?.value?.length,l=a||this.props.t("common.select_placeholder"),p=this.props["data-tid"];return n.createElement(b.A,{"data-tid":p,isMobile:!0},n.createElement(b.A.Select,{size:s,value:t?.value,onChange:this.handleChange,disabled:e,error:o},r&&n.createElement("option",{disabled:!0,selected:!0,value:""},l),i&&i.map((t=>n.createElement("option",{key:t.value,value:t.value},t.label)))),n.createElement(v.A,{icon:"angle-down"}))};scrollSelectedOptionIntoView=()=>{setTimeout((()=>{const t=document.querySelector(".Select__option--is-selected");if(t){t.parentElement.scrollTop=t.offsetTop}}),0)};render(){if(this.isMobile()&&this.props.renderNativeOnMobile)return this.renderMobileSelect();const{size:t,field:e,options:i,error:s,valid:o,inputRef:p,usePortal:c,disabled:d,creatable:h,isMulti:u,isSearchable:m,placeholder:f,t:v,...k}=this.props,_=h?l.Ay:a.Ay,x=f||v("common.select_placeholder"),C=this.props["data-tid"];return n.createElement(b.A,{isMulti:u,"data-tid":C},n.createElement(g,{size:t,error:!d&&s,valid:o,isMulti:u},n.createElement(_,y({options:i},e,k,{isMulti:u,value:this.value||"",classNamePrefix:"Select",ref:t=>{this.ref=t,p?.(t)},onChange:this.handleChange,styles:this.customStyles,menuPortalTarget:c?document.body:null,menuPosition:"absolute",isDisabled:d,isSearchable:void 0!==m?m:!this.isMobile(),placeholder:x,filterOption:(0,r.c)({stringify:t=>t.label}),onMenuOpen:this.scrollSelectedOptionIntoView}))))}}x.displayName="Select";var C=(0,m.C)()((0,p.SL)(x))},90336:function(t,e,i){"use strict";i.d(e,{A:function(){return l}});var n=i(96540),s=i(5556),o=i.n(s),a=i(85272),r=i(44073);class l extends n.Component{static displayName="Tooltip";static propTypes=(()=>({direction:o().oneOf(["top","right","bottom","left"]),content:o().oneOfType([o().string,o().node]),maxWidth:o().oneOfType([o().string,o().number]),children:o().node,center:o().bool,disabled:o().bool,onMouseEnter:o().func,onMouseLeave:o().func,offset:o().number}))();static defaultProps={offset:10};render(){const{children:t,direction:e,content:i,disabled:s,maxWidth:o,onMouseEnter:l,onMouseLeave:p,center:c,offset:d}=this.props;return n.createElement(a.A,{useContentWrapper:!1,interactive:!1,direction:e,method:"hover",offset:d,content:i&&n.createElement(r.A.Content,{disabled:s,direction:e,onMouseEnter:l,onMouseLeave:p,tippy:!0,notFixed:!0},n.createElement(r.A.Inner,{maxWidth:o,center:c},i,n.createElement(r.A.Arrow,{direction:e})))},t)}}l.displayName="Tooltip"},13315:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.b.withConfig({displayName:"B"})(["font-weight:700;",""],(({theme:t})=>(0,s.Ch)((0,o.A)(t))));e.A=a},21227:function(t,e,i){"use strict";var n=i(51510),s=i(11162);const o=(0,n.Ay)(s.A).withConfig({displayName:"Col"})([""]);e.A=o},44591:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(11162);const a=(0,n.Ay)(o.A).withConfig({displayName:"Description"})(["margin:0;color:",";font-size:",";font-weight:",";line-height:20px;",""],(0,s.yW)("Text/Secondary"),(0,s.J)("md"),(0,s.Wy)("lighter"),(t=>t.inline&&(0,n.AH)(["display:inline;"])));e.A=a},11162:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.div.withConfig({displayName:"Div"})(["",""],(({theme:t})=>(0,s.Ch)((0,o.A)(t))));e.A=a},55954:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.h1.withConfig({displayName:"H1"})(["font-size:",";font-weight:100;",""],(0,s.J)("xxl"),(({theme:t})=>(0,s.Ch)((0,o.A)(t))));e.A=a},56863:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.h2.withConfig({displayName:"H2"})(["margin:0;color:",";font-size:",";font-weight:",";",""],(0,s.yW)("Text/Primary"),(0,s.J)("xl"),(0,s.Wy)("semibold"),(({theme:t})=>(0,s.Ch)((0,o.A)(t))));e.A=a},45544:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.h3.withConfig({displayName:"H3"})(["margin:0;color:",";font-family:",";font-size:",";font-weight:",";",""],(0,s.yW)("Text/Primary"),(t=>t.theme.font.body),(0,s.J)("lg"),(0,s.Wy)("semibold"),(({theme:t})=>(0,s.Ch)((0,o.A)(t))));e.A=a},72735:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.hr.withConfig({displayName:"Hr"})(["border-color:",";margin:"," 0;border-width:",";",""],(0,s.yW)("Misc/Divider"),(0,s.Ej)("margin"),(({thick:t})=>t?"2px":"1px"),(({theme:t})=>(0,s.Ch)((0,o.A)(t))));e.A=a},68709:function(t,e,i){"use strict";var n=i(51510),s=i(89227);const o=n.Ay.input.withConfig({displayName:"Input"})(["&&{display:inline-block;vertical-align:middle;width:100%;height:",";padding:0 ",";margin:0;color:",";background:",";border:"," solid ",";border-radius:",";outline:0;font-size:",";font-weight:",";line-height:1;box-sizing:border-box;"," "," "," "," "," "," &::placeholder{color:"," !important;font-size:"," !important;}}"],(0,s.Ej)("controlHeight"),(0,s.Ej)("padding"),(0,s.yW)("Text/Primary"),(0,s.yW)("white"),(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Ej)("borderRadius","sm"),(0,s.J)(),(0,s.Wy)("lighter"),(t=>t.visibleOnHover&&(0,n.AH)(["border-color:transparent;background:transparent;"])),(t=>t.readOnly&&(0,n.AH)(["color:"," !important;border-color:"," !important;"],(0,s.yW)("Text/Tertiary"),(0,s.yW)("Misc/Divider"))),(t=>t.error&&(0,n.AH)(["border-color:",";&:hover:not(:focus){border-color:",";}&:hover{border-color:",";}&:focus{border-color:",";&:hover{border-color:",";}}"],(0,s.yW)("Danger/Base"),(0,s.yW)("Danger/Base"),(0,s.yW)("Danger/Base"),(0,s.yW)("Danger/Base"),(0,s.yW)("Danger/Base"))),(t=>!t.error&&(0,n.AH)(["&:hover{border-color:",";}&:focus{border-color:",";&:hover{border-color:",";}}",""],(0,s.yW)("borderHover"),(0,s.yW)("Primary/Base"),(0,s.yW)("Primary/Base"),(t=>t.focused&&(0,n.AH)(["border-color:"," !important;&:hover{border-color:"," !important;}"],(0,s.yW)("Primary/Base"),(0,s.yW)("Primary/Base"))))),(t=>t.disabled&&(0,n.AH)(["background:",";pointer-events:none;"],(0,s.yW)("Background/Base"))),(t=>t.valid&&(0,n.AH)(["border-color:",";"],(0,s.yW)("Success/Base"))),(0,s.yW)("Text/Tertiary"),(0,s.J)());e.A=o},76667:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.label.withConfig({displayName:"Label"})(["display:block;color:",";font-size:",";font-weight:",";line-height:",";margin-bottom:5px;"," "," ",""],(0,s.yW)("Text/Primary"),(0,s.J)("md"),(0,s.Wy)("semibold"),(0,s.J)("md"),(t=>t.inline&&(0,n.AH)(["display:inline;vertical-align:middle;"])),(t=>t.cursor&&(0,n.AH)(["cursor:",";"],t.cursor)),(({theme:t})=>(0,s.Ch)((0,o.A)(t))));e.A=a},82517:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(7120);const a=n.Ay.p.withConfig({displayName:"P"})([""," ",""],(({theme:t})=>(0,s.Ch)((0,o.A)(t))),(t=>"light"===t.color&&(0,n.AH)(["color:",";"],(0,s.yW)("Text/Secondary"))));e.A=a},23197:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(21227),a=i(11162);const r=(0,n.Ay)(a.A).withConfig({displayName:"Row"})([""," "," "," ",""],(t=>t.smallGutters&&(0,n.AH)(["margin-left:-",";margin-right:-",";> ","{padding-left:",";padding-right:",";}"],(0,s.Ej)("padding","xs"),(0,s.Ej)("padding","xs"),o.A,(0,s.Ej)("padding","xs"),(0,s.Ej)("padding","xs"))),(t=>t.noGutters&&(0,n.AH)(["margin-left:0;margin-right:0;> ","{padding-left:0;padding-right:0;}"],o.A)),(t=>t.equalHeight&&(0,n.AH)(["@media (min-width:992px){display:flex;flex-wrap:wrap;}","{@media (min-width:992px){display:flex;flex-direction:column;}}"],o.A)),(t=>t.marginBottom&&(0,n.AH)(["","{margin-bottom:",";}"],o.A,(0,s.Ej)("margin","md"))));e.A=r},54243:function(t,e,i){"use strict";var n=i(51510),s=i(89227),o=i(21663);const a=(0,n.Ay)(o.A).withConfig({displayName:"TextArea"})(["height:100%;width:100%;padding:",";color:",";background:",";border:"," solid ",";font-weight:",";font-size:",";border-radius:",";appearance:none;"," "," "," "," "," &::placeholder{color:"," !important;font-size:"," !important;}",""],(0,s.Ej)("padding"),(0,s.yW)("Text/Primary"),(0,s.yW)("white"),(0,s.Ej)("borderWidth"),(0,s.yW)("Misc/Divider"),(0,s.Wy)("lighter"),(0,s.J)(),(0,s.Ej)("borderRadius"),(t=>t.visibleOnHover&&(0,n.AH)(["border-color:transparent;background:transparent;"])),(t=>t.readOnly&&(0,n.AH)(["color:"," !important;border-color:"," !important;"],(0,s.yW)("Text/Tertiary"),(0,s.yW)("Misc/Divider"))),(t=>t.error&&(0,n.AH)(["border-color:"," !important;"],(0,s.yW)("Danger/Base"))),(t=>!t.error&&(0,n.AH)(["&:hover{border-color:",";}&:focus{border-color:",";&:hover{border-color:",";}}"],(0,s.yW)("borderHover"),(0,s.yW)("Primary/Base"),(0,s.yW)("Primary/Base"))),(t=>t.disabled&&(0,n.AH)(["background:",";pointer-events:none;"],(0,s.yW)("Background/Base"))),(0,s.yW)("Text/Tertiary"),(0,s.J)(),(t=>t.monospace&&(0,n.AH)(["font-family:monospace;"])));e.A=a},90952:function(t,e,i){var n={"./af":25177,"./af.js":25177,"./ar":61509,"./ar-dz":41488,"./ar-dz.js":41488,"./ar-kw":58676,"./ar-kw.js":58676,"./ar-ly":42353,"./ar-ly.js":42353,"./ar-ma":24496,"./ar-ma.js":24496,"./ar-ps":6947,"./ar-ps.js":6947,"./ar-sa":82682,"./ar-sa.js":82682,"./ar-tn":89756,"./ar-tn.js":89756,"./ar.js":61509,"./az":95533,"./az.js":95533,"./be":28959,"./be.js":28959,"./bg":47777,"./bg.js":47777,"./bm":54903,"./bm.js":54903,"./bn":61290,"./bn-bd":17357,"./bn-bd.js":17357,"./bn.js":61290,"./bo":31545,"./bo.js":31545,"./br":11470,"./br.js":11470,"./bs":44429,"./bs.js":44429,"./ca":7306,"./ca.js":7306,"./cs":56464,"./cs.js":56464,"./cv":73635,"./cv.js":73635,"./cy":64226,"./cy.js":64226,"./da":93601,"./da.js":93601,"./de":77853,"./de-at":26111,"./de-at.js":26111,"./de-ch":54697,"./de-ch.js":54697,"./de.js":77853,"./dv":60708,"./dv.js":60708,"./el":54691,"./el.js":54691,"./en-au":53872,"./en-au.js":53872,"./en-ca":28298,"./en-ca.js":28298,"./en-gb":56195,"./en-gb.js":56195,"./en-ie":66584,"./en-ie.js":66584,"./en-il":65543,"./en-il.js":65543,"./en-in":9033,"./en-in.js":9033,"./en-nz":79402,"./en-nz.js":79402,"./en-sg":43004,"./en-sg.js":43004,"./eo":32934,"./eo.js":32934,"./es":97650,"./es-do":20838,"./es-do.js":20838,"./es-mx":17730,"./es-mx.js":17730,"./es-us":56575,"./es-us.js":56575,"./es.js":97650,"./et":3035,"./et.js":3035,"./eu":3508,"./eu.js":3508,"./fa":119,"./fa.js":119,"./fi":90527,"./fi.js":90527,"./fil":95995,"./fil.js":95995,"./fo":52477,"./fo.js":52477,"./fr":85498,"./fr-ca":26435,"./fr-ca.js":26435,"./fr-ch":37892,"./fr-ch.js":37892,"./fr.js":85498,"./fy":37071,"./fy.js":37071,"./ga":41734,"./ga.js":41734,"./gd":70217,"./gd.js":70217,"./gl":77329,"./gl.js":77329,"./gom-deva":32124,"./gom-deva.js":32124,"./gom-latn":93383,"./gom-latn.js":93383,"./gu":95050,"./gu.js":95050,"./he":11713,"./he.js":11713,"./hi":43861,"./hi.js":43861,"./hr":26308,"./hr.js":26308,"./hu":90609,"./hu.js":90609,"./hy-am":17160,"./hy-am.js":17160,"./id":74063,"./id.js":74063,"./is":89374,"./is.js":89374,"./it":88383,"./it-ch":21827,"./it-ch.js":21827,"./it.js":88383,"./ja":23827,"./ja.js":23827,"./jv":89722,"./jv.js":89722,"./ka":41794,"./ka.js":41794,"./kk":27088,"./kk.js":27088,"./km":96870,"./km.js":96870,"./kn":84451,"./kn.js":84451,"./ko":63164,"./ko.js":63164,"./ku":98174,"./ku-kmr":6181,"./ku-kmr.js":6181,"./ku.js":98174,"./ky":78474,"./ky.js":78474,"./lb":79680,"./lb.js":79680,"./lo":15867,"./lo.js":15867,"./lt":45766,"./lt.js":45766,"./lv":69532,"./lv.js":69532,"./me":58076,"./me.js":58076,"./mi":41848,"./mi.js":41848,"./mk":30306,"./mk.js":30306,"./ml":73739,"./ml.js":73739,"./mn":99053,"./mn.js":99053,"./mr":86169,"./mr.js":86169,"./ms":73386,"./ms-my":92297,"./ms-my.js":92297,"./ms.js":73386,"./mt":77075,"./mt.js":77075,"./my":72264,"./my.js":72264,"./nb":22274,"./nb.js":22274,"./ne":8235,"./ne.js":8235,"./nl":92572,"./nl-be":43784,"./nl-be.js":43784,"./nl.js":92572,"./nn":54566,"./nn.js":54566,"./oc-lnc":69330,"./oc-lnc.js":69330,"./pa-in":29849,"./pa-in.js":29849,"./pl":94418,"./pl.js":94418,"./pt":79834,"./pt-br":48303,"./pt-br.js":48303,"./pt.js":79834,"./ro":24457,"./ro.js":24457,"./ru":82271,"./ru.js":82271,"./sd":1221,"./sd.js":1221,"./se":33478,"./se.js":33478,"./si":17538,"./si.js":17538,"./sk":5784,"./sk.js":5784,"./sl":46637,"./sl.js":46637,"./sq":86794,"./sq.js":86794,"./sr":45719,"./sr-cyrl":3322,"./sr-cyrl.js":3322,"./sr.js":45719,"./ss":56e3,"./ss.js":56e3,"./sv":41011,"./sv.js":41011,"./sw":40748,"./sw.js":40748,"./ta":11025,"./ta.js":11025,"./te":11885,"./te.js":11885,"./tet":28861,"./tet.js":28861,"./tg":86571,"./tg.js":86571,"./th":55802,"./th.js":55802,"./tk":59527,"./tk.js":59527,"./tl-ph":29231,"./tl-ph.js":29231,"./tlh":31052,"./tlh.js":31052,"./tr":85096,"./tr.js":85096,"./tzl":79846,"./tzl.js":79846,"./tzm":81765,"./tzm-latn":97711,"./tzm-latn.js":97711,"./tzm.js":81765,"./ug-cn":48414,"./ug-cn.js":48414,"./uk":16618,"./uk.js":16618,"./ur":57777,"./ur.js":57777,"./uz":57609,"./uz-latn":72475,"./uz-latn.js":72475,"./uz.js":57609,"./vi":21135,"./vi.js":21135,"./x-pseudo":64051,"./x-pseudo.js":64051,"./yo":82218,"./yo.js":82218,"./zh-cn":52648,"./zh-cn.js":52648,"./zh-hk":1632,"./zh-hk.js":1632,"./zh-mo":31541,"./zh-mo.js":31541,"./zh-tw":50304,"./zh-tw.js":50304};function s(t){return Promise.resolve().then((function(){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}var s=n[t];return i.t(s,23)}))}s.keys=function(){return Object.keys(n)},s.id=90952,t.exports=s},13390:function(t,e,i){"use strict";t.exports=i.p+"static/assets/images/no-product-image-15fcfa4a830b4e78c96d.png"}}]);
//# sourceMappingURL=611-3bcdb5a6f6c11bcde451.js.map